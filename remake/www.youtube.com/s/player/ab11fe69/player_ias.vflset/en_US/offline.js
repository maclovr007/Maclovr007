(function(g){var window=this;'use strict';var ozV=function(c){var A=new g.Tq("und",new g.kc("Default","und",!0));A.captionTracks=c.captionTracks;return A},uuw=function(c){return new g.GS(function(A,J){var q=c.length,Y=[];
if(q)for(var p=function(T,R){q--;Y[T]=R;q==0&&A(Y)},m=function(T){J(T)},E,O=0;O<c.length;O++)E=c[O],g.Kmc(E,g.jN(p,O),m);
else A(Y)})},zT=function(c){this.C=c},Sm=function(){zT.apply(this,arguments)},$IV=function(){Sm.apply(this,arguments)},w3R=function(){Sm.apply(this,arguments)},WBJ=function(){Sm.apply(this,arguments)},LBN=function(){Sm.apply(this,arguments)},GxH=function(){Sm.apply(this,arguments)},CkC=function(){Sm.apply(this,arguments)},MkV=function(){zT.apply(this,arguments)},FBN=function(){Sm.apply(this,arguments)},vzC=function(){Sm.apply(this,arguments)},Qve=function(){Sm.apply(this,arguments)},X3M=function(){Sm.apply(this,
arguments)},ZOx=function(){Sm.apply(this,arguments)},I2r=function(){Sm.apply(this,arguments)},zKw=function(){Sm.apply(this,arguments)},Sex=function(){Sm.apply(this,arguments)},xIr=function(){Sm.apply(this,arguments)},Pki=function(){Sm.apply(this,arguments)},svH=function(){Sm.apply(this,arguments)},UIr=function(){Sm.apply(this,arguments)},f2J=function(){zT.apply(this,arguments)},l2J=function(){Sm.apply(this,arguments)},a2H=function(){Sm.apply(this,arguments)},bOi=function(){Sm.apply(this,arguments)},
tkx=function(){Sm.apply(this,arguments)},iOx=function(){Sm.apply(this,arguments)},yGi=function(){Sm.apply(this,arguments)},eKV=function(){Sm.apply(this,arguments)},nzw=function(){Sm.apply(this,arguments)},KBV=function(){Sm.apply(this,arguments)},hK9=function(){zT.apply(this,arguments)},BjN=function(){zT.apply(this,arguments)},cE9=function(){zT.apply(this,arguments)},AER=function(){Sm.apply(this,arguments)},JEw=function(){Sm.apply(this,arguments)},q1N=function(){Sm.apply(this,arguments)},Y1N=function(){Sm.apply(this,
arguments)},puJ=function(){Sm.apply(this,arguments)},meN=function(){Sm.apply(this,arguments)},jKx=function(){Sm.apply(this,arguments)},deC=function(){Sm.apply(this,arguments)},E4w=function(){Sm.apply(this,arguments)},OAJ=function(){Sm.apply(this,arguments)},Toe=function(){Sm.apply(this,arguments)},RAM=function(){Sm.apply(this,arguments)},rEM=function(){Sm.apply(this,arguments)},HAH=function(){Sm.apply(this,arguments)},V$J=function(){Sm.apply(this,arguments)},Noi=function(){Sm.apply(this,arguments)},
Dew=function(){Sm.apply(this,arguments)},ko9=function(){Sm.apply(this,arguments)},g4J=function(){Sm.apply(this,arguments)},o4M=function(){Sm.apply(this,arguments)},u_H=function(){Sm.apply(this,arguments)},$eN=function(){Sm.apply(this,arguments)},wuC=function(){Sm.apply(this,arguments)},W$J=function(){Sm.apply(this,arguments)},L$H=function(){Sm.apply(this,arguments)},GoV=function(){Sm.apply(this,arguments)},CuO=function(){zT.apply(this,arguments)},M$r=function(){Sm.apply(this,arguments)},F$C=function(){Sm.apply(this,
arguments)},v4C=function(){Sm.apply(this,arguments)},QKC=function(){Sm.apply(this,arguments)},XuJ=function(){Sm.apply(this,arguments)},ZAR=function(){Sm.apply(this,arguments)},IVO=function(){Sm.apply(this,arguments)},zAH=function(){Sm.apply(this,arguments)},S1V=function(){Sm.apply(this,arguments)},xe9=function(){Sm.apply(this,arguments)},Pui=function(){Sm.apply(this,arguments)},sKe=function(){Sm.apply(this,arguments)},UeJ=function(){Sm.apply(this,arguments)},fVV=function(){Sm.apply(this,arguments)},
lVO=function(){Sm.apply(this,arguments)},aVV=function(){Sm.apply(this,arguments)},bAi=function(){Sm.apply(this,arguments)},t$w=function(){Sm.apply(this,arguments)},iAO=function(){Sm.apply(this,arguments)},yEH=function(){Sm.apply(this,arguments)},eAr=function(){Sm.apply(this,arguments)},n4H=function(){Sm.apply(this,arguments)},K$J=function(){Sm.apply(this,arguments)},hAR=function(){Sm.apply(this,arguments)},BoH=function(){Sm.apply(this,arguments)},crR=function(){Sm.apply(this,arguments)},Arw=function(){Sm.apply(this,
arguments)},JrO=function(){Sm.apply(this,arguments)},q49=function(){Sm.apply(this,arguments)},Y4i=function(){Sm.apply(this,arguments)},pVV=function(){Sm.apply(this,arguments)},m_e=function(){Sm.apply(this,arguments)},jEH=function(c){c=c.key||c.id;
if(!c)throw Error("Entity key is missing");return c},d_V=function(){if(xa)return xa();
var c={};xa=g.AR("PersistentEntityStoreDb",{Wj:(c.EntityStore={Dv:1},c.EntityAssociationStore={Dv:2},c),shared:!1,upgrade:function(A,J){J(1)&&g.Sp(g.vm(A,"EntityStore",{keyPath:"key"}),"entityType","entityType");J(2)&&(A=g.vm(A,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Sp(A,"byParentEntityKey","parentEntityKey"),g.Sp(A,"byChildEntityKey","childEntityKey"))},
version:3});return xa()},EJV=function(c){return g.bQ(d_V(),c)},OPH=function(c){return g.bQ((0,g.yvM)(),c)},PU=function(c){this.token=c},si=function(c,A){A=A===void 0?{}:A;
g.eq.call(this,g.emM[c],Object.assign({},{name:"PESEncoderError",type:c},A));this.type=c;this.level="WARNING";Object.setPrototypeOf(this,si.prototype)},T$w=function(c){return new si("WRONG_DATA_TYPE",{eQ:c})},RbC=function(c){return c instanceof Error?new si("UNKNOWN_ENCODE_ERROR",{originalMessage:c.message}):new si("UNKNOWN_ENCODE_ERROR")},rrr=function(c){return c instanceof Error?new si("UNKNOWN_DECODE_ERROR",{originalMessage:c.message}):new si("UNKNOWN_DECODE_ERROR")},HPw=function(c,A){c=c instanceof
si?c:A(c);
g.zg(c);throw c;},VrM=function(){},N$O=function(c,A,J){try{return c.j(A,J)}catch(q){HPw(q,RbC)}},D_O=function(c){c=(new TextEncoder).encode(c).subarray(0,16);
var A=new Uint8Array(16);A.set(c);return A},Ui=function(c){this.C=c},gJx=function(c){var A=kSJ[c];
if(A)return A;g.Sv(new g.eq("Entity model not found.",{entityType:c}))},oJN=function(c,A){this.C=c;
this.K=A;this.j={}},$_V=function(c,A){a:{c=uNw(c.K,A.version);
try{var J=c.K(A.data,A.key);break a}catch(q){HPw(q,rrr)}J=void 0}return J},f8=function(c,A,J){return c.C.objectStore("EntityStore").get(A).then(function(q){if(q){if(J&&q.entityType!==J)throw Error("Incorrect entity type");
return $_V(c,q)}})},lq=function(c,A,J){return J?(J=J.map(function(q){return f8(c,q,A)}),g.Lh.all(J)):c.C.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(A)).then(function(q){return q.map(function(Y){return $_V(c,Y)})})},bq=function(c,A,J){var q=jEH(A),Y=uNw(c.K,1),p=Object.assign({},A);
return c.C.objectStore("EntityStore").get(q).then(function(m){if(m){if(m.entityType!==J)throw Error("Incorrect entity type");p.entityMetadata||(m=$_V(c,m),p.entityMetadata=m.entityMetadata)}}).then(function(){var m={key:q,
entityType:J,data:N$O(Y,p,q),version:1};return g.Lh.all([g.ZR(c.C.objectStore("EntityStore"),m),wVr(c,p,J)])}).then(function(){a_(c,q,J);
return q})},WUr=function(c,A,J){A=A.map(function(q){return bq(c,q,J)});
return g.Lh.all(A)},tK=function(c,A,J){if(J==null?0:J.aH){var q=new Set;
return LU9(c,A,q).then(function(){for(var p=[],m=g.u(q),E=m.next();!E.done;E=m.next())p.push(tK(c,E.value));return g.Lh.all(p).then(function(){})})}var Y=g.c5(A).entityType;
return g.Lh.all([c.C.objectStore("EntityStore").delete(A),GSO(c,A)]).then(function(){a_(c,A,Y)})},Cyr=function(c,A){return g.UI(c.C.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(A)},function(J){return g.Lh.all([J.delete(),
GSO(c,J.cursor.primaryKey)]).then(function(){a_(c,J.cursor.primaryKey,A);return g.Pm(J)})})},MrR=function(c,A,J,q){var Y=uNw(c.K,1);
return f8(c,A,q).then(function(p){if(p){p=g.gr(p,J);var m={key:A,entityType:q,data:N$O(Y,p,A),version:1};return g.Lh.all([g.ZR(c.C.objectStore("EntityStore"),m),wVr(c,p,q)])}}).then(function(){a_(c,A,q);
return A})},a_=function(c,A,J){var q=c.j[J];
q||(q=new Set,c.j[J]=q);q.add(A)},FUJ=function(c,A,J){var q=jEH(A);
J=gJx(J);if(!J)return g.Lh.resolve([]);J=new J(A);c=c.C.objectStore("EntityAssociationStore");A=[];J=g.u(J.K());for(var Y=J.next();!Y.done;Y=J.next())A.push(g.ZR(c,{parentEntityKey:q,childEntityKey:Y.value}));return g.Lh.all(A).then(function(p){return p.map(function(m){return m[1]})})},GSO=function(c,A){return c.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(A))},wVr=function(c,A,J){var q=jEH(A);
return GSO(c,q).then(function(){return FUJ(c,A,J)})},LU9=function(c,A,J){if(J.has(A))return g.Lh.resolve(void 0);
J.add(A);return vJi(c,A).then(function(q){return c.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(A)).then(function(){return q})}).then(function(q){var Y=g.Lh.resolve(void 0);
q=g.u(q);for(var p=q.next(),m={};!p.done;m={gG:void 0},p=q.next())m.gG=p.value,Y=Y.then(function(E){return function(){return LU9(c,E.gG,J)}}(m));
return Y}).then(function(){})},vJi=function(c,A){var J=c.C.objectStore("EntityAssociationStore");
return J.index("byParentEntityKey").getAll(IDBKeyRange.only(A)).then(function(q){var Y=[];q=g.u(q);for(var p=q.next();!p.done;p=q.next())p=p.value,Y.push(J.index("byChildEntityKey").getAll(p.childEntityKey));return g.Lh.all(Y)}).then(function(q){var Y=[];
q=g.u(q);for(var p=q.next();!p.done;p=q.next())p=p.value,p.length===1&&Y.push(p[0].childEntityKey);return Y})},iq=function(){},QEO=function(){this.C={};
this.C[0]=new iq;if(!g.$h("aes_pes_encoder_killswitch")){var c=this.C;try{var A=g.nX();var J=D_O(A);var q=new Ui(new g.GE(J),new g.L7(J))}catch(Y){throw c=Y instanceof Error?new si("KEY_CREATION_FAILED",{originalMessage:Y.message}):new si("KEY_CREATION_FAILED"),g.zg(c),c;}c[1]=q}},uNw=function(c,A){A=A===void 0?0:A;
c=c.C[A];if(!c)throw A=new si("INVALID_ENCODER_VERSION",{eQ:A}),g.zg(A),A;return c},yh=function(c,A){g.P.call(this);
this.token=c;this.C=A;this.observers=[];c=new g.e1.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.nX());c.onmessage=this.K.bind(this);this.channel=c},em=function(c,A,J){var q,Y,p,m;
return g.S(function(E){if(E.K==1)return g.X(E,EJV(c.token),2);if(E.K!=3)return q=E.C,g.X(E,g.XK(q,["EntityStore","EntityAssociationStore"],A,function(O){Y=new oJN(O,c.C);return J(Y)}),3);
p=E.C;Y&&(m=Y.j,Object.keys(m).length>0&&(c.channel.postMessage(m),XVx(c,m)));return E.return(p)})},n8=function(c,A,J){return em(c,{mode:"readwrite",
Hf:!0},function(q){return bq(q,A,J)})},ZPJ=function(c,A){return em(c,{mode:"readwrite",
Hf:!0},function(J){return WUr(J,A,"offlineOrchestrationActionWrapperEntity")})},IkH=function(c,A){return em(c,{mode:"readwrite",
Hf:!0},function(J){return tK(J,A)})},zb9=function(c){return em(c,{mode:"readwrite",
Hf:!0},function(A){return Cyr(A,"videoPlaybackPositionEntity")})},K8=function(c,A,J){return em(c,{mode:"readonly",
Hf:!0},function(q){return f8(q,A,J)})},hK=function(c,A,J){return em(c,{mode:"readonly",
Hf:!0},function(q){return lq(q,A,J)})},XVx=function(c,A){c=g.u(c.observers);
for(var J=c.next();!J.done;J=c.next())J=J.value,J(A)},S4i=function(){var c,A,J;
return g.S(function(q){if(q.K==1)return g.$I(q,2),g.X(q,g.Bm(),4);if(q.K!=2){c=q.C;if(!c||!g.KX()||typeof g.e1.BroadcastChannel==="undefined")return q.return();A=new QEO;return q.return(new yh(c,A))}J=g.F$(q);J instanceof Error&&g.zg(J);return q.return()})},BU=function(){x_i||(x_i=S4i());
return x_i},Pyi=function(c){var A;
c=(A=c.options)==null?void 0:A.persistenceOption;return c==="ENTITY_PERSISTENCE_OPTION_PERSIST"||c==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},sEr=function(c){var A;
return g.S(function(J){return J.K==1?g.X(J,BU(),2):(A=J.C)?g.X(J,em(A,"readwrite",function(q){for(var Y={},p=g.u(c),m=p.next(),E={};!m.done;E={kd:void 0,rM:void 0},m=p.next())E.kd=m.value,E.kd.entityKey&&Pyi(E.kd)&&(E.rM=g.iC(E.kd.payload),m=void 0,E.kd.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(m=function(O){return function(){return bq(q,O.kd.payload[O.rM],O.rM)}}(E)),E.kd.type==="ENTITY_MUTATION_TYPE_DELETE"&&(m=function(O){return function(){return tK(q,O.kd.entityKey)}}(E)),E.kd.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(m=function(O){return function(){return MrR(q,O.kd.entityKey,O.kd.payload[O.rM],O.rM)}}(E)),m&&(Y[E.kd.entityKey]=Y[E.kd.entityKey]?Y[E.kd.entityKey].then(m):m()));
return g.Lh.all(Object.values(Y))}),0):J.return()})},U_C=function(c){var A;
return g.S(function(J){if(J.K==1){A=c.mutations;if(!A||A.length<=0)return J.return();if(g.pN){var q={type:"ENTITY_LOADED"};A!==void 0&&(q.payload=A);g.pN.dispatch(q)}return g.X(J,sEr(A),2)}A.length=0;g.u$(J)})},fkO=function(c){return c!==void 0},lkH=function(c){var A=g.XL();
A=Object.assign({},A);c=Object.assign({},c);for(var J in A)c[J]?(A[J]!==4&&(A[J]=c[J]),delete c[J]):A[J]!==2&&(A[J]=4);Object.assign(A,c);g.V01(A);JSON.stringify(A);return A},ak9=function(c){var A,J;
return g.S(function(q){if(q.K==1)return g.X(q,g.Bm(),2);if(q.K!=3)return(A=q.C)?g.X(q,g.zN(A),3):q.return();J=q.C;return q.return(g.XK(J,["index","media","captions"],{mode:"readwrite",Hf:!0},function(Y){var p=IDBKeyRange.bound(c+"|",c+"~");Y=[Y.objectStore("index").delete(p),Y.objectStore("media").delete(p),Y.objectStore("captions").delete(p)];return g.Lh.all(Y).then(function(){})}))})},bPM=function(){var c,A;
return g.S(function(J){if(J.K==1)return g.X(J,g.Bm(),2);if(J.K!=3){c=J.C;if(!c)throw g.wQ("rvdfd");return g.X(J,g.zN(c),3)}A=J.C;return J.return(g.XK(A,["index","media"],{mode:"readwrite",Hf:!0},function(q){var Y={};return g.xf(q.objectStore("index"),{},function(p){var m=p.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),E=g.Lh.resolve(void 0);if(m){var O=m[1];m=m[2];Y[O]=Y[O]||{};var T;Y[O][m]=g.ona((T=p.getValue())==null?void 0:T.fmts)}else E=p.delete().then(function(){});
return g.Lh.all([g.Pm(p),E]).then(function(R){return g.u(R).next().value})}).then(function(){for(var p={},m=g.u(Object.keys(Y)),E=m.next();!E.done;E=m.next()){E=E.value;
var O=Y[E].v;p[E]=Y[E].a&&O?1:2}var T=lkH(p);return g.Qfc(q.objectStore("media"),{},function(R){var r=R.cursor.key.match(g.W_M);r&&p[r[1]]||q.objectStore("media").delete(R.cursor.key);return g.$mc(R)}).then(function(){return T})})}))})},tri=function(c,A){var J,q;
return g.S(function(Y){if(Y.K==1)return g.X(Y,g.Bm(),2);if(Y.K!=3){J=Y.C;if(!J)throw g.wQ("wct");return g.X(Y,g.zN(J),3)}q=Y.C;return g.X(Y,g.XK(q,["captions"],{mode:"readwrite",Hf:!0},function(p){var m=[];p=p.objectStore("captions");for(var E=0;E<A.length;E++){var O=g.ZR(p,A[E],c+"|"+A[E].metadata.vss_id);m.push(O)}return g.Lh.all(m)}),0)})},iPM=function(c){var A,J,q;
return g.S(function(Y){if(Y.K==1)return A=IDBKeyRange.bound(c+"|",c+"~"),g.X(Y,g.Bm(),2);if(Y.K!=3){J=Y.C;if(!J)throw g.wQ("gactfv");return g.X(Y,g.zN(J),3)}q=Y.C;return Y.return(q.getAll("captions",A))})},yrR=function(c){return g.S(function(A){g.Ij(c,0);
return A.return(ak9(c))})},eb9=function(c){return{context:g.Aw(),
videoIds:c}},nJe=function(c){return{context:g.Aw(),
playlistIds:c}},KUi=function(c){return{context:g.Aw(),
offlinePlaylistSyncChecks:c}},hbJ=function(){this.C=new Map},cyr=function(){B$C||(B$C=new hbJ);
return B$C},Ayr=function(c,A){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:c},metadata:A,statusCode:void 0,csn:void 0,can:void 0}},JyR=function(c,A,J){if(!J){var q=q===void 0?!1:q;
J=c.C.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!J||q)J=g.WA(16),c.C.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",J)}c={flowNonce:J,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:A.eventType};A.metadata&&(c.flowMetadata=A.metadata);A.statusCode!==void 0&&(c.flowEventStatus=A.statusCode);A.csn&&(c.csn=A.csn);A.can&&(c.can=A.can);g.TI("flowEvent",c,void 0)},qoH=function(c){var A,J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI,cw,EL,h,wa,M8,b$,Gw,OO,vw,CI,mM,L,da,eN,WL;
return g.S(function(vr){if(vr.K==1)return g.X(vr,em(c,{mode:"readonly",Hf:!0},function(Dx){return lq(Dx,"playbackData").then(function(fI){var xH=fI.map(function(Q){return Q.transfer}).filter(function(Q){return!!Q}),QJ=fI.map(function(Q){return Q.offlineVideoPolicy}).filter(function(Q){return!!Q}),F=fI.filter(function(Q){return!!Q.key}).map(function(Q){return g.A5(g.c5(Q.key).entityId,"downloadStatusEntity")});
xH=lq(Dx,"transfer",xH);QJ=lq(Dx,"offlineVideoPolicy",QJ);F=lq(Dx,"downloadStatusEntity",F);var v=xH.then(function(Q){Q=Q.reduce(function(z,a){(a==null?0:a.offlineVideoStreams)&&z.push.apply(z,g.M(a.offlineVideoStreams));return z},[]).filter(function(z){return!!z});
return lq(Dx,"offlineVideoStreams",Q)});
return g.Lh.all([xH,QJ,v,F]).then(function(Q){var z=g.u(Q);Q=z.next().value;var a=z.next().value;var LI=z.next().value;z=z.next().value;return[fI,Q,a,LI,z]})})}),2);
if(vr.K!=3)return A=vr.C,g.X(vr,em(c,{mode:"readonly",Hf:!0},function(Dx){return lq(Dx,"mainDownloadsListEntity").then(function(fI){var xH,QJ;return(QJ=(xH=fI[0])==null?void 0:xH.downloads)!=null?QJ:[]})}),3);
J=vr.C;q=g.u(A);Y=q.next().value;p=q.next().value;m=q.next().value;E=q.next().value;O=q.next().value;T=Y;R=p;r=m;H=E;V=O;N={};w={};W={};C={};G={};Z=[];I=g.u(R);for(f=I.next();!f.done;f=I.next())(K=f.value)&&(N[K.key]=K);y=g.u(r);for(q8=y.next();!q8.done;q8=y.next())(pI=q8.value)&&(w[pI.key]=pI);cw=g.u(V);for(EL=cw.next();!EL.done;EL=cw.next())(h=EL.value)&&(W[h.key]=h);wa=g.u(H);for(M8=wa.next();!M8.done;M8=wa.next())(b$=M8.value)&&(C[b$.key]=b$);Gw=g.u(J);for(OO=Gw.next();!OO.done;OO=Gw.next())vw=
OO.value,CI=void 0,G[(CI=vw.videoItem)!=null?CI:""]=!0,vw.videoItem&&(L=mM=void 0,da=(L=(mM=g.c5(vw.videoItem))==null?void 0:mM.entityId)!=null?L:"",Z.push({externalVideoId:da}));eN=T.filter(function(Dx){if(!Dx||!Dx.key||!Dx.offlineVideoPolicy)return!1;Dx=g.c5(Dx.key).entityId;Dx=g.A5(Dx,"downloadStatusEntity");var fI;return!(Dx&&((fI=W[Dx])==null?void 0:fI.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
WL=eN.map(function(Dx){var fI=N[Dx.transfer],xH=[];if(fI==null?0:fI.offlineVideoStreams)for(var QJ=g.u(fI.offlineVideoStreams),F=QJ.next();!F.done;F=QJ.next())(F=C[F.value])&&xH.push(F);QJ=w[Dx.offlineVideoPolicy];F=G;var v=Dx==null?void 0:Dx.playerResponseTimestamp,Q=g.c5(QJ.key).entityId;Dx=g.A5(Q,"mainVideoEntity");if(QJ.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var z="OFFLINE_VIDEO_STATE_DISABLED";QJ.expirationTimestamp&&Number(QJ.expirationTimestamp)<Date.now()/1E3&&(z="OFFLINE_VIDEO_STATE_EXPIRED")}else if(QJ.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")z="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(fI==null?void 0:fI.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":z="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":z="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":z="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":z="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":z="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":z="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:z="OFFLINE_VIDEO_STATE_UNKNOWN"}if(z==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(fI==null?void 0:fI.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":z="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":z="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":z=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Q={id:Q,videoState:z};if(fI==null?0:fI.cotn)Q.cotn=fI.cotn;if(fI==null?0:fI.maximumDownloadQuality)Q.selectedVideoQuality=fI==null?void 0:fI.maximumDownloadQuality;if(fI==null?0:fI.lastProgressTimeMs)Q.lastProgressTimeMs=fI.lastProgressTimeMs;v&&(Q.playerResponseSavedTimeMs=String(Number(v)*1E3));fI=String;v=0;xH=g.u(xH);for(z=xH.next();!z.done;z=xH.next())if(z=z.value,z.streamsProgress){z=g.u(z.streamsProgress);for(var a=z.next();!a.done;a=z.next()){var LI=void 0;
v+=Number((LI=a.value.numBytesDownloaded)!=null?LI:0)}}Q.downloadedBytes=fI(v);Q.selectedOfflineMode=F[Dx]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";QJ.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Q.offlinePlaybackDisabledReason=QJ.offlinePlaybackDisabledReason);return Q});
return vr.return({offlineVideos:WL,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:Z}}})})},Yoi=function(){this.locks=navigator.locks},poR=function(){try{var c=g.KI("ytglobal.locks_");
if(c)return c;var A;if(A=navigator){var J=navigator;A="locks"in J&&!!J.locks}if(A)return g.e1.localStorage&&g.e1.localStorage.getItem("noop"),c=new Yoi,g.nI("ytglobal.locks_",c),c}catch(q){}},ck=function(){},m$M=function(){},jce=function(c){if(c.includes(":"))throw Error("Invalid user cache name: "+c);
return c+":"+g.nX("CacheStorage get")},d$M=function(){return g.S(function(c){if(An!==void 0)return c.return(An);
An=new Promise(function(A){var J;return g.S(function(q){switch(q.K){case 1:return g.$I(q,2),g.X(q,Jn.open("test-only"),4);case 4:return g.X(q,Jn.delete("test-only"),5);case 5:g.GW(q,3);break;case 2:if(J=g.F$(q),J instanceof Error&&J.name==="SecurityError")return A(!1),q.return();case 3:A("caches"in window),g.u$(q)}})});
return c.return(An)})},OGC=function(){return g.S(function(c){if(c.K==1)return g.X(c,d$M(),2);
if(!c.C)return c.return(void 0);EGi||(EGi=new m$M);return c.return(EGi)})},qi=function(c,A,J){g.Sv(new g.eq("Woffle: "+c,J?{cotn:J}:""));
A instanceof Error&&g.Sv(A)},TWH=function(c){var A;
return g.S(function(J){if(J.K==1)return g.X(J,qoH(c),2);A=J.C;g.TI("offlineStateSnapshot",A);g.u$(J)})},pS=function(c){g.P.call(this);
var A=this;this.api=c;this.lr={Gpx:function(){return A.C},
jIP:function(){return A.K}};
typeof g.e1.BroadcastChannel!=="undefined"&&(this.C=new g.e1.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.nX()),this.C.onmessage=this.j.bind(this),this.K=new g.e1.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.nX()),this.K.onmessage=this.T.bind(this))},mk=function(c,A){c.api.gF("onOfflineOperationFailure",A);
var J;(J=c.C)==null||J.postMessage(A)},RLH=function(c,A,J,q){var Y=this;
this.X=c;this.L=A;this.visibility=J;this.W=q;this.U=this.D=this.Y=this.j=this.C=!1;this.T=new g.hN(function(){Y.rb()});
this.lr={Vv:function(){return Y.K},
rb:function(){Y.rb()},
QIT:function(){return Y.T}};
this.visibility.subscribe("visibilitystatechange",function(){Y.Ac()})},ryi=function(c){if(!c.j&&!c.C){var A=poR();
if(A){c.j=!0;var J=g.nX("OfflineLockManager");A.request("woffle_orchestration_leader:"+J,{},function(){var q,Y,p,m;return g.S(function(E){switch(E.K){case 1:return g.$I(E,2),c.K=new g.Ho,c.C=!0,c.j=!1,g.X(E,c.X(),4);case 4:return g.X(E,c.K.promise,5);case 5:g.GW(E,0);break;case 2:q=g.F$(E),((p=(Y=c).W)==null?0:p.call(Y,"wo_relinquish_leadership_on_lock_request_error"))||c.rb(),q instanceof Error&&(m=q,m.args=[{name:"WoLockManagerError",yE:q.name}],g.zg(m)),g.u$(E)}})})}}},HGH=function(c){c.C&&(c.U=
!0,jc(c))},VgR=function(c,A){c.C&&(c.Y=A,jc(c))},NWR=function(c,A){c.C&&(c.D=A,jc(c))},jc=function(c){c.D&&c.Y&&c.U&&c.visibility.isBackground()?g.Ba(c.T,6E4):c.T.stop()},dx=function(c){var A;
c.offlineDeleteReason=(A=c.offlineDeleteReason)!=null?A:"OFFLINE_DELETE_REASON_UNKNOWN";var J;c.offlineModeType=(J=c.offlineModeType)!=null?J:"OFFLINE_NOW";g.TI("offlineDeleteEvent",c)},Ef=function(c,A){var J=A.videoId;
var q=A.Se;A=A.offlineModeType;c.encryptedVideoId=J;c.cotn=q==null?void 0:q.cotn;c.offlineabilityFormatType=q==null?void 0:q.maximumDownloadQuality;var Y;c.isRefresh=(Y=q==null?void 0:q.isRefresh)!=null?Y:!1;var p;c.softErrorCount=(p=q==null?void 0:q.transferRetryCount)!=null?p:0;c.offlineModeType=A!=null?A:"OFFLINE_NOW";(c.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&c.statusType==="UNKNOWN_STATUS_TYPE"||!c.transferStatusType&&!c.statusType)&&g.Sv(Error("Woffle unknown transfer status"));
g.TI("offlineTransferStatusChanged",c)},D$9=function(c){Ef({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},c)},kKC=function(c,A,J,q){q={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!q};A&&J&&(A=Math.floor(A/1024).toFixed(),J=Math.floor(J/1024).toFixed(),q.alreadyDownloadedKbytes=A,q.totalFetchedKbytes=A,q.totalContentKbytes=J);Ef(q,c)},gG9=function(c){Ef({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},c)},oGO=function(c){Ef({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},c)},uIR=function(c){switch(c){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Of=function(c){var A,J,q;
return((q=(A=c.actionMetadata)==null?void 0:(J=A.retryScheduleIntervalsInSeconds)==null?void 0:J.length)!=null?q:0)>0},TO=function(c){return c.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!c.entityKey},Ro=function(c){return c.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!c.entityKey},rx=function(c){return c.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!c.entityKey},$$H=function(c){return c.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!c.entityKey},
Hk=function(c,A,J,q,Y){Y=Y===void 0?!1:Y;
var p,m,E,O,T,R;return g.S(function(r){if(r.K==1)return p=g.A5(c,A),m=g.A5(c,"downloadStatusEntity"),g.X(r,em(J,{mode:"readonly",Hf:!0},function(H){return g.Lh.all([f8(H,p,A),f8(H,m,"downloadStatusEntity")])}),2);
E=r.C;O=E.length?E[0]:void 0;if(!O)return r.Tx(0);T=wo9;if(R=E.length>1?E[1]:void 0){if(R.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!Y)return r.return();R.downloadState=q}else R={key:m,downloadState:q};g.fK(O,T,R);return g.X(r,em(J,{mode:"readwrite",Hf:!0},function(H){return g.Lh.all([bq(H,O,A),bq(H,R,"downloadStatusEntity")])}),0)})},VG=function(c,A){return c.actionType===A.actionType&&c.entityKey===A.entityKey},Ni=function(c,A){if(c&&c.transferState!=="TRANSFER_STATE_COMPLETE"&&c.transferState!==
"TRANSFER_STATE_FAILED"){var J=g.c5(c.key).entityId;
Ef({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:J,Se:c,offlineModeType:A})}},Dt=function(c){if(!c||!c.thumbnails)return[];
var A=[];c=g.u(c.thumbnails);for(var J=c.next();!J.done;J=c.next())J=J.value,J.url&&A.push(J.url);return A},WPi=function(c,A,J){J=J===void 0?[]:J;
var q,Y,p,m,E,O,T,R,r,H,V,N,w;return g.S(function(W){if(W.K==1)return J.length?g.X(W,hK(c,A),2):W.return([]);q=W.C;Y=new Set;p=g.u(q);for(m=p.next();!m.done;m=p.next())if(E=m.value,O=E.id||E.key)T=g.c5(O).entityId,Y.add(T);R=[];r=g.u(J);for(H=r.next();!H.done;H=r.next())V=H.value,N=V.offlineVideoData,w=void 0,((w=N)==null?0:w.videoId)&&!Y.has(N.videoId)&&R.push(V);return W.return(R)})},LPr=function(c,A,J){return new g.ym(c,{cotn:A,
raw_player_response:J,download_media:!0,start:Infinity,disable_watch_next:!0})},GKH=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},kT=function(c,A,J,q,Y,p,m,E,O,T,R){this.entityType=c;
this.actionId=A;this.action=J;this.parentActionId=q;this.rootActionId=Y===void 0?A:Y;this.childActionIds=p;this.prereqActionId=m;this.postreqActionIds=E;this.hasChildActionFailed=T;this.retryScheduleIndex=0;this.C=R||Date.now();this.retryScheduleIndex=O||0},gx=function(c){if(!c.key)throw Error("Entity key is required.");
if(!c.actionProto)throw Error("OfflineOrchestrationAction is required.");var A=g.c5(c.key),J=g.c5(c.actionProto.entityKey);return new kT(J.entityType,A.entityId,c.actionProto,c.parentActionId,c.rootActionId,c.childActionIds,c.prereqActionId,c.postreqActionIds,c.retryScheduleIndex,c.hasChildActionFailed,Number(c.enqueueTimeSec)*1E3)},oo=function(c){return{key:g.A5(c.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:c.action,parentActionId:c.parentActionId,rootActionId:c.rootActionId,childActionIds:c.childActionIds,prereqActionId:c.prereqActionId,postreqActionIds:c.postreqActionIds,retryScheduleIndex:c.retryScheduleIndex,hasChildActionFailed:c.hasChildActionFailed,enqueueTimeSec:(c.C/1E3).toFixed()}},CtJ=function(){var c;
return g.S(function(A){return A.K==1?g.X(A,OGC(),2):(c=A.C)?A.return(c.delete("yt-player-local-img")):A.return(!0)})},uX=function(c){var A,J;
return g.S(function(q){if(q.K==1)return g.X(q,OGC(),2);if(q.K!=3){A=q.C;if(!A)throw Error("Cache API not supported");return c.length?g.X(q,A.open("yt-player-local-img"),3):q.return()}J=q.C;return g.X(q,Promise.all(c.map(function(Y){return J.delete(Y)})),0)})},$T=function(c){var A,J;
return g.S(function(q){if(q.K==1)return g.X(q,OGC(),2);if(q.K!=3){A=q.C;if(!A)throw Error("Cache API not supported");return c.length?g.X(q,A.open("yt-player-local-img"),3):q.return()}J=q.C;return g.X(q,J.addAll(c),0)})},wx=function(c,A,J,q,Y){var p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI,cw,EL,h,wa,M8,b$,Gw,OO,vw,CI;
return g.S(function(mM){switch(mM.K){case 1:return p=g.A5(c,"mainVideoEntity"),m=g.A5(c,"ytMainChannelEntity"),E=g.A5(c,"transfer"),O=g.A5(c,"videoDownloadContextEntity"),g.X(mM,em(A,{mode:"readonly",Hf:!0},function(L){return g.Lh.all([f8(L,p,"mainVideoEntity"),f8(L,m,"ytMainChannelEntity"),f8(L,E,"transfer"),f8(L,O,"videoDownloadContextEntity"),lq(L,"ytMainChannelEntity"),lq(L,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:T=mM.C;R=g.u(T);r=R.next().value;H=R.next().value;V=R.next().value;N=R.next().value;w=R.next().value;W=R.next().value;C=r;G=H;Z=V;I=N;f=w;K=W;if(!C&&!G){mM.Tx(3);break}y=C?Dt(C.thumbnail):[];if(!G){q8=[];mM.Tx(4);break}return g.X(mM,MgV(G,f),5);case 5:q8=mM.C;case 4:return pI=q8,g.X(mM,uX(y.concat(pI)),3);case 3:cw=[];EL=g.A5(c,"downloadStatusEntity");h=g.u(K);for(wa=h.next();!wa.done;wa=h.next())M8=wa.value,b$=g.c5(M8.key).entityId,Gw=gx(M8),OO=g.c5(Gw.action.entityKey).entityId,b$!==c&&OO!==
c||VG(J,M8.actionProto)||cw.push(M8.key);return g.X(mM,em(A,{mode:"readwrite",Hf:!0},function(L){var da=cw.map(function(eN){return tK(L,eN)});
da.push(tK(L,p,{aH:!0}));da.push(tK(L,EL,{aH:!0}));return g.Lh.all(da)}),7);
case 7:CI=(vw=I)==null?void 0:vw.offlineModeType,Y&&(dx(Y),Y.offlineModeType&&(CI=Y.offlineModeType)),Ni(Z,CI),mk(q,{entityKey:p,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.u$(mM)}})},Qcw=function(c,A,J,q){var Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI,cw,EL,h,wa,M8,b$,Gw,OO,vw,CI,mM,L,da,eN,WL,vr,Dx,fI,xH,QJ,F,v,Q,z,a,LI,Jd,kI;
return g.S(function(YI){switch(YI.K){case 1:return Y=g.A5(c,"mainPlaylistEntity"),p=g.A5(c,"ytMainChannelEntity"),g.X(YI,em(A,{mode:"readonly",Hf:!0},function(X$){return g.Lh.all([f8(X$,Y,"mainPlaylistEntity"),f8(X$,p,"ytMainChannelEntity"),lq(X$,"mainPlaylistEntity"),lq(X$,"mainDownloadsListEntity"),lq(X$,"ytMainChannelEntity"),lq(X$,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:m=YI.C;E=g.u(m);O=E.next().value;T=E.next().value;R=E.next().value;r=E.next().value;H=E.next().value;V=E.next().value;N=O;w=T;W=R;C=r;G=H;Z=V;if(!N&&!w){YI.Tx(3);break}I=N?FPr(N):[];if(!w){f=[];YI.Tx(4);break}return g.X(YI,MgV(w,G),5);case 5:f=YI.C;case 4:return K=f,g.X(YI,uX(I.concat(K)),3);case 3:y=[];q8=new Map;if(!N){YI.Tx(7);break}return g.X(YI,vGN(N,W,C),8);case 8:y=YI.C;pI=g.u(y);for(cw=pI.next();!cw.done;cw=pI.next())EL=cw.value,q8.set(EL,{videoId:EL,playlistId:c,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.X(YI,em(A,{mode:"readonly",Hf:!0},function(X$){return g.Lh.all([lq(X$,"transfer"),lq(X$,"videoDownloadContextEntity")])}),9);
case 9:h=YI.C;wa=g.u(h);M8=wa.next().value;b$=wa.next().value;Gw=M8;OO=b$;vw=g.u(Gw);for(CI=vw.next();!CI.done;CI=vw.next())mM=CI.value,L=g.c5(mM.key).entityId,(da=q8.get(L))&&mM&&(da.cotn=mM.cotn);eN=g.u(OO);for(WL=eN.next();!WL.done;WL=eN.next())vr=WL.value,Dx=g.c5(vr.key).entityId,(fI=q8.get(Dx))&&vr&&(fI.offlineModeType=vr.offlineModeType);case 7:xH=[];QJ=g.u(Z);for(F=QJ.next();!F.done;F=QJ.next())v=F.value,Q=g.c5(v.key).entityId,z=gx(v),Q!==c&&z.rootActionId!==c||VG(J,v.actionProto)||xH.push(v.key);
a=g.A5(c,"mainPlaylistEntity");return g.X(YI,em(A,{mode:"readwrite",Hf:!0},function(X$){var hd=xH.map(function(Wr){return tK(X$,Wr)});
hd.push(tK(X$,a,{aH:!0}));return g.Lh.all(hd)}),10);
case 10:if(!N){YI.Tx(0);break}y.reverse();if(!y){YI.Tx(0);break}LI=g.u(y);Jd=LI.next();case 13:if(Jd.done){YI.Tx(0);break}kI=Jd.value;return g.X(YI,wx(kI,A,J,q,q8.get(kI)),14);case 14:Jd=LI.next(),YI.Tx(13)}})},ZGr=function(c,A,J,q){var Y,p,m,E,O,T,R,r,H;
return g.S(function(V){if(V.K==1)return Y=g.A5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),p=new Map,g.X(V,em(c,{mode:"readwrite",Hf:!0},function(N){var w=lq(N,"transfer"),W=lq(N,"offlineOrchestrationActionWrapperEntity"),C=lq(N,"videoDownloadContextEntity"),G=f8(N,Y,"mainDownloadsListEntity");return g.Lh.all([w,W,C,G]).then(function(Z){Z=g.u(Z);var I=Z.next().value;var f=Z.next().value;var K=Z.next().value;var y=Z.next().value;Z=Xow.map(function(pI){return Cyr(N,pI)});
f=g.u(f);for(var q8=f.next();!q8.done;q8=f.next())q8=q8.value,VG(A,q8.actionProto)||Z.push(tK(N,q8.key,{aH:!0}));y&&(y.downloads=[],Z.push(bq(N,y,"mainDownloadsListEntity")));if(K)for(K=g.u(K),y=K.next();!y.done;y=K.next())y=y.value,f=g.c5(y.key).entityId,f=g.A5(f,"transfer"),p.set(f,y.offlineModeType);return g.Lh.all(Z).then(function(){return I})})}),2);
m=V.C;E=g.u(m);for(O=E.next();!O.done;O=E.next())T=O.value,Ni(T,p.get(T.key)),R=g.c5(T.key).entityId,r={videoId:R,offlineDeleteReason:q,cotn:T.cotn,offlineModeType:p.get(T.key)},dx(r),H=g.A5(R,"mainVideoEntity"),mk(J,{entityKey:H,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.X(V,CtJ(),0)})},FPr=function(c,A){var J=[];
if(c.thumbnailStyleData){c=g.u(c.thumbnailStyleData);for(var q=c.next();!q.done;q=c.next()){var Y=void 0,p=void 0,m=void 0;J=J.concat(Dt((Y=q.value)==null?void 0:(p=Y.value)==null?void 0:(m=p.collageThumbnail)==null?void 0:m.coverThumbnail))}}A=Dt(A);return J.concat(A)},vGN=function(c,A,J){var q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI;
return g.S(function(cw){q=[];Y=new Set;if(J.length)for(p=g.u(J),m=p.next();!m.done;m=p.next())if(E=m.value,O=void 0,(O=E.downloads)==null?0:O.length)for(T=g.u(E.downloads),R=T.next();!R.done;R=T.next())r=R.value,r.videoItem&&(H=g.c5(r.videoItem).entityId,Y.add(H));if(c.videos){V=g.u(c.videos);for(N=V.next();!N.done;N=V.next())w=N.value,W=JSON.parse(g.c5(w).entityId),W.videoId&&!Y.has(W.videoId)&&q.push(W.videoId);C=g.u(A);for(G=C.next();!G.done;G=C.next())if(Z=G.value,Z.key!==c.key&&(I=Z.videos))for(f=
g.u(I),K=f.next();!K.done;K=f.next())y=K.value,q8=JSON.parse(g.c5(y).entityId),q8.videoId&&(pI=q.indexOf(q8.videoId),pI!==-1&&q.splice(pI,1))}return cw.return(q)})},MgV=function(c,A){var J,q,Y,p,m,E,O,T;
return g.S(function(R){J=Dt(c.avatar);q=g.u(A);for(Y=q.next();!Y.done;Y=q.next())if(p=Y.value,p.id!==c.id)for(m=g.u(Dt(p.avatar)),E=m.next();!E.done;E=m.next())O=E.value,T=J.indexOf(O),T!==-1&&J.splice(T,1);return R.return(J)})},IIw=function(c){var A;
return g.S(function(J){A=g.l(c.frameworkUpdates,Wk);return c.frameworkUpdates&&A?g.X(J,U_C(A),0):J.return()})},SoM=function(c){var A;
if((A=c.onResponseReceivedActions)!=null&&A.length){var J;c=(J=g.l(g.l(c.onResponseReceivedActions[0],zLr),g.ter))==null?void 0:J.actions;if(c!=null&&c.length)return c}},x$r=function(c){var A,J,q;
return g.S(function(Y){if(Y.K==1)return c?g.X(Y,K8(c,g.IC,"mainDownloadsListEntity"),2):Y.return([]);A=Y.C;return((J=A)==null?0:(q=J.downloads)==null?0:q.length)?Y.return(A.downloads.map(function(p){var m;return(m=p.videoItem)!=null?m:""})):Y.return([])})},scJ=function(c,A){var J;
return g.S(function(q){return q.K==1?g.X(q,PtM(c,A),2):(J=q.C)?g.X(q,em(c,{mode:"readwrite",Hf:!0},function(Y){var p=[bq(Y,J.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];J.mainDownloadsListEntity&&p.push(bq(Y,J.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Lh.all(p)}),0):q.Tx(0)})},PtM=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z;
return g.S(function(I){if(I.K==1)return J=g.A5("main_downloads_library_id","mainDownloadsLibraryEntity"),q=g.A5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.X(I,em(c,{mode:"readonly",Hf:!0},function(f){return g.Lh.all([f8(f,J,"mainDownloadsLibraryEntity"),f8(f,q,"mainDownloadsListEntity")])}),2);
Y=I.C;p=g.u(Y);m=p.next().value;E=p.next().value;O=m;T=E;O||(O={id:J});R=g.u(A);for(r=R.next();!r.done;r=R.next())if(H=r.value,H===g.IC){if(O.smartDownloadsList)return I.return();O.smartDownloadsList=H}else if(V=g.c5(H).entityType,N={},V==="mainPlaylistEntity"?N.playlistItem=H:V==="mainVideoEntity"&&(N.videoItem=H),!g.cL(N)){w=void 0;if((w=T)==null?0:w.downloads){W=!1;C=g.u(T.downloads);for(G=C.next();!G.done;G=C.next())if(Z=G.value,Z.playlistItem===H||Z.videoItem===H){W=!0;break}W||T.downloads.push(N)}else T=
{id:q,downloads:[N]};O.downloadsList=q}return I.return({mainDownloadsLibraryEntity:O,mainDownloadsListEntity:T})})},U$N=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W;
return g.S(function(C){if(C.K==1)return J=g.A5("main_downloads_library_id","mainDownloadsLibraryEntity"),q=g.A5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.X(C,em(c,{mode:"readonly",Hf:!0},function(G){return g.Lh.all([f8(G,J,"mainDownloadsLibraryEntity"),f8(G,q,"mainDownloadsListEntity"),f8(G,g.IC,"mainDownloadsListEntity")])}),2);
Y=C.C;p=g.u(Y);m=p.next().value;E=p.next().value;O=p.next().value;T=m;R=E;r=O;if(!T)return C.Tx(0);if(A===g.IC&&((H=r)==null?0:H.downloads))r.downloads=[];else if((V=R)==null?0:V.downloads)for(N=g.c5(A).entityType,w=0;w<R.downloads.length;w++)if(W=R.downloads[w],N==="mainVideoEntity"&&W.videoItem===A){R.downloads.splice(w,1);break}else if(N==="mainPlaylistEntity"&&W.playlistItem===A){R.downloads.splice(w,1);break}return g.X(C,em(c,{mode:"readwrite",Hf:!0},function(G){var Z=[bq(G,T,"mainDownloadsLibraryEntity")];
R&&Z.push(bq(G,R,"mainDownloadsListEntity"));r&&Z.push(bq(G,r,"mainDownloadsListEntity"));return g.Lh.all(Z)}),0)})},LS=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H;
return g.S(function(V){if(V.K==1)return J=g.A5(A,"transfer"),q=g.A5(A,"videoDownloadContextEntity"),g.X(V,em(c,{mode:"readonly",Hf:!0},function(N){return g.Lh.all([f8(N,J,"transfer"),f8(N,q,"videoDownloadContextEntity")])}),2);
Y=V.C;p=g.u(Y);m=p.next().value;E=p.next().value;O=m;T=E;H={videoId:A,cotn:(R=O)==null?void 0:R.cotn,offlineModeType:(r=T)==null?void 0:r.offlineModeType};return V.return(H)})},GO=function(c,A,J,q,Y){var p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8;
return g.S(function(pI){switch(pI.K){case 1:return p=g.A5(c,"musicTrack"),m=g.A5(c,"transfer"),g.X(pI,em(A,{mode:"readonly",Hf:!0},function(cw){return g.Lh.all([f8(cw,p,"musicTrack"),f8(cw,m,"transfer"),lq(cw,"musicTrack"),lq(cw,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=pI.C;O=g.u(E);T=O.next().value;R=O.next().value;r=O.next().value;H=O.next().value;V=T;N=R;w=r;W=H;if(!V){pI.Tx(3);break}return g.X(pI,fIH(V,w),4);case 4:return C=pI.C,g.X(pI,uX(C),3);case 3:G=[];Z=g.u(W);for(I=Z.next();!I.done;I=Z.next())f=I.value,K=g.c5(f.key).entityId,y=gx(f),q8=g.c5(y.action.entityKey).entityId,K!==c&&q8!==c||VG(J,f.actionProto)||G.push(f.key);return g.X(pI,em(A,{mode:"readwrite",Hf:!0},function(cw){var EL=G.map(function(h){return tK(cw,h)});
EL.push(tK(cw,p,{aH:!0}));return g.Lh.all(EL)}),6);
case 6:Ni(N),Y&&dx(Y),mk(q,{entityKey:p,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.u$(pI)}})},CS=function(c,A,J,q,Y){var p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI,cw,EL,h,wa,M8,b$,Gw,OO,vw,CI,mM,L,da,eN,WL;
return g.S(function(vr){switch(vr.K){case 1:return p=g.A5(c,A),m=g.A5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.X(vr,em(J,{mode:"readonly",Hf:!0},function(Dx){return g.Lh.all([f8(Dx,p,A),f8(Dx,m,"musicDownloadsLibraryEntity"),lq(Dx,A),lq(Dx,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=vr.C;O=g.u(E);T=O.next().value;R=O.next().value;r=O.next().value;H=O.next().value;V=T;N=R;w=r;W=H;if(!V){vr.Tx(3);break}return g.X(vr,fIH(V,w),4);case 4:return C=vr.C,g.X(vr,uX(C),3);case 3:G=[];Z=new Map;if(!V){vr.Tx(6);break}return g.X(vr,lIw(V,w,N),7);case 7:G=vr.C;I=g.u(G);for(f=I.next();!f.done;f=I.next())K=f.value,y=g.c5(K).entityId,Z.set(y,{videoId:y,playlistId:c,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.X(vr,hK(J,"transfer"),8);case 8:for(q8=vr.C,pI=
g.u(q8),cw=pI.next();!cw.done;cw=pI.next())EL=cw.value,h=g.c5(EL.key).entityId,(wa=Z.get(h))&&EL&&(wa.cotn=EL.cotn);case 6:M8=[];b$=g.u(W);for(Gw=b$.next();!Gw.done;Gw=b$.next())OO=Gw.value,vw=g.c5(OO.key).entityId,CI=gx(OO),vw!==c&&CI.rootActionId!==c||VG(q,OO.actionProto)||M8.push(OO.key);mM=g.A5(c,A);return g.X(vr,em(J,{mode:"readwrite",Hf:!0},function(Dx){var fI=M8.map(function(xH){return tK(Dx,xH)});
fI.push(tK(Dx,mM,{aH:!0}));return g.Lh.all(fI)}),9);
case 9:if(!V){vr.Tx(0);break}G.reverse();if(!G.length){vr.Tx(0);break}L=g.u(G);da=L.next();case 12:if(da.done){vr.Tx(0);break}eN=da.value;WL=g.c5(eN).entityId;if(!WL){vr.Tx(13);break}return g.X(vr,GO(WL,J,q,Y,Z.get(WL)),13);case 13:da=L.next(),vr.Tx(12)}})},Mi=function(c,A,J){var q,Y,p,m,E,O,T;
return g.S(function(R){if(R.K==1)return g.X(R,em(c,{mode:"readwrite",Hf:!0},function(r){var H=lq(r,"transfer"),V=lq(r,"offlineOrchestrationActionWrapperEntity");return g.Lh.all([H,V]).then(function(N){N=g.u(N);var w=N.next().value;var W=N.next().value;N=aIr.map(function(I){return Cyr(r,I)});
W=g.u(W);for(var C=W.next();!C.done;C=W.next()){C=C.value;var G=g.c5(C.actionProto.entityKey).entityType==="musicTrack",Z=C.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";VG(A,C.actionProto)||G&&(!G||Z)||N.push(tK(r,C.key,{aH:!0}))}return g.Lh.all(N).then(function(){return w})})}),2);
q=R.C;Y=g.u(q);for(p=Y.next();!p.done;p=Y.next())m=p.value,Ni(m),E=g.c5(m.key).entityId,O={videoId:E,offlineDeleteReason:void 0,cotn:m.cotn},dx(O),T=g.A5(E,"musicTrack"),mk(J,{entityKey:T,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.X(R,CtJ(),0)})},bGi=function(c){for(var A,J=g.u(c.additionalMetadatas),q=J.next();!q.done;q=J.next())q=q.value,q.offlineMusicVideoData&&(A=q.offlineMusicVideoData);
var Y,p,m,E,O;return{id:g.A5(c.videoId,"musicTrack"),videoId:c.videoId,title:c.title,thumbnailDetails:c.thumbnail,lengthMs:String(Number(c.lengthSeconds)*1E3),albumTitle:(Y=A)==null?void 0:Y.releaseTitle,musicVideoType:(p=A)==null?void 0:p.musicVideoType,contentRating:{explicitType:(m=A)==null?void 0:m.explicitType},artistNames:((E=A)==null?void 0:E.byline)||((O=A)==null?void 0:O.channelName),downloadMetadata:g.A5(c.videoId,"musicTrackDownloadMetadataEntity")}},lIw=function(c,A,J){var q,Y,p,m,E,O,
T,R,r,H,V,N,w,W,C,G,Z,I;
return g.S(function(f){q=[];Y=new Set;if((p=J)==null?0:(m=p.downloadedTracks)==null?0:m.length)for(E=g.u(J.downloadedTracks),O=E.next();!O.done;O=E.next())T=O.value,Y.add(T);if(c.tracks){R=g.u(c.tracks);for(r=R.next();!r.done;r=R.next())H=r.value,Y.has(H)||q.push(H);V=g.u(A);for(N=V.next();!N.done;N=V.next())if(w=N.value,w.id!==c.id&&(W=w.tracks))for(C=g.u(W),G=C.next();!G.done;G=C.next())Z=G.value,I=q.indexOf(Z),I!==-1&&q.splice(I,1)}return f.return(q)})},fIH=function(c,A){var J,q,Y,p,m,E,O,T;
return g.S(function(R){J=Dt(c.thumbnailDetails);q=g.u(A);for(Y=q.next();!Y.done;Y=q.next())if(p=Y.value,p.id!==c.id)for(m=g.u(Dt(p.thumbnailDetails)),E=m.next();!E.done;E=m.next())O=E.value,T=J.indexOf(O),T!==-1&&J.splice(T,1);return R.return(J)})},tgR=function(c,A){var J,q,Y,p,m,E,O,T,R;
return g.S(function(r){if(r.K==1)return J=g.A5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.X(r,K8(c,J,"musicDownloadsLibraryEntity"),2);(q=r.C)||(q={id:J});Y=g.c5(A).entityType;Y==="musicTrack"?(p=q.downloadedTracks)!=null&&p.includes(A)||(q.downloadedTracks=((m=q.downloadedTracks)!=null?m:[]).concat(A)):Y==="musicPlaylist"?(E=q.downloadedPlaylists)!=null&&E.includes(A)||(q.downloadedPlaylists=((O=q.downloadedPlaylists)!=null?O:[]).concat(A)):Y!=="musicAlbumRelease"||(T=q.downloadedAlbumReleases)!=
null&&T.includes(A)||(q.downloadedAlbumReleases=((R=q.downloadedAlbumReleases)!=null?R:[]).concat(A));return g.X(r,n8(c,q,"musicDownloadsLibraryEntity"),0)})},iGJ=function(c,A){var J,q,Y,p,m,E,O;
return g.S(function(T){if(T.K==1)return J=g.A5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.X(T,K8(c,J,"musicDownloadsLibraryEntity"),2);q=T.C;if(!q)return T.Tx(0);Y=g.c5(A).entityType;Y==="musicTrack"?p=q.downloadedTracks:Y==="musicPlaylist"&&(p=q.downloadedPlaylists);if((m=p)==null?0:m.length)for(E=0;E<p.length;E++)if(O=p[E],O===A){p.splice(E,1);break}return g.X(T,n8(c,q,"musicDownloadsLibraryEntity"),0)})},yyC=function(c){var A=c.videos;
c=[];var J=[];if(A){A=g.u(A);for(var q=A.next();!q.done;q=A.next()){var Y=q.value.offlineVideoData.videoId;q=g.A5(Y,"musicTrack");Y=g.A5(Y,"musicTrackDownloadMetadataEntity");c.push(q);J.push(Y)}}return{Xw:c,mq:J}},Fj=function(c,A,J){A={track:bGi(A)};
J&&(A.playlistId=J);if(c=g.l(c.actionMetadata,eLR))A.maximumDownloadQuality=c.maximumDownloadQuality;return{musicTrackEntityActionMetadata:A}},KPO=function(c){var A,J,q,Y,p,m,E,O;
return g.S(function(T){switch(T.K){case 1:return A=g.dr(),J=eb9(c),q=g.Ye(nGM),g.$I(T,2),p={sz:!0},g.X(T,g.KU(A,J,q,void 0,p),4);case 4:Y=T.C;g.GW(T,3);break;case 2:m=g.F$(T);if(m instanceof g.px)throw E="GetOffline network manager error: "+m.message,qi(E,m),Error(E);qi("GetOffline fetch request error",m);throw Error("GetOffline fetch request error");case 3:O=vk(Y);if(!Y)throw qi("Network request failed"),Error("Network request failed");if(O!==void 0)QG(O);else if(!Y.videos||!Y.videos.length)throw qi("No data"),
Error("No data");return T.return(Y.videos.map(function(R){return R.offlineVideoData}))}})},hLr=function(c){var A,J,q,Y,p,m,E,O;
return g.S(function(T){switch(T.K){case 1:return A=g.dr(),J=nJe(c),q=g.Ye(nGM),g.$I(T,2),p={sz:!0},g.X(T,g.KU(A,J,q,void 0,p),4);case 4:Y=T.C;g.GW(T,3);break;case 2:m=g.F$(T);if(m instanceof g.px)throw E="GetOffline network manager error for playlist: "+m.message,qi(E,m),Error(E);qi("GetOffline fetch request error for playlist",m);throw Error("GetOffline fetch request error for playlist");case 3:O=vk(Y);if(!Y)throw qi("Network request failed for playlist"),Error("Network request failed for playlist");
if(O!==void 0)QG(O,"playlist");else if(!Y.playlists||!Y.playlists.length)throw qi("No data for playlist"),Error("No data for playlist");return T.return(Y.playlists.map(function(R){return R.offlinePlaylistData}))}})},cNw=function(c,A,J,q){var Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI,cw,EL,h,wa,M8,b$,Gw,OO;
return g.S(function(vw){switch(vw.K){case 1:return g.X(vw,BU(),2);case 2:Y=vw.C;if(!Y)return vw.return([]);p=[];if((m=q)==null?0:m.length){p=q;vw.Tx(3);break}return g.X(vw,hK(Y,"mainPlaylistEntity"),4);case 4:p=vw.C;case 3:if(!p.length)return vw.return([]);E=[];O=Date.now()/1E3;T=g.u(p);R=T.next();case 5:if(R.done)return E.length?g.X(vw,BWJ(E),10):vw.return([]);r=R.value;if(!r.downloadState){H=void 0;vw.Tx(8);break}return g.X(vw,K8(Y,r.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:H=
vw.C;case 8:V=H;N=void 0;W=(w=(N=r)==null?void 0:N.entityMetadata)&&w.nextAutoRefreshIntervalSeconds?Number(w.nextAutoRefreshIntervalSeconds):NaN;C=Number.isNaN(W)?c:W;Z=G=void 0;I=((G=V)==null?0:G.lastSyncedTimestampMillis)?Number((Z=V)==null?void 0:Z.lastSyncedTimestampMillis)/1E3:0;K=f=void 0;y=((f=V)==null?0:f.addedTimestampMillis)?Number((K=V)==null?void 0:K.addedTimestampMillis)/1E3:0;if(J||!w||I+C<=O){q8=[];pI=void 0;if((pI=r.videos)==null?0:pI.length)for(cw=g.u(r.videos),EL=cw.next();!EL.done;EL=
cw.next())h=EL.value,wa=JSON.parse(g.c5(h).entityId),wa.videoId&&q8.push(wa.videoId);M8="0";w&&(b$=void 0,M8=String(Number((b$=w.offlineLastModifiedTimestampSeconds)!=null?b$:0).toFixed()));Gw={playlistId:r.playlistId,videoIds:q8,offlineLastModifiedTimestamp:M8,autoSync:A,offlineDateAddedTimestamp:String(y.toFixed())};E.push(Gw)}R=T.next();vw.Tx(5);break;case 10:return OO=vw.C,vw.return(OO)}})},ANi=function(){var c,A,J,q,Y;
return g.S(function(p){if(p.K==1)return g.X(p,BU(),2);if(p.K!=3)return(c=p.C)?g.X(p,hK(c,"refresh"),3):p.return(!1);A=p.C;if((J=A[0])==null||!J.refreshTime)return p.return(!1);q=Number(A[0].refreshTime);Y=Date.now()/1E3;return p.return(isFinite(q)&&Y>=q)})},qYM=function(c,A){var J,q,Y;
return g.S(function(p){switch(p.K){case 1:return g.$I(p,2),g.X(p,JNC(c,A),4);case 4:return q=p.C,g.X(p,IIw(q),5);case 5:J=SoM(q);g.GW(p,3);break;case 2:Y=g.F$(p),qi("getAndProcessSmartDownloadsResponse request or processing error",Y);case 3:return p.return(J)}})},YY9=function(c,A,J,q){var Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI,cw,EL,h,wa,M8,b$,Gw,OO;
return g.S(function(vw){switch(vw.K){case 1:return g.X(vw,BU(),2);case 2:Y=vw.C;if(!Y)return vw.return([]);p=[];if((m=q)==null?0:m.length){p=q;vw.Tx(3);break}return g.X(vw,hK(Y,"musicPlaylist"),4);case 4:p=vw.C;case 3:if(!p.length)return vw.return([]);E=[];O=Date.now()/1E3;T=g.u(p);R=T.next();case 5:if(R.done)return E.length?g.X(vw,BWJ(E),10):vw.return([]);r=R.value;H=void 0;N=(V=(H=r)==null?void 0:H.entityMetadata)&&V.nextAutoRefreshIntervalSeconds?Number(V.nextAutoRefreshIntervalSeconds):NaN;w=
Number.isNaN(N)?c:N;C=W=0;G="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!r.downloadMetadata){vw.Tx(8);break}return g.X(vw,K8(Y,r.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:Z=vw.C,f=I=void 0,W=Number((f=(I=Z)==null?void 0:I.addedTimestampMillis)!=null?f:"0")/1E3,y=K=void 0,C=Number((y=(K=Z)==null?void 0:K.lastModifiedTimestampMillis)!=null?y:"0")/1E3,pI=q8=void 0,G=(pI=(q8=Z)==null?void 0:q8.syncState)!=null?pI:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:cw=void 0;if(J||G!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!V||Number((cw=V.lastSyncedTimestampSeconds)!=null?cw:0)+w<=O){EL=[];h=void 0;if((h=r.tracks)==null?0:h.length)for(wa=g.u(r.tracks),M8=wa.next();!M8.done;M8=wa.next())b$=M8.value,EL.push(g.c5(b$).entityId);Gw={playlistId:r.playlistId,videoIds:EL,offlineLastModifiedTimestamp:String(C.toFixed()),autoSync:A,offlineDateAddedTimestamp:String(W.toFixed())};E.push(Gw)}R=T.next();vw.Tx(5);break;case 10:return OO=vw.C,vw.return(OO)}})},JNC=function(c,A){var J,q,Y,p,m,E,O,T,R,r;
return g.S(function(H){switch(H.K){case 1:return J=g.dr(),g.X(H,BU(),2);case 2:q=H.C;if(!q){H.Tx(3);break}return g.X(H,qoH(q),4);case 4:Y=H.C;case 3:var V=Y;p={context:g.Aw(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:c},offlineClientState:V,clientStateRequestData:{preferredFormatType:A}}}};m=g.Ye(paV);g.$I(H,5);O={sz:!0};return g.X(H,g.KU(J,p,m,void 0,O),7);case 7:E=H.C;g.GW(H,6);break;case 5:T=g.F$(H);if(T instanceof g.px)throw R=
"DPS network manager error for smart downloads: "+T.message,qi(R,T),Error(R);qi("DPS fetch request error for smart downloads",T);throw Error("DPS fetch request error for smart downloads");case 6:r=vk(E);if(E)r!==void 0&&QG(r,"smart downloads");else throw qi("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return H.return(E)}})},jhV=function(c,A){var J,q,Y,p,m,E,O,T;
return g.S(function(R){switch(R.K){case 1:return J=g.dr(),q={context:g.Aw(),videoPlaybackPositionEntities:c,lastSyncTimestampUsec:A},Y=g.Ye(mw9),g.$I(R,2),m={sz:!0},g.X(R,g.KU(J,q,Y,void 0,m),4);case 4:p=R.C;g.GW(R,3);break;case 2:E=g.F$(R);if(E instanceof g.px)throw O="VPPS network manager error: "+E.message,qi(O,E),Error(O);qi("VPPS fetch request error",E);throw Error("VPPS fetch request error");case 3:T=vk(p);if(p)T!==void 0&&QG(T,"position sync");else throw qi("Network request failed for position sync"),
Error("Network request failed for position sync");return R.return(p)}})},EVw=function(c,A,J){var q,Y,p,m,E,O,T,R;
return g.S(function(r){switch(r.K){case 1:q=g.dr();var H=J.refreshData,V=J.isEnqueuedForExpiredStreamUrlRefetch,N=J.SI,w=J.offlineSourceData,W=J.mediaCapabilities,C={entityKey:c};H&&(C.refreshData=H);V&&(C.isExpiredStreamUrlRefetch=V);N&&(C.downloadParameters=N);w&&(C.offlineSourceData=w);H={context:g.JO(A),signatureTimestamp:20215,videos:[C]};W&&(H.mediaCapabilities=W);Y=H;p=g.Ye(dwH);g.$I(r,2);E={sz:!0};return g.X(r,g.KU(q,Y,p,void 0,E),4);case 4:m=r.C;g.GW(r,3);break;case 2:O=g.F$(r);if(O instanceof
g.px)throw T="GetPDE network manager error: "+O.message,qi(T,O),Error(T);qi("GetPDE fetch request error",O);throw Error("GetPDE fetch request error");case 3:R=vk(m);if(m)R!==void 0&&QG(R,"PDE");else throw qi("Network request failed for PDE"),Error("Network request failed for PDE");return r.return(m)}})},vk=function(c){var A;
return(A=c.errorMetadata)==null?void 0:A.status},QG=function(c,A){A=A?" for "+A:"";
if(c===0)throw c="Empty response body"+A,qi(c),Error(c);c="Response with error"+A;qi(c);throw Error(c);},BWJ=function(c){var A,J,q,Y,p,m,E,O;
return g.S(function(T){switch(T.K){case 1:return A=g.dr(),J=KUi(c),q=g.Ye(OtR),g.$I(T,2),p={sz:!0},g.X(T,g.KU(A,J,q,void 0,p),4);case 4:Y=T.C;g.GW(T,3);break;case 2:m=g.F$(T);if(m instanceof g.px)throw E="offlinePlaylistSyncCheck network manager error: "+m.message,qi(E,m),Error(E);qi("offlinePlaylistSyncCheck fetch request error",m);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:O=vk(Y);if(!Y)throw qi("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(O!==void 0)QG(O,"playlist sync");else if(!Y.offlinePlaylistSyncCheckDatas||!Y.offlinePlaylistSyncCheckDatas.length)throw qi("No data for playlist sync"),Error("No data for playlist sync");return T.return(Y.offlinePlaylistSyncCheckDatas.map(function(R){return R.offlinePlaylistSyncCheckData}))}})},Xj=function(c){this.C=c},Tew=function(c,A){var J,q,Y,p,m,E;
return g.S(function(O){switch(O.K){case 1:J=new Map,q=g.u(A),Y=q.next();case 2:if(Y.done){O.Tx(4);break}p=Y.value;m=J;E=m.set;return g.X(O,c.K(p),5);case 5:E.call(m,p,O.C);Y=q.next();O.Tx(2);break;case 4:return O.return(J)}})},Zt=function(c,A,J,q,Y,p){A=g.A5(A,J);
q=Object.assign({},p,{priority:q,retryScheduleIntervalsInSeconds:Y});return{actionType:c,entityKey:A,actionMetadata:q}},Io=function(c,A,J,q,Y,p){this.status=c;
this.C=A;this.T=J;this.K=q;this.j=Y;this.downloadState=p},RYO=function(c,A,J){this.C=c;
this.o8=A;this.j=J},VyN=function(c,A){var J,q,Y,p,m,E,O,T,R;
return g.S(function(r){switch(r.K){case 1:return J=A.entityKey,Y=(q=g.l(A.actionMetadata,zO))==null?void 0:q.isEnqueuedForExpiredStreamUrlRefetch,g.$I(r,2),p=void 0,g.X(r,rNC(c,A),4);case 4:p=r.C;g.$I(r,5);var H=(H=g.l(A.actionMetadata,zO))?{maximumDownloadQuality:H.maximumDownloadQuality}:void 0;return g.X(r,EVw(J,c.o8,{isEnqueuedForExpiredStreamUrlRefetch:Y,SI:H,offlineSourceData:p}),7);case 7:m=r.C;g.GW(r,6,2);break;case 5:return g.F$(r,2),E=Of(A)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",qi("PDE handleAdd error"),r.return(Sc(A,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",E,"DOWNLOAD_STATE_FAILED"));case 6:return g.X(r,HtN(c,m,A),8);case 8:return r.return(Sc(A,!0,m.orchestrationActions));case 2:return O=g.F$(r),T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",R="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.kf&&O.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
R="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),qi("PDE handleAdd error"),r.return(Sc(A,!1,void 0,T,R,"DOWNLOAD_STATE_FAILED"))}})},klw=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI;
return g.S(function(cw){switch(cw.K){case 1:return J=A.entityKey,q=g.c5(J).entityId,g.X(cw,em(c.C,{mode:"readonly",Hf:!0},function(EL){var h=f8(EL,J,"playbackData"),wa=f8(EL,g.A5(q,"offlineVideoPolicy"),"offlineVideoPolicy");EL=f8(EL,g.A5(q,"transfer"),"transfer");return g.Lh.all([h,wa,EL])}),2);
case 2:Y=cw.C;p=g.u(Y);m=p.next().value;E=p.next().value;O=p.next().value;T=m;R=E;r=O;if(!T||!R)return cw.return(Sc(A,!0));H=[];w=((N=T)==null?0:N.playerResponseJson)?JSON.parse(T.playerResponseJson):null;if(!(r&&w&&c.o8.W("html5_refresh_deprecated_downloads"))){cw.Tx(3);break}V=NeH(c,w,r);return g.X(cw,DwN(c,r),4);case 4:H=cw.C;case 3:W={lastPlayerResponseTimestampSeconds:T.playerResponseTimestamp,offlineToken:R.offlineToken,formatIds:H};C={};if((G=r)==null?0:G.maximumDownloadQuality)C.maximumDownloadQuality=
r.maximumDownloadQuality;g.$I(cw,5);Z=void 0;return g.X(cw,rNC(c,A),7);case 7:return Z=cw.C,g.$I(cw,8),g.X(cw,EVw(J,c.o8,{refreshData:W,SI:C,offlineSourceData:Z,mediaCapabilities:V}),10);case 10:I=cw.C;g.GW(cw,9,5);break;case 8:return g.F$(cw,5),f=Of(A)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",qi("PDE handleRefresh error"),cw.return(Sc(A,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",f,
"DOWNLOAD_STATE_FAILED"));case 9:return g.X(cw,HtN(c,I,A),11);case 11:return cw.return(Sc(A,!0,I.orchestrationActions));case 5:return K=g.F$(cw),y="PDE handleRefresh error",K instanceof Error&&(y="PDE handleRefresh error: "+K.message),q8="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",pI="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.kf&&K.type==="QUOTA_EXCEEDED"&&(q8="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",pI="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
qi(y),cw.return(Sc(A,!1,void 0,q8,pI,"DOWNLOAD_STATE_FAILED"))}})},rNC=function(c,A){var J,q,Y,p;
return g.S(function(m){if(m.K==1)return J=g.c5(A.entityKey).entityId,q=g.A5(J,"videoDownloadContextEntity"),g.X(m,K8(c.C,q,"videoDownloadContextEntity"),2);Y=m.C;return(p=Y)!=null&&p.offlineModeType?m.return({offlineModeType:Y.offlineModeType}):m.return(void 0)})},HtN=function(c,A,J){var q,Y,p,m,E;
return g.S(function(O){if(O.K==1){if(!A.frameworkUpdates||!g.l(A.frameworkUpdates,Wk))return O.return();if(!(g.l(A.frameworkUpdates,Wk).mutations&&g.l(A.frameworkUpdates,Wk).mutations.length>0&&g.l(A.frameworkUpdates,Wk).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return O.Tx(2);q=g.c5(g.l(A.frameworkUpdates,Wk).mutations[0].entityKey).entityId;return g.X(O,LS(c.C,q),3)}if(O.K!=2){Y=O.C;p=g.l(J.actionMetadata,zO);if(E=(m=p)==null?void 0:m.playlistId)Y.playlistId=E;Y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.c1(c.o8)?g.X(O,wx(q,c.C,J,c.j,Y),2):g.fk(c.o8)?g.X(O,GO(q,c.C,J,c.j),2):O.Tx(2)}return g.X(O,U_C(g.l(A.frameworkUpdates,Wk)),0)})},Sc=function(c,A,J,q,Y,p){return new Io(A?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Of(c),J,q,Y,p)},NeH=function(c,A,J){A=LPr(c.o8,J.cotn,A);
J=g.TY(A);return g.A33(A,J,c.o8)},DwN=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H;
return g.S(function(V){if(V.K==1)return J=[],g.X(V,em(c.C,{mode:"readonly",Hf:!0},function(N){var w=[],W=A.offlineVideoStreams;if(W){W=g.u(W);for(var C=W.next();!C.done;C=W.next())w.push(f8(N,C.value,"offlineVideoStreams"))}return g.Lh.all(w)}),2);
if(q=V.C)for(Y=g.u(q),p=Y.next();!p.done;p=Y.next())if(m=p.value,E=void 0,(E=m)==null?0:E.streamsProgress)for(O=m.streamsProgress,T=0;T<O.length;T++)R=O[T],r=JSON.parse(R.formatStreamBytes),H={itag:r.itag,lmt:r.lastModified,xtags:r.xtags},J.push(H);return V.return(J)})},gVR=function(c,A){this.C=c;
this.o8=A},oVH=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V;
return g.S(function(N){switch(N.K){case 1:return J=Of(A),g.X(N,hK(c.C,"videoPlaybackPositionEntity"),2);case 2:q=N.C;if(q.length===0)return N.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));g.$I(N,3);return g.X(N,PU.getInstance(),5);case 5:Y=N.C;if(!Y)throw Error("prefStorage is undefined");return g.X(N,Y.get("psi"),6);case 6:return p=N.C,O=(E=(m=p)==null?void 0:m.IE)!=null?E:"0",g.X(N,jhV(q,O),7);case 7:return T=N.C,R={isPaused:T.watchHistoryPaused,IE:T.syncTimestampUsec},g.X(N,Y.set("psi",
R),8);case 8:if(R.isPaused){N.Tx(9);break}r=g.l(T.frameworkUpdates,Wk);if(!T.frameworkUpdates||!r){N.Tx(9);break}return g.X(N,U_C(r),9);case 9:g.GW(N,4);break;case 3:return H=g.F$(N),V="PPE handleRefresh error: "+(H instanceof Error?H.message:"unknown error"),qi(V),N.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return N.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},$wJ=function(c,A){var J,q,Y,p,m,E,O,T;
return g.S(function(R){switch(R.K){case 1:return J=Of(A),q=g.c5(A.entityKey).entityId,g.$I(R,2),g.X(R,PU.getInstance(),4);case 4:Y=R.C;if(!Y)throw Error("prefStorage is undefined");return g.X(R,Y.get("psi"),5);case 5:p=R.C;m=g.l(A.actionMetadata,uZw);if(((E=p)==null?void 0:E.isPaused)!==!1||(O=m)==null||!O.lastPlaybackPositionSeconds){R.Tx(6);break}T={key:g.A5(q,"videoPlaybackPositionEntity"),videoId:q,lastPlaybackPositionSeconds:m.lastPlaybackPositionSeconds};return g.X(R,n8(c.C,T,"videoPlaybackPositionEntity"),
6);case 6:g.GW(R,3);break;case 2:return g.F$(R),R.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return R.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J))}})},waM=function(c,A){var J,q,Y;
return g.S(function(p){switch(p.K){case 1:J=Of(A);g.$I(p,2);q=g.c5(A.entityKey).entityId;if(q==="!*$_ALL_ENTITIES_!*$")return g.X(p,zb9(c.C),5);Y=g.A5(q,"videoPlaybackPositionEntity");return g.X(p,IkH(c.C,Y),5);case 5:g.GW(p,3);break;case 2:return g.F$(p),p.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},WOV=function(c,A){this.api=c;
this.C=A;this.logger=new g.jB("woffle");this.K=!1;this.lr={EL:this.EL};this.logger.debug("Initialized OfflineMediaManager")},LON=function(c){return g.S(function(A){return A.return(yrR(c))})},GlH=function(c){var A;
return g.S(function(J){if(J.K==1)return g.X(J,g.udw(c),2);A=J.C;return J.return(A.filter(function(q){return!!q.url}).map(function(q){return q.url}))})},xT=function(c,A){var J=g.ZS(A);
if(J===1||J===0)return Promise.resolve();(J=CTO(c,A))&&J.stopVideo();c.j=0;return LON(A)},Pk=function(c,A,J,q){J=J===void 0?!1:J;
q=q===void 0?!0:q;var Y=typeof A==="string"?A:A.videoDetails.videoId;g.ZS(Y)===2&&((A=CTO(c,Y))?A.stopVideo():c.logger.info(function(){return"Corresponding player for "+Y+" not found. Pausing anyway"}),g.Ij(Y,2),c.j=2,J?MyC(c.C):q&&FOH(c.C))},CTO=function(c,A){var J;
return((J=c.player)==null?void 0:J.getVideoData().videoId)===A?c.player:null},vVH=function(c,A,J){A.getPlayerResponse();
g.Ij(A.videoId,2);c.j=2;c.K=!1;var q;(q=c.player)==null||q.dispose();c.player=c.api.jP(A);A={};c.player.Tq((A.localmediachange=c.FU,A.signatureexpired=c.BY,A.statechange=c.OYP,A),c);var Y=c.EL(J);c.player.wd(g.ri(Y,Y,!0,"m"),!1);c.logger.debug(function(){return"Starting headless playback with quality: "+Y});
c.player.bC(!1)},QhO=function(c,A){this.C=c;
this.o8=A},Ztr=function(c,A){var J,q;
return g.S(function(Y){switch(Y.K){case 1:return J=Of(A),g.X(Y,K8(c.C,A.entityKey,"transfer"),2);case 2:if(q=Y.C)return Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));g.$I(Y,3);return g.X(Y,XaM(c,A),5);case 5:g.GW(Y,4);break;case 3:return g.F$(Y),Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},IwC=function(c,A){var J,q;
return g.S(function(Y){switch(Y.K){case 1:return J=Of(A),g.X(Y,K8(c.C,A.entityKey,"transfer"),2);case 2:q=Y.C;if(!q||q.transferState!=="TRANSFER_STATE_COMPLETE")return Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));g.$I(Y,3);return g.X(Y,XaM(c,A,!0),5);case 5:g.GW(Y,4);break;case 3:return g.F$(Y),Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J))}})},zYe=function(c,A){var J,q,Y,p,m,E,O,T,R,r;
return g.S(function(H){switch(H.K){case 1:return J=Of(A),q=g.c5(A.entityKey).entityId,g.X(H,em(c.C,{mode:"readonly",Hf:!0},function(V){var N=f8(V,A.entityKey,"transfer");V=f8(V,g.A5(q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Lh.all([N,V])}),2);
case 2:Y=H.C;p=g.u(Y);m=p.next().value;E=p.next().value;O=m;T=E;if(!O||O.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return H.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));g.$I(H,3);O.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.X(H,n8(c.C,O,"transfer"),5);case 5:R=g.c5(O.key).entityId;gG9({videoId:R,Se:O,offlineModeType:(r=T)==null?void 0:r.offlineModeType});g.GW(H,4);break;case 3:return g.F$(H),H.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return H.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J))}})},XaM=function(c,A,J){J=J===void 0?!1:J;
var q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C;return g.S(function(G){switch(G.K){case 1:return q=g.l(A.actionMetadata,SYO),Y=g.c5(A.entityKey).entityId,p=g.A5(Y,"downloadStatusEntity"),g.X(G,em(c.C,{mode:"readonly",Hf:!0},function(Z){var I=f8(Z,p,"downloadStatusEntity");Z=f8(Z,g.A5(Y,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Lh.all([I,Z])}),2);
case 2:return m=G.C,E=g.u(m),O=E.next().value,T=E.next().value,R=O,r=T,H="TRANSFER_STATE_TRANSFER_IN_QUEUE",((V=R)==null?void 0:V.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(H="TRANSFER_STATE_PAUSED_BY_USER"),W={key:A.entityKey,transferState:H,cotn:g.WA(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(N=q)==null?void 0:N.maximumDownloadQuality,preferredAudioTrack:(w=q)==null?void 0:w.preferredAudioTrack,transferRetryCount:0,isRefresh:J,hasLoggedFirstStarted:!1},g.X(G,em(c.C,
{mode:"readwrite",Hf:!0},function(Z){var I=[];J&&I.push(tK(Z,g.A5(Y,"offlineVideoStreams")));I.push(bq(Z,W,"transfer"));return g.Lh.all(I)}),3);
case 3:if(!J){G.Tx(4);break}return g.X(G,LON(Y),4);case 4:D$9({videoId:Y,Se:W,offlineModeType:(C=r)==null?void 0:C.offlineModeType}),g.u$(G)}})},PTC=function(c,A,J,q){if(!c.action.entityKey)throw Error("entityKey is missing.");
var Y=g.c5(c.action.entityKey);Y={entityType:Y.W0,entityId:Y.entityId,offlineOrchestrationActionType:c.action.actionType,orchestrationAction:{orchestrationActionId:c.actionId}};A&&(Y.offlineOrchestrationActionResult=A.status,Y.isRetryable=J?!1:A.C,A.j&&(Y.offlineOrchestrationFailureReason=xwH(A.j,Y.isRetryable)));var p,m;if((p=c.action.actionMetadata)==null?0:(m=p.offlineLoggingData)==null?0:m.offlineModeType)Y.offlineModeType=c.action.actionMetadata.offlineLoggingData.offlineModeType;q&&(Y.additionalOrchestrationActions=
q.map(function(E){return{orchestrationActionId:E.actionId}}));
return Y},xwH=function(c,A){return c!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||A?c==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&A?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":c:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},shr=function(c,A){var J={offlineOrchestrationContext:PTC(c)};
A=Ayr(A,J);JyR(cyr(),A,c.rootActionId)},Uww=function(c,A,J,q){q=q===void 0?[]:q;
A={offlineOrchestrationContext:PTC(c,A,J,q)};A=Ayr(3,A);JyR(cyr(),A,c.rootActionId)},fwJ=function(){this.actions=[]},lwr=function(c,A){A=g.u(A);
for(var J=A.next();!J.done;J=A.next())J=J.value,shr(J,1),c.actions.push(J);c.actions.sort(c.C)},awM=function(c,A){if(A)for(var J=0;J<c.actions.length;J++)if(A==="!*$_ALL_ENTITIES_!*$"&&c.actions[J].actionId!==A||A!=="!*$_ALL_ENTITIES_!*$"&&c.actions[J].rootActionId===A&&c.actions[J].actionId!==A)c.actions.splice(J,1),J--},btM=function(c,A){c=g.u(c.actions);
for(var J=c.next();!J.done;J=c.next())if(J.value.actionId===A)return!0;return!1},sf=function(c,A,J,q,Y){g.P.call(this);
var p=this;this.K=c;this.nJ=A;this.CJ=J;this.D=q;this.o8=Y;this.C=new fwJ;this.Y=new g.eF;this.j=new g.hN(function(){p.retry()});
this.X=NaN;this.U=!1;this.lr={St0:function(){return p.C},
Xk:function(){return p.Y},
Heg:function(){return p.j},
retry:function(){return p.retry()}};
g.U(this,this.j);this.L=this.K.observe(this.l$.bind(this))},yNN=function(c,A,J,q,Y){var p;
return g.S(function(m){if(m.K==1)return p=new sf(c,A,J,q,Y),g.X(m,tyH(p),2);itC(p);return m.return(p)})},itC=function(c){var A=c.C.actions[0];
return c.T?((A==null?void 0:A.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&c.T[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(c.U=!0),Promise.resolve()):eYR(c)},eYR=function(c){var A,J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C;
return g.S(function(G){switch(G.K){case 1:if(c.T)throw Error("Already processing an action");if(c.Uq())return G.return();A=c.C.actions.shift();VgR(c.CJ,!A);if(A===void 0)return G.return();A.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&A.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&awM(c.C,A.actionId);J="";A.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&A.rootActionId===A.actionId&&(J=A.actionId);q=[A];c.T=q;if(Y=c.nJ[A.entityType]){G.Tx(2);break}c.T=
void 0;return g.X(G,eYR(c),3);case 3:return G.return();case 2:p=g.u(q);for(m=p.next();!m.done;m=p.next())E=m.value,shr(E,2);g.$I(G,4,5);return g.X(G,Tew(Y,q.map(function(Z){return Z.action})),7);
case 7:O=G.C,T=g.u(q),R=T.next();case 8:if(R.done){G.Tx(10);break}r=R.value;H=O.get(r.action);return g.X(G,nV9(c,r,H),9);case 9:R=T.next();G.Tx(8);break;case 10:awM(c.C,J);case 5:g.Q3(G);c.T=void 0;g.Zc(G,6);break;case 4:return V=g.F$(G),qi("Orchestration error",V),g.$I(G,12),g.X(G,KOr(c,q),14);case 14:g.GW(G,5);break;case 12:N=g.F$(G);qi("Orchestration retry error",N);w=g.u(q);for(W=w.next();!W.done;W=w.next())C=W.value,C.retryScheduleIndex<3&&lwr(c.C,[C]);G.Tx(5);break;case 6:return g.X(G,eYR(c),
0)}})},nV9=function(c,A,J){var q,Y,p,m,E,O,T,R,r,H,V,N;
return g.S(function(w){switch(w.K){case 1:q=A.retryScheduleIndex+2===3;if(J.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){w.Tx(2);break}if(J.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){w.Tx(0);break}Uww(A,J,q);if(J.C&&A.retryScheduleIndex+1<3)return g.X(w,KOr(c,[A]),0);p=((Y=J)==null?0:Y.K)?J.K:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";m={entityKey:A.action.entityKey,failureReason:p};E=void 0;g.c1(c.o8)?E="mainVideoDownloadStateEntity":g.fk(c.o8)&&(E="musicTrackDownloadMetadataEntity");
if(!E||!J.downloadState){w.Tx(7);break}O=g.c5(A.action.entityKey).entityId;return g.X(w,Hk(O,E,c.K,J.downloadState),7);case 7:mk(c.D,m);if(J.downloadState==="DOWNLOAD_STATE_FAILED"&&c.o8.W("html5_auto_retry_failed_pde_actions")){w.Tx(0);break}qi("Orchestration result is not retryable, deleting action");return g.X(w,IkH(c.K,oo(A).key),0);case 2:T=void 0;try{T=(R=J.T)==null?void 0:R.map(function(W){return c.createAction(W,A)})}catch(W){return Uww(A,J,q),r={entityKey:A.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},mk(c.D,r),qi("Orchestration subactions creation error",W),w.return()}Uww(A,J,q,T);if(!T){w.Tx(12);break}H=T.map(function(W){return oo(W)});
V=0;case 13:if(!(V<T.length)||c.U){w.Tx(15);break}return g.X(w,em(c.K,{mode:"readwrite",Hf:!0},function(W){var C=[];C.push(WUr(W,H.slice(V,V+10),"offlineOrchestrationActionWrapperEntity"));return g.Lh.all(C)}),16);
case 16:V+=10;w.Tx(13);break;case 15:if(c.U)return c.U=!1,w.return();case 12:return N=oo(A),g.X(w,IkH(c.K,N.key),17);case 17:shr(A,4),g.u$(w)}})},A29=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V;
return g.S(function(N){J=[];q=Infinity;Y=4E3;p=g.u(A);for(m=p.next();!m.done;m=p.next())E=m.value,O=Number(E.enqueueTimeSec),T=hYr(O),R=E.retryScheduleIndex,r=R!=null&&R>0,T>0&&r?(q=Math.min(q,O),Y=Math.min(T,Y)):J.push(E);isFinite(q)&&(!c.j.isActive()||q<c.X)&&(c.X=q,c.j.start(Y));c.Y.x6()||(H=J.length,J=J.filter(function(w){var W;w=((W=w.actionProto)==null?void 0:W.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!BeM.includes(w)}),V=J.length<H,!c.j.isActive()&&V&&c.j.start(1));
J.length>0&&c2N(c,J);return g.X(N,itC(c),0)})},qtw=function(c){var A,J,q,Y,p,m,E;
return g.S(function(O){if(O.K==1)return g.X(O,J2O(c),2);A=O.C;J=[];q=g.u(A);for(Y=q.next();!Y.done;Y=q.next())p=Y.value,m=g.c5(p.key),E=m.entityId,btM(c.C,E)||J.push(p);return g.X(O,A29(c,J),0)})},hYr=function(c){c=c*1E3-Date.now();
return c>4E3?4E3:c},KOr=function(c,A){var J,q,Y;
return g.S(function(p){J=g.u(A);for(q=J.next();!q.done;q=J.next()){Y=q.value;var m=void 0,E=void 0,O=((E=Y.action)==null?void 0:(m=E.actionMetadata)==null?void 0:m.retryScheduleIntervalsInSeconds)||[1,2,4];m=1;Y.retryScheduleIndex<O.length&&(m=O[Y.retryScheduleIndex]);Y.C=m*1E3+Date.now();Y.retryScheduleIndex++}return g.X(p,Yt9(c,A),0)})},tyH=function(c){var A;
return g.S(function(J){if(J.K==1)return g.X(J,hK(c.K,"offlineOrchestrationActionWrapperEntity"),2);A=J.C;return g.X(J,A29(c,A),0)})},c2N=function(c,A){A.length!==0&&A.forEach(function(J){J=gx(J);
J.retryScheduleIndex<3&&lwr(c.C,[J])})},J2O=function(c,A){var J;
return g.S(function(q){if(q.K==1)return g.X(q,hK(c.K,"offlineOrchestrationActionWrapperEntity",A),2);J=q.C;return q.return(J.filter(fkO))})},Yt9=function(c,A){if(A.length===0)return Promise.resolve([]);
A=A.map(function(J){return oo(J)});
return ZPJ(c.K,A)},pdO=function(c){this.a8=c;
this.C=void 0},mmN=function(c,A){var J,q,Y,p;
return g.S(function(m){J=A.videoId;q=!0;if(A.captionTracks.length)Y=ozV(A),c.C=new g.kt(c.a8,A,Y);else if(A.IZ)p=g.ZR$(A),c.C=new g.ol(c.a8,A.IZ,J,p,A.Yo,A.eventId),q=A.Yo;else return m.return();return m.return(new Promise(function(E){var O;(O=c.C)==null||O.yT({lY:function(){return g.S(function(T){if(T.K==1)return g.X(T,c.lY(J,q),2);E();g.u$(T)})},
oS:function(){}})}))})},jfO=function(c){var A;
return g.S(function(J){if(J.K==1)return g.X(J,iPM(c),2);A=J.C;return J.return(!!A&&A.length>0)})},Uf=function(c){g.P.call(this);
this.C=c;this.K=this.C.observe(this.j.bind(this))},dmR=function(c,A){var J,q,Y,p,m,E,O;
return g.S(function(T){switch(T.K){case 1:if(A.length===0)return T.return([]);J=A.map(function(R){return g.A5(R,"transfer")});
return g.X(T,hK(c.C,"transfer",J),2);case 2:q=T.C;Y=q.filter(fkO).map(function(R){return g.c5(R.key).entityId});
p=A.filter(function(R){return Y.indexOf(R)===-1});
if(p.length===0)return T.return([]);m=g.u(p);E=m.next();case 3:if(E.done){T.Tx(5);break}O=E.value;return g.X(T,LON(O),4);case 4:E=m.next();T.Tx(3);break;case 5:return T.return(p)}})},Tce=function(c,A,J,q,Y,p){var m,E,O;
return g.S(function(T){m="STREAM_TYPE_UNKNOWN";J.video&&J.audio?(m="STREAM_TYPE_AUDIO_AND_VIDEO",qi("unexpected stream type")):J.video&&!J.audio?m="STREAM_TYPE_VIDEO":!J.video&&J.audio&&(m="STREAM_TYPE_AUDIO");E=g.A5(A,"offlineVideoStreams");O={numBytesDownloaded:Y.toFixed(),numTotalBytes:p.toFixed(),streamType:m,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(q),itag:m==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(J.itag):void 0};return g.X(T,em(c,{mode:"readwrite",Hf:!0},
function(R){var r=f8(R,E,"offlineVideoStreams"),H=f8(R,g.A5(A,"transfer"),"transfer");return g.Lh.all([r,H]).then(function(V){V=g.u(V);var N=V.next().value;V=V.next().value;if(!V)return tK(R,E).then(function(){});
var w=Eir(N);N=Oje(N,q,O,E);var W=bq(R,N,"offlineVideoStreams");Eir(N)>w&&(V.lastProgressTimeMs=Date.now().toString());w=[W];V.offlineVideoStreams||(V.offlineVideoStreams=[]);V.offlineVideoStreams.indexOf(E)===-1&&(V.offlineVideoStreams.push(E),w.push(bq(R,V,"transfer")));return g.Lh.all(w)})}),0)})},RhV=function(c,A){var J,q,Y,p,m;
return g.S(function(E){if(E.K==1)return J=g.A5(A,"offlineVideoStreams"),g.X(E,K8(c,J,"offlineVideoStreams"),2);q=E.C;if(!q||!q.streamsProgress)return E.return();Y=g.u(q.streamsProgress);for(p=Y.next();!p.done;p=Y.next())m=p.value,m.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",m.numTotalBytes!==m.numBytesDownloaded&&(m.numBytesDownloaded=m.numTotalBytes);return g.X(E,n8(c,q,"offlineVideoStreams"),0)})},Oje=function(c,A,J,q){if(c&&c.streamsProgress){q=c;
a:{A=A.itag+";"+A.xtags;for(var Y=c.streamsProgress,p=0;p<Y.length;p++){var m=JSON.parse(Y[p].formatStreamBytes);if(m.itag+";"+m.xtags===A){Y[p]=J;J=Y;break a}}Y.push(J);J=Y}q.streamsProgress=J}else c={key:q,streamsProgress:[J]};return c},Eir=function(c){if(c==null?0:c.streamsProgress){var A=0;
c=c.streamsProgress;for(var J=0;J<c.length;J++){var q=c[J];isNaN(Number(q.numBytesDownloaded))?qi("stream progress bytes number invalid"):A+=Number(q.numBytesDownloaded)}return A}return 0},r2C=function(c,A,J,q){g.P.call(this);
var Y=this;this.K=c;this.api=A;this.xT=J;this.l$=q;this.Y=new g.eF;this.T=new g.hN(function(){Y.C&&Y.C.transferState==="TRANSFER_STATE_TRANSFERRING"&&Y.Y.x6()&&((Y.C.transferRetryCount||0)<3?Pk(Y.D,Y.U,!1,!1):xT(Y.D,Y.U.videoDetails.videoId),Y.sI("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.CJ=this.Oq=0;this.L=this.X=!1;this.Ba=g.V8(this.api.B().experiments,"html5_transfer_processing_logs_interval");this.eg=new g.sM(this);this.lr={W0D:function(){return Y.T},
K0F:function(){return Y.l$},
Xk:function(){return Y.Y}};
this.nJ=this.K.observe(this.m7.bind(this));this.D=new WOV(A,this);this.I8=new pdO(A);this.Fl=new Uf(this.K);this.wF=this.Y.listen("publicytnetworkstatus-online",this.rd.bind(this));this.dF=this.Y.listen("publicytnetworkstatus-offline",this.phJ.bind(this));this.L=this.api.B().W("html5_less_transfer_processing_logs");g.U(this,this.eg);this.eg.Z(A,"offlinetransferpause",this.GJy);g.c1(this.api.B())?this.j="mainVideoDownloadStateEntity":g.fk(this.api.B())&&(this.j="musicTrackDownloadMetadataEntity")},
Hje=function(c){return g.S(function(A){if(A.K==1)A=g.X(A,bPM(),2);
else{var J=c.Fl;var q=g.XL();q=Object.keys(q);J=dmR(J,q);A=g.X(A,J,0)}return A})},lX=function(c,A){A=A===void 0?!1:A;
var J;return g.S(function(q){if(q.K==1){if(c.C)throw Error("Already downloading a video");c.CJ=0;c.X=!1;return g.X(q,VSR(c),2)}return q.K!=4?(J=q.C,NWR(c.xT,!J),J&&c.Y.x6()?A?g.X(q,new Promise(function(Y){g.DA(Y,1E3)}),4):q.Tx(4):(!J&&c.C&&fS(c),q.Tx(0))):g.X(q,NcV(c,J),0)})},Dmi=function(c){return g.S(function(A){if(A.K==1)return c.U?g.X(A,xT(c.D,c.U.videoDetails.videoId),3):A.Tx(0);
fS(c);g.u$(A)})},ksR=function(c,A){var J,q,Y;
return g.S(function(p){switch(p.K){case 1:return g.$I(p,2),(J=!!A.captionTracks.length||!!A.IZ)?g.X(p,jfO(A.videoId),4):p.return();case 4:return(q=p.C)?p.return():g.X(p,mmN(c.I8,A),5);case 5:g.GW(p,0);break;case 2:Y=g.F$(p),qi("Caption downloading error",Y,A.cotn),g.u$(p)}})},NcV=function(c,A){var J,q,Y,p,m,E;
return g.S(function(O){switch(O.K){case 1:if(c.X)return O.return();c.X=!0;c.C=A;J=g.c5(c.C.key);q=J.entityId;Y=void 0;if(c.C.transferState==="TRANSFER_STATE_TRANSFERRING")return g.X(O,ao(c,q),7);if(c.C.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||c.C.transferRetryCount||c.C.hasLoggedFirstStarted){O.Tx(3);break}return g.X(O,ao(c,q),5);case 5:return Y=O.C,c.C.hasLoggedFirstStarted=!0,g.X(O,giH(c),6);case 6:kKC({videoId:q,Se:c.C,offlineModeType:Y},void 0,void 0,!0);O.Tx(3);break;case 7:Y=O.C,
Ef({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:q,Se:c.C,offlineModeType:Y});case 3:return g.X(O,oiC(c),8);case 8:return p=null,g.$I(O,9),g.X(O,uzC(c,A),11);case 11:p=O.C;c.U=p;g.GW(O,10);break;case 9:return m=g.F$(O),qi("error getting player response",m,A.cotn),g.X(O,c.sI("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return O.return();case 10:return E=LPr(c.api.B(),A.cotn,p),g.X(O,ksR(c,E),13);case 13:return g.X(O,GlH(E.videoId),
14);case 14:E.Tn=O.C,vVH(c.D,E,A.maximumDownloadQuality),c.T.start(108E5),g.u$(O)}})},VSR=function(c){var A,J;
return g.S(function(q){if(q.K==1)return g.X(q,hK(c.K,"transfer"),2);A=q.C;J=A.filter($mx).sort(wdx);return J.length===0?q.return():q.return(J[0])})},oiC=function(c){var A,J,q;
return g.S(function(Y){if(Y.K==1){if(!c.C)return bX(c,"onTransferStart"),Y.return();c.T.start(108E5);return g.X(Y,tn(c,"TRANSFER_STATE_TRANSFERRING"),2)}A=c.C;return(q=((J=A)==null?0:J.key)?g.c5(A.key).entityId:"")&&c.j?g.X(Y,Hk(q,c.j,c.K,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):Y.Tx(0)})},MyC=function(c){var A,J,q,Y;
g.S(function(p){switch(p.K){case 1:if(!c.C){bX(c,"onTransferPausedByUser");p.Tx(2);break}A=c.C;c.T.stop();return g.X(p,tn(c,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:q=((J=A)==null?0:J.key)?g.c5(A.key).entityId:"";if(!q||!c.j){p.Tx(4);break}return g.X(p,Hk(q,c.j,c.K,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.X(p,ao(c,q),6);case 6:Y=p.C,oGO({videoId:q,Se:A,offlineModeType:Y});case 2:fS(c),lX(c),g.u$(p)}})},FOH=function(c){var A,J,q;
g.S(function(Y){if(Y.K==1){if(!c.C)return bX(c,"onTransferPausedByNetwork"),Y.return();c.T.stop();return g.X(Y,tn(c,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(Y.K!=3)return A=c.C,(q=((J=A)==null?0:J.key)?g.c5(A.key).entityId:"")&&c.j?g.X(Y,Hk(q,c.j,c.K,"DOWNLOAD_STATE_PAUSED"),3):Y.Tx(3);fS(c);g.u$(Y)})},WW9=function(c){var A,J,q,Y,p;
g.S(function(m){switch(m.K){case 1:if(!c.C)return bX(c,"onTransferComplete"),m.return();A=c.C;c.T.stop();if(!A||!c.U){m.Tx(2);break}J=LPr(c.api.B(),A.cotn,c.U);return g.X(m,ksR(c,J),2);case 2:return g.X(m,tn(c,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:Y=((q=A)==null?0:q.key)?g.c5(A.key).entityId:"";if(!Y||!c.j){m.Tx(5);break}return g.X(m,Hk(Y,c.j,c.K,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.X(m,RhV(c.K,Y),7);case 7:return g.X(m,ao(c,Y),8);case 8:p=m.C,Ef({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:Y,Se:A,offlineModeType:p}),fS(c),lX(c),g.u$(m)}})},LWH=function(c,A,J){var q,Y;
g.S(function(p){switch(p.K){case 1:if(!c.C)return bX(c,"onTransferProgress: "+A),p.return();if(c.C.transferState==="TRANSFER_STATE_TRANSFERRING"){p.Tx(2);break}return g.X(p,oiC(c),2);case 2:q=Date.now();if(!(q-c.Oq>1E3)){p.Tx(4);break}c.Oq=q;return g.X(p,Tce(c.K,J.videoId,J.K,J.vI,J.bytesDownloaded,J.C),5);case 5:if(c.L&&!(c.L&&q-c.CJ>c.Ba)){p.Tx(4);break}c.CJ=q;return g.X(p,ao(c,A),7);case 7:Y=p.C,kKC({videoId:A,Se:c.C,offlineModeType:Y},J.bytesDownloaded,J.C);case 4:c.T.start(108E5),g.u$(p)}})},
GsN=function(c){var A=(c.C.transferRetryCount||0)<3;
A&&(c=c.C,c.transferRetryCount=(c.transferRetryCount||0)+1);return A},CvC=function(c,A){A=A===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":A;
var J,q,Y,p;return g.S(function(m){if(m.K==1)return c.C||bX(c,"setTransferToFailed: "+A),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A==="TRANSFER_FAILURE_REASON_NETWORK"?J="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":A==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.X(m,tn(c,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",A),2);if(m.K!=3)return mk(c.l$,{entityKey:(q=c.C)==null?void 0:q.key,failureReason:J}),
Y=c.C?g.c5(c.C.key).entityId:"",g.X(m,ao(c,Y),3);p=m.C;var E={videoId:Y,Se:c.C,offlineModeType:p},O=A,T={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};O&&(T.transferFailureReason=O,T.failureReason=uIR(O));Ef(T,E);g.u$(m)})},tn=function(c,A,J,q){var Y;
return g.S(function(p){if(p.K==1){if(!c.C)return bX(c,"saveTransferState: "+A),p.return();c.C.transferState=A;c.C.failureReason=q;g.$I(p,2);return g.X(p,giH(c,function(m){return J?lq(m,"offlineVideoStreams",c.C.offlineVideoStreams).then(function(E){for(var O=g.u(E),T=O.next();!T.done;T=O.next())if((T=T.value)&&T.streamsProgress){T=g.u(T.streamsProgress);for(var R=T.next();!R.done;R=T.next())R.value.streamState=J}return WUr(m,E.filter(function(r){return!!r}),"offlineVideoStreams")}):g.Lh.resolve(void 0)}),
4)}if(p.K!=2)return g.GW(p,0);
Y=g.F$(p);return Y instanceof g.kf&&Y.type==="QUOTA_EXCEEDED"?g.X(p,c.sI("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):p.Tx(0)})},giH=function(c,A){var J;
return g.S(function(q){if(!c.C)return q.return();J=c.C;return g.X(q,em(c.K,{mode:"readwrite",Hf:!0},function(Y){var p=[bq(Y,J,"transfer")];A&&p.push(A(Y));return g.Lh.all(p)}),0)})},fS=function(c){c.C=void 0;
c.U=void 0;c.T.stop()},uzC=function(c,A){var J,q,Y,p,m;
return g.S(function(E){if(E.K==1)return J=g.c5(A.key),q=J.entityId,Y=g.A5(q,"playbackData"),g.X(E,K8(c.K,Y,"playbackData"),2);p=E.C;if((m=p)==null?0:m.playerResponseJson)return E.return(JSON.parse(p.playerResponseJson));throw Error("No PlayerResponse found");})},bX=function(c,A){c.api.b$("woffle",{mcte:A});
qi("missing current transfer entity.")},ao=function(c,A){var J,q,Y;
return g.S(function(p){if(p.K==1)return g.X(p,K8(c.K,g.A5(A,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);J=p.C;return p.return((Y=(q=J)==null?void 0:q.offlineModeType)!=null?Y:void 0)})},$mx=function(c){return MSV[c.transferState]!==void 0},wdx=function(c,A){var J=MSV[c.transferState],q=MSV[A.transferState];
return J!==q?J-q:Number(c.enqueuedTimestampMs)-Number(A.enqueuedTimestampMs)},iX=function(c,A){var J=this;
this.o8=c;this.api=A;this.Y=new g.eF;this.U=new g.Ho;this.lr={Vv:function(){return J.j.lr.Vv()},
Xk:function(){return J.Y},
rlT:function(){return J.j},
YQ:function(){return J.YQ()},
Bz:function(){return J.Bz()},
zH:function(){return J.zH()},
oV:function(){return J.oV()},
uO:function(){return J.uO()},
iV:function(q){return J.iV(q)}};
this.j=new RLH(function(){return FWr(J)},function(){J.zH()},this.api.MB(),this.api.W.bind(this.api));
this.C=new pS(this.api);ryi(this.j)},FWr=function(c){return g.S(function(A){c.api.gF("onOrchestrationBecameLeader");
return g.X(A,c.Bz(),0)})},Qfx=function(c){var A,J;
return g.S(function(q){if(q.K==1)return g.X(q,BU(),2);if(q.K!=3){A=q.C;if(!A)return qi("PES is undefined"),q.return();c.K=new r2C(A,c.api,c.j,c.C);J=c.Lx(A);return g.X(q,yNN(A,J,c.j,c.C,c.o8),3)}c.D=q.C;return g.X(q,vi9(c),0)})},vi9=function(c){var A;
return g.S(function(J){switch(J.K){case 1:if(!c.K)return qi("transferManager is undefined"),J.return();if(c.K.C){J.Tx(2);break}return g.X(J,lX(c.K),2);case 2:if(!c.o8.W("woffle_enable_main_downloads_library")){J.Tx(4);break}return g.X(J,c.BD(),4);case 4:if(!c.o8.W("html5_offline_playback_position_sync")){J.Tx(6);break}return g.X(J,c.rU(),7);case 7:return g.X(J,c.iV(864E5),6);case 6:return g.X(J,c.refreshAllStaleEntities(43200,!0),9);case 9:return g.X(J,c.kG(),10);case 10:if(!c.o8.W("html5_retry_downloads_for_expiration")){J.Tx(11);
break}return g.X(J,c.uO(),11);case 11:return c.X=g.kh(function(){c.refreshAllStaleEntities(43200,!0);c.kG()},9E5),g.cm(g.Jt(),function(){return c.oV()}),g.X(J,BU(),13);
case 13:return A=J.C,g.X(J,TWH(A),14);case 14:HGH(c.j),g.u$(J)}})},XdH=function(){var c,A,J,q,Y,p;
return g.S(function(m){switch(m.K){case 1:return g.X(m,BU(),2);case 2:c=m.C;if(!c)return m.return([]);A=Date.now()/1E3;return g.X(m,hK(c,"offlineVideoPolicy"),3);case 3:J=m.C,q=g.u(J),Y=q.next();case 4:if(Y.done){m.Tx(6);break}p=Y.value;if(!(p.expirationTimestamp&&Number(p.expirationTimestamp)<A)){m.Tx(5);break}p.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";p.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.X(m,n8(c,p,"offlineVideoPolicy"),5);
case 5:Y=q.next();m.Tx(4);break;case 6:return m.return(J.map(function(E){return E.key}))}})},yG=function(c,A,J,q,Y){var p,m,E;
return g.S(function(O){if(O.K==1)return g.X(O,BU(),2);p=O.C;if(!p)return O.return([]);m=A.map(function(T){var R=g.A5(T,J);R={actionType:q,entityKey:R,actionMetadata:Object.assign({},GKH(),Y)};q!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(R.actionMetadata.priority=0);T=new kT(J,T,R);return oo(T)});
E=ZPJ(p,m);ryi(c.j);return O.return(E)})},ZjR=function(c,A,J,q){var Y,p,m,E,O,T,R,r;
return g.S(function(H){switch(H.K){case 1:Y=[],p=g.u(A),m=p.next();case 2:if(m.done){H.Tx(4);break}E=m.value;if(E.upToDate||J&&!E.shouldAutoSyncMetadata||!E.playlistId){H.Tx(3);break}O={};switch(q){case "mainPlaylistEntity":T={nextAutoRefreshIntervalSeconds:E.checkInSeconds,autoSync:J};O={mainPlaylistEntityActionMetadata:T};break;case "musicPlaylist":R={autoSync:J},O={musicPlaylistEntityActionMetadata:R}}return g.X(H,yG(c,[E.playlistId],q,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O),6);case 6:(r=
H.C)&&Y.push.apply(Y,g.M(r));case 3:m=p.next();H.Tx(2);break;case 4:return H.return(Y)}})},IqJ=function(c,A){var J;
return g.S(function(q){return A.length?(J=GKH(),g.fK(J,zO,{isEnqueuedForExpiredStreamUrlRefetch:!0}),c.api.b$("qrd",{v:A.length}),q.return(yG(c,A,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J))):q.return([])})},zhe=function(c,A,J){this.C=c;
this.o8=A;this.j=J},PvV=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G;
return g.S(function(Z){switch(Z.K){case 1:return J=Of(A),q=g.c5(A.entityKey),Y=q.entityId,p=[],g.$I(Z,2),g.X(Z,StV(c,Y),4);case 4:p=Z.C;if(!(c.o8.W("woffle_enable_main_downloads_library")&&((m=p)==null?0:m.length))){Z.Tx(5);break}return g.X(Z,scJ(c.C,[A.entityKey]),5);case 5:g.GW(Z,3);break;case 2:return E=g.F$(Z),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.kf&&E.type==="QUOTA_EXCEEDED"?(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):qi("Playlist add error"),Z.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,O,T));case 3:R=[];if(!c.o8.W("html5_offline_prevent_redownload_downloaded_video")){Z.Tx(7);break}return g.X(Z,WPi(c.C,"mainVideoEntity",p),8);case 8:p=Z.C;case 7:if((r=p)==null?0:r.length)for(H=g.u(p),V=H.next();!V.done;V=H.next())if(N=V.value,w=N.offlineVideoData,W=void 0,(W=w)==null?0:W.videoId)C=void 0,G=Number(((C=A.actionMetadata)==null?void 0:C.priority)||
0)+1,R.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w.videoId,"mainVideoEntity",G,ec,xmH(A,w,Y)));return Z.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,R))}})},UmC=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI,cw,EL,h,wa,M8,b$,Gw,OO,vw,CI,mM,L,da,eN,WL,vr,Dx,fI,xH,QJ,F,v,Q,z,a,LI,Jd,kI,YI,X$,hd,Wr,Lc,IY,eP,y6,nm,w6,rn,Xm,gA,ZM,ik,yS,Cp,mc,Km,dv,Mw,yP;
return g.S(function(gv){switch(gv.K){case 1:return J=Of(A),q=A.entityKey,Y=g.c5(q).entityId,p=[],m=!1,Y==="!*$_ALL_ENTITIES_!*$"?(m=!0,g.X(gv,hK(c.C,"mainPlaylistEntity"),5)):g.X(gv,K8(c.C,q,"mainPlaylistEntity"),4);case 4:(E=gv.C)&&p.push(E);gv.Tx(3);break;case 5:p=gv.C;case 3:if((O=p)==null||!O.length)return gv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));T=g.l(A.actionMetadata,sfH);r=(R=T)==null?void 0:R.nextAutoRefreshIntervalSeconds;V=(H=T)==null?void 0:H.autoSync;N=[];W=w=
!0;C=!1;if(!m&&V===!1){gv.Tx(6);break}g.$I(gv,7);return g.X(gv,cNw(0,!!V,!0,p),9);case 9:N=gv.C;g.GW(gv,8);break;case 7:G=g.F$(gv);if(!(G instanceof Error&&G.message==="No data")){G instanceof Error&&G.message==="Empty response body"&&qi(G.message);gv.Tx(8);break}return Y==="!*$_ALL_ENTITIES_!*$"?g.X(gv,ZGr(c.C,A,c.j,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.X(gv,Qcw(Y,c.C,A,c.j),8);case 8:if(!N.length||!m&&N[0].playlistId!==Y)return gv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J));case 6:if(m){Z=[];I=g.u(N);for(f=I.next();!f.done;f=I.next())K=f.value,K.upToDate||V&&!K.shouldAutoSyncMetadata||!K.playlistId||(y={nextAutoRefreshIntervalSeconds:K.checkInSeconds,autoSync:V},Z.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",K.playlistId,"mainPlaylistEntity",0,ec,{mainPlaylistEntityActionMetadata:y})));return gv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,Z))}N.length&&(q8=N[0],C=!!q8.upToDate,V&&(w=(pI=q8.shouldAutoSyncMetadata)!=null?pI:!0,W=(cw=q8.shouldAutoSyncVideos)!=
null?cw:!0,q8.checkInSeconds&&(r=q8.checkInSeconds)));if(C||!w)return gv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));EL=[];h=p[0];if(!h.downloadState){wa=void 0;gv.Tx(15);break}return g.X(gv,K8(c.C,h.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:wa=gv.C;case 15:return M8=wa,Gw=((b$=M8)==null?0:b$.addedTimestampMillis)?String(M8.addedTimestampMillis):void 0,g.$I(gv,17),g.X(gv,StV(c,Y,Gw,r),19);case 19:EL=gv.C;g.GW(gv,18);break;case 17:OO=g.F$(gv);if(!(OO instanceof
Error&&OO.message==="No data for playlist")){if(OO instanceof Error&&OO.message==="Empty response body for playlist")qi(OO.message);else return vw="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",CI="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",OO instanceof g.kf&&OO.type==="QUOTA_EXCEEDED"&&(vw="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",CI="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),gv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,vw,CI));
gv.Tx(18);break}return g.X(gv,Qcw(Y,c.C,A,c.j),18);case 18:if(!W)return gv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));mM=[];L=new Map;if((da=EL)==null?0:da.length)for(eN=g.u(EL),WL=eN.next();!WL.done;WL=eN.next())vr=WL.value,Dx=vr.offlineVideoData,fI=void 0,((fI=Dx)==null?0:fI.videoId)&&L.set(Dx.videoId,Dx);xH=new Map;QJ=[];if((F=h)==null?0:(v=F.videos)==null?0:v.length)for(Q=g.u(h.videos),z=Q.next();!z.done;z=Q.next())if(a=z.value,LI=JSON.parse(g.c5(a).entityId),Jd=LI.videoId)L.has(Jd)?
(xH.set(Jd,L.get(Jd)),L.delete(Jd)):QJ.push(Jd);YI=Number(((kI=A.actionMetadata)==null?void 0:kI.priority)||0)+1;X$=g.u(L.entries());for(hd=X$.next();!hd.done;hd=X$.next())Wr=hd.value,Lc=g.u(Wr),IY=Lc.next().value,eP=Lc.next().value,y6=IY,nm=eP,mM.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y6,"mainVideoEntity",YI,ec,xmH(A,nm,Y)));w6=g.u(xH.entries());for(rn=w6.next();!rn.done;rn=w6.next())Xm=rn.value,gA=g.u(Xm),ZM=gA.next().value,ik=gA.next().value,yS=ZM,Cp=ik,mM.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
yS,"mainVideoEntity",YI,ec,xmH(A,Cp,Y)));mc=g.u(QJ);for(Km=mc.next();!Km.done;Km=mc.next())dv=Km.value,Mw={playlistId:Y},yP={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Mw},mM.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",dv,"mainVideoEntity",0,ec,yP));return gv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,mM))}})},fqO=function(c,A){var J,q,Y,p;
return g.S(function(m){switch(m.K){case 1:return J=Of(A),g.$I(m,2),q=g.c5(A.entityKey).entityId,q==="!*$_ALL_ENTITIES_!*$"?g.X(m,ZGr(c.C,A,c.j,(Y=A.actionMetadata)==null?void 0:(p=Y.offlineLoggingData)==null?void 0:p.offlineDeleteReason),5):g.X(m,Qcw(q,c.C,A,c.j),6);case 6:if(!c.o8.W("woffle_enable_main_downloads_library")){m.Tx(5);break}return g.X(m,U$N(c.C,A.entityKey),5);case 5:g.GW(m,3);break;case 2:return g.F$(m),m.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return m.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J))}})},StV=function(c,A,J,q){var Y,p,m,E,O,T,R;
return g.S(function(r){switch(r.K){case 1:return g.X(r,hLr([A]),2);case 2:return Y=r.C,g.X(r,lqH(c,Y[0],J,q),3);case 3:return p=r.C,m=p.mainPlaylistEntity,E=p.cmx,T=FPr(m,(O=E)==null?void 0:O.avatar),g.$I(r,4),g.X(r,$T(T),6);case 6:g.GW(r,5);break;case 4:R=g.F$(r),R instanceof Error&&R.message==="Failed to fetch"&&qi(R.message);case 5:return r.return(Y[0].videos)}})},lqH=function(c,A,J,q){var Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I;
return g.S(function(f){switch(f.K){case 1:Y=Date.now().toString();J||(J=Y);p=A.videos;m=A.playlistId;E=[];O=[];if(p)for(T=g.u(p),R=T.next();!R.done;R=T.next()){r=R.value;H=r.offlineVideoData;if(!H||!H.videoId)throw qi("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");V=H.videoId;N={videoId:V,playlistId:m};w={id:g.A5(JSON.stringify(N),"mainPlaylistVideoEntity"),video:g.A5(V,"mainVideoEntity")};E.push(w);O.push(w.id)}C={key:g.A5(m,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:J,lastSyncedTimestampMillis:Y};G={key:g.A5(m,"mainPlaylistEntity"),playlistId:m,videos:O,title:A.title,thumbnailStyleData:aqH(A),visibility:bj9(A),downloadState:C.key};A.channel&&(Z=A.channel.offlineChannelData,W=tSH(g.A5(m,"ytMainChannelEntity"),Z),G.channelOwner=W.id);((I=G)==null?0:I.entityMetadata)?(G.entityMetadata.offlineLastModifiedTimestampSeconds=A.lastModifiedTimestamp,q&&(G.entityMetadata.nextAutoRefreshIntervalSeconds=String(q))):G&&(G.entityMetadata={nextAutoRefreshIntervalSeconds:q?
String(q):void 0,offlineLastModifiedTimestampSeconds:A.lastModifiedTimestamp});g.$I(f,2);return g.X(f,em(c.C,{mode:"readwrite",Hf:!0},function(K){var y=bq(K,G,"mainPlaylistEntity"),q8=bq(K,C,"mainPlaylistDownloadStateEntity");y=[y,q8];q8=g.u(E);for(var pI=q8.next();!pI.done;pI=q8.next())y.push(bq(K,pI.value,"mainPlaylistVideoEntity"));W&&y.push(bq(K,W,"ytMainChannelEntity"));return g.Lh.all(y)}),4);
case 4:g.GW(f,3);break;case 2:throw g.F$(f),qi("PES failure for playlist"),Error("PES failure for playlist");case 3:return f.return({mainPlaylistEntity:G,cmx:W,DXT:E})}})},tSH=function(c,A){return{id:c,
channelId:A.channelId,title:A.title,avatar:A.thumbnail}},aqH=function(c){var A=[],J=c.videos;
J&&J.length>0&&A.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:J[0].offlineVideoData.thumbnail}}});if((c=c.additionalMetadadatas)&&c.length>0)for(c=g.u(c),J=c.next();!J.done;J=c.next()){var q=J.value.offlineBundleItemPlaylistData,Y=void 0;J=(Y=q)==null?void 0:Y.style;Y=void 0;q={collageThumbnail:{coverThumbnail:(Y=q)==null?void 0:Y.coverThumbnail}};switch(J){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":A.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:q});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":A.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":A.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":A.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:q})}}return A},bj9=function(c){switch(c.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},xmH=function(c,A,J){A={offlineVideoData:A,
playlistId:J};if(c=g.l(c.actionMetadata,sfH))A.maximumDownloadQuality=c.maximumDownloadQuality;return{mainVideoEntityActionMetadata:A}},iji=function(c,A,J){this.C=c;
this.o8=A;this.j=J},niH=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N;
return g.S(function(w){switch(w.K){case 1:return J=Of(A),q=g.c5(A.entityKey),Y=q.entityId,p=g.l(A.actionMetadata,nS),E=!((m=p)==null?0:m.playlistId),g.$I(w,2),g.X(w,y2w(c,Y,void 0,(O=p)==null?void 0:O.offlineVideoData,E),4);case 4:g.GW(w,3);break;case 2:return T=g.F$(w),R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.kf&&T.type==="QUOTA_EXCEEDED"&&(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
w.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,R,r));case 3:H=1;H=Number(((V=A.actionMetadata)==null?void 0:V.priority)||0)+1;var W=(W=g.l(A.actionMetadata,nS))?{playbackDataActionMetadata:{maximumDownloadQuality:W.maximumDownloadQuality}}:void 0;N=Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y,"playbackData",H,ehR,W);return w.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,[N]))}})},KWN=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G;
return g.S(function(Z){switch(Z.K){case 1:return J=Of(A),q=g.c5(A.entityKey),Y=q.entityId,g.X(Z,K8(c.C,A.entityKey,"mainVideoEntity"),2);case 2:p=Z.C;if(!p){m=void 0;Z.Tx(3);break}return g.X(Z,K8(c.C,p.downloadState,"mainVideoDownloadStateEntity"),4);case 4:m=Z.C;case 3:E=m;if(!p||!E)return Z.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));g.$I(Z,5);return g.X(Z,y2w(c,Y,E.addedTimestampMillis,(T=g.l(A.actionMetadata,nS))==null?void 0:T.offlineVideoData),7);case 7:R=1;R=Number(((r=
A.actionMetadata)==null?void 0:r.priority)||0)+1;O=Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Y,"playbackData",R,ehR);g.GW(Z,6);break;case 5:H=g.F$(Z);if(!(H instanceof Error&&H.message==="No data")){if(H instanceof Error&&H.message==="Empty response body")qi(H.message);else return V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.kf&&H.type==="QUOTA_EXCEEDED"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Z.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,V,N));Z.Tx(6);break}return g.X(Z,LS(c.C,Y),9);case 9:w=Z.C;W=g.l(A.actionMetadata,nS);if(G=(C=W)==null?void 0:C.playlistId)w.playlistId=G;w.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.X(Z,wx(Y,c.C,A,c.j,w),6);case 6:return Z.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,O?[O]:void 0))}})},hhw=function(c,A){var J,q,Y,p,m,E,O,T,R,r;
return g.S(function(H){switch(H.K){case 1:return J=Of(A),g.$I(H,2),q=g.c5(A.entityKey).entityId,q==="!*$_ALL_ENTITIES_!*$"?g.X(H,ZGr(c.C,A,c.j,(R=A.actionMetadata)==null?void 0:(r=R.offlineLoggingData)==null?void 0:r.offlineDeleteReason),5):g.X(H,LS(c.C,q),6);case 6:Y=H.C;p=g.l(A.actionMetadata,nS);if(E=(m=p)==null?void 0:m.playlistId)Y.playlistId=E;Y.offlineDeleteReason=(O=A.actionMetadata)==null?void 0:(T=O.offlineLoggingData)==null?void 0:T.offlineDeleteReason;return g.X(H,wx(q,c.C,A,c.j,Y),7);
case 7:if(!c.o8.W("woffle_enable_main_downloads_library")){H.Tx(5);break}return g.X(H,U$N(c.C,A.entityKey),5);case 5:g.GW(H,3);break;case 2:return g.F$(H),H.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J))}})},y2w=function(c,A,J,q,Y){var p,m,E,O,T,R;
return g.S(function(r){switch(r.K){case 1:if(p=q){r.Tx(2);break}return g.X(r,KPO([A]),3);case 3:m=r.C,p=m[0];case 2:return g.X(r,Bcx(c,p,J,Y),4);case 4:E=r.C;O=E.mainVideoEntity;T=E.channelEntity;g.$I(r,5);var H=Dt(O.thumbnail),V=Dt(T.avatar);return g.X(r,$T(H.concat(V)),7);case 7:g.GW(r,0);break;case 5:R=g.F$(r),R instanceof Error&&R.message==="Failed to fetch"&&qi(R.message),g.u$(r)}})},Bcx=function(c,A,J,q){var Y,p,m,E,O,T,R,r,H,V,N,w,W;
return g.S(function(C){switch(C.K){case 1:J||(J=Date.now().toString());p=(Y=A.channel)==null?void 0:Y.offlineChannelData;m={id:g.A5(A.videoId,"ytMainChannelEntity"),channelId:p.channelId,title:p.title,avatar:p.thumbnail};E={key:g.A5(A.videoId,"mainVideoDownloadStateEntity"),playbackData:g.A5(A.videoId,"playbackData"),addedTimestampMillis:J,videoDownloadContextEntity:g.A5(A.videoId,"videoDownloadContextEntity")};O={key:g.A5(A.videoId,"videoPlaybackPositionEntity"),videoId:A.videoId,lastPlaybackPositionSeconds:"0"};
c.o8.W("html5_offline_playback_position_sync")&&(T={playbackPosition:O.key});R=g.A5(A.videoId,"mainVideoEntity");r={key:R,videoId:A.videoId,title:A.title,thumbnail:A.thumbnail,localizedStrings:{viewCount:A.shortViewCountText},userState:T,lengthSeconds:A.lengthSeconds?Number(A.lengthSeconds):void 0,publishedTimestampMillis:A.publishedTimestamp?(Number(A.publishedTimestamp)*1E3).toString():void 0,formattedDescription:A.description,owner:m.id,downloadState:E.key};if(!c.o8.W("woffle_enable_main_downloads_library")||
!q){C.Tx(2);break}return g.X(C,PtM(c.C,[R]),3);case 3:if(N=C.C)H=N.mainDownloadsLibraryEntity,V=N.mainDownloadsListEntity;case 2:return W=wo9,w={key:g.A5(A.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.fK(E,W,w),g.X(C,em(c.C,{mode:"readwrite",Hf:!0},function(G){var Z=bq(G,m,"ytMainChannelEntity"),I=bq(G,E,"mainVideoDownloadStateEntity"),f=bq(G,r,"mainVideoEntity");Z=[Z,I,f];c.o8.W("html5_offline_playback_position_sync")&&(I=bq(G,O,"videoPlaybackPositionEntity"),
Z.push(I));H&&(I=bq(G,H,"mainDownloadsLibraryEntity"),Z.push(I));V&&(I=bq(G,V,"mainDownloadsListEntity"),Z.push(I));w&&(G=bq(G,w,"downloadStatusEntity"),Z.push(G));return g.Lh.all(Z)}),4);
case 4:return C.return({mainVideoEntity:r,channelEntity:m})}})},cSH=function(c,A,J){this.C=c;
this.o8=A;this.j=J},JS9=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI,cw,EL,h;
return g.S(function(wa){switch(wa.K){case 1:return J=Of(A),q=[],g.X(wa,PU.getInstance(),2);case 2:Y=wa.C;if(!Y){wa.Tx(3);break}return g.X(wa,Y.get("sdois"),4);case 4:return p=wa.C,g.X(wa,(E=Y)==null?void 0:E.get("lmqf"),5);case 5:m=wa.C;case 3:g.$I(wa,6);if(p===void 0)throw Error("prefStorage or opt-in state is undefined");O=[];if(p){wa.Tx(8);break}return g.X(wa,x$r(c.C),9);case 9:O=wa.C,O.reverse();case 8:if(!O.length){wa.Tx(10);break}T=g.u(O);R=T.next();case 11:if(R.done){wa.Tx(10);break}r=R.value;
if(!r){wa.Tx(12);break}H=g.c5(r).entityId;return g.X(wa,LS(c.C,H),14);case 14:return V=wa.C,V.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.X(wa,wx(H,c.C,{entityKey:r,actionType:A.actionType},c.j,V),12);case 12:R=T.next();wa.Tx(11);break;case 10:return g.X(wa,JNC(p,(N=m)!=null?N:"SD"),16);case 16:return w=wa.C,g.X(wa,IIw(w),17);case 17:W=SoM(w);if(!c.o8.W("woffle_enable_main_downloads_library")){wa.Tx(18);break}if(p){wa.Tx(19);break}return g.X(wa,U$N(c.C,g.IC),19);case 19:return g.X(wa,
scJ(c.C,[g.IC]),18);case 18:if((C=W)==null?0:C.length)for(G=g.u(W),Z=G.next();!Z.done;Z=G.next())if(f=I=Z.value,K=f.actionType,y=f.entityKey,q8=f.actionMetadata,K&&y&&q8&&!g.l(q8,ASC)){K==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(q8.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(pI=g.l(I.actionMetadata,nS))pI.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",I.actionMetadata=Object.assign({},I.actionMetadata,{mainVideoEntityActionMetadata:pI});q.push(I)}g.GW(wa,
7);break;case 6:return cw=g.F$(wa),EL="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",cw instanceof g.kf&&cw.type==="QUOTA_EXCEEDED"&&(EL="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),wa.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,EL,h));case 7:return wa.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,q))}})},q5x=function(){iX.apply(this,
arguments);
this.L="mainVideoEntity"},Y5r=function(c,A,J){A=A===void 0?43200:A;
J=J===void 0?!0:J;var q=q===void 0?!1:q;var Y,p,m;return g.S(function(E){switch(E.K){case 1:if(!c.Y.x6())return E.return([]);Y=[];g.$I(E,2);return g.X(E,cNw(A,J,q),4);case 4:Y=E.C;g.GW(E,3);break;case 2:p=g.F$(E),p instanceof Error&&p.message==="No data"||p instanceof Error&&p.message==="Empty response body"&&qi(p.message);case 3:return m=ZjR(c,Y,J,"mainPlaylistEntity"),E.return(m)}})},pFe=function(c,A,J,q){q=q===void 0?!1:q;
var Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G;return g.S(function(Z){switch(Z.K){case 1:return Y=[],g.X(Z,ANi(),2);case 2:return(p=Z.C)||q?g.X(Z,qYM(A,J),3):Z.return([]);case 3:m=Z.C;if((E=m)==null||!E.length)return Z.return([]);O={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};T=g.u(m);R=T.next();case 4:if(R.done){Z.Tx(6);break}H=r=R.value;V=H.actionType;N=H.entityKey;w=H.actionMetadata;if(!(V&&N&&w)||g.l(w,ASC)){Z.Tx(5);break}V==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(w.offlineLoggingData=
O);W=g.c5(N);C=W.entityId;return g.X(Z,yG(c,[C],"mainVideoEntity",V,w),8);case 8:G=Z.C,Y=Y.concat(G);case 5:R=T.next();Z.Tx(4);break;case 6:return Z.return(Y)}})},mUO=function(c,A){this.C=c;
this.j=A},dU9=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C;
return g.S(function(G){switch(G.K){case 1:return J=Of(A),q=g.c5(A.entityKey),Y=q.entityId,p=[],g.$I(G,2),g.X(G,jTM(c,Y),4);case 4:p=G.C;if((m=p)==null||!m.length){G.Tx(5);break}return g.X(G,tgR(c.C,A.entityKey),5);case 5:g.GW(G,3);break;case 2:return E=g.F$(G),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.kf&&E.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
G.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,O,T));case 3:return R=[],g.X(G,WPi(c.C,"musicTrack",p),7);case 7:p=G.C;if(p.length)for(r=g.u(p),H=r.next();!H.done;H=r.next())if(V=H.value,N=V.offlineVideoData,w=void 0,(w=N)==null?0:w.videoId)W=void 0,C=Number(((W=A.actionMetadata)==null?void 0:W.priority)||0)+1,R.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N.videoId,"musicTrack",C,KS,Fj(A,N,Y)));return G.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,R))}})},
EUM=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI,cw,EL,h,wa,M8,b$,Gw,OO,vw,CI,mM,L,da,eN,WL,vr,Dx,fI,xH,QJ,F,v,Q,z,a,LI,Jd,kI,YI,X$,hd,Wr,Lc,IY,eP;
return g.S(function(y6){switch(y6.K){case 1:return J=Of(A),q=A.entityKey,Y=g.c5(q).entityId,p=[],m=!1,Y==="!*$_ALL_ENTITIES_!*$"?(m=!0,g.X(y6,hK(c.C,"musicAlbumRelease"),5)):g.X(y6,K8(c.C,q,"musicAlbumRelease"),4);case 4:(E=y6.C)&&p.push(E);y6.Tx(3);break;case 5:p=y6.C;case 3:if((O=p)==null||!O.length)return y6.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));if(m){T=[];R=g.u(p);for(r=R.next();!r.done;r=R.next())H=r.value,V=g.c5(H.id).entityId,T.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
V,"musicAlbumRelease",0,KS));return y6.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,T))}N=[];w=p[0];W=void 0;if(!w.downloadMetadata){y6.Tx(6);break}return g.X(y6,K8(c.C,w.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:C=y6.C,W=Number((Z=(G=C)==null?void 0:G.addedTimestampMillis)!=null?Z:"0")/1E3;case 6:return g.$I(y6,8),g.X(y6,jTM(c,Y,(I=W)==null?void 0:I.toString()),10);case 10:N=y6.C;g.GW(y6,9);break;case 8:f=g.F$(y6);if(!(f instanceof Error&&f.message===
"No data")){if(f instanceof Error&&f.message==="Empty response body")qi(f.message);else return K="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.kf&&f.type==="QUOTA_EXCEEDED"&&(K="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),y6.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,K,y));y6.Tx(9);break}return g.X(y6,CS(Y,"musicAlbumRelease",c.C,
A,c.j),9);case 9:q8=[];pI=new Map;if((cw=N)==null?0:cw.length)for(EL=g.u(N),h=EL.next();!h.done;h=EL.next())wa=h.value,M8=wa.offlineVideoData,b$=void 0,((b$=M8)==null?0:b$.videoId)&&pI.set(M8.videoId,M8);Gw=new Map;OO=[];if((vw=w)==null?0:(CI=vw.tracks)==null?0:CI.length)for(mM=g.u(w.tracks),L=mM.next();!L.done;L=mM.next())if(da=L.value,eN=g.c5(da).entityId)pI.has(eN)?(Gw.set(eN,pI.get(eN)),pI.delete(eN)):OO.push(eN);vr=Number(((WL=A.actionMetadata)==null?void 0:WL.priority)||0)+1;Dx=g.u(pI.entries());
for(fI=Dx.next();!fI.done;fI=Dx.next())xH=fI.value,QJ=g.u(xH),F=QJ.next().value,v=QJ.next().value,Q=F,z=v,q8.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Q,"musicTrack",vr,KS,Fj(A,z)));a=g.u(Gw.entries());for(LI=a.next();!LI.done;LI=a.next())Jd=LI.value,kI=g.u(Jd),YI=kI.next().value,X$=kI.next().value,hd=YI,Wr=X$,q8.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",hd,"musicTrack",vr,KS,Fj(A,Wr)));Lc=g.u(OO);for(IY=Lc.next();!IY.done;IY=Lc.next())eP=IY.value,q8.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
eP,"musicTrack",0,KS));return y6.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,q8))}})},O5H=function(c,A){var J,q;
return g.S(function(Y){switch(Y.K){case 1:return J=Of(A),g.$I(Y,2),q=g.c5(A.entityKey).entityId,q==="!*$_ALL_ENTITIES_!*$"?g.X(Y,Mi(c.C,A,c.j),5):g.X(Y,CS(q,"musicAlbumRelease",c.C,A,c.j),6);case 6:return g.X(Y,iGJ(c.C,A.entityKey),5);case 5:g.GW(Y,3);break;case 2:return g.F$(Y),Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},jTM=function(c,A,J){var q,Y,p;
return g.S(function(m){switch(m.K){case 1:return g.X(m,hLr([A]),2);case 2:return q=m.C,g.X(m,TUN(c,q[0],J),3);case 3:return Y=m.C,p=Dt(Y.thumbnailDetails),g.X(m,$T(p),4);case 4:return m.return(q[0].videos)}})},TUN=function(c,A,J){var q,Y,p,m,E,O,T,R,r,H,V,N,w,W;
return g.S(function(C){if(C.K==1){q=A.additionalMetadadatas;Y=void 0;if(q&&q.length>0)for(p=g.u(q),m=p.next();!m.done;m=p.next())if(E=m.value,E.offlineMusicPlaylistData){Y=E.offlineMusicPlaylistData;break}O=A.playlistId;T=yyC(A);R=T.Xw;r=T.mq;H=J?(Number(J)*1E3).toString():Date.now().toString();V=A.lastModifiedTimestamp?(Number(A.lastModifiedTimestamp)*1E3).toString():"0";N={id:g.A5(O,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:r,lastModifiedTimestampMillis:V,addedTimestampMillis:H,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};w={id:g.A5(O,"musicAlbumRelease"),title:A.title,audioPlaylistId:O,trackCount:A.totalVideoCount,tracks:R,downloadMetadata:N.id};Y&&(w.thumbnailDetails=(W=Y.albumHqThumbnail)!=null?W:Y.albumArtistThumbnail,w.artistDisplayName=Y.albumArtistDisplayName,w.releaseDate=Y.albumReleaseDate,w.contentRating={explicitType:Y.albumReleaseExplicitType},w.releaseType=Y.albumReleaseType);return g.X(C,em(c.C,{mode:"readwrite",Hf:!0},function(G){var Z=bq(G,w,"musicAlbumRelease");
G=bq(G,N,"musicAlbumReleaseDownloadMetadataEntity");return g.Lh.all([Z,G])}),2)}return C.return(w)})},R6C=function(c,A){this.C=c;
this.j=A},H5C=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C;
return g.S(function(G){switch(G.K){case 1:return J=Of(A),q=g.c5(A.entityKey),Y=q.entityId,p=[],g.$I(G,2),g.X(G,rSR(c,Y),4);case 4:p=G.C;if((m=p)==null||!m.length){G.Tx(5);break}return g.X(G,tgR(c.C,A.entityKey),5);case 5:g.GW(G,3);break;case 2:return E=g.F$(G),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.kf&&E.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
G.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,O,T));case 3:return R=[],g.X(G,WPi(c.C,"musicTrack",p),7);case 7:p=G.C;if(p.length)for(r=g.u(p),H=r.next();!H.done;H=r.next())if(V=H.value,N=V.offlineVideoData,w=void 0,(w=N)==null?0:w.videoId)W=void 0,C=Number(((W=A.actionMetadata)==null?void 0:W.priority)||0)+1,R.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N.videoId,"musicTrack",C,hn,Fj(A,N,Y)));return G.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,R))}})},
VlN=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI,cw,EL,h,wa,M8,b$,Gw,OO,vw,CI,mM,L,da,eN,WL,vr,Dx,fI,xH,QJ,F,v,Q,z,a,LI,Jd,kI,YI,X$,hd,Wr,Lc,IY,eP,y6,nm,w6,rn,Xm,gA,ZM,ik,yS,Cp,mc,Km;
return g.S(function(dv){switch(dv.K){case 1:return J=Of(A),q=A.entityKey,Y=g.c5(q).entityId,p=[],m=!1,Y==="!*$_ALL_ENTITIES_!*$"?(m=!0,g.X(dv,hK(c.C,"musicPlaylist"),5)):g.X(dv,K8(c.C,q,"musicPlaylist"),4);case 4:(E=dv.C)&&p.push(E);dv.Tx(3);break;case 5:p=dv.C;case 3:if((O=p)==null||!O.length)return dv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));T=g.l(A.actionMetadata,eLR);r=(R=T)==null?void 0:R.autoSync;H=[];N=V=!0;w=!1;W=void 0;if(!m&&r===!1){dv.Tx(6);break}g.$I(dv,7);return g.X(dv,
YY9(0,!!r,!0,p),9);case 9:H=dv.C;g.GW(dv,8);break;case 7:C=g.F$(dv);if(!(C instanceof Error&&C.message==="No data")){C instanceof Error&&C.message==="Empty response body"&&qi(C.message);dv.Tx(8);break}return Y==="!*$_ALL_ENTITIES_!*$"?g.X(dv,Mi(c.C,A,c.j),8):g.X(dv,CS(Y,"musicPlaylist",c.C,A,c.j),8);case 8:if(!H.length||!m&&H[0].playlistId!==Y)return dv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));case 6:if(m){G=[];Z=g.u(H);for(I=Z.next();!I.done;I=Z.next())f=I.value,f.upToDate||
r&&!f.shouldAutoSyncMetadata||!f.playlistId||(K={autoSync:r},G.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",f.playlistId,"musicPlaylist",0,hn,{musicPlaylistEntityActionMetadata:K})));return dv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,G))}H.length&&(y=H[0],w=!!y.upToDate,r&&(V=(q8=y.shouldAutoSyncMetadata)!=null?q8:!0,N=(pI=y.shouldAutoSyncVideos)!=null?pI:!0,y.checkInSeconds&&(W=y.checkInSeconds)));if(w||!V)return dv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J));cw=[];EL=p[0];h=void 0;if(!EL.downloadMetadata){dv.Tx(15);break}return g.X(dv,K8(c.C,EL.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:wa=dv.C,h=Number((b$=(M8=wa)==null?void 0:M8.addedTimestampMillis)!=null?b$:"0")/1E3;case 15:return g.$I(dv,17),g.X(dv,rSR(c,Y,(Gw=h)==null?void 0:Gw.toString(),W),19);case 19:cw=dv.C;g.GW(dv,18);break;case 17:OO=g.F$(dv);if(!(OO instanceof Error&&OO.message==="No data")){if(OO instanceof Error&&OO.message==="Empty response body")qi(OO.message);
else return vw="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",CI="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",OO instanceof g.kf&&OO.type==="QUOTA_EXCEEDED"&&(vw="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",CI="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),dv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,vw,CI));dv.Tx(18);break}return g.X(dv,CS(Y,"musicPlaylist",c.C,A,c.j),18);case 18:if(!N)return dv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J));mM=[];L=new Map;if((da=cw)==null?0:da.length)for(eN=g.u(cw),WL=eN.next();!WL.done;WL=eN.next())vr=WL.value,Dx=vr.offlineVideoData,fI=void 0,((fI=Dx)==null?0:fI.videoId)&&L.set(Dx.videoId,Dx);xH=new Map;QJ=[];if((F=EL)==null?0:(v=F.tracks)==null?0:v.length)for(Q=g.u(EL.tracks),z=Q.next();!z.done;z=Q.next())if(a=z.value,LI=g.c5(a).entityId)L.has(LI)?(xH.set(LI,L.get(LI)),L.delete(LI)):QJ.push(LI);kI=Number(((Jd=A.actionMetadata)==null?void 0:Jd.priority)||0)+1;YI=g.u(L.entries());for(X$=YI.next();!X$.done;X$=
YI.next())hd=X$.value,Wr=g.u(hd),Lc=Wr.next().value,IY=Wr.next().value,eP=Lc,y6=IY,mM.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",eP,"musicTrack",kI,hn,Fj(A,y6)));nm=g.u(xH.entries());for(w6=nm.next();!w6.done;w6=nm.next())rn=w6.value,Xm=g.u(rn),gA=Xm.next().value,ZM=Xm.next().value,ik=gA,yS=ZM,mM.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",ik,"musicTrack",kI,hn,Fj(A,yS)));Cp=g.u(QJ);for(mc=Cp.next();!mc.done;mc=Cp.next())Km=mc.value,mM.push(Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Km,"musicTrack",0,hn));return dv.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,mM))}})},NUN=function(c,A){var J,q;
return g.S(function(Y){switch(Y.K){case 1:return J=Of(A),g.$I(Y,2),q=g.c5(A.entityKey).entityId,q==="!*$_ALL_ENTITIES_!*$"?g.X(Y,Mi(c.C,A,c.j),5):g.X(Y,CS(q,"musicPlaylist",c.C,A,c.j),6);case 6:return g.X(Y,iGJ(c.C,A.entityKey),5);case 5:g.GW(Y,3);break;case 2:return g.F$(Y),Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},rSR=function(c,A,J,q){var Y,p,m;
return g.S(function(E){switch(E.K){case 1:return g.X(E,hLr([A]),2);case 2:return Y=E.C,g.X(E,DUe(c,Y[0],J,q),3);case 3:return p=E.C,m=Dt(p.thumbnailDetails),g.X(E,$T(m),4);case 4:return E.return(Y[0].videos)}})},DUe=function(c,A,J,q){var Y,p,m,E,O,T,R,r,H;
return g.S(function(V){return V.K==1?(Y=A.playlistId,p=yyC(A),m=p.Xw,E=p.mq,O=J?(Number(J)*1E3).toString():Date.now().toString(),T=A.lastModifiedTimestamp?(Number(A.lastModifiedTimestamp)*1E3).toString():"0",R={id:g.A5(Y,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:E,lastModifiedTimestampMillis:T,addedTimestampMillis:O,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},r={id:g.A5(Y,"musicPlaylist"),title:A.title,playlistId:Y,thumbnailDetails:A.thumbnail,visibility:kP9(A),trackCount:A.totalVideoCount,
tracks:m,downloadMetadata:R.id},q&&(((H=r)==null?0:H.entityMetadata)?r.entityMetadata.nextAutoRefreshIntervalSeconds=String(q):r&&(r.entityMetadata={nextAutoRefreshIntervalSeconds:String(q)})),g.X(V,em(c.C,{mode:"readwrite",Hf:!0},function(N){var w=bq(N,r,"musicPlaylist");N=bq(N,R,"musicPlaylistDownloadMetadataEntity");return g.Lh.all([w,N])}),2)):V.return(r)})},kP9=function(c){switch(c.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},gU9=function(c,A){this.C=c;
this.j=A},wFr=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N;
return g.S(function(w){switch(w.K){case 1:return J=Of(A),q=g.c5(A.entityKey),Y=q.entityId,p=g.l(A.actionMetadata,oUJ),g.$I(w,2),g.X(w,uDC(c,Y,void 0,(m=p)==null?void 0:m.track,(E=p)==null?void 0:E.albumRelease),4);case 4:if((O=p)==null?0:O.playlistId){w.Tx(5);break}return g.X(w,tgR(c.C,A.entityKey),5);case 5:g.GW(w,3);break;case 2:return T=g.F$(w),R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.kf&&T.type==="QUOTA_EXCEEDED"&&
(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),w.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,R,r));case 3:V=Number(((H=A.actionMetadata)==null?void 0:H.priority)||0)+1;var W=(W=g.l(A.actionMetadata,oUJ))?{playbackDataActionMetadata:{maximumDownloadQuality:W.maximumDownloadQuality}}:void 0;N=Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y,"playbackData",V,$UV,W);return w.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J,[N]))}})},WV9=function(c,A){var J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W;
return g.S(function(C){switch(C.K){case 1:return J=Of(A),q=g.c5(A.entityKey),Y=q.entityId,g.X(C,K8(c.C,A.entityKey,"musicTrack"),2);case 2:p=C.C;if(!p){m=void 0;C.Tx(3);break}return g.X(C,K8(c.C,p.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:m=C.C;case 3:E=m;if(!p||!E)return C.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));T=g.l(A.actionMetadata,oUJ);g.$I(C,5);return g.X(C,uDC(c,Y,E.addedTimestampMillis,(R=T)==null?void 0:R.track,(r=T)==null?void 0:r.albumRelease),
7);case 7:V=Number(((H=A.actionMetadata)==null?void 0:H.priority)||0)+1;O=Zt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Y,"playbackData",V,$UV);g.GW(C,6);break;case 5:N=g.F$(C);if(!(N instanceof Error&&N.message==="No data")){if(N instanceof Error&&N.message==="Empty response body")qi(N.message);else return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.kf&&N.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),C.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,w,W));C.Tx(6);break}return g.X(C,GO(Y,c.C,A,c.j),6);case 6:return C.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,O?[O]:void 0))}})},LVR=function(c,A){var J,q;
return g.S(function(Y){switch(Y.K){case 1:return J=Of(A),g.$I(Y,2),q=g.c5(A.entityKey).entityId,q==="!*$_ALL_ENTITIES_!*$"?g.X(Y,Mi(c.C,A,c.j),5):g.X(Y,GO(q,c.C,A,c.j),6);case 6:return g.X(Y,iGJ(c.C,A.entityKey),5);case 5:g.GW(Y,3);break;case 2:return g.F$(Y),Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new Io("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},uDC=function(c,A,J,q,Y){var p,m,E,O,T,R;
return g.S(function(r){switch(r.K){case 1:if(p=q){r.Tx(2);break}return g.X(r,KPO([A]),3);case 3:m=r.C,E=m[0],p=bGi(E);case 2:return g.X(r,GPV(c,p,A,Y,J),4);case 4:O=r.C;T=O.musicTrackEntity;R=O.EJ;var H=Dt(T.thumbnailDetails),V=[];R&&(V=Dt(R.thumbnailDetails));return g.X(r,$T(H.concat(V)),0)}})},GPV=function(c,A,J,q,Y){var p;
return g.S(function(m){return m.K==1?(Y||(Y=Date.now().toString()),p={id:g.A5(J,"musicTrackDownloadMetadataEntity"),playbackData:g.A5(J,"playbackData"),addedTimestampMillis:Y,videoDownloadContextEntity:g.A5(J,"videoDownloadContextEntity")},q&&(A.albumRelease=q.id),g.X(m,em(c.C,{mode:"readwrite",Hf:!0},function(E){var O=[],T=bq(E,p,"musicTrackDownloadMetadataEntity");O.push(T);T=bq(E,A,"musicTrack");O.push(T);q&&(E=bq(E,q,"musicAlbumRelease"),O.push(E));return g.Lh.all(O)}),2)):m.K!=3?g.X(m,Hk(J,"musicTrackDownloadMetadataEntity",
c.C,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):m.return({musicTrackEntity:A,
EJ:q})})},Bk=function(){iX.apply(this,arguments);
this.L="musicTrack"},C39=function(c,A,J){A=A===void 0?43200:A;
J=J===void 0?!0:J;var q=q===void 0?!1:q;var Y,p;return g.S(function(m){switch(m.K){case 1:if(!c.Y.x6())return m.return([]);Y=[];g.$I(m,2);return g.X(m,YY9(A,J,q),4);case 4:Y=m.C;g.GW(m,3);break;case 2:g.F$(m);case 3:return p=ZjR(c,Y,J,"musicPlaylist"),m.return(p)}})},MlR=function(){g.V5.apply(this,arguments);
var c=this;this.events=new g.sM(this);this.o8=this.player.B();this.lr={Ala:function(){return c.C},
Ax:function(){return c.Ax()},
G0:function(A){return c.G0(A)}}},FVN=function(c){var A;
c=g.l((A=c.getWatchNextResponse())==null?void 0:A.currentVideoEndpoint,g.J8);if(c==null?0:c.playlistId)var J=c.playlistId;return J},vUx=function(c,A){var J,q,Y,p;
return g.S(function(m){if(m.K==1){J=A.clientPlaybackNonce;q={cpn:J,offlineSourceVisualElement:g.WQ(A.wF||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};A.K&&(q.videoFmt=Number(A.K.itag));A.T&&(q.audioFmt=Number(A.T.itag));if((Y=FVN(A))&&A.videoId){var E=A.videoId;E=Y!=="PPSV"?Promise.resolve(!1):c.C.Pv(E);m=g.X(m,E,3)}else m=m.Tx(2);return m}m.K!=2&&(p=m.C)&&(q.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");c.K=J;g.TI("offlinePlaybackStarted",q);g.u$(m)})};
g.MY.prototype.jP=g.mY(51,function(c){return this.app.jP(c)});
g.Vu.prototype.jP=g.mY(50,function(c){return g.tcd(this,9,c)});
g.k(Sm,zT);g.j1.Object.defineProperties(Sm.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.C.entityMetadata},
set:function(c){this.C.entityMetadata=c}}});
g.k($IV,Sm);$IV.prototype.K=function(){return[]};
g.k(w3R,Sm);w3R.prototype.K=function(){return[]};
g.k(WBJ,Sm);WBJ.prototype.K=function(){return[]};
g.k(LBN,Sm);LBN.prototype.K=function(){return[]};
g.k(GxH,Sm);GxH.prototype.K=function(){var c=[];this.C.alternateChannel&&c.push(this.C.alternateChannel);this.C.alternateChannelList&&c.push.apply(c,g.M(this.C.alternateChannelList));this.C.oneofChannelEntity&&c.push(this.C.oneofChannelEntity);return[].concat(g.M(new Set(c)))};
g.k(CkC,Sm);CkC.prototype.K=function(){var c=[];this.C.entryCollection&&c.push(this.C.entryCollection);return[].concat(g.M(new Set(c)))};
g.k(MkV,zT);MkV.prototype.K=function(){var c=[];this.C.video&&c.push(this.C.video);return[].concat(g.M(new Set(c)))};
g.k(FBN,Sm);FBN.prototype.K=function(){var c=[];this.C.parentPlaylist&&c.push(this.C.parentPlaylist);if(this.C.entries)for(var A=g.u(this.C.entries),J=A.next();!J.done;J=A.next())c.push.apply(c,g.M((new MkV(J.value)).K()));return[].concat(g.M(new Set(c)))};
g.k(vzC,Sm);vzC.prototype.K=function(){var c=[];this.C.descriptionEntity&&c.push(this.C.descriptionEntity);this.C.creators&&c.push.apply(c,g.M(this.C.creators));this.C.theBiggestFan&&c.push(this.C.theBiggestFan);return[].concat(g.M(new Set(c)))};
g.k(Qve,Sm);Qve.prototype.K=function(){return[]};
g.k(X3M,Sm);X3M.prototype.K=function(){return[]};
g.k(ZOx,Sm);ZOx.prototype.K=function(){return[]};
g.k(I2r,Sm);I2r.prototype.K=function(){return[]};
g.k(zKw,Sm);zKw.prototype.K=function(){return[]};
g.k(Sex,Sm);Sex.prototype.K=function(){return[]};
g.k(xIr,Sm);xIr.prototype.K=function(){return[]};
g.k(Pki,Sm);Pki.prototype.K=function(){return[]};
g.k(svH,Sm);svH.prototype.K=function(){return[]};
g.k(UIr,Sm);UIr.prototype.K=function(){var c=[];this.C.downloadsList&&c.push(this.C.downloadsList);this.C.smartDownloadsList&&c.push(this.C.smartDownloadsList);this.C.recommendedDownloadsList&&c.push(this.C.recommendedDownloadsList);this.C.refresh&&c.push(this.C.refresh);return[].concat(g.M(new Set(c)))};
g.k(f2J,zT);f2J.prototype.K=function(){var c=[];this.C.video&&c.push(this.C.video);this.C.playlist&&c.push(this.C.playlist);this.C.videoItem&&c.push(this.C.videoItem);this.C.playlistItem&&c.push(this.C.playlistItem);return[].concat(g.M(new Set(c)))};
g.k(l2J,Sm);l2J.prototype.K=function(){var c=[];this.C.refresh&&c.push(this.C.refresh);if(this.C.downloads)for(var A=g.u(this.C.downloads),J=A.next();!J.done;J=A.next())c.push.apply(c,g.M((new f2J(J.value)).K()));return[].concat(g.M(new Set(c)))};
g.k(a2H,Sm);a2H.prototype.K=function(){var c=[];this.C.localImageEntities&&c.push.apply(c,g.M(this.C.localImageEntities));return[].concat(g.M(new Set(c)))};
g.k(bOi,Sm);bOi.prototype.K=function(){var c=[];this.C.playbackData&&c.push(this.C.playbackData);this.C.localImageEntities&&c.push.apply(c,g.M(this.C.localImageEntities));this.C.videoDownloadContextEntity&&c.push(this.C.videoDownloadContextEntity);return[].concat(g.M(new Set(c)))};
g.k(tkx,Sm);tkx.prototype.K=function(){return[]};
g.k(iOx,Sm);iOx.prototype.K=function(){var c=[];this.C.fakeChildren&&c.push.apply(c,g.M(this.C.fakeChildren));return[].concat(g.M(new Set(c)))};
g.k(yGi,Sm);yGi.prototype.K=function(){var c=[];this.C.video&&c.push(this.C.video);this.C.playbackData&&c.push(this.C.playbackData);this.C.offlineVideoPolicy&&c.push(this.C.offlineVideoPolicy);return[].concat(g.M(new Set(c)))};
g.k(eKV,Sm);eKV.prototype.K=function(){return[]};
g.k(nzw,Sm);nzw.prototype.K=function(){var c=[];this.C.channelOwner&&c.push(this.C.channelOwner);this.C.videos&&c.push.apply(c,g.M(this.C.videos));this.C.collaboratorChannels&&c.push.apply(c,g.M(this.C.collaboratorChannels));this.C.downloadState&&c.push(this.C.downloadState);this.C.refresh&&c.push(this.C.refresh);return[].concat(g.M(new Set(c)))};
g.k(KBV,Sm);KBV.prototype.K=function(){var c=[];this.C.video&&c.push(this.C.video);this.C.channelContributor&&c.push(this.C.channelContributor);return[].concat(g.M(new Set(c)))};
g.k(hK9,zT);hK9.prototype.K=function(){var c=[];this.C.localImageEntities&&c.push.apply(c,g.M(this.C.localImageEntities));this.C.videoDownloadContextEntity&&c.push(this.C.videoDownloadContextEntity);return[].concat(g.M(new Set(c)))};
g.k(BjN,zT);BjN.prototype.K=function(){var c=[];this.C.recommendedVideoMetadata&&c.push.apply(c,g.M((new hK9(this.C.recommendedVideoMetadata)).K()));return[].concat(g.M(new Set(c)))};
g.k(cE9,zT);cE9.prototype.K=function(){var c=[];this.C.playbackPosition&&c.push(this.C.playbackPosition);return[].concat(g.M(new Set(c)))};
g.k(AER,Sm);AER.prototype.K=function(){var c=[];this.C.owner&&c.push(this.C.owner);this.C.downloadState&&c.push(this.C.downloadState);this.C.userState&&c.push.apply(c,g.M((new cE9(this.C.userState)).K()));this.C.additionalMetadata&&c.push.apply(c,g.M((new BjN(this.C.additionalMetadata)).K()));return[].concat(g.M(new Set(c)))};
g.k(JEw,Sm);JEw.prototype.K=function(){var c=[];this.C.userChannelDetails&&c.push(this.C.userChannelDetails);return[].concat(g.M(new Set(c)))};
g.k(q1N,Sm);q1N.prototype.K=function(){var c=[];this.C.channelOwner&&c.push(this.C.channelOwner);this.C.playbackPosition&&c.push(this.C.playbackPosition);this.C.localImageEntities&&c.push.apply(c,g.M(this.C.localImageEntities));this.C.downloadStatus&&c.push(this.C.downloadStatus);return[].concat(g.M(new Set(c)))};
g.k(Y1N,Sm);Y1N.prototype.K=function(){return[]};
g.k(puJ,Sm);puJ.prototype.K=function(){return[]};
g.k(meN,Sm);meN.prototype.K=function(){return[]};
g.k(jKx,Sm);jKx.prototype.K=function(){return[]};
g.k(deC,Sm);deC.prototype.K=function(){return[]};
g.k(E4w,Sm);E4w.prototype.K=function(){return[]};
g.k(OAJ,Sm);OAJ.prototype.K=function(){return[]};
g.k(Toe,Sm);Toe.prototype.K=function(){return[]};
g.k(RAM,Sm);RAM.prototype.K=function(){return[]};
g.k(rEM,Sm);rEM.prototype.K=function(){return[]};
g.k(HAH,Sm);HAH.prototype.K=function(){return[]};
g.k(V$J,Sm);V$J.prototype.K=function(){var c=[];this.C.trackDownloadMetadatas&&c.push.apply(c,g.M(this.C.trackDownloadMetadatas));return[].concat(g.M(new Set(c)))};
g.k(Noi,Sm);
Noi.prototype.K=function(){var c=[];this.C.downloadedTracks&&c.push.apply(c,g.M(this.C.downloadedTracks));this.C.smartDownloadedTracks&&c.push.apply(c,g.M(this.C.smartDownloadedTracks));this.C.downloadedEpisodes&&c.push.apply(c,g.M(this.C.downloadedEpisodes));this.C.downloadedAlbumReleases&&c.push.apply(c,g.M(this.C.downloadedAlbumReleases));this.C.smartDownloadedAlbumReleases&&c.push.apply(c,g.M(this.C.smartDownloadedAlbumReleases));this.C.downloadedPlaylists&&c.push.apply(c,g.M(this.C.downloadedPlaylists));this.C.smartDownloadedPlaylists&&
c.push.apply(c,g.M(this.C.smartDownloadedPlaylists));this.C.metadataOnlyTracks&&c.push.apply(c,g.M(this.C.metadataOnlyTracks));return[].concat(g.M(new Set(c)))};
g.k(Dew,Sm);Dew.prototype.K=function(){var c=[];this.C.trackDownloadMetadatas&&c.push.apply(c,g.M(this.C.trackDownloadMetadatas));return[].concat(g.M(new Set(c)))};
g.k(ko9,Sm);ko9.prototype.K=function(){var c=[];this.C.playbackData&&c.push(this.C.playbackData);this.C.localImageEntities&&c.push.apply(c,g.M(this.C.localImageEntities));this.C.videoDownloadContextEntity&&c.push(this.C.videoDownloadContextEntity);return[].concat(g.M(new Set(c)))};
g.k(g4J,Sm);g4J.prototype.K=function(){var c=[];this.C.musicLibraryStatusEntity&&c.push(this.C.musicLibraryStatusEntity);this.C.primaryArtists&&c.push.apply(c,g.M(this.C.primaryArtists));this.C.details&&c.push(this.C.details);this.C.userDetails&&c.push(this.C.userDetails);this.C.tracks&&c.push.apply(c,g.M(this.C.tracks));this.C.share&&c.push(this.C.share);this.C.downloadMetadata&&c.push(this.C.downloadMetadata);this.C.refresh&&c.push(this.C.refresh);return[].concat(g.M(new Set(c)))};
g.k(o4M,Sm);o4M.prototype.K=function(){var c=[];this.C.albumRelease&&c.push(this.C.albumRelease);this.C.tracks&&c.push.apply(c,g.M(this.C.tracks));return[].concat(g.M(new Set(c)))};
g.k(u_H,Sm);u_H.prototype.K=function(){var c=[];this.C.albumRelease&&c.push(this.C.albumRelease);return[].concat(g.M(new Set(c)))};
g.k($eN,Sm);$eN.prototype.K=function(){var c=[];this.C.details&&c.push(this.C.details);this.C.userDetails&&c.push(this.C.userDetails);return[].concat(g.M(new Set(c)))};
g.k(wuC,Sm);wuC.prototype.K=function(){var c=[];this.C.parentArtist&&c.push(this.C.parentArtist);return[].concat(g.M(new Set(c)))};
g.k(W$J,Sm);W$J.prototype.K=function(){var c=[];this.C.parentArtist&&c.push(this.C.parentArtist);return[].concat(g.M(new Set(c)))};
g.k(L$H,Sm);L$H.prototype.K=function(){return[]};
g.k(GoV,Sm);GoV.prototype.K=function(){return[]};
g.k(CuO,zT);CuO.prototype.K=function(){var c=[];this.C.creatorEntity&&c.push(this.C.creatorEntity);return[].concat(g.M(new Set(c)))};
g.k(M$r,Sm);
M$r.prototype.K=function(){var c=[];this.C.tracks&&c.push.apply(c,g.M(this.C.tracks));this.C.refresh&&c.push(this.C.refresh);this.C.musicLibraryStatusEntity&&c.push(this.C.musicLibraryStatusEntity);this.C.details&&c.push(this.C.details);this.C.downloadMetadata&&c.push(this.C.downloadMetadata);this.C.sideloadMetadata&&c.push(this.C.sideloadMetadata);this.C.userDetails&&c.push(this.C.userDetails);this.C.entryCollection&&c.push(this.C.entryCollection);this.C.share&&c.push(this.C.share);this.C.podcastShowAdditionalMetadata&&c.push.apply(c,
g.M((new CuO(this.C.podcastShowAdditionalMetadata)).K()));return[].concat(g.M(new Set(c)))};
g.k(F$C,Sm);F$C.prototype.K=function(){return[]};
g.k(v4C,Sm);
v4C.prototype.K=function(){var c=[];this.C.musicLibraryStatusEntity&&c.push(this.C.musicLibraryStatusEntity);this.C.artists&&c.push.apply(c,g.M(this.C.artists));this.C.audioModeVersion&&c.push(this.C.audioModeVersion);this.C.videoModeVersion&&c.push(this.C.videoModeVersion);this.C.userDetails&&c.push(this.C.userDetails);this.C.details&&c.push(this.C.details);this.C.albumRelease&&c.push(this.C.albumRelease);this.C.share&&c.push(this.C.share);this.C.libraryEdit&&c.push(this.C.libraryEdit);this.C.downloadMetadata&&
c.push(this.C.downloadMetadata);this.C.playbackPosition&&c.push(this.C.playbackPosition);this.C.lyrics&&c.push(this.C.lyrics);return[].concat(g.M(new Set(c)))};
g.k(QKC,Sm);QKC.prototype.K=function(){var c=[];this.C.parentTrack&&c.push(this.C.parentTrack);return[].concat(g.M(new Set(c)))};
g.k(XuJ,Sm);XuJ.prototype.K=function(){var c=[];this.C.parentTrack&&c.push(this.C.parentTrack);return[].concat(g.M(new Set(c)))};
g.k(ZAR,Sm);ZAR.prototype.K=function(){return[]};
g.k(IVO,Sm);IVO.prototype.K=function(){return[]};
g.k(zAH,Sm);zAH.prototype.K=function(){return[]};
g.k(S1V,Sm);S1V.prototype.K=function(){return[]};
g.k(xe9,Sm);xe9.prototype.K=function(){var c=[];this.C.transfer&&c.push(this.C.transfer);this.C.adsPlaybackData&&c.push.apply(c,g.M(this.C.adsPlaybackData));this.C.drmLicense&&c.push(this.C.drmLicense);this.C.offlineVideoPolicy&&c.push(this.C.offlineVideoPolicy);this.C.videoDownloadContextEntity&&c.push(this.C.videoDownloadContextEntity);return[].concat(g.M(new Set(c)))};
g.k(Pui,Sm);Pui.prototype.K=function(){return[]};
g.k(sKe,Sm);sKe.prototype.K=function(){var c=[];this.C.offlineVideoStreams&&c.push.apply(c,g.M(this.C.offlineVideoStreams));this.C.captionTrack&&c.push.apply(c,g.M(this.C.captionTrack));return[].concat(g.M(new Set(c)))};
g.k(UeJ,Sm);UeJ.prototype.K=function(){return[]};
g.k(fVV,Sm);fVV.prototype.K=function(){return[]};
g.k(lVO,Sm);lVO.prototype.K=function(){return[]};
g.k(aVV,Sm);aVV.prototype.K=function(){return[]};
g.k(bAi,Sm);bAi.prototype.K=function(){return[]};
g.k(t$w,Sm);t$w.prototype.K=function(){return[]};
g.k(iAO,Sm);iAO.prototype.K=function(){return[]};
g.k(yEH,Sm);yEH.prototype.K=function(){return[]};
g.k(eAr,Sm);eAr.prototype.K=function(){return[]};
g.k(n4H,Sm);n4H.prototype.K=function(){return[]};
g.k(K$J,Sm);K$J.prototype.K=function(){return[]};
g.k(hAR,Sm);hAR.prototype.K=function(){return[]};
g.k(BoH,Sm);BoH.prototype.K=function(){return[]};
g.k(crR,Sm);crR.prototype.K=function(){return[]};
g.k(Arw,Sm);Arw.prototype.K=function(){return[]};
g.k(JrO,Sm);JrO.prototype.K=function(){return[]};
g.k(q49,Sm);q49.prototype.K=function(){return[]};
g.k(Y4i,Sm);Y4i.prototype.K=function(){return[]};
g.k(pVV,Sm);pVV.prototype.K=function(){return[]};
g.k(m_e,Sm);m_e.prototype.K=function(){return[]};
var paV=["browse","music/browse","unplugged/browse"],OtR=["offline/playlist_sync_check"],nGM=["offline"],mw9=["offline/offline_video_playback_position_sync"],dwH=["offline/get_playback_data_entity"],xa;PU.getInstance=function(){return g.S(function(c){return c.return(new Promise(function(A){g.Bm().then(function(J){J?(PU.instance||(PU.instance=new PU(J)),A(PU.instance)):A(void 0)})}))})};
PU.prototype.get=function(c){var A=this,J,q,Y;return g.S(function(p){if(p.K==1)return g.X(p,OPH(A.token),2);if(p.K!=3)return J=p.C,g.X(p,J.get("prefs",c),3);q=p.C;if(!q)return p.return();Y=(0,g.b)();return q.expirationTimestampMs<=Y?p.return():p.return(q.value)})};
PU.prototype.set=function(c,A,J){J=J===void 0?31536E3:J;var q=this,Y,p,m;return g.S(function(E){if(E.K==1)return Y=(0,g.b)(),p={key:c,value:A,expirationTimestampMs:Y+J*1E3},g.X(E,OPH(q.token),2);m=E.C;return g.X(E,g.Iq(m,"prefs",p),0)})};
PU.prototype.remove=function(c){var A=this,J;return g.S(function(q){if(q.K==1)return g.X(q,OPH(A.token),2);J=q.C;return g.X(q,J.delete("prefs",c),0)})};
g.k(si,g.eq);g.k(Ui,VrM);Ui.prototype.j=function(c,A){A=D_O(A);c=(new TextEncoder).encode(JSON.stringify(c));return this.C.encrypt(c,A)};
Ui.prototype.K=function(c,A){if(!(c instanceof Uint8Array))throw T$w(1);var J=new TextDecoder;A=D_O(A);c=this.C.decrypt(c,A);return JSON.parse(J.decode(c))};
var kSJ={accountLinkStatusEntity:ZOx,booleanEntity:WBJ,buttonEntity:BoH,captionTrack:ZAR,channelHandle:$IV,commerceAcquisitionClientPayloadEntity:Arw,commerceCartListEntity:JrO,contextNoteFeedEntityPayload:w3R,continuationTokenEntity:eKV,downloadQualityPickerEntity:xIr,downloadsPageRefreshTokenEntity:svH,downloadsPageViewConfigurationEntity:Y1N,downloadStatusEntity:Pki,dismissState:iAO,sfvAudioItemCurrentlyPlayingEntity:aVV,emojiFountainDataEntity:K$J,emojiCustomizationSetEntity:n4H,fakeChannel:GxH,
fakePlaylist:CkC,fakePlaylistEntryCollection:FBN,fakeVideo:vzC,fakeVideoDescription:Qve,featuredProductsEntity:RAM,flowStateEntity:X3M,iconBadgeEntity:q49,interstitialInteractionStateEntity:zKw,likeButtonAnimationEntity:puJ,liveChatPollStateEntity:Sex,liveViewerLeaderboardChatEntryPointStateEntity:fVV,liveViewerLeaderboardPointsEntity:lVO,liveReactionsDataEntity:hAR,logoEntity:I2r,macroMarkerEntity:meN,mainDownloadsLibraryEntity:UIr,mainDownloadsListEntity:l2J,mainPlaylistDownloadStateEntity:a2H,
mainPlaylistEntity:nzw,mainPlaylistVideoEntity:KBV,mainVideoDownloadStateEntity:bOi,mainVideoEntity:AER,markersEngagementPanelSyncEntity:jKx,markersVisibilityOverrideEntity:deC,musicAlbumReleaseDetail:o4M,musicAlbumReleaseDownloadMetadataEntity:V$J,musicAlbumRelease:g4J,musicAlbumReleaseUserDetail:u_H,musicArtistDetail:wuC,musicArtist:$eN,musicArtistUserDetail:W$J,musicDownloadsLibraryEntity:Noi,musicLibraryEdit:L$H,musicLibraryStatusEntity:GoV,musicPlaylist:M$r,musicPlaylistDownloadMetadataEntity:Dew,
musicShare:F$C,musicTrackDetail:QKC,musicTrackDownloadMetadataEntity:ko9,musicTrack:v4C,musicTrackUserDetail:XuJ,offlineOrchestrationActionWrapperEntity:IVO,offlineVideoPolicy:zAH,offlineVideoStreams:S1V,offlineabilityEntity:tkx,orchestrationWebSamplingEntity:iOx,pageHeaderEntity:yEH,pdpStateEntity:Y4i,pinnedProductEntity:rEM,playbackData:xe9,playerStateEntity:E4w,quantityIncrementerEntity:pVV,refresh:Pui,saveToPlaylistListEntity:bAi,settingEntity:t$w,stringEntity:LBN,suggestedFeedbackChipStateEntity:OAJ,
transfer:sKe,trendingOfferEntity:HAH,videoDownloadContextEntity:UeJ,videoOverviewAsyncDataEntity:m_e,videoPlaybackPositionEntity:crR,votingEntity:eAr,ytMainChannelEntity:JEw,youchatPendingResponseEntity:Toe,ytMainDownloadedVideoEntity:yGi,ytMainVideoEntity:q1N};g.k(iq,VrM);iq.prototype.j=function(c){return c};
iq.prototype.K=function(c){if(c instanceof Uint8Array)throw T$w(0);return c};
g.k(yh,g.P);yh.prototype.observe=function(c){var A=this;this.observers.push(c);return function(){var J=A.observers.indexOf(c);J>=0&&A.observers.splice(J,1)}};
yh.prototype.K=function(c){XVx(this,c.data)};
yh.prototype.rF=function(){this.channel.close()};
var x_i,zLr=new g.MU("elementsCommand");var Wk=new g.MU("entityBatchUpdate");var wo9=new g.MU("downloadStatusEntity");var sfH=new g.MU("mainPlaylistEntityActionMetadata");var nS=new g.MU("mainVideoEntityActionMetadata");var eLR=new g.MU("musicPlaylistEntityActionMetadata");var oUJ=new g.MU("musicTrackEntityActionMetadata");var ASC=new g.MU("localImageEntityActionMetadata");var zO=new g.MU("playbackDataActionMetadata");var SYO=new g.MU("transferEntityActionMetadata");var uZw=new g.MU("videoPlaybackPositionEntityActionMetadata");var B$C;new g.Ho;new g.Ho;Yoi.prototype.request=function(c,A,J){A=A===void 0?{}:A;return this.locks.request(c,A,function(q){return J(q)})};var Jn=g.e1.caches,An,EGi;ck.prototype.open=function(c){return Jn.open(jce(c))};
ck.prototype.has=function(c){return Jn.has(jce(c))};
ck.prototype.delete=function(c){return Jn.delete(jce(c))};
ck.prototype.match=function(c,A){var J=this,q,Y,p,m,E,O;return g.S(function(T){switch(T.K){case 1:return g.X(T,J.keys(),2);case 2:q=T.C,Y=g.u(q),p=Y.next();case 3:if(p.done){T.Tx(5);break}m=p.value;return g.X(T,J.open(m),6);case 6:return E=T.C,g.X(T,E.match(c,A),7);case 7:if(O=T.C)return T.return(O);p=Y.next();T.Tx(3);break;case 5:return T.return()}})};
g.k(m$M,ck);m$M.prototype.keys=function(){var c,A,J,q,Y,p,m,E,O;return g.S(function(T){if(T.K==1)return c=[],A=g.nX("CacheStorage keys"),g.X(T,Jn.keys(),2);J=T.C;q=g.u(J);for(Y=q.next();!Y.done;Y=q.next()){p=Y.value;var R=p.indexOf(":");m=R===-1?{yE:p}:{yE:p.substring(0,R),datasyncId:p.substring(R+1)};E=m.yE;O=m.datasyncId;O===A&&c.push(E)}return T.return(c)})};g.k(pS,g.P);pS.prototype.j=function(c){this.api.gF("onOfflineOperationFailure",c.data)};
pS.prototype.T=function(c){this.api.publish("offlinetransferpause",c.data)};
pS.prototype.rF=function(){var c;(c=this.C)==null||c.close();var A;(A=this.K)==null||A.close()};RLH.prototype.Ac=function(){this.C&&jc(this)};
RLH.prototype.rb=function(){this.K&&this.K.resolve();this.j=this.C=!1;this.L()};var BeM=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var Xow="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var aIr="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.k(RYO,Xj);RYO.prototype.K=function(c){return TO(c)?VyN(this,c):Ro(c)?klw(this,c):Promise.reject(Error("Unsupported action type: "+c.actionType))};g.k(gVR,Xj);gVR.prototype.K=function(c){return Ro(c)?oVH(this,c):$$H(c)?$wJ(this,c):rx(c)?waM(this,c):Promise.reject(Error("Unsupported action type: "+c.actionType))};g.D=WOV.prototype;g.D.OYP=function(c){var A=this,J,q,Y,p;return g.S(function(m){if(!g.e(c.state,128))return m.Tx(0);J=c.state.L1;var E=(q=J)==null?void 0:q.errorCode,O=(Y=J)==null?void 0:Y.KN;p=E==="net.connect"&&O===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(E==null?0:E.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.X(m,A.sI(A.player.getVideoData().videoId,p),0)})};
g.D.sI=function(c,A){var J=this;return g.S(function(q){if(q.K==1){if(J.K)return q.return();J.K=!0;return A==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Pk(J,c,!1,!0),q.Tx(0)):g.X(q,xT(J,c),3)}g.Ij(c,4);return g.X(q,J.C.sI(A),0)})};
g.D.FU=function(c){c.status===2?(c.status!==this.j&&(oiC(this.C),g.Ij(c.videoId,2)),c.zZ&&LWH(this.C,c.videoId,c.zZ)):c.status===4?(xT(this,c.videoId),this.sI(c.videoId,c.o$?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):c.status===1&&WW9(this.C);this.j=c.status;this.api.gF("localmediachange",{videoId:c.videoId,status:c.status})};
g.D.BY=function(){var c=this,A;return g.S(function(J){if(J.K==1){if(c.K)return J.return();c.K=!0;A=c.player.getVideoData().videoId;return g.X(J,xT(c,A),2)}return g.X(J,c.C.BY(),0)})};
g.D.EL=function(c){switch(c){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.D.W=function(c){return this.api.B().W(c)};g.k(QhO,Xj);QhO.prototype.K=function(c){return TO(c)?Ztr(this,c):Ro(c)?IwC(this,c):$$H(c)?zYe(this,c):Promise.reject(Error("Unsupported action type: "+c.actionType))};fwJ.prototype.C=function(c,A){var J=c.action.actionMetadata.priority-A.action.actionMetadata.priority;J===0&&(c.C<A.C?J=-1:c.C>A.C&&(J=1));return J};g.k(sf,g.P);sf.prototype.rF=function(){this.L&&this.L();g.P.prototype.rF.call(this)};
sf.prototype.createAction=function(c,A){var J=g.c5(c.entityKey).entityType,q=g.WA(16);return new kT(J,q,c,A.actionId,A.rootActionId)};
sf.prototype.l$=function(c){var A=this,J,q,Y,p,m,E,O,T,R;return g.S(function(r){if(r.K==1){if(A.Uq())return r.return();q=(J=c.offlineOrchestrationActionWrapperEntity)!=null?J:new Set;Y=[];p=g.u(q);for(m=p.next();!m.done;m=p.next())E=m.value,O=g.c5(E),T=O.entityId,btM(A.C,T)||Y.push(E);return g.X(r,J2O(A,Y),2)}R=r.C;return g.X(r,A29(A,R),0)})};
sf.prototype.retry=function(){var c=this;return g.S(function(A){return g.X(A,qtw(c),0)})};pdO.prototype.lY=function(c,A){A=A===void 0?!0:A;var J=this,q,Y,p,m,E,O,T,R;return g.S(function(r){switch(r.K){case 1:if(!J.C)return r.return();q=[];Y=g.JB(J.C.K,A);p=[];for(m={Sh:0};m.Sh<Y.length;m={Sh:m.Sh},m.Sh++)E=Y[m.Sh],O=J.C.AO(E,"json3"),T=g.Q0(O,{withCredentials:!0,format:"RAW"},3,500).then(function(H){return function(V){V={metadata:g.gC(Y[H.Sh]),trackData:V.xhr.responseText};p.push(V)}}(m)).Ye(function(H){qi("Caption fetch error",H)}),q.push(T);
return g.X(r,uuw(q),2);case 2:return g.$I(r,3),g.X(r,tri(c,p),5);case 5:g.GW(r,0);break;case 3:R=g.F$(r),qi("Caption DB transaction error",R),g.u$(r)}})};g.k(Uf,g.P);Uf.prototype.rF=function(){this.K&&this.K();g.P.prototype.rF.call(this)};
Uf.prototype.j=function(c){var A=this,J,q,Y,p,m,E,O,T;return g.S(function(R){q=(J=c.transfer)!=null?J:new Set;Y=[];p=g.u(q);for(m=p.next();!m.done;m=p.next())E=m.value,O=g.c5(E),T=O.entityId,Y.push(T);return Y.length===0?R.return():g.X(R,dmR(A,Y),0)})};g.k(r2C,g.P);g.D=r2C.prototype;g.D.rF=function(){this.nJ&&this.nJ();this.Fl.dispose();this.T.dispose();this.wF&&g.Jr(this.Y.BF,this.wF);this.dF&&g.Jr(this.Y.BF,this.dF);g.P.prototype.rF.call(this)};
g.D.GJy=function(c){var A=this,J,q,Y;return g.S(function(p){switch(p.K){case 1:J=g.A5(c,"transfer");if(A.C&&J===A.C.key){Pk(A.D,A.U,!0);A.T.stop();p.Tx(0);break}return g.X(p,em(A.K,{mode:"readwrite",Hf:!0},function(m){return f8(m,J,"transfer").then(function(E){if(E&&E.transferState!=="TRANSFER_STATE_COMPLETE"&&E.transferState!=="TRANSFER_STATE_FAILED")return E.transferState="TRANSFER_STATE_PAUSED_BY_USER",bq(m,E,"transfer").then(function(){return E})})}),3);
case 3:q=p.C;if(!q){p.Tx(0);break}if(!c||!A.j){p.Tx(5);break}return g.X(p,Hk(c,A.j,A.K,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.X(p,ao(A,c),7);case 7:Y=p.C,oGO({videoId:c,Se:q,offlineModeType:Y}),g.u$(p)}})};
g.D.phJ=function(){var c=this;if(this.C&&this.U){Pk(this.D,this.U,!1);var A=this.C,J=(A==null?0:A.key)?g.c5(A.key).entityId:"";J&&this.j&&(new Promise(function(q,Y){Hk(J,c.j,c.K,"DOWNLOAD_STATE_PAUSED").catch(function(p){Y(p)})})).catch(function(q){qi("Download state setting error",q)})}this.T.stop()};
g.D.rd=function(){this.C?NcV(this,this.C):lX(this)};
g.D.m7=function(c){var A=this;return g.S(function(J){switch(J.K){case 1:if(!A.C){J.Tx(2);break}if(A.C.transferState==="TRANSFER_STATE_COMPLETE"||A.C.transferState==="TRANSFER_STATE_FAILED"||!c.transfer||!c.transfer.has(A.C.key)){J.Tx(3);break}return g.X(J,K8(A.K,A.C.key,"transfer"),4);case 4:A.C=J.C;if(A.C){J.Tx(3);break}return g.X(J,Dmi(A),3);case 3:if(A.C)return J.return();case 2:return g.X(J,lX(A),0)}})};
g.D.sI=function(c,A){var J=this,q,Y,p,m,E;return g.S(function(O){switch(O.K){case 1:if(!J.C){bX(J,"onTransferFailure: "+c);O.Tx(2);break}q=J.C;p=((Y=q)==null?0:Y.key)?g.c5(q.key).entityId:"";a:switch(c){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var T=!1;break a;default:T=!0}return T&&GsN(J)?g.X(O,tn(J,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.X(O,
CvC(J,c),5);case 5:if(!p||!J.j){O.Tx(2);break}return g.X(O,Hk(p,J.j,J.K,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.X(O,ao(J,p),9);case 9:m=O.C;Ef({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:p,Se:q,offlineModeType:m});if(!p||!J.j){O.Tx(2);break}return g.X(O,Hk(p,J.j,J.K,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:fS(J),E=lX(J,!0),A&&A(E),g.u$(O)}})};
g.D.BY=function(c){var A=this,J,q,Y,p,m,E,O,T,R,r,H,V;return g.S(function(N){switch(N.K){case 1:if(!A.C){bX(A,"onMaybeTransferStreamsExpired");N.Tx(2);break}return GsN(A)?g.X(N,tn(A,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.X(N,CvC(A,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!A.j){N.Tx(2);break}J=A.C;Y=((q=J)==null?0:q.key)?g.c5(J.key).entityId:"";if(!Y){N.Tx(2);break}return g.X(N,Hk(Y,A.j,A.K,"DOWNLOAD_STATE_FAILED"),2);case 9:return A.C||bX(A,"onMaybeTransferStreamsExpiredRetryAttempting"),
p=A.C,E=((m=p)==null?0:m.key)?g.c5(p.key).entityId:"",g.X(N,ao(A,E),10);case 10:return O=N.C,Ef({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:E,Se:p,offlineModeType:O}),T=GKH(),g.fK(T,zO,{isEnqueuedForExpiredStreamUrlRefetch:!0}),R=g.A5(E,"playbackData"),r={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:R,actionMetadata:T},H=oo(new kT("playbackData",E,r)),g.X(N,n8(A.K,H,"offlineOrchestrationActionWrapperEntity"),2);case 2:fS(A),V=lX(A,!0),
c&&c(V),g.u$(N)}})};
var QTR={},MSV=(QTR.TRANSFER_STATE_TRANSFERRING=1,QTR.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,QTR);g.D=iX.prototype;g.D.YQ=function(){return this.U.promise};
g.D.Bz=function(){if(this.K&&this.D)return this.U.promise;Qfx(this).then(this.U.resolve).catch(this.U.reject);return this.U.promise};
g.D.Lx=function(c){var A={};return A.playbackData=new RYO(c,this.o8,this.C),A.transfer=new QhO(c,this.o8),A.videoPlaybackPositionEntity=new gVR(c,this.o8),A};
g.D.oV=function(){var c=this;return g.S(function(A){return c.K?g.X(A,Hje(c.K),0):A.Tx(0)})};
g.D.zH=function(){var c=this,A,J;return g.S(function(q){if(q.K==1)return c.K||c.D?g.X(q,c.YQ(),2):q.return();c.X!==void 0&&(g.oW(c.X),c.X=void 0);c.T!==void 0&&(g.oW(c.T),c.T=void 0);(A=c.K)==null||A.dispose();c.K=void 0;(J=c.D)==null||J.dispose();c.D=void 0;c.api.gF("onOrchestrationLostLeader");c.U=new g.Ho;g.u$(q)})};
g.D.isOrchestrationLeader=function(){return this.j.C};
g.D.Pv=function(){return g.S(function(c){return c.return(!1)})};
g.D.Sy=function(c){var A=this.C;A.api.publish("offlinetransferpause",c);var J;(J=A.K)==null||J.postMessage(c)};
g.D.rd=function(c){var A,J;return g.S(function(q){if(q.K==1)return g.X(q,BU(),2);A=q.C;if(!A)return q.return();J=g.A5(c,"transfer");return g.X(q,em(A,{mode:"readwrite",Hf:!0},function(Y){var p=f8(Y,J,"transfer"),m=f8(Y,g.A5(c,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Lh.all([p,m]).then(function(E){E=g.u(E);var O=E.next().value;var T=E.next().value;return O&&O.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(O.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",bq(Y,O,"transfer").then(function(){Ef({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:c,Se:O,offlineModeType:T==null?void 0:T.offlineModeType});return g.Lh.resolve(null)})):g.Lh.resolve(null)})}),0)})};
g.D.ZQ=function(c){c=c===void 0?43200:c;var A=this,J,q,Y,p,m,E,O,T;return g.S(function(R){if(R.K==1)return A.Y.x6()?g.X(R,BU(),2):R.return(XdH());if(R.K!=3){J=R.C;if(!J)return R.return([]);q=Date.now()/1E3;return g.X(R,hK(J,"offlineVideoPolicy"),3)}Y=R.C;p=[];m=g.u(Y);for(E=m.next();!E.done;E=m.next())O=E.value,Number(O.lastUpdatedTimestampSeconds)+c<=q&&(T=g.c5(O.key).entityId,p.push(T));return p.length?R.return(yG(A,p,A.L,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):R.return([])})};
g.D.deleteAll=function(){return yG(this,["!*$_ALL_ENTITIES_!*$"],this.L,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.D.refreshAllStaleEntities=function(c){var A=this;return g.S(function(J){return J.K==1?g.X(J,A.ZQ(c),2):J.return(J.C)})};
g.D.setUpPositionSyncInterval=function(c){var A=this;this.T!==void 0&&(g.oW(this.T),this.T=void 0);var J=c!=null?c:864E5;this.T=g.kh(function(){A.iV(J)},J)};
g.D.iV=function(c){var A=this,J,q,Y,p,m,E;return g.S(function(O){switch(O.K){case 1:return g.$I(O,2),g.X(O,PU.getInstance(),4);case 4:J=O.C;if(!J)throw Error("prefStorage is undefined");return g.X(O,J.get("psi"),5);case 5:q=O.C;p=((Y=q)==null?0:Y.IE)?Number(q.IE)/1E3:0;m=Date.now();if(!(p+c<=m)){O.Tx(6);break}return g.X(O,yG(A,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.GW(O,0);break;case 2:E=g.F$(O),qi("Offline manager error",E),
g.u$(O)}})};
g.D.uO=function(){var c=this,A,J,q,Y,p,m,E;return g.S(function(O){if(O.K==1)return g.X(O,BU(),2);if(O.K!=3)return(A=O.C)?g.X(O,hK(A,"transfer"),3):O.return([]);J=O.C;q=[];Y=g.u(J);for(p=Y.next();!p.done;p=Y.next())m=p.value,m.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&m.key&&(E=g.c5(m.key).entityId,q.push(E));return O.return(IqJ(c,q))})};
g.D.kG=function(){return g.S(function(c){return c.return([])})};
g.D.BD=function(){return g.S(function(c){g.u$(c)})};
g.D.rU=function(){return g.S(function(c){g.u$(c)})};g.k(zhe,Xj);zhe.prototype.K=function(c){return TO(c)?PvV(this,c):Ro(c)?UmC(this,c):rx(c)?fqO(this,c):Promise.reject(Error("Unsupported action type: "+c.actionType))};
var ec=[10];g.k(iji,Xj);iji.prototype.K=function(c){return TO(c)?niH(this,c):Ro(c)?KWN(this,c):rx(c)?hhw(this,c):Promise.reject(Error("Unsupported action type: "+c.actionType))};
var ehR=[10];g.k(cSH,Xj);cSH.prototype.K=function(c){return Ro(c)?JS9(this,c):Promise.reject(Error("Unsupported action type: "+c.actionType))};g.k(q5x,iX);g.D=q5x.prototype;g.D.Lx=function(c){var A=iX.prototype.Lx.call(this,c);A.mainVideoEntity=new iji(c,this.o8,this.C);A.mainPlaylistEntity=new zhe(c,this.o8,this.C);A.mainDownloadsListEntity=new cSH(c,this.o8,this.C);return A};
g.D.refreshAllStaleEntities=function(c,A){var J=this,q,Y,p,m,E,O,T,R,r,H,V;return g.S(function(N){switch(N.K){case 1:q=[];if(!J.o8.W("web_player_offline_playlist_auto_refresh")){N.Tx(2);break}return g.X(N,Y5r(J,c,A),3);case 3:q=N.C;case 2:return g.X(N,PU.getInstance(),4);case 4:return Y=N.C,g.X(N,(p=Y)==null?void 0:p.get("sdois"),5);case 5:return m=N.C,g.X(N,(E=Y)==null?void 0:E.get("lmqf"),6);case 6:O=N.C;if(!m){N.Tx(7);break}R=q;r=R.concat;return g.X(N,pFe(J,m,(T=O)!=null?T:"SD",c===0),8);case 8:q=
r.call(R,N.C);case 7:return H=q,V=H.concat,g.X(N,iX.prototype.refreshAllStaleEntities.call(J,c,A),9);case 9:return q=V.call(H,N.C),N.return(q)}})};
g.D.Pv=function(c){var A,J,q,Y,p,m,E,O;return g.S(function(T){if(T.K==1)return g.X(T,BU(),2);if(T.K!=3)return(A=T.C)?g.X(T,K8(A,g.IC,"mainDownloadsListEntity"),3):T.return(!1);J=T.C;if((q=J)==null?0:(Y=q.downloads)==null?0:Y.length)for(p=g.A5(c,"mainVideoEntity"),m=g.u(J.downloads),E=m.next();!E.done;E=m.next())if(O=E.value,O.videoItem===p)return T.return(!0);return T.return(!1)})};
g.D.kG=function(){var c=this,A,J,q,Y,p,m,E,O;return g.S(function(T){if(T.K==1)return g.X(T,BU(),2);if(T.K!=3)return(A=T.C)?g.X(T,hK(A,"downloadStatusEntity"),3):T.return([]);J=T.C;q=[];Y=g.u(J);for(p=Y.next();!p.done;p=Y.next())m=p.value,m.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&m.key&&(E=g.c5(m.key).entityId,q.push(E));return q.length?(O={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},T.return(yG(c,q,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
O))):T.return([])})};
g.D.rU=function(){var c;return g.S(function(A){return A.K==1?g.X(A,BU(),2):(c=A.C)?g.X(A,em(c,{mode:"readwrite",Hf:!0},function(J){return lq(J,"mainVideoEntity").then(function(q){var Y=[];q=g.u(q);for(var p=q.next();!p.done;p=q.next()){p=p.value;var m=void 0;(m=p.userState)!=null&&m.playbackPosition||(m=g.c5(p.key).entityId,m={key:g.A5(m,"videoPlaybackPositionEntity"),videoId:m,lastPlaybackPositionSeconds:"0"},Y.push(bq(J,m,"videoPlaybackPositionEntity")),p.userState={playbackPosition:m.key},Y.push(bq(J,
p,"mainVideoEntity")))}return g.Lh.all(Y)})}),0):A.return()})};
g.D.BD=function(){var c,A,J,q,Y,p,m,E,O,T,R,r,H,V,N,w,W,C,G,Z,I,f,K,y,q8,pI,cw,EL,h,wa,M8,b$,Gw,OO,vw,CI,mM,L;return g.S(function(da){if(da.K==1)return g.X(da,BU(),2);if(da.K!=3){c=da.C;if(!c)return da.return();A=g.A5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.X(da,em(c,{mode:"readonly",Hf:!0},function(eN){return g.Lh.all([f8(eN,A,"mainDownloadsListEntity"),f8(eN,g.IC,"mainDownloadsListEntity"),lq(eN,"mainVideoEntity"),lq(eN,"mainPlaylistEntity")])}),3)}J=da.C;
q=g.u(J);Y=q.next().value;p=q.next().value;m=q.next().value;E=q.next().value;O=Y;T=p;R=m;r=E;H=new Set;if((V=O)==null?0:(N=V.downloads)==null?0:N.length)for(w=g.u(O.downloads),W=w.next();!W.done;W=w.next())C=W.value,G=void 0,(Z=(G=C.videoItem)!=null?G:C.playlistItem)&&H.add(Z);if((I=T)==null?0:(f=I.downloads)==null?0:f.length)for(K=g.u(T.downloads),y=K.next();!y.done;y=K.next())q8=y.value,q8.videoItem&&H.add(q8.videoItem);pI=new Set;cw=[];EL=g.u(r);for(h=EL.next();!h.done;h=EL.next()){wa=h.value;
if(wa.videos)for(M8=g.u(wa.videos),b$=M8.next();!b$.done;b$=M8.next())Gw=b$.value,(OO=JSON.parse(g.c5(Gw).entityId).videoId)&&pI.add(OO);wa.key&&!H.has(wa.key)&&cw.push(wa.key)}vw=g.u(R);for(CI=vw.next();!CI.done;CI=vw.next())mM=CI.value,mM.key&&!H.has(mM.key)&&(L=g.c5(mM.key).entityId,pI.has(L)||cw.push(mM.key));return cw.length?g.X(da,scJ(c,cw),0):da.Tx(0)})};g.k(mUO,Xj);mUO.prototype.K=function(c){return TO(c)?dU9(this,c):Ro(c)?EUM(this,c):rx(c)?O5H(this,c):Promise.reject(Error("Unsupported action type: "+c.actionType))};
var KS=[10];g.k(R6C,Xj);R6C.prototype.K=function(c){return TO(c)?H5C(this,c):Ro(c)?VlN(this,c):rx(c)?NUN(this,c):Promise.reject(Error("Unsupported action type: "+c.actionType))};
var hn=[10];g.k(gU9,Xj);gU9.prototype.K=function(c){return TO(c)?wFr(this,c):Ro(c)?WV9(this,c):rx(c)?LVR(this,c):Promise.reject(Error("Unsupported action type: "+c.actionType))};
var $UV=[10];g.k(Bk,iX);Bk.prototype.Lx=function(c){var A=iX.prototype.Lx.call(this,c);A.musicTrack=new gU9(c,this.C);A.musicPlaylist=new R6C(c,this.C);A.musicAlbumRelease=new mUO(c,this.C);return A};
Bk.prototype.refreshAllStaleEntities=function(c,A){var J=this,q,Y,p;return g.S(function(m){if(m.K==1)return g.X(m,C39(J,c,A),2);if(m.K!=3)return Y=q=m.C,p=Y.concat,g.X(m,iX.prototype.refreshAllStaleEntities.call(J,c,A),3);q=p.call(Y,m.C);return m.return(q)})};g.k(MlR,g.V5);g.D=MlR.prototype;g.D.create=function(){var c=this;g.U(this,this.events);if(g.c1(this.o8))this.C=new q5x(this.o8,this.player);else if(g.fk(this.o8)||g.qx(this.o8)==="WEB_MUSIC_INTEGRATIONS")this.C=new Bk(this.o8,this.player);this.events.Z(this.player,"onPlaybackStartExternal",function(){c.Ax()});
this.events.Z(this.player,"videodatachange",function(){c.Ax()});
this.o8.W("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.G0)};
g.D.A5=function(){return!1};
g.D.E$=function(c,A,J,q){var Y=this;return g.S(function(p){return Y.C?p.return(yG(Y.C,c,A,J,q)):p.return(Promise.reject())})};
g.D.deleteAll=function(){return this.C.deleteAll()};
g.D.ZQ=function(c){return this.C.ZQ(c)};
g.D.refreshAllStaleEntities=function(c){return this.C.refreshAllStaleEntities(c)};
g.D.setUpPositionSyncInterval=function(c){this.C.setUpPositionSyncInterval(c)};
g.D.Sy=function(c){this.C.Sy(c)};
g.D.rd=function(c){return this.C.rd(c)};
g.D.Ax=function(){var c=this,A;return g.S(function(J){A=c.player.getVideoData();return g.eA(A)?FVN(A)&&c.K!==A.clientPlaybackNonce?g.X(J,vUx(c,A),0):J.Tx(0):J.return()})};
g.D.G0=function(c){var A=this,J,q,Y,p,m,E,O;return g.S(function(T){if(T.K==1)return J=A.player.getVideoData(),q=J.Bf,g.kj(c,2)||g.kj(c,512)?g.X(T,BU(),2):T.return();if(T.K!=3){Y=T.C;if(!Y)return qi("PES is undefined"),T.return();p=J.videoId;return g.X(T,K8(Y,g.A5(p,"mainVideoEntity"),"mainVideoEntity"),3)}m=T.C;if(!m)return T.return();E=Math.floor(q).toString();O={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:E}};return g.X(T,A.E$([p],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
O),0)})};
g.D.isOrchestrationLeader=function(){return this.C.isOrchestrationLeader()};
g.D.updateDownloadState=function(c,A){var J,q,Y,p;return g.S(function(m){if(m.K==1)return g.X(m,BU(),2);J=m.C;if(!J)return qi("PES is undefined"),m.return();q=g.c5(c);Y=q.entityType;p=q.entityId;return g.X(m,Hk(p,Y,J,A,!0),0)})};g.HO("offline",MlR);})(_yt_player);

/*! For license information please see npm-d801507b.30e4f28fc4f779605087.js.LICENSE.txt */
(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[6534],{26456:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>R,wA:()=>M});var r=n(22523),i=n(2303),s=n(4408),a=n.n(s),o=n(64821),l=n.n(o),u=n(12969),c=n.n(u),h=n(7569);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,h.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=f(f({},{name:"en",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysMin:["S","M","T","W","T","F","S"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],formats:{lt:"h:mm A",lts:"h:mm:ss A",LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/DD/YYYY",LL:"MMMM D, YYYY","LL-D":"MMMM YYYY","LL-Y":"MMMM D",LLL:"MMMM D, YYYY HH:mm","LLL-Y":"MMMM D HH:mm",LLLL:"dddd MMMM D, YYYY HH:mm","LLLL-Y":"dddd MMMM D HH:mm",l:"M/D/YYYY","l-Y":"M/D",ll:"MMM D, YYYY","ll-Y":"MMM D",lll:"MMM D, YYYY h:mm A","lll-Y":"MMM D h:mm A",llll:"ddd MMM D, YYYY h:mm A","llll-Y":"ddd MMM D h:mm A","ll-Y+w":"ddd, MMM D","LT+to":"HH:mm ([GMT]Z)","LLL+to":"MMMM D, YYYY, HH:mm ([GMT]Z)"},meridiem:{am:"am",pm:"pm",AM:"AM",PM:"PM"},past:{y:{one:"%s yr. ago",other:"%s yr. ago"},M:{one:"%s mo. ago",other:"%s mo. ago"},w:{one:"%s wk. ago",other:"%s wk. ago"},d:{one:"%s day ago",other:"%s days ago"},h:{one:"%s hr. ago",other:"%s hr. ago"},m:{one:"%s min. ago",other:"%s min. ago"},s:{one:"%s sec. ago",other:"%s sec. ago"}},future:{y:{one:"in %s yr.",other:"in %s yr."},M:{one:"in %s mo.",other:"in %s mo."},w:{one:"in %s wk.",other:"in %s wk."},d:{one:"in %s day",other:"in %s days"},h:{one:"in %s hr.",other:"in %s hr."},m:{one:"in %s min.",other:"in %s min."},s:{one:"in %s sec.",other:"in %s sec."}},abbr:{y:{one:"%sy",other:"%sy"},M:{one:"%smo",other:"%smo"},w:{one:"%sw",other:"%sw"},d:{one:"%sd",other:"%sd"},h:{one:"%sh",other:"%sh"},m:{one:"%sm",other:"%sm"},s:{one:"%ss",other:"%ss"}},justNow:"Just now",yesterday:"Yesterday",today:"Today",tomorrow:"Tomorrow",weekStart:0}),{},{name:"en",meridiem:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e<12?n?"am":"AM":n?"pm":"PM"}}),g="second",m="zero",v="one",y="few",_="many",T="other",b=[{relativeTimeKey:"y",num:11,unit:"month"},{relativeTimeKey:"M",num:3.5,unit:"week"},{relativeTimeKey:"w",num:6.5,unit:"day"},{relativeTimeKey:"d",num:22,unit:"hour"},{relativeTimeKey:"h",num:45,unit:"minute"},{relativeTimeKey:"m",num:45,unit:g},{relativeTimeKey:"s",num:0,unit:g}],S=new Set(["af","ar","az","bg","bn","ca","ceb","cs","da","de","el","en-GB","en","es-419","es","et","fi","fil","fr-CA","fr","ga","gu","he","hi","hr","hu","id","is","it","ja","jv","kk","km","kn","ko","lt","lv","ml","mr","ms","my","nb","nl","or","pa","pl","pt-BR","pt-PT","pt","ro","ru","sk","sl","sq","sv","sw","ta","te","th","tr","uk","ur","uz","vi","zh-Hans","zh-Hant"]),P=p.formats,w=function(e,t){switch(t){case"ar":return 0===e?m:1===e?v:2===e?"two":e%100>=3&&e%100<=10?y:e%100>10?_:T;case"bn":case"nl":case"en":case"fil":case"fi":case"de":case"el":case"hu":case"it":case"pt":case"es":case"sv":case"ta":case"tr":case"et":case"af":case"bg":case"ml":case"mr":case"or":case"sw":case"te":case"ur":case"uz":case"da":case"nb":return 1===e?v:T;case"ceb":return e%10==4||e%10==6||e%10==9?v:T;case"cs":return 1===e?v:e%10>=2&&e%10<=4?y:Number.isInteger(e)?T:_;case"fr":case"gu":case"hi":case"pa":case"kn":return 0===e||1===e?v:T;case"he":return 1===e?v:2===e?"two":0!==e&&e%10==0?_:T;case"pl":case"ru":case"uk":return 1===e?v:e%10>=2&&e%10<=4?y:Number.isInteger(e)?_:T;case"ro":return 1===e?v:0===e||e%100>=2&&e%100<=19?y:T;case"hr":return e%10==1?v:e%10==2||e%10==3||e%10==4?y:T;case"lt":return e%10==1?v:e%10==0?T:Number.isInteger(e)?y:_;case"lv":return e%10==0?m:e%10==1?v:T;case"sk":return e%10==1?v:e%10==2||e%10==3||e%10==4?y:Number.isInteger(e)?T:_;default:return T}},k=function(e,t,n){var r=t.prototype,i=e.justNowThreshold;r.getTimeExpression=function(e,t){var r=n(e),s=n(t),a=s.$locale(),o=a.justNow,l=a.today,u=a.tomorrow,c=a.yesterday;return Math.abs(r.diff(s,"ms",!0))<=i?o:r.isSame(s,"day")?l:r.add(1,"day").isSame(s,"day")?u:r.subtract(1,"day").isSame(s,"day")?c:""}};function M(e){var t,n=e.toLowerCase();if(S.forEach((function(e){e.toLowerCase()===n&&(t=e)})),t)return t;var r=n.split("-")[0];return S.has(r)?r:"en"}k.$i=!1,a().extend(c()),a().extend(l()),a().extend((function(e,t,n){var r=t.prototype,i=r.format;n.Ls.en.formats=P,r.format=function(){var e,t,n=(e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"YYYY-MM-DDTHH:mm:ssZ",t=this.$locale().formats,e.replace(/(\[[^\]]+])|(LTS?|lts?|L{2,4}\-Y|l{1,4}\-Y|LL\-D|l{1,4}|L{1,4})/g,(function(e,n,r){return n||t[r]||P[r]})));return i.call(this,n)}})),a().extend((function(e,t,n){t.prototype.to=function(t){return function(t,r,i){for(var s=r.$locale(),a=e.thresholds,o=e.rounding,l="",u=0;u<a.length;u+=1){var c=a[u],h=c.relativeTimeKey,d=c.num,f=c.unit,p=n(t).diff(r,f,!0);if(o(Math.abs(p))>=d){var g=o(Math.abs(n(t).diff(r,h,!0))),m=w(g,r.$locale().name),v=p>0?"future":"past";l=((i?s.abbr[h]:s[v][h])[m]||"").replace("%s","".concat(g));break}}return l}(t,this,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}}),{thresholds:b,rounding:Math.round}),a().extend(k,{justNowThreshold:1e3}),a().locale(p.name,p);var E=function(){function e(){(0,r.A)(this,e),this.currentLocale=p.name}return(0,i.A)(e,[{key:"currentLocaleConfig",get:function(){return this.protectMultiThreadedRender(),a()().$locale()}},{key:"format",value:function(e,t){this.protectMultiThreadedRender();var n=this.getDate(e);return a()(n).format(t)}},{key:"setLocale",value:function(e){this.currentLocale=M(e),a().locale(M(e))}},{key:"setLocaleConfig",value:function(e){return this.currentLocale=M(e.name),a().locale(e.name,e),this}},{key:"utcFormat",value:function(e,t){this.protectMultiThreadedRender();var n=this.getDate(e);return a()(n).utc().format(t)}},{key:"getRelativeTime",value:function(e,t){return this.protectMultiThreadedRender(),a()(a()(e).utc()).to(a()(t).utc())}},{key:"getRelativeTimeAbbr",value:function(e,t){return this.protectMultiThreadedRender(),a()(a()(e).utc()).to(a()(t).utc(),!0)}},{key:"configureTimeExpression",value:function(e){this.protectMultiThreadedRender(),k.$i=!1,a().extend(k,e)}},{key:"getTimeExpression",value:function(e,t){return this.protectMultiThreadedRender(),a().prototype.getTimeExpression(e,t)}},{key:"getDate",value:function(e){return"number"==typeof e?new Date(e):e}},{key:"protectMultiThreadedRender",value:function(){var e=a().locale();this.currentLocale!==e&&this.setLocale(this.currentLocale)}}]),e}(),R=new E},94810:(e,t,n)=>{"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){var n;if(e)return"string"==typeof e?a(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(){return(1<arguments.length&&void 0!==arguments[1]&&!arguments[1]?/^[0-9]+$/:/^[0-9]*$/).test(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"")}function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return e&&/[^a-zA-Z0-9\_\.]/.test(e)}function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return e&&!o(e)&&!l(e)&&e.length<=25}function c(e){var t=e.uniqueId;return e=e.secUid,u(t)?t:e}function h(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return e?e.replace(/([\[\]\,.?"\(\)+_*\/\\&\$#^@!%~`<>:;\{\}？，。·！￥……（）+｛｝【】、|《》]|(?!\s)'\s+|\s+'(?!\s))/gi,"").trim().replace(/(\s+)-(\s+)/gi," ").replace(/\s+|・/gi,"-"):""}function d(){function e(e){return h.test(e)}function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return e?e.replace(l,"").trim().replace(/(\s+)-(\s+)/gi," ").replace(/\s+|・/gi,"-"):""}function n(){var e=r(h.exec(0<arguments.length&&void 0!==arguments[0]?arguments[0]:""),4);return e[0],{name:e[1],sign:e[2],feat:e[3]}}function s(){var i,s,a,o,l=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",u=1<arguments.length?arguments[1]:void 0,c=[];return u?((u=r(u.exec(l)||[],3))[0],i=u[1],u=void 0===(u=u[2])?"":u,!e(i=void 0===i?"":i)&&e(u)?(c.push(t(i)),o=(s=n(u)).sign,s=s.feat,o&&c.push(t(o)),s&&c.push(t(s))):(e(i)&&!e(u)?(s=(o=n(i)).name,a=o.sign,o=o.feat,s&&c.push(t(s)),a&&c.push(t(a)),o&&c.push(t(o))):c.push(t(i)),c.push(t(u)))):(a=(s=n(l)).name,o=s.feat,a&&c.push(t(a)),o&&c.push(t(o))),c}var a,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",l=/([\[\]\,.?"\(\)+_*\/\\&\$#^@!%~`<>:;\{\}？，。·！￥……（）+｛｝【】、|《》]|(?!\s)'\s+|\s+'(?!\s))/gi,u=/^(.*)\s?-\s?(.*)?/,c=/^(.*)\((.*)?\)/,h=/^(.*)(ft\.|feat\.)(.*)/;return a=o,(c.test(a)?i(s(o,c)):(a=o,u.test(a)?i(s(o,u)):e(o)?i(s(o)):[t(o)])).join("-")}n.d(t,{A:()=>f,h:()=>p});var f=Object.freeze({__proto__:null,isPureNumber:o,hasIllegalText:l,isRealUniqueId:u,getPureUniqueId:c,purifyPlainText:h,purifyMusicName:d}),p=Object.freeze({__proto__:null,getPureUserPath:function(e){var t=e.uniqueId,n=e.secUid,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"/";return(t=c({uniqueId:t,secUid:n}))?"/@".concat(t):r},getPureVideoPath:function(e){var t=e.uniqueId,n=e.secUid,r=e.videoId,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"/";return(t=c({uniqueId:t,secUid:n}))&&r?"/@".concat(t,"/video/").concat(r):i},getPureTagPath:function(e){var t=e.tagName,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"/";return t?"/tag/".concat(encodeURIComponent(t)):n},getPureMusicPath:function(e){var t=e.musicName,n=e.musicId,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"/";return t&&n?"/music/".concat(d(t),"-").concat(n):r},getPureLivePath:function(e){var t=e.uniqueId,n=e.secUid,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"/";return(t=c({uniqueId:t,secUid:n}))?"/@".concat(t,"/live"):r},getPureStickerPath:function(e){var t=e.stickerName,n=e.stickerId,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"/";return t&&n?"/sticker/".concat(h(t),"-").concat(n):r},getPureQuestionPath:function(e){var t=e.questionContent,n=e.questionId,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"/";return t&&n?"/question/".concat(h(t),"-").concat(n):r},getPureCollectionPath:function(e){var t=e.uniqueId,n=e.title,r=e.collectionId,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"/";return t&&n&&r?"/@".concat(t,"/collection/").concat(n,"-").concat(r):i}})},90170:function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(14);function i(){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=i=function(e,t,n){var i=r(e,t);if(i){var s=Object.getOwnPropertyDescriptor(i,t);return s.get?s.get.call(arguments.length<3?e:n):s.value}},e.exports.__esModule=!0,e.exports.default=e.exports),i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(15);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(11).default,i=n(7);e.exports=function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(16)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(e,t){function n(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,s){var a=e.apply(t,r);function o(e){n(a,i,s,o,l,"next",e)}function l(e){n(a,i,s,o,l,"throw",e)}o(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(17),i=n(18),s=n(19),a=n(20);e.exports=function(e){return r(e)||i(e)||s(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){e.exports=n(21)},function(e,t,n){var r=n(0);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t,r)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(11).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,s=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,s=Object.create(i.prototype),a=new M(r||[]);return s._invoke=function(e,t,n){var r="suspendedStart";return function(i,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw s;return{value:void 0,done:!0}}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var o=P(a,n);if(o){if(o===f)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=d(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,a),s}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var f={};function p(){}function g(){}function m(){}var v={};c(v,o,(function(){return this}));var y=Object.getPrototypeOf,_=y&&y(y(E([])));_&&_!==n&&s.call(_,o)&&(v=_);var T=m.prototype=p.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){var n;this._invoke=function(i,a){function o(){return new t((function(n,o){!function n(i,a,o,l){var u=d(e[i],e,a);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==r(h)&&s.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,l)}),(function(e){n("throw",e,o,l)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,l)}))}l(u.arg)}(i,a,n,o)}))}return n=n?n.then(o,o):o()}}function P(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,P(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=d(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,f;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function E(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(s.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:R}}function R(){return{value:void 0,done:!0}}return g.prototype=m,c(T,"constructor",m),c(m,"constructor",g),g.displayName=c(m,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,u,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},b(S.prototype),c(S.prototype,l,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var a=new S(h(e,n,r,i),s);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(T),c(T,u,"Generator"),c(T,o,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=E,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var o=s.call(i,"catchLoc"),l=s.call(i,"finallyLoc");if(o&&l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(12);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(12);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";n.r(t),n.d(t,"StreamPlayer",(function(){return jt})),n.d(t,"BasicPlayer",(function(){return Xt})),n.d(t,"storage",(function(){return Ht}));var r=n(9),i=n.n(r),s=n(2),a=n.n(s),o=n(3),l=n.n(o),u=n(1),c=n.n(u),h=n(4),d=n.n(h),f=n(5),p=n.n(f),g=n(0),m=n.n(g),v=n(8),y=n.n(v),_=n(10),T=n.n(_),b={autoplay:!1,loop:!1,muted:!1,metaChunkSize:209715.2,dataChunkSize:1048576,bufferEnoughTime:.5,bufferMaxTime:3,bufferCheckingInterval:100,preload:"auto"},S={defaultBufferSize:10485760},P=n(7),w=n.n(P),k=n(6),M=n.n(k),E=function(){function e(){a()(this,e),this._events=[],this._callbacks={}}return l()(e,[{key:"register",value:function(e){this._events.includes[e]||this._events.push(e)}},{key:"on",value:function(e,t){return!!this._events.includes(e)&&(this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),!0)}},{key:"off",value:function(e,t){if(!this._events.includes(e))return!1;var n=this._callbacks[e].indexOf(t);return this._callbacks[e].splice(n,1),!0}},{key:"trigger",value:function(e,t){if(!this._callbacks[e]||!this._callbacks[e].length)return!1;var n=null;return this._callbacks[e].forEach((function(e,r){0==r?n=e(t):e(t)})),n}},{key:"events",get:function(){return this._events},set:function(e){var t=this;e.forEach((function(e){t.register(e)}))}}]),e}();var R=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e){var r;return a()(this,n),r=t.call(this),M()(w()(r),"_initTextTrack",(function(){r.textTrack=document.createElement("track"),r.textTrack.default=!0,r.textTrack.kind="captions",r.textTrack.label="English",r.textTrack.srclang="en",r.textTrack.oncuechange=function(e){var t,n,i=null===(t=e.target)||void 0===t||null===(n=t.track)||void 0===n?void 0:n.activeCues;i&&i.length&&(i[0].track.mode="hidden",r.trigger("SUBTITLE_CHANGED",i[0].text))}})),M()(w()(r),"load",(function(e){return fetch(e).then((function(e){return e.text()})).then((function(e){var t=new Blob([e],{type:"text/vtt"});r.textTrack&&(r.textTrack.src=URL.createObjectURL(t),r.el.appendChild(r.textTrack))}))})),M()(w()(r),"reset",(function(){r.textTrack&&(r.textTrack.src&&URL.revokeObjectURL(r.textTrack.src),r.textTrack.parentNode&&r.textTrack.parentNode.removeChild(r.textTrack),r.textTrack=null)})),r.el=e,r.textTrack=null,r._initTextTrack(),r.events=["SUBTITLE_CHANGED"],r}return l()(n)}(E);var x=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this)).el=e,i.events=r,i.proxyEvents=[],i}return l()(n,[{key:"bind",value:function(e,t){c()(m()(n.prototype),"on",this).call(this,e,t)||this.el.addEventListener(e,t)}},{key:"remove",value:function(e,t){c()(m()(n.prototype),"off",this).call(this,e,t)||this.el.removeEventListener(e,t)}},{key:"proxy",value:function(e,t){var r=this;this.register(e),this.proxyEvents.push(e),c()(m()(n.prototype),"on",this).call(this,e,t),this.el.addEventListener(e,(function(t){c()(m()(n.prototype),"trigger",r).call(r,e,t)}))}}]),n}(E),D=[],I=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;a()(this,e),this.type=t,this.config=n,this.el=document.createElement("video"),this.config.container&&this.config.container.appendChild(this.el),this.eventManager=new x(this.el,[].concat(T()(D),T()(r))),this.subtitle=null,this.isReady=!1,this._initAttributes()}var t;return l()(e,[{key:"_initAttributes",value:function(){this.el.autoplay=this.config.autoplay||b.autoplay,this.el.loop=this.config.loop||b.loop,this.el.muted=this.config.muted||b.muted,this.el.controls=!1,this.el.playsInline=!0,this.el.preload=this.config.preload||b.preload}},{key:"_initEvents",value:function(){var e=this;this.eventManager.proxy("canplay",(function(){e.isReady=!0}))}},{key:"load",value:function(e){this.el.src!==e&&(this.el.src=e)}},{key:"play",value:function(){return this.el.play()}},{key:"pause",value:function(){this.el.pause()}},{key:"seek",value:function(e){this.el.currentTime=e}},{key:"mute",value:function(e){this.el.muted=e}},{key:"addSubtitle",value:function(e,t){return this.subtitle&&(this.subtitle.reset(),this.subtitle=null),this.subtitle=new R(this.el),this.subtitle.on("SUBTITLE_CHANGED",t),this.subtitle.load(e)}},{key:"access",value:function(){var e=this;return this.el.play().then((function(){e.el.pause()}))}},{key:"reset",value:function(){this.pause(),this.el.src=""}},{key:"on",value:function(e,t){this.eventManager.bind(e,t)}},{key:"off",value:function(e,t){this.eventManager.remove(e,t)}},{key:"replay",value:(t=i()(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.seek(0),e.prev=1,e.next=4,this.play();case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return t.apply(this,arguments)})},{key:"currentTime",get:function(){return this.el.currentTime}},{key:"playing",get:function(){return!this.el.paused}},{key:"duration",get:function(){return this.el.duration}},{key:"bufferRanges",get:function(){for(var e=[],t=0;t<this.el.buffered.length;t++)e.push({startTime:this.el.buffered.start(t),duration:this.el.buffered.end(t)-this.el.buffered.start(t)});return e}},{key:"volume",set:function(e){this.el.volume=e}},{key:"speed",set:function(e){this.el.playbackRate=e}},{key:"release",value:function(){this.isReady=!1}},{key:"getQualityInfo",value:function(){return this.el.getVideoPlaybackQuality?this.el.getVideoPlaybackQuality():{corruptedVideoFrames:0,creationTime:performance.now(),droppedVideoFrames:this.el.webkitDroppedFrameCount||0,totalVideoFrames:this.el.webkitDecodedFrameCount||0}}}]),e}();I.isSoftwareRender=function(){try{var e=document.createElement("canvas").getContext("webgl"),t=e.getExtension("WEBGL_debug_renderer_info");return e.getParameter(t.UNMASKED_RENDERER_WEBGL).includes("SwiftShader")}catch(e){return!0}};var C=I;var L=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a()(this,n),e=t.call(this),M()(w()(e),"_downloadChunk",(function(){if(!(e.loading||e._totalSize&&e._chunkOffset>=e._totalSize)){var t=function(){var e=performance.now();return function(){return(performance.now()-e)/1e3}}(),n=e._chunkSize,r=e._chunkOffset,i=e.url,s=new XMLHttpRequest;e.xhr=s,s.open("GET",i,!0),s.withCredentials=!!e.config.withCredentials,s.responseType="arraybuffer",s.start=e._chunkOffset,s.setRequestHeader("Range","bytes="+e._chunkOffset+"-"+(e._chunkOffset+n-1)),s.onerror=function(t){0!==t.target.status&&void 0!==t.target.status||e.trigger("ERROR",{name:"CORS_ERROR",url:i})},s.onreadystatechange=function(a){if(403===s.status&&e.trigger("ERROR",{name:"FORBIDDEN_ERROR",url:i,code:403}),4==s.readyState&&(e.loading=!1,200==s.status||206==s.status||304==s.status||416==s.status)){if(416==s.status)return void e.trigger("ERROR",{url:i,name:"RANGE_ERROR",code:416,range:"bytes="+r+"-"+(r+n-1)});if(i!=e.url)return;var o=null;if(s.getAllResponseHeaders().toLocaleLowerCase().indexOf("content-range")>=0&&(o=s.getResponseHeader("content-range")),!e._totalSize&&o){var l=o.split("/");2==l.length&&(e._totalSize=parseInt(l[1]),e.trigger("FILE_SIZE",e._totalSize))}e.eof=s.response.byteLength!=n||s.response.byteLength==e._totalSize,e.lastChunkNetworkTime=t(),e.trigger("CHUNK_READY",{data:s.response,eof:e.eof,chunkOffset:r,chunkSize:n,totalSize:e._totalSize,networkDuration:e.lastChunkNetworkTime}),e.eof||e.paused?e.eof&&e.trigger("EOF",null):e.timeoutId=setTimeout((function(){e._chunkOffset+=n,e._downloadChunk()}),0)}},e.loading=!0,s.send()}})),M()(w()(e),"load",(function(t){e.url=t})),M()(w()(e),"start",(function(){e.url&&(e.eof=!1,e.paused=!1,e.chunkOffset=0,e.switchToInitSize(),e._downloadChunk())})),M()(w()(e),"pause",(function(){e.paused=!0})),M()(w()(e),"resume",(function(t){!e.paused||e.loading||e.eof||(e.paused=!1,null!=t?e._chunkOffset=t:e._chunkOffset+=e._chunkSize,e._downloadChunk())})),M()(w()(e),"release",(function(){e.xhr&&(e.xhr.abort(),e.xhr=null,e.loading=!1),e.eof=!0,e.paused=!0,e.timeoutId&&clearTimeout(e.timeoutId),e.switchToInitSize(),e._chunkOffset=0,e._totalSize=0,e.url=""})),e.config=r,e._chunkSize=0,e._chunkOffset=0,e._totalSize=0,e.url="",e._initChunkSize=-1,e._commonChunkSize=-1,e.lastChunkNetworkTime=0,e.eof=!0,e.paused=!0,e.loading=!1,e.timeoutId=null,e.xhr=null,e.events=["CHUNK_READY","FILE_SIZE","EOF","ERROR"],e}return l()(n,[{key:"chunkSize",set:function(e){!e||e<0||(this._chunkSize=Math.ceil(e))}},{key:"initChunkSize",set:function(e){!e||e<0||(this._initChunkSize=Math.ceil(e))}},{key:"commonChunkSize",set:function(e){!e||e<0||(this._commonChunkSize=Math.ceil(e))}},{key:"switchToCommonSize",value:function(){this._commonChunkSize<=0||(this.chunkSize=this._commonChunkSize)}},{key:"switchToInitSize",value:function(){this._initChunkSize<=0||(this.chunkSize=this._initChunkSize)}},{key:"chunkOffset",set:function(e){this._chunkOffset=e}}]),n}(E),O=new(l()((function e(){var t=this;a()(this,e),M()(this,"create",(function(e,n,r){return new t.defs[e](n,r)})),M()(this,"define",(function(e,n){t.defs[e]=n})),M()(this,"isSupported",(function(e){return t.defs[e]})),this.defs={}}))),A=Math.pow(2,32),G=function(e,t,n,r,i){var s=new Uint8Array(e,t,i),a=new Uint8Array(n,r,i);s.set(a)},B=function(e,t){return e+t},N=function(e,t){return{value:e.getUint8(t),position:t+1}},$=function(e,t){return{value:e.getUint16(t),position:t+2}},U=function(e,t,n){return{value:e.getUint32(t,!n),position:t+4}},F=function(e,t,n){return e.setUint8(t,n),t+1},H=function(e,t,n){return e.setUint16(t,n),t+2},V=function(e,t,n){return e.setInt32(t,n),t+4},j=function(e,t,n){return e.setUint32(t,n),t+4},z=G,X=B,K=N,W=$,Q=function(e,t){return{value:e.getInt16(t),position:t+2}},q=function(e,t){var n=$(e,t),r=n.value<<16;return t=n.position,{value:r|(n=N(e,t)).value,position:t=n.position}},Y=U,J=function(e,t,n){return{value:e.getInt32(t,!n),position:t+4}},Z=function(e,t,n){var r=U(e,t,n),i=r.value;t=r.position;var s=(r=U(e,t,n)).value;return t=r.position,{value:n?i*A+s:s*A+i,position:t}},ee=function(e,t,n){return{value:null,position:B(t,8)}},te=function(e,t,n){for(var r=[],i=t;i<t+n;i++)r.push(e.getUint8(i));return{value:String.fromCharCode.apply(null,r),position:t+n}},ne=function(e,t,n){var r=new Uint8Array(n);return G(r.buffer,0,e.buffer,t,n*r.BYTES_PER_ELEMENT),{value:r,position:t+r.byteLength}},re=F,ie=function(e,t,n){return e.setInt16(t,n),t+2},se=H,ae=function(e,t,n){return t=F(e,t,(16711680&n)>>16),t=F(e,t,(65280&n)>>8),F(e,t,255&n)},oe=V,le=j,ue=function(e,t,n){var r=Math.floor(n/A);return t=j(e,t,r),j(e,t,4294967295&n)},ce=function(e,t,n,r){var i=Math.min(n.length,r),s=0;for(s=0;s<i;s++)t=F(e,t,n.charCodeAt(s));for(;s<r;s++)t=F(e,t,0);return t},he=function(e,t,n){if(n instanceof Uint8Array)G(e.buffer,t,n.buffer,0,n.byteLength),t+=n.byteLength;else for(var r=0;r<n.length;r++)t=F(e,t,n[r]);return t},de=function(e,t,n){if(n instanceof Uint32Array)G(e.buffer,t,n.buffer,0,n.byteLength),t+=n.byteLength;else for(var r=0;r<n.length;r++)t=j(e,t,n[r]);return t},fe=function(e,t,n){n=n||0;var r=new ArrayBuffer(t),i=new Uint8Array(r),s=new Uint8Array(e,n,t);return i.set(s),r},pe=function(e,t){var n=Number(e).toString(16);for(t=null==t?t=2:t;n.length<t;)n="0"+n;return n};var ge=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r,i){var s;return a()(this,n),(s=t.call(this)).offset=i,s.type=e,s.size=r,s}return l()(n,[{key:"parse",value:function(e,t){}},{key:"write",value:function(e,t){var n=this;return this.offset=t,t=X(t,4),{position:t=ce(e,t,this.type,4),writeSize:function(t){return n.size=t-n.offset,n.size,le(e,n.offset,n.size),t}}}}]),n}(E);var me=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"ftyp",e,r)).data=null,i.majorBrand=null,i.minorVersion=null,i.compatibleBrands=[],i}return l()(n,[{key:"parse",value:function(e,t){if(n.skippable){var r=ne(e,t,this.size-8);this.data=r.value,t=r.position}else{var i=this.size-8,s=te(e,t,4);for(this.majorBrand=s.value,t=s.position,s=Y(e,t,!0),this.minorVersion=s.value,t=s.position,i-=8,this.compatibleBrands=[];i>=4;){var a=te(e,t,4);this.compatibleBrands.push(a.value),t=a.position,i-=4}}return t}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);if(t=r.position,this.data)t=he(e,t,this.data);else{t=ce(e,t,this.majorBrand,4),t=le(e,t,this.minorVersion);for(var i=0;i<this.compatibleBrands.length;i++)t=ce(e,t,this.compatibleBrands[i],4)}return r.writeSize(t),t}}]),n}(ge);me.type="ftyp",me.skippable=!0,O.define(me.type,me);var ve=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r,i){var s;return a()(this,n),(s=t.call(this,e,r,i)).boxes=[],s.events=["SUB_BOX"],s.lastPosition=-1,s.listBoxes=[],s}return l()(n,[{key:"parse",value:function(e,t){for(;t<this.offset+this.size;){this.lastPosition=t;var n=this.trigger("SUB_BOX",{position:t});if(n){t=n.position;var r=n.type;this.listBoxes&&this.listBoxes.length&&this.listBoxes.indexOf(r)>=0?(this[n.type]||(this[n.type]=[]),this[n.type].push(n.box)):this[n.type]=n.box,this.boxes.push(n.type)}if(t==this.lastPosition)break}}},{key:"write",value:function(e,t){var r=this,i=c()(m()(n.prototype),"write",this).call(this,e,t);return{position:t=i.position,writeSize:function(e){return i.writeSize(e)},writeSubBoxes:function(e,t){for(var n=0;n<r.boxes.length;n++){var i=r.boxes[n];if(r[i]&&!r[i].unwritable)if(r.listBoxes&&r.listBoxes.length&&r.listBoxes.indexOf(i)>=0)for(var s=0;s<r[i].length;s++)t=r[i][s].write(e,t),r.size+=r[i][s].size;else t=r[i].write(e,t),r.size+=r[i].size}return t}}}},{key:"addSubBox",value:function(e,t){this[e=e||t.type]=t,this.boxes.push(e)}}]),n}(ge);var ye=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"moov",e,r)).listBoxes=["trak"],i}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=r.writeSubBoxes(e,t),r.writeSize(t),t}},{key:"duration",get:function(){return this.mvhd?this.mvhd.duration:0}},{key:"timescale",get:function(){return this.mvhd?this.mvhd.timescale:1}}]),n}(ve);ye.type="moov",O.define(ye.type,ye);var _e=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r,i){var s;return a()(this,n),(s=t.call(this,e,r,i)).version=0,s.flags=0,s}return l()(n,[{key:"parse",value:function(e,t){var n=K(e,t);return this.version=n.value,t=n.position,n=q(e,t),this.flags=n.value,n.position}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=re(e,t,this.version),{position:t=ae(e,t,this.flags),writeSize:function(e){return r.writeSize(e)}}}}]),n}(ge);var Te=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"mvhd",e,r)).data=null,i.creationTime=null,i.modificationTime=null,i.timescale=null,i.duration=null,i.rate=null,i.volume=null,i.nextTrackId=null,i}return l()(n,[{key:"parse",value:function(e,t){if(n.skippable){var r=t;t=c()(m()(n.prototype),"parse",this).call(this,e,t);var i=ne(e,t,this.size-8-(t-r));return this.data=i.value,r=i.position,1==this.version?(t=X(t,16),i=Y(e,t,!0),this.timescale=i.value,t=i.position,i=Z(e,t,!0),this.duration=i.value,t=i.position):(t=X(t,8),i=Y(e,t,!0),this.timescale=i.value,t=i.position,i=Y(e,t,!0),this.duration=i.value,t=i.position),r}t=c()(m()(n.prototype),"parse",this).call(this,e,t);var s=null;if(1==this.version)s=Z(e,t,!0),this.creationTime=s.value,t=s.position,s=Z(e,t,!0),this.modificationTime=s.value,t=s.position,s=Y(e,t,!0),this.timescale=s.value,t=s.position,s=Z(e,t,!0),this.duration=s.value,t=s.position;else{var a=Y(e,t,!0);this.creationTime=a.value,t=a.position,a=Y(e,t,!0),this.modificationTime=a.value,t=a.position,a=Y(e,t,!0),this.timescale=a.value,t=a.position,a=Y(e,t,!0),this.duration=a.value,t=a.position}return s=Y(e,t,!0),this.rate=s.value,t=s.position,s=W(e,t),this.volume=s.value>>8,t=s.position,s=function(e,t,n){var r=new Uint32Array(n);return G(r.buffer,0,e.buffer,t,n*r.BYTES_PER_ELEMENT),{value:r,position:t+r.byteLength}}(e,t=X(t,10),9),this.matrix=s.value,t=s.position,t=X(t,24),s=Y(e,t,!0),this.nextTrackId=s.value,s.position}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,this.data?t=he(e,t,this.data):(t=le(e,t,this.creationTime),t=le(e,t,this.modificationTime),t=le(e,t,this.timescale),t=le(e,t,this.duration),t=le(e,t,this.rate),t=se(e,t,this.volume<<8),t=X(t,10),t=de(e,t,this.matrix),t=X(t,24),t=le(e,t,this.nextTrackId)),r.writeSize(t),t}}]),n}(_e);Te.type="mvhd",Te.skippable=!0,O.define(Te.type,Te);var be=function(){function e(t,n){a()(this,e),this.index=t,this.trackId=n,this.dts=0,this.timescale=1,this.size=0,this.read=!1}return l()(e,[{key:"timestamp",get:function(){return this.dts/this.timescale}}]),e}();var Se=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),i=t.call(this,"trak",e,r),M()(w()(i),"buildSamples",(function(){if(i.sampleIndex=0,i.samples=[],i.samplesDuration=0,i.samplesSize=0,i.mdia&&i.mdia.minf&&i.mdia.minf.stbl){var e=i.mdia.minf.stbl.stco,t=i.mdia.minf.stbl.stsc,n=i.mdia.minf.stbl.stsz,r=i.mdia.minf.stbl.stts,s=i.mdia.minf.stbl.ctts,a=i.mdia.minf.stbl.stss,o=i.mdia.minf.stbl.stsd;if(n&&n.sampleSizes&&n.sampleSizes.length)for(var l=0,u=-1,c=-1,h=-1,d=-1,f=0,p=-1,g=-1,m=-1,v=-1,y=0;y<n.sampleSizes.length;y++){var _=new be(y,i.id);_.timescale=i.timescale,i.samples[y]=_,_.size=n.sampleSizes[y],i.samplesSize+=_.size,0===y?(p=1,g=0,_.chunkIndex=p,_.chunkRunIndex=g,m=t.samplesPerChunk[g],l=0,v=g+1<t.firstChunk.length?t.firstChunk[g+1]-1:1/0):y<m?(_.chunkIndex=p,_.chunkRunIndex=g):(p++,_.chunkIndex=p,l=0,p<=v||(v=1+ ++g<t.firstChunk.length?t.firstChunk[g+1]-1:1/0),_.chunkRunIndex=g,m+=t.samplesPerChunk[g]),_.descriptionIndex=t.sampleDescriptionIndex[_.chunkRunIndex]-1,_.description=o.entries[_.descriptionIndex],_.offset=e.chunkOffsets[_.chunkIndex-1]+l,l+=_.size,y>u&&(c++,u<0&&(u=0),u+=r.sampleCounts[c]),y>0?(i.samples[y-1].duration=r.sampleDeltas[c],i.samplesDuration+=i.samples[y-1].duration,_.dts=i.samples[y-1].dts+i.samples[y-1].duration,y==n.sampleSizes.length-1&&(_.duration=r.sampleDeltas[c],i.samplesDuration+=_.duration)):_.dts=0,s?(y>=h&&(d++,h<0&&(h=0),h+=s.sampleCounts[d]),_.cts=i.samples[y].dts+s.sampleOffsets[d]):_.cts=_.dts,a?y==a.sampleNumbers[f]-1?(_.iFrame=!0,f++):_.iFrame=!1:_.iFrame=!0}}})),M()(w()(i),"resetForFMP4",(function(){if(i.tkhd&&(i.tkhd.duration=0),i.mdia&&(i.mdia.mdhd&&(i.mdia.mdhd.duration=0),i.mdia&&i.mdia.minf&&i.mdia.minf.stbl)){var e=i.mdia.minf.stbl;if(e.stco&&(e.stco.chunkOffsets=[]),e.stsc){var t=e.stsc;t.firstChunk=[],t.samplesPerChunk=[],t.sampleDescriptionIndex=[]}if(e.stsz&&(e.stsz.sampleSizes=[]),e.stts){var n=e.stts;n.sampleCounts=[],n.sampleDeltas=[]}if(e.ctts){var r=e.ctts;r.sampleCounts=[],r.sampleOffsets=[]}}})),i}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=r.writeSubBoxes(e,t),r.writeSize(t),t}},{key:"getSampleOffsetWithTime",value:function(e){if(!this.samples.length)return 0;for(var t=-1,n=-1,r=(this.samples[0].timescale,0);r<this.samples.length;r++){var i=this.samples[r];if(i.cts>e*i.timescale){t=Math.max(0,r-1);break}i.iFrame&&(n=r)}if(t=n)return 0;for(e=this.samples[t].cts,this.sampleIndex=t;this.samples[t].read&&t!=this.samples.length-1;)t++;return this.samples[t].offset}},{key:"id",get:function(){return this.tkhd?this.tkhd.trackId:0}},{key:"idString",get:function(){return"trak_"+this.id}},{key:"name",get:function(){return this.mdia&&this.mdia.hdlr?this.mdia.hdlr.handler:""}},{key:"isAudio",get:function(){return"soun"==this.name}},{key:"isVideo",get:function(){return"vide"==this.name}},{key:"duration",get:function(){return this.mdia&&this.mdia.mdhd?this.mdia.mdhd.duration:0}},{key:"calculatedDuration",get:function(){if(!this.samples.length)return 0;var e=this.samples[this.samples.length-1];return(e.cts+e.duration)/e.timescale}},{key:"timescale",get:function(){return this.mdia&&this.mdia.mdhd?this.mdia.mdhd.timescale:1}},{key:"sampleDesc",get:function(){return this.mdia&&this.mdia.minf&&this.mdia.minf.stbl&&this.mdia.minf.stbl.stsd&&this.mdia.minf.stbl.stsd.entries.length?this.mdia.minf.stbl.stsd.entries[0]:null}},{key:"codec",get:function(){return this.sampleDesc?this.sampleDesc.getCodec():""}},{key:"sampleDuration",get:function(){return this.samples&&this.samples.length?this.samples[0].duration:0}}]),n}(ve);Se.type="trak",O.define(Se.type,Se);var Pe=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"tkhd",e,r)).data=null,i.creationTime=null,i.modificationTime=null,i.trackId=null,i.duration=null,i.layer=null,i.alternateGroup=null,i.volume=null,i.matrix=null,i.width=null,i.height=null,i}return l()(n,[{key:"parse",value:function(e,t){if(n.skippable){var r=t;t=c()(m()(n.prototype),"parse",this).call(this,e,t);var i=ne(e,t,this.size-8-(t-r));return this.data=i.value,r=i.position,1==this.version?(t=X(t,16),i=Y(e,t,!0),this.trackId=i.value,t=i.position,t=X(t,4),i=Z(e,t,!0),this.duration=i.value,t=i.position):(t=X(t,8),i=Y(e,t,!0),this.trackId=i.value,t=i.position,t=X(t,4),i=Y(e,t,!0),this.duration=i.value,t=i.position),t=X(t,52),i=Y(e,t,!0),this.width=i.value,t=i.position,i=Y(e,t,!0),this.height=i.value,t=i.position,r}if(t=c()(m()(n.prototype),"parse",this).call(this,e,t),1==this.version){var s=Z(e,t,!0);this.creationTime=s.value,t=s.position,s=Z(e,t,!0),this.modificationTime=s.value,t=s.position,s=Y(e,t,!0),this.trackId=s.value,t=s.position,t=(s=Y(e,t,!0)).position,s=Z(e,t,!0),this.duration=s.value,t=s.position}else{var a=Y(e,t,!0);this.creationTime=a.value,t=a.position,a=Y(e,t,!0),this.modificationTime=a.value,t=a.position,a=Y(e,t,!0),this.trackId=a.value,t=a.position,t=X(t,4),a=Y(e,t,!0),this.duration=a.value,t=a.position}t=X(t,8);var o=Q(e,t);return this.layer=o.value,t=o.position,o=Q(e,t),this.alternateGroup=o.value,t=o.position,o=Q(e,t),this.volume=o.value>>8,t=o.position,o=function(e,t,n){var r=new Int32Array(n);return G(r.buffer,0,e.buffer,t,n*r.BYTES_PER_ELEMENT),{value:r,position:t+r.byteLength}}(e,t=X(t,2),9),this.matrix=o.value,t=o.position,o=Y(e,t,!0),this.width=o.value,t=o.position,o=Y(e,t,!0),this.height=o.value,o.position}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,this.data?t=he(e,t,this.data):(t=le(e,t,this.creationTime),t=le(e,t,this.modificationTime),t=le(e,t,this.trackId),t=X(t,4),t=le(e,t,this.duration),t=X(t,8),t=ie(e,t,this.layer),t=ie(e,t,this.alternateGroup),t=ie(e,t,this.volume<<8),t=function(e,t,n){if(n instanceof Int32Array)G(e.buffer,t,n.buffer,0,n.byteLength),t+=n.byteLength;else for(var r=0;r<n.length;r++)t=V(e,t,n[r]);return t}(e,t=X(t,2),this.matrix),t=le(e,t,this.width),t=le(e,t,this.height)),r.writeSize(t),t}}]),n}(_e);Pe.type="tkhd",Pe.skippable=!0,O.define(Pe.type,Pe);var we=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"edts",e,r)).unwritable=!0,i}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=r.writeSubBoxes(e,t),r.writeSize(t),t}}]),n}(ve);we.type="edts",O.define(we.type,we);var ke=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"elst",e,r)).entries=[],i}return l()(n,[{key:"parse",value:function(e,t){if(n.skippable){var r=t;t=c()(m()(n.prototype),"parse",this).call(this,e,t);var i=ne(e,t,this.size-8-(t-r));return this.data=i.value,i.position}t=c()(m()(n.prototype),"parse",this).call(this,e,t);var s=Y(e,t,!0),a=s.value;t=s.position;for(var o=0;o<a;o++){var l={};this.entries.push(l),1===this.version?(s=Z(e,t,!0),l.segmentDuration=s.value,t=s.position,s=ee(0,t),l.mediaTime=s.value,t=s.position):(s=Y(e,t,!0),l.segmentDuration=s.value,t=s.position,s=J(e,t,!0),l.mediaTime=s.value,t=s.position),s=Q(e,t),l.mediaRateInteger=s.value,t=s.position,s=Q(e,t),l.mediaRateFraction=s.value,t=s.position}return t}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);if(t=r.position,this.data)t=he(e,t,this.data);else{t=le(e,t,this.entries.length);for(var i=0;i<this.entries.length;i++){var s=this.entries[i];t=le(e,t,s.segmentDuration),t=oe(e,t,s.mediaTime),t=ie(e,t,s.mediaRateInteger),t=ie(e,t,s.mediaRateFraction)}}return r.writeSize(t),t}}]),n}(_e);ke.type="elst",ke.skippable=!0,O.define(ke.type,ke);var Me=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"mdia",e,r)}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=r.writeSubBoxes(e,t),r.writeSize(t),t}}]),n}(ve);Me.type="mdia",O.define(Me.type,Me);var Ee=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"mdhd",e,r)}return l()(n,[{key:"parse",value:function(e,t){if(n.skippable){var r=t;t=c()(m()(n.prototype),"parse",this).call(this,e,t);var i=ne(e,t,this.size-8-(t-r));return this.data=i.value,r=i.position,1==this.version?(t=X(t,16),i=Y(e,t,!0),this.timescale=i.value,t=i.position,i=Z(e,t,!0),this.duration=i.value,t=i.position):(t=X(t,8),i=Y(e,t,!0),this.timescale=i.value,t=i.position,i=Y(e,t,!0),this.duration=i.value,t=i.position),r}if(t=c()(m()(n.prototype),"parse",this).call(this,e,t),1==this.version){var s=Z(e,t,!0);this.creationTime=s.value,t=s.position,s=Z(e,t,!0),this.modificationTime=s.value,t=s.position,s=Y(e,t,!0),this.timescale=s.value,t=s.position,s=Z(e,t,!0),this.duration=s.value,t=s.position}else{var a=Y(e,t,!0);this.creationTime=a.value,t=a.position,a=Y(e,t,!0),this.modificationTime=a.value,t=a.position,a=Y(e,t,!0),this.timescale=a.value,t=a.position,a=Y(e,t,!0),this.duration=a.value,t=a.position}var o=W(e,t);this.language=o.value,t=o.position;var l=[];return l[0]=this.language>>10&31,l[1]=this.language>>5&31,l[2]=31&this.language,this.languageString=String.fromCharCode(l[0]+96,l[1]+96,l[2]+96),X(t,2)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,this.data?t=he(e,t,this.data):(t=le(e,t,this.creationTime),t=le(e,t,this.modificationTime),t=le(e,t,this.timescale),t=le(e,t,this.duration),t=se(e,t,this.language),t=X(t,2)),r.writeSize(t),t}}]),n}(_e);Ee.type="mdhd",Ee.skippable=!0,O.define(Ee.type,Ee);var Re=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"hdlr",e,r)).name="",i.handler="",i}return l()(n,[{key:"parse",value:function(e,t){if(t=c()(m()(n.prototype),"parse",this).call(this,e,t),0===this.version){t=X(t,4);var r=te(e,t,4);this.handler=r.value,t=r.position,t=X(t,12),r=te(e,t,12),this.name=r.value,t=r.position}return t}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=X(t,4),t=ce(e,t,this.handler,4),t=X(t,12),t=ce(e,t,this.name,this.name.length+1),r.writeSize(t),t}}]),n}(_e);Re.type="hdlr",Re.skippable=!0,O.define(Re.type,Re);var xe=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"minf",e,r)}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=r.writeSubBoxes(e,t),r.writeSize(t),t}}]),n}(ve);xe.type="minf",O.define(xe.type,xe);var De=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"vmhd",e,r)}return l()(n,[{key:"parse",value:function(e,t){if(n.skippable){var r=t;t=c()(m()(n.prototype),"parse",this).call(this,e,t);var i=ne(e,t,this.size-8-(t-r));return this.data=i.value,i.position}t=c()(m()(n.prototype),"parse",this).call(this,e,t);var s=W(e,t);return this.graphicsMode=s.value,s=function(e,t,n){var r=new Uint16Array(n);return G(r.buffer,0,e.buffer,t,n*r.BYTES_PER_ELEMENT),{value:r,position:t+r.byteLength}}(e,t=s.position,3),this.opcolor=s.value,s.position}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,this.data?t=he(e,t,this.data):t=function(e,t,n){if(n instanceof Uint16Array)G(e.buffer,t,n.buffer,0,n.byteLength),t+=n.byteLength;else for(var r=0;r<n.length;r++)t=H(e,t,n[r]);return t}(e,t=se(e,t,this.graphicsMode),this.opcolor),r.writeSize(t),t}}]),n}(_e);De.type="vmhd",De.skippable=!0,O.define(De.type,De);var Ie=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"dinf",e,r)}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=r.writeSubBoxes(e,t),r.writeSize(t),t}}]),n}(ve);Ie.type="dinf",O.define(Ie.type,Ie);var Ce=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"url ",e,r)).location="",i}return l()(n,[{key:"parse",value:function(e,t){t=c()(m()(n.prototype),"parse",this).call(this,e,t),1!==this.flags&&(this.location="")}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,r.writeSize(t),t}}]),n}(_e);Ce.type="url ",O.define(Ce.type,Ce);var Le=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"dref",e,r)).events=["SUB_BOX"],i.entries=[],i}return l()(n,[{key:"parse",value:function(e,t){t=c()(m()(n.prototype),"parse",this).call(this,e,t);var r=Y(e,t,!0),i=r.value;t=r.position;for(var s=0;s<i;s++){var a=this.trigger("SUB_BOX",{position:t});a&&(t=a.position,this.entries.push(a.box))}}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);t=r.position,t=le(e,t,this.entries.length);for(var i=0;i<this.entries.length;i++)t=this.entries[i].write(e,t);return r.writeSize(t),t}}]),n}(_e);Le.type="dref",O.define(Le.type,Le);var Oe=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"stbl",e,r)}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=r.writeSubBoxes(e,t),r.writeSize(t),t}}]),n}(ve);Oe.type="stbl",O.define(Oe.type,Oe);var Ae=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"stsd",e,r)).events=["SUB_BOX"],i.entries=[],i}return l()(n,[{key:"parse",value:function(e,t){t=c()(m()(n.prototype),"parse",this).call(this,e,t);var r=Y(e,t,!0),i=r.value;t=r.position;for(var s=0;s<i;s++){var a=this.trigger("SUB_BOX",{position:t});a&&(t=a.position,this.entries.push(a.box))}}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);t=r.position,t=le(e,t,this.entries.length);for(var i=0;i<this.entries.length;i++)t=this.entries[i].write(e,t);return r.writeSize(t),t}}]),n}(_e);Ae.type="stsd",O.define(Ae.type,Ae);var Ge=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r,i){return a()(this,n),t.call(this,e,r,i)}return l()(n,[{key:"parse",value:function(e,t){if(n.skippable){var r=ne(e,t,78);this.data=r.value,t=r.position}else{t=X(t,6);var i=W(e,t);this.dataReferenceIndex=i.value,t=i.position,t=X(t,16),i=W(e,t),this.width=i.value,t=i.position,i=W(e,t),this.height=i.value,t=i.position,i=Y(e,t,!0),this.hResolution=i.value,t=i.position,i=Y(e,t,!0),this.vResolution=i.value,t=i.position,t=(i=Y(e,t,!0)).position,i=W(e,t),this.frameCount=i.value,t=i.position,i=K(e,t);var s=Math.min(31,i.value);t=i.position,i=te(e,t,s),this.compressorName=i.value,t=i.position,s<31&&(t=(i=te(e,t,31-s)).position),i=W(e,t),this.depth=i.value,t=i.position,t=X(t,2)}c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,this.data?t=he(e,t,this.data):(t=X(t,6),t=se(e,t,this.dataReferenceIndex),t=X(t,16),t=se(e,t,this.width),t=se(e,t,this.height),t=le(e,t,this.hResolution),t=le(e,t,this.vResolution),t=X(t,4),t=se(e,t,this.frameCount),t=re(e,t,Math.min(31,this.compressorName.length)),t=ce(e,t,this.compressorName,31),t=se(e,t,this.depth),t=ie(e,t,-1)),t=r.writeSubBoxes(e,t),r.writeSize(t),t}},{key:"getCodec",value:function(){return this.type.replace(".","")}}]),n}(ve);Ge.skippable=!0;var Be=Ge;var Ne=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"avc1",e,r)}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"getCodec",value:function(){var e=c()(m()(n.prototype),"getCodec",this).call(this);if(this.avcC)return e+"."+pe(this.avcC.AVCProfileIndication)+pe(this.avcC.profileCompatibility)+pe(this.avcC.AVCLevelIndication)}}]),n}(Be);Ne.type="avc1",O.define(Ne.type,Ne);var $e=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"avcC",e,r)}return l()(n,[{key:"parse",value:function(e,t){if(n.skippable){var r,i=ne(e,t,this.size-8);return this.data=i.value,r=i.position,t=X(t,1),i=K(e,t),this.AVCProfileIndication=i.value,t=i.position,i=K(e,t),this.profileCompatibility=i.value,t=i.position,i=K(e,t),this.AVCLevelIndication=i.value,t=i.position,t=X(t,1),r}var s=K(e,t);this.configurationVersion=s.value,t=s.position,s=K(e,t),this.AVCProfileIndication=s.value,t=s.position,s=K(e,t),this.profileCompatibility=s.value,t=s.position,s=K(e,t),this.AVCLevelIndication=s.value,t=s.position,s=K(e,t),this.lengthSizeMinusOne=3&s.value,t=s.position,s=K(e,t),this.SPSNalusCount=31&s.value,t=s.position;var a=this.size-8-6;this.SPS=[];for(var o=0;o<this.SPSNalusCount;o++){this.SPS[o]={};var l=W(e,t);this.SPS[o].length=l.value,t=l.position,l=ne(e,t,this.SPS[o].length),this.SPS[o].nalu=l.value,t=l.position,a-=2+this.SPS[o].length}s=K(e,t),this.PPSNalusCount=s.value,t=s.position,a--,this.PPS=[];for(var u=0;u<this.PPSNalusCount;u++){this.PPS[u]={};var c=W(e,t);this.PPS[u].length=c.value,t=c.position,c=ne(e,t,this.PPS[u].length),this.PPS[u].nalu=c.value,t=c.position,a-=2+this.PPS[u].length}if(a>0){var h=ne(e,t,a);this.ext=h.value,t=h.position}return t}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);if(t=r.position,this.data)t=he(e,t,this.data);else{t=re(e,t,this.configurationVersion),t=re(e,t,this.AVCProfileIndication),t=re(e,t,this.profileCompatibility),t=re(e,t,this.AVCLevelIndication),t=re(e,t,this.lengthSizeMinusOne+252),t=re(e,t,this.SPS.length+224);for(var i=0;i<this.SPS.length;i++)t=se(e,t,this.SPS[i].length),t=he(e,t,this.SPS[i].nalu);t=re(e,t,this.PPS.length);for(var s=0;s<this.PPS.length;s++)t=se(e,t,this.PPS[s].length),t=he(e,t,this.PPS[s].nalu);this.ext&&(t=he(e,t,this.ext))}return r.writeSize(t),t}}]),n}(ge);$e.type="avcC",$e.skippable=!0,O.define($e.type,$e);var Ue=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"pasp",e,r)).unwritable=!0,i}return l()(n,[{key:"parse",value:function(e,t){if(n.keepData){var r=ne(e,t,this.size-8);this.data=r.value}var i=Y(e,t,!0);this.hSpacing=i.value,t=i.position,i=Y(e,t,!0),this.vSpacing=i.value,t=i.position}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,this.data&&(t=he(e,t,this.data)),r.writeSize(t),t}}]),n}(ge);Ue.type="pasp",Ue.keepData=!0,O.define(Ue.type,Ue);var Fe=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"btrt",e,r)).unwritable=!0,i}return l()(n,[{key:"parse",value:function(e,t){if(n.keepData){var r=ne(e,t,this.size-8);this.data=r.value}var i=J(e,t,!0);this.bufferSize=i.value,t=i.position,i=J(e,t,!0),this.maxBitrate=i.value,t=i.position,i=J(e,t,!0),this.avgBitrate=i.value,t=i.position}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,this.data&&(t=he(e,t,this.data)),r.writeSize(t),t}}]),n}(ge);Fe.type="btrt",Fe.keepData=!0,O.define(Fe.type,Fe);var He=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"stts",e,r)).sampleCounts=[],i.sampleDeltas=[],i}return l()(n,[{key:"parse",value:function(e,t){t=c()(m()(n.prototype),"parse",this).call(this,e,t);var r=Y(e,t,!0),i=r.value;if(t=r.position,0===this.version)for(var s=0;s<i;s++){var a=Y(e,t,!0);this.sampleCounts.push(a.value),t=a.position;var o=(a=J(e,t,!0)).value;t=a.position,o<0&&(o=1),this.sampleDeltas.push(o)}}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);t=r.position,t=le(e,t,this.sampleCounts.length);for(var i=0;i<this.sampleCounts.length;i++)t=le(e,t,this.sampleCounts[i]),t=le(e,t,this.sampleDeltas[i]);return r.writeSize(t),t}}]),n}(_e);He.type="stts",O.define(He.type,He);var Ve=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"stss",e,r)).sampleNumbers=[],i}return l()(n,[{key:"parse",value:function(e,t){t=c()(m()(n.prototype),"parse",this).call(this,e,t);var r=Y(e,t,!0),i=r.value;if(t=r.position,0===this.version)for(var s=0;s<i;s++){var a=Y(e,t,!0);this.sampleNumbers.push(a.value),t=a.position}}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=le(e,t,this.sampleNumbers.length),t=de(e,t,this.sampleNumbers),r.writeSize(t),t}}]),n}(_e);Ve.type="stss",O.define(Ve.type,Ve);var je=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"ctts",e,r)).sampleCounts=[],i.sampleOffsets=[],i.unwritable=!0,i}return l()(n,[{key:"parse",value:function(e,t){t=c()(m()(n.prototype),"parse",this).call(this,e,t);var r=Y(e,t,!0),i=r.value;t=r.position;for(var s=0;s<i;s++){var a=Y(e,t,!0);this.sampleCounts.push(a.value),t=a.position,a=J(e,t,!0),this.sampleOffsets.push(a.value),t=a.position}}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);t=r.position,t=le(e,t,this.sampleCounts.length);for(var i=0;i<this.sampleCounts.length;i++)t=le(e,t,this.sampleCounts[i]),t=1===this.version?oe(e,t,this.sampleOffsets[i]):le(e,t,this.sampleOffsets[i]);return r.writeSize(t),t}}]),n}(_e);je.type="ctts",O.define(je.type,je);var ze=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"stsc",e,r)).firstChunk=[],i.samplesPerChunk=[],i.sampleDescriptionIndex=[],i}return l()(n,[{key:"parse",value:function(e,t){t=c()(m()(n.prototype),"parse",this).call(this,e,t);var r=Y(e,t,!0),i=r.value;if(t=r.position,0===this.version)for(var s=0;s<i;s++){var a=Y(e,t,!0);this.firstChunk.push(a.value),t=a.position,a=Y(e,t,!0),this.samplesPerChunk.push(a.value),t=a.position,a=Y(e,t,!0),this.sampleDescriptionIndex.push(a.value),t=a.position}}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);t=r.position,t=le(e,t,this.firstChunk.length);for(var i=0;i<this.firstChunk.length;i++)t=le(e,t,this.firstChunk[i]),t=le(e,t,this.samplesPerChunk[i]),t=le(e,t,this.sampleDescriptionIndex[i]);return r.writeSize(t),t}}]),n}(_e);ze.type="stsc",O.define(ze.type,ze);var Xe=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"stsz",e,r)).sampleSizes=[],i.sampleSize=0,i.sampleCount=0,i}return l()(n,[{key:"parse",value:function(e,t){if(t=c()(m()(n.prototype),"parse",this).call(this,e,t),0===this.version){var r=Y(e,t,!0);this.sampleSize=r.value,t=r.position,r=Y(e,t,!0),this.sampleCount=r.value,t=r.position;for(var i=0;i<this.sampleCount;i++)if(0===this.sampleSize){var s=Y(e,t,!0);this.sampleSizes.push(s.value),t=s.position}else this.sampleSizes[i]=this.sampleSize}}},{key:"write",value:function(e,t){var r=!0;if(this.sampleSizes.length>0)for(var i=0;i+1<this.sampleSizes.length;){if(this.sampleSizes[i+1]!==this.sampleSizes[0]){r=!1;break}i++}else r=!1;var s=c()(m()(n.prototype),"write",this).call(this,e,t);return t=s.position,t=r?le(e,t,this.sampleSizes[0]):X(t,4),t=le(e,t,this.sampleSizes.length),r||(t=de(e,t,this.sampleSizes)),s.writeSize(t),t}}]),n}(_e);Xe.type="stsz",O.define(Xe.type,Xe);var Ke=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"stco",e,r)).chunkOffsets=[],i}return l()(n,[{key:"parse",value:function(e,t){t=c()(m()(n.prototype),"parse",this).call(this,e,t);var r=Y(e,t,!0),i=r.value;if(t=r.position,0===this.version)for(var s=0;s<i;s++){var a=Y(e,t,!0);this.chunkOffsets.push(a.value),t=a.position}}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=le(e,t,this.chunkOffsets.length),t=de(e,t,this.chunkOffsets),r.writeSize(t),t}}]),n}(_e);Ke.type="stco",O.define(Ke.type,Ke);var We=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"udta",e,r)}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=r.writeSubBoxes(e,t),r.writeSize(t),t}}]),n}(ve);We.type="udta",O.define(We.type,We);var Qe=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"meta",e,r)).events=["SUB_BOX"],i.boxes=[],i.lastPosition=-1,i}return l()(n,[{key:"parse",value:function(e,t){for(t=c()(m()(n.prototype),"parse",this).call(this,e,t);t<this.offset+this.size;){this.lastPosition=t;var r=this.trigger("SUB_BOX",{position:t});if(r&&(t=r.position,this[r.type]=r.box,this.boxes.push(r.type)),t==this.lastPosition)break}}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,r.writeSize(t),t}}]),n}(_e);Qe.type="meta",O.define(Qe.type,Qe);var qe=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"ilst",e,r)}return l()(n,[{key:"parse",value:function(e,t){}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,r.writeSize(t),t}}]),n}(ge);qe.type="ilst",O.define(qe.type,qe);var Ye=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"free",e,r)}return l()(n,[{key:"parse",value:function(e,t){}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,r.writeSize(t),t}}]),n}(ge);Ye.type="free",O.define(Ye.type,Ye);var Je=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"mdat",e,r)).data=null,i}return l()(n,[{key:"parse",value:function(e,t){}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,this.data&&(t=he(e,t,this.data)),r.writeSize(t),t}}]),n}(ge);Je.type="mdat",O.define(Je.type,Je);var Ze=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"mvex",e,r)).listBoxes=[],i}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=r.writeSubBoxes(e,t),r.writeSize(t),t}}]),n}(ve);Ze.type="mvex",O.define(Ze.type,Ze);var et=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"mehd",e,r)}return l()(n,[{key:"parse",value:function(e,t){if(t=c()(m()(n.prototype),"parse",this).call(this,e,t),1&this.flags&&(this.version=1),1==this.version){var r=Z(e,t,!0);this.fragmentDuration=r.value,t=r.position}else{var i=Y(e,t,!0);this.fragmentDuration=i.value,t=i.position}return t}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,r.writeSize(t),t}}]),n}(_e);et.type="mehd",O.define(et.type,et);var tt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"trex",e,r)).trackId=null,i.defaultSampleDescriptionIndex=null,i.defaultSampleDuration=null,i.defaultSampleSize=null,i.defaultSampleFlags=null,i}return l()(n,[{key:"parse",value:function(e,t){t=c()(m()(n.prototype),"parse",this).call(this,e,t);var r=Y(e,t,!0);return this.trackId=r.value,t=r.position,r=Y(e,t,!0),this.defaultSampleDescriptionIndex=r.value,t=r.position,r=Y(e,t,!0),this.defaultSampleDuration=r.value,t=r.position,r=Y(e,t,!0),this.defaultSampleSize=r.value,t=r.position,r=Y(e,t,!0),this.defaultSampleFlags=r.value,r.position}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=le(e,t,this.trackId),t=le(e,t,this.defaultSampleDescriptionIndex),t=le(e,t,this.defaultSampleDuration),t=le(e,t,this.defaultSampleSize),t=le(e,t,this.defaultSampleFlags),r.writeSize(t),t}}]),n}(_e);tt.type="trex",O.define(tt.type,tt);var nt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"moof",e,r)).listBoxes=[],i}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=r.writeSubBoxes(e,t),r.writeSize(t),t}},{key:"adjustDataOffset",value:function(e){this.traf&&this.traf.trun&&(this.traf.trun.dataOffset=this.size+8),le(e,this.dataOffsetPosition,this.dataOffset)}},{key:"dataOffset",get:function(){return this.traf&&this.traf.trun?this.traf.trun.dataOffset:0}},{key:"dataOffsetPosition",get:function(){return this.traf&&this.traf.trun?this.traf.trun.dataOffsetPosition:0}}]),n}(ve);nt.type="moof",O.define(nt.type,nt);var rt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"mfhd",e,r)).sequenceNumber=0,i}return l()(n,[{key:"parse",value:function(e,t){t=c()(m()(n.prototype),"parse",this).call(this,e,t);var r=Y(e,t,!0);return this.sequenceNumber=r.value,r.position}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=le(e,t,this.sequenceNumber),r.writeSize(t),t}}]),n}(_e);rt.type="mfhd",O.define(rt.type,rt);var it=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"traf",e,r)).listBoxes=[],i}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=r.writeSubBoxes(e,t),r.writeSize(t),t}}]),n}(ve);it.type="traf",O.define(it.type,it);var st=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"tfhd",e,r)).trackId=0,i}return l()(n,[{key:"parse",value:function(e,t){}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=le(e,t,this.trackId),1&this.flags&&(t=ue(e,t,this.baseDataOffset)),2&this.flags&&(t=le(e,t,this.defaultSampleDescriptionIndex)),8&this.flags&&(t=le(e,t,this.defaultSampleDuration)),16&this.flags&&(t=le(e,t,this.defaultSampleSize)),32&this.flags&&(t=le(e,t,this.defaultSampleFlags)),r.writeSize(t),t}}]),n}(_e);st.type="tfhd",O.define(st.type,st);var at=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"tfdt",e,r)}return l()(n,[{key:"parse",value:function(e,t){}},{key:"write",value:function(e,t){this.version=this.baseMediaDecodeTime>Math.pow(2,32)-1?1:0;var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=1===this.version?ue(e,t,this.baseMediaDecodeTime):le(e,t,this.baseMediaDecodeTime),r.writeSize(t),t}}]),n}(_e);at.type="tfdt",O.define(at.type,at);var ot=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"trun",e,r)).flags=0,i}return l()(n,[{key:"parse",value:function(e,t){}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);t=r.position,t=le(e,t,this.sampleCount),1&this.flags&&(this.dataOffsetPosition=t,t=oe(e,t,this.dataOffset)),4&this.flags&&(t=le(e,t,this.firstSampleFlags));for(var i=0;i<this.sampleCount;i++)256&this.flags&&(t=le(e,t,this.sampleDuration[i])),512&this.flags&&(t=le(e,t,this.sampleSize[i])),1024&this.flags&&(t=le(e,t,this.sampleFlags[i])),2048&this.flags&&(t=0===this.version?le(e,t,this.sampleCompositionTimeOffset[i]):oe(e,t,this.sampleCompositionTimeOffset[i]));return r.writeSize(t),t}}]),n}(_e);ot.type="trun",O.define(ot.type,ot);var lt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"smhd",e,r)}return l()(n,[{key:"parse",value:function(e,t){if(n.skippable){var r=t;t=c()(m()(n.prototype),"parse",this).call(this,e,t);var i=ne(e,t,this.size-8-(t-r));return this.data=i.value,i.position}t=c()(m()(n.prototype),"parse",this).call(this,e,t);var s=W(e,t);return this.balance=s.value,s.position}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,this.data?t=he(e,t,this.data):(t=se(e,t,this.balance),t=X(t,2)),r.writeSize(t),t}}]),n}(_e);lt.type="smhd",lt.skippable=!0,O.define(lt.type,lt);var ut=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r,i){var s;return a()(this,n),(s=t.call(this)).type=e,s.size=r,s.offset=i,s}return l()(n,[{key:"parse",value:function(e,t){}},{key:"write",value:function(e,t){return t}}]),n}(E);var ct=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,n.type,e,r)}return l()(n,[{key:"parse",value:function(e,t){var n=W(e,t);if(this.esId=n.value,t=n.position,n=K(e,t),this.flags=n.value,t=n.position,this.size-=3,128&this.flags?(n=W(e,t),this.depEsId=n.value,t=n.position,this.size-=2):this.depEsId=0,64&this.flags){var r=K(e,t),i=r.value;t=r.position,r=te(e,t,i),this.URL=r.value,t=r.position,this.size-=i+1}else this.URL="";if(32&this.flags){var s=W(e,t);this.ocrEsId=s.value,t=s.position,this.size-=2}else this.ocrEsId=0;return t}},{key:"write",value:function(e,t){return t}}]),n}(ut);ct.type=3..toString();var ht=ct;var dt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,n.type,e,r)}return l()(n,[{key:"parse",value:function(e,t){var n=ne(e,t,this.size);return this.data=n.value,n.position}},{key:"write",value:function(e,t){return t}}]),n}(ut);dt.type=5..toString();var ft=dt;var pt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,n.type,e,r)}return l()(n,[{key:"parse",value:function(e,t){var n=K(e,t);return this.oti=n.value,t=n.position,n=K(e,t),this.streamType=n.value,t=n.position,n=q(e,t),this.bufferSize=n.value,t=n.position,n=Y(e,t,!0),this.maxBitrate=n.value,t=n.position,n=Y(e,t,!0),this.avgBitrate=n.value,t=n.position,this.size-=13,t}},{key:"write",value:function(e,t){return t}}]),n}(ut);pt.type=4..toString();var gt=pt;var mt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,n.type,e,r)}return l()(n,[{key:"parse",value:function(e,t){var n=ne(e,t,this.size);return this.data=n.value,n.position}},{key:"write",value:function(e,t){return t}}]),n}(ut);mt.type=6..toString();var vt=mt;var yt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"esds",e,r)).lastPosition=-1,i.boxes=[],i.boxDef={},i.boxDef[ht.type]=ht,i.boxDef[gt.type]=gt,i.boxDef[ft.type]=ft,i.boxDef[vt.type]=vt,i}return l()(n,[{key:"parseDesc",value:function(e,t){var n=0,r=K(e,t),i=r.value;t=r.position;var s=(r=K(e,t)).value;for(t=r.position;128&s;){n=(127&s)<<7;var a=K(e,t);s=a.value,t=a.position}return{size:n+=127&s,position:t,type:i+""}}},{key:"parse",value:function(e,t){t=c()(m()(n.prototype),"parse",this).call(this,e,t);var r=ne(e,t,this.size-12);this.data=r.value,t=r.position;for(var i=new DataView(this.data.buffer),s=0;s<this.size-12;){var a=this.parseDesc(i,s);if(a){s=a.position;var o=a.type;if(!this.boxDef[o])break;var l=new this.boxDef[o](a.size,s);s=l.parse(i,s),this[o]=l,this.boxes.push(o)}}return t}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,this.data&&(t=he(e,t,this.data)),r.writeSize(t),t}},{key:"getCodec",value:function(){var e=this[gt.type],t=this[ft.type],n=e?e.oti:0,r="";return t&&t.data&&31==(r=(248&t.data[0])>>3)&&t.data.length>=2&&(r=32+((7&t.data[0])<<3)+((224&t.data[1])>>5)),function(e,t){var n=Number(e).toString(16);for(t=null==t?t=2:t;n.length<t;)n="0"+n;return n}(n)+(r?"."+r:"")}}]),n}(_e);yt.type="esds",O.define(yt.type,yt);var _t=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"mp4a",e,r)}return l()(n,[{key:"parse",value:function(e,t){return c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){return c()(m()(n.prototype),"write",this).call(this,e,t)}},{key:"getCodec",value:function(){var e=c()(m()(n.prototype),"getCodec",this).call(this);return this.esds?e+"."+this.esds.getCodec():e}}]),n}(function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r,i){return a()(this,n),t.call(this,e,r,i)}return l()(n,[{key:"parse",value:function(e,t){t=X(t,6);var r=W(e,t);this.dataReferenceIndex=r.value,t=r.position,t=X(t,8),r=W(e,t),this.channelCount=r.value,t=r.position,r=W(e,t),this.sampleSize=r.value,t=r.position,t=X(t,4),r=Y(e,t,!0),this.samplerate=r.value/65536,t=r.position,c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=X(t,6),t=se(e,t,this.dataReferenceIndex),t=X(t,8),t=se(e,t,this.channelCount),t=se(e,t,this.sampleSize),t=X(t,4),t=le(e,t,this.samplerate<<16),t=r.writeSubBoxes(e,t),r.writeSize(t),t}},{key:"getCodec",value:function(){return this.type.replace(".","")}}]),n}(ve));_t.type="mp4a",O.define(_t.type,_t);var Tt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"keys",e,r)}return l()(n,[{key:"parse",value:function(e,t){if(n.keepData){var r=ne(e,t,this.size-8);this.data=r.value}}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,r.writeSize(t),t}}]),n}(ge);Tt.type="keys",Tt.keepData=!0,O.define(Tt.type,Tt);var bt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"hvc1",e,r)}return l()(n,[{key:"parse",value:function(e,t){c()(m()(n.prototype),"parse",this).call(this,e,t)}},{key:"getCodec",value:function(){var e=c()(m()(n.prototype),"getCodec",this).call(this);if(this.hvcC){switch(e+=".",this.hvcC.generalProfileSpace){case 0:e+="";break;case 1:e+="A";break;case 2:e+="B";break;case 3:e+="C"}e+=this.hvcC.generalProfileIdc,e+=".";for(var t=this.hvcC.generalProfileCompatibility,r=0,i=0;i<32&&(r|=1&t,31!=i);i++)r<<=1,t>>=1;e+=pe(r,0),e+=".",0===this.hvcC.generalTierFlag?e+="L":e+="H",e+=this.hvcC.generalLevelIdc;for(var s=!1,a="",o=5;o>=0;o--)(this.hvcC.generalConstraintIndicator[o]||s)&&(a="."+pe(this.hvcC.generalConstraintIndicator[o],0)+a,s=!0);e+=a}return e}}]),n}(Be);bt.type="hvc1",O.define(bt.type,bt);var St=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"hvcC",e,r)}return l()(n,[{key:"parse",value:function(e,t){if(n.skippable){var r,i=ne(e,t,this.size-8);this.data=i.value,r=i.position,t=X(t,1);var s=(i=K(e,t)).value;return t=i.position,this.generalProfileSpace=s>>6,this.generalTierFlag=(32&s)>>5,this.generalProfileIdc=31&s,i=Y(e,t,!0),this.generalProfileCompatibility=i.value,t=i.position,i=ne(e,t,6),this.generalConstraintIndicator=i.value,t=i.position,i=K(e,t),this.generalLevelIdc=i.value,t=i.position,r}var a=K(e,t);this.configurationVersion=a.value,t=a.position;var o=(a=K(e,t)).value;t=a.position,this.generalProfileSpace=o>>6,this.generalTierFlag=(32&o)>>5,this.generalProfileIdc=31&o,a=Y(e,t,!0),this.generalProfileCompatibility=a.value,t=a.position,a=ne(e,t,6),this.generalConstraintIndicator=a.value,t=a.position,a=K(e,t),this.generalLevelIdc=a.value,t=a.position,a=W(e,t),this.minSpatialSegmentationIdc=4095&a.value,t=a.position,a=K(e,t),this.parallelismType=3&a.value,t=a.position,a=K(e,t),this.chromaFormatIdc=3&a.value,t=a.position,a=K(e,t),this.bitDepthLumaMinus8=7&a.value,t=a.position,a=K(e,t),this.bitDepthChromaMinus8=7&a.value,t=a.position,a=W(e,t),this.avgFrameRate=a.value,t=a.position,o=(a=K(e,t)).value,t=a.position,this.constantFrameRate=o>>6,this.numTemporalLayers=1&o,this.temporalIdNested=1&o,this.lengthSizeMinusOne=3&o,this.naluArrays=[];var l=(a=K(e,t)).value;t=a.position;for(var u=0;u<l;u++){var c=[];this.naluArrays.push(c),o=(a=K(e,t)).value,t=a.position,c.completeness=(128&o)>>7,c.naluType=63&o;var h=(a=W(e,t)).value;t=a.position;for(var d=0;d<h;d++){var f={};c.push(f);var p=(a=W(e,t)).value;t=a.position,a=ne(e,t,p),f.data=a.value,t=a.position}}}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);if(t=r.position,this.data)t=he(e,t,this.data);else{t=re(e,t,this.configurationVersion),t=re(e,t,this.generalProfileSpace<<6|this.generalTierFlag<<5|this.generalProfileIdc),t=le(e,t,this.generalProfileCompatibility),t=he(e,t,this.generalConstraintIndicator),t=re(e,t,this.generalLevelIdc),t=se(e,t,this.minSpatialSegmentationIdc+(15<<24)),t=re(e,t,this.parallelismType+252),t=re(e,t,this.chromaFormatIdc+252),t=re(e,t,this.bitDepthLumaMinus8+248),t=re(e,t,this.bitDepthChromaMinus8+248),t=se(e,t,this.avgFrameRate),t=re(e,t,(this.constantFrameRate<<6)+(this.numTemporalLayers<<3)+(this.temporalIdNested<<2)+this.lengthSizeMinusOne),t=re(e,t,this.naluArrays.length);for(var i=0;i<this.naluArrays.length;i++){t=re(e,t,(this.naluArrays[i].completeness<<7)+this.naluArrays[i].naluType),t=se(e,t,this.naluArrays[i].length);for(var s=0;s<this.naluArrays[i].length;s++)t=se(e,t,this.naluArrays[i][s].data.length),t=he(e,t,this.naluArrays[i][s].data)}}return r.writeSize(t),t}}]),n}(ge);St.type="hvcC",St.skippable=!0,O.define(St.type,St);var Pt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,"colr",e,r)).unwritable=!0,i}return l()(n,[{key:"parse",value:function(e,t){var n=te(e,t,4);if(this.colourType=n.value,t=n.position,"nclx"===this.colourType){n=W(e,t),this.colourPrimaries=n.value,t=n.position,n=W(e,t),this.transferCharacteristics=n.value,t=n.position,n=W(e,t),this.matrixCoefficients=n.value,t=n.position;var r=(n=K(e,t)).value;t=n.position,this.fullRangeFlag=r>>7}else"rICC"!==this.colourType&&"prof"!==this.colourType||(n=ne(this.size-4),this.ICCProfile=n.value,t=n.position)}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,r.writeSize(t),t}}]),n}(ge);Pt.type="colr",Pt.keepData=!1,O.define(Pt.type,Pt);var wt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e,r){return a()(this,n),t.call(this,"fiel",e,r)}return l()(n,[{key:"parse",value:function(e,t){var n=K(e,t);this.fieldCount=n.value,t=n.position,n=K(e,t),this.fieldOrdering=n.value,t=n.position}},{key:"write",value:function(e,t){var r=c()(m()(n.prototype),"write",this).call(this,e,t);return t=r.position,t=re(e,t,this.fieldCount),t=re(e,t,this.fieldOrdering),r.writeSize(t),t}}]),n}(ge);wt.type="fiel",wt.keepData=!1,O.define(wt.type,wt);var kt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(){var e;return a()(this,n),e=t.call(this),M()(w()(e),"setPosition",(function(t){e.position=t})),M()(w()(e),"setEndPosition",(function(t){e.endPosition=t})),M()(w()(e),"_isEnoughForSize",(function(){return e.endPosition-e.position>=4})),M()(w()(e),"_isEnoughForType",(function(){return e.endPosition-e.position>=4})),M()(w()(e),"_isEnoughForBox",(function(t){return e.endPosition-e.position>=t})),M()(w()(e),"start",(function(){for(e.paused=!1;e.position<e.endPosition&&!e.moovReady&&(e.lastPosition=e.position,e._parse(),e.lastPosition!=e.position&&!e.paused););})),M()(w()(e),"updateBuffer",(function(t){e.dataView=new DataView(t),e.trigger("UPDATED",null)})),M()(w()(e),"_parse",(function(){var t=e.position;if(!e._isEnoughForSize())return e.paused=!0,e.trigger("PAUSED",{type:null,size:null,position:e.position}),!1;var n=Y(e.dataView,e.position,!0),r=n.value;if(e.position=n.position,!e._isEnoughForType())return e.paused=!0,e.position=t,e.trigger("PAUSED",{type:null,size:r,position:e.position}),!1;var i=(n=te(e.dataView,e.position,4)).value;if(!e._isEnoughForBox(r))return e.paused=!0,e.position=t,e.trigger("PAUSED",{type:i,size:r,position:e.position}),!1;if(e.position=n.position,!O.isSupported(i))return e.position=t+r,{type:i,box:null,position:e.position};e.trigger("STARTED",{type:i,offset:t,size:r});var s=O.create(i,r,t);return s.on("SUB_BOX",(function(t){return e.position=t.position,e._parse()})),s.parse(e.dataView,e.position),e.position=t+r,e.trigger("ENDED",{type:i,offset:t,size:r,box:s}),"moov"==i?(e.moovReady=!0,!1):{type:i,box:s,position:e.position}})),M()(w()(e),"release",(function(){e.dataView=null,e.position=0,e.endPosition=0,e.lastPosition=-1,e.paused=!0,e.moovReady=!1})),e.dataView=null,e.position=0,e.endPosition=0,e.lastPosition=-1,e.paused=!0,e.moovReady=!1,e.events=["STARTED","PAUSED","ENDED","UPDATED"],e}return l()(n)}(E);var Mt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e){var r;return a()(this,n),r=t.call(this),M()(w()(r),"inputBuffer",(function(e){r.memory.inputBuffer(e)})),M()(w()(r),"release",(function(){r.boxParser.release()})),r.boxParser=new kt,r.boxParser.on("STARTED",(function(e){})),r.boxParser.on("PAUSED",(function(e){})),r.boxParser.on("ENDED",(function(e){var t=(e.type+"_READY").toUpperCase();r.trigger(t,e)})),r.boxParser.on("UPDATED",(function(e){r.boxParser.start()})),r.memory=e,r.memory.on("UPDATED",(function(e){r.boxParser.moovReady||(r.boxParser.setEndPosition(r.memory.endPosition),r.boxParser.updateBuffer(e))})),r.events=["MOOV_READY","FTYP_READY"],r}return l()(n,[{key:"moovReady",get:function(){return this.boxParser.moovReady}}]),n}(E);var Et=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e){var r;return a()(this,n),r=t.call(this),M()(w()(r),"initFromConf",(function(e){r.conf=e;var t=r.conf.getTracks(),n=r.conf.moov.mvhd;r.conf.moov.mvhd.duration=0;for(var i=r.conf.ftyp,s=0;s<t.length;s++){var a=t[s];a.resetForFMP4();var o=O.create("moov",0,0);o.addSubBox("mvhd",n),o.addSubBox("trak",[a]);var l=O.create("mvex",0,0),u=O.create("trex",0,0);u.trackId=a.id,u.defaultSampleDescriptionIndex=1,u.defaultSampleDuration=a.sampleDuration,u.defaultSampleSize=0,u.defaultSampleFlags=65536,l.addSubBox("trex",u),o.addSubBox("mvex",l),r.trigger("META_READY",{trackId:a.idString,buffer:r.createFmp4MoovBuffer(i,o),startSampleIndex:-1,stopSampleIndex:-1,eos:!1})}r.ready=!0})),M()(w()(r),"createFmp4MoovBuffer",(function(e,t){var n=r.memory.createBuffer(r.conf.fileSize),i=new DataView(n),s=0;return s=e.write(i,s),t.write(i,s),fe(i.buffer,e.size+t.size)})),M()(w()(r),"getSample",(function(e,t){var n=e.samples[t];n.data||(n.data=new Uint8Array(n.size));var i=r.memory.findNextBufferEndPos(n.offset)-n.offset;return n.size>i?null:(z(n.data.buffer,0,r.memory.buffer,n.offset-r.memory.startPosition,n.size),r.readLength+=n.size,e.samples[t].read=!0,n)})),M()(w()(r),"createMoof",(function(e){var t=O.create("moof",0,0),n=O.create("mfhd",0,0);t.addSubBox("mfhd",n),n.sequenceNumber=r.nextMoofIndex,r.nextMoofIndex++;var i=O.create("traf",0,0);t.addSubBox("traf",i);var s=O.create("tfhd",0,0);i.addSubBox("tfhd",s),s.trackId=e.trackId,s.flags=131072;var a=O.create("tfdt",0,0);i.addSubBox("tfdt",a),a.baseMediaDecodeTime=e.dts-0;var o=O.create("trun",0,0);return i.addSubBox("trun",o),o.flags=3841,o.dataOffset=0,o.firstSampleFlags=0,o.sampleCount=1,o.sampleDuration=[e.duration],o.sampleSize=[e.size],o.sampleFlags=[e.iFrame?1<<25:65536],o.sampleCompositionTimeOffset=[e.cts-e.dts],t})),M()(w()(r),"createFragment",(function(e,t,n,i){var s=r.getSample(e,t);if(!s)return i;var a=r.createMoof(s);i=a.write(n,i),r.moofSize=a.size,a.adjustDataOffset(n);var o=O.create("mdat",0,0);return o.data=s.data,o.write(n,i)})),M()(w()(r),"createFMP4",(function(e){for(var t=e.idString,n=e.name,i=0,s=r.memory.createBuffer(r.fragmentBufferSize),a=new DataView(s),o=!1,l=e.sampleIndex;e.sampleIndex<e.samples.length;){0==r.moofSize&&(r.moofSize=e.samples[e.sampleIndex].size);var u=i+e.samples[e.sampleIndex].size+r.moofSize+r.mdatHeaderSize;if(u>=r.fragmentBufferSize){0==i&&(r.fragmentBufferSize=u),o=!0;break}var c=r.createFragment(e,e.sampleIndex,a,i);if((e.isVideo?r.videoPaused:r.audioPaused)||c==i){e.isVideo?r.videoPaused=!0:r.audioPaused=!0,r.trigger("PAUSED",{trackId:t,trackName:n,index:e.sampleIndex,timestamp:e.samples[e.sampleIndex].timestamp,offset:e.samples[e.sampleIndex].offset});break}i=c,e.sampleIndex++}if(0!=i&&!r.paused){var h=fe(a.buffer,i);r.trigger("DATA_READY",{trackId:t,startSampleIndex:l,stopSampleIndex:e.sampleIndex,buffer:h,eos:e.sampleIndex==e.samples.length})}o&&r.createFMP4(e)})),M()(w()(r),"createVideoFMP4",(function(){return new Promise((function(e,t){var n=r.conf.getVideoTrack();setTimeout((function(){r.createFMP4(n),e()}))}))})),M()(w()(r),"createAudioFMP4",(function(){return new Promise((function(e,t){var n=r.conf.getAudioTrack();setTimeout((function(){r.createFMP4(n),e()}))}))})),M()(w()(r),"start",(function(){if(r.ready){var e=[];return r.paused=!1,r.videoPaused&&(r.videoPaused=!1,e.push(r.createVideoFMP4())),r.audioPaused&&(r.audioPaused=!1,e.push(r.createAudioFMP4())),Promise.all(e)}})),M()(w()(r),"pause",(function(){r.videoPaused=!0,r.audioPaused=!0,r.paused=!0})),M()(w()(r),"release",(function(){r.ready=!1,r.readLength=0,r.nextMoofIndex=0,r.moofSize=0,r.paused=!0,r.shouldStart=!1,r.videoPaused=!0,r.audioPaused=!0})),r.ready=!1,r.readLength=0,r.nextMoofIndex=0,r.paused=!0,r.shouldStart=!1,r.fragmentBufferSize=1048576,r.memory=e,r.moofSize=0,r.mdatHeaderSize=8,r.videoPaused=!0,r.audioPaused=!0,r.events=["META_READY","DATA_READY","PAUSED"],r}return l()(n)}(E);var Rt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e){var r;return a()(this,n),r=t.call(this),M()(w()(r),"_initMediaSource",(function(){r.mediaSource=new MediaSource,r.el.src=window.URL.createObjectURL(r.mediaSource);var e=function(){window.URL.revokeObjectURL(r.el.src),r.shouldEos=!1,r.ready=!0,r.initSourceBuffer(),r.trigger("OPENED",null)};return r.mediaSource.addEventListener("sourceopen",e),r.mediaSource.addEventListener("sourceended",(function e(){r.ready=!1,r.trigger("ENDED",null),r.mediaSource.removeEventListener("sourceended",e)})),r.mediaSource.addEventListener("sourceclose",(function e(){r.ready=!1,r.trigger("CLOSED",null),r.mediaSource.removeEventListener("sourceclose",e)})),function(){r.el.pause(),r.checkSourceBufferReady()?r.mediaSource.endOfStream():r.shouldEos=!0,r.mediaSource.removeEventListener("sourceopen",e)}})),M()(w()(r),"init",(function(e){e&&(r.conf=e,r.initSourceBuffer())})),M()(w()(r),"initSourceBuffer",(function(){r.conf&&r.ready&&(r.mediaSource.duration=r.conf.duration,r.conf.getTracks().forEach((function(e,t){var n='video/mp4; codecs="'+e.codec+'"',i=e.idString;if(MediaSource.isTypeSupported(n)){var s=r.mediaSource.addSourceBuffer(n);s.addEventListener("abort",(function(e){})),s.addEventListener("update",(function(e){})),s.addEventListener("updatestart",(function(e){})),s.addEventListener("error",(function(e){})),s.addEventListener("updateend",(function(e){r.feedBuffer(i),r.trigger("UPDATED",{trackId:i}),s.bufferCompleteCount++,s.eosBufferIndex>=0&&s.eosBufferIndex==s.bufferCompleteCount&&(s.eos=!0,r.checkEndOfStream(i)),r.shouldEos&&r.checkSourceBufferReady()&&(r.mediaSource.endOfStream(),r.shouldEos=!1)})),s.bufferInputCount=0,s.bufferCompleteCount=0,s.eosBufferIndex=-1,s.eos=!1,r.sourceBuffers[i]=s,r.inputBuffers[i]||(r.inputBuffers[i]=[]),r.feedBuffer(i)}})))})),M()(w()(r),"checkEndOfStream",(function(){var e=!0;for(var t in r.sourceBuffers)e=e&&r.sourceBuffers[t].eos;e&&r.checkSourceBufferReady()&&r.mediaSource.endOfStream()})),M()(w()(r),"feedBuffer",(function(e){if(r.checkSourceBufferReady(e)&&r.hasPendingBuffer(e)){var t=r.inputBuffers[e].shift();r.sourceBuffers[e].appendBuffer(t.buffer),r.sourceBuffers[e].bufferInputCount++,t.eos&&(r.sourceBuffers[e].eosBufferIndex=r.sourceBuffers[e].bufferInputCount)}})),M()(w()(r),"hasPendingBuffer",(function(e){return!!r.inputBuffers[e]&&0!=r.inputBuffers[e].length})),M()(w()(r),"clearPendingBuffers",(function(){for(var e in r.inputBuffers)r.inputBuffers[e]=[]})),M()(w()(r),"checkSourceBufferReady",(function(e){var t=!0;if(e)t=!!r.sourceBuffers[e]&&!r.sourceBuffers[e].updating;else for(var n in r.sourceBuffers)t=t&&!r.sourceBuffers[n].updating;return r.msAvailable&&t})),M()(w()(r),"inputBuffer",(function(e,t){r.inputBuffers[e]||(r.inputBuffers[e]=[]),r.inputBuffers[e].push(t),r.feedBuffer(e)})),M()(w()(r),"start",(function(){return r.el.play()})),M()(w()(r),"stop",(function(){r.el.pause()})),M()(w()(r),"release",(function(){r._releaseMediaSource&&r._releaseMediaSource(),r._releaseMediaSource=r._initMediaSource(),r.conf=null,r.ready=!1,r.sourceBuffers={},r.inputBuffers={},r.bufferInputCount=0,r.bufferCompleteCount=0,r.eosBufferIndex=-1})),r.el=e,r.conf=null,r.ready=!1,r.sourceBuffers={},r.inputBuffers={},r.bufferInputCount=0,r.bufferCompleteCount=0,r.eosBufferIndex=-1,r.shouldEos=!1,r._releaseMediaSource=r._initMediaSource(),r.events=["OPENED","CLOSED","UPDATED"],r}return l()(n,[{key:"msAvailable",get:function(){return this.mediaSource&&"open"===this.mediaSource.readyState}}]),n}(E);var xt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(){var e;return a()(this,n),e=t.call(this),M()(w()(e),"inputFTYP",(function(t){t&&t.box&&(e.ftyp=t.box)})),M()(w()(e),"inputMOOV",(function(t){t&&t.box&&(e.moov=t.box,e.getTracks().forEach((function(e){e.buildSamples()})),e.moov.timescale&&(e.duration=e.moov.duration/e.moov.timescale),e.fileSize&&e.duration&&(e.durationPerUnitSize=e.duration/(e.fileSize-e.metadataSize)),e.trigger("CONF_READY",w()(e)))})),M()(w()(e),"getTracks",(function(){return e.moov.trak})),M()(w()(e),"getTrack",(function(t){var n=e.moov.trak.filter((function(e){return e.name==t}));return n.length?n[0]:null})),M()(w()(e),"getVideoTrack",(function(){return e.getTrack("vide")})),M()(w()(e),"getAudioTrack",(function(){return e.getTrack("soun")})),M()(w()(e),"getISamples",(function(e){return e.samples.filter((function(e){return e.iFrame}))})),M()(w()(e),"getVideoISamples",(function(){var t=e.getVideoTrack();return e.getISamples(t)})),M()(w()(e),"getAudioISamples",(function(){var t=e.getAudioTrack();return e.getISamples(t)})),M()(w()(e),"getGopSize",(function(){var t=e.getGopOffsets();return t.length>=2?t[1]-t[0]:0})),M()(w()(e),"getGopOffsets",(function(){e.iVideoSamples.length||(e.iVideoSamples=e.getVideoISamples());for(var t=e.getAudioISamples(),n=e.iVideoSamples.map((function(e){return e.offset})),r=-1,i=[],s=1;s<e.iVideoSamples.length;s++){for(var a=e.iVideoSamples[s-1],o=e.iVideoSamples[s],l=a.dts/a.timescale,u=(o.dts+o.duration)/o.timescale,c=r,h=-1,d=r+1;d<t.length;d++){var f=t[d];c<0&&(f.dts/f.timescale<=l&&(c=d),c>=0&&i.push(t[c].offset)),(f.dts+f.duration)/f.timescale<=u&&(h=d)}h>=0&&(i.push(t[h].offset),r=h)}return n.map((function(e,t){return 0==t?Math.min(e,i[t]):Math.max(e,i[t])}))})),M()(w()(e),"getDataOffsetWithTime",(function(t){for(var n=e.getTracks(),r=1/0,i=0;i<n.length;i++){var s=n[i];if(!(t>s.calculatedDuration)){var a=s.getSampleOffsetWithTime(t);a<r&&(r=a)}}return r})),M()(w()(e),"release",(function(){e.ftyp=null,e.moov=null,e.fileSize=0,e.iVideoSamples=[]})),e.ftyp=null,e.moov=null,e.fileSize=0,e.duration=0,e.durationPerUnitSize=0,e.iVideoSamples=[],e.events=["CONF_READY"],e}return l()(n,[{key:"metadataSize",get:function(){return this.moov?this.moov.size:0}}]),n}(E);var Dt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(){var e;return a()(this,n),e=t.call(this),M()(w()(e),"inputBuffer",(function(t){e.buffer?e.buffer=function(e,t,n){if(e+t.byteLength<n.byteLength){var r=new ArrayBuffer(n.byteLength),i=new Uint8Array(r);return i.set(new Uint8Array(n),0),i.set(new Uint8Array(t),e),r}var s=new ArrayBuffer(e+t.byteLength),a=new Uint8Array(s);return a.set(new Uint8Array(n),0),a.set(new Uint8Array(t),e),s}(t.chunkOffset,t.data,e.buffer):(e.buffer=t.data,e.offset=t.chunkOffset),e.chunkInfo.push({offset:t.chunkOffset,size:t.chunkSize}),e.chunkInfo=function(e,t,n){if(0===e.length)return[];e.sort((function(e,n){return e[t]-n[t]}));for(var r=[e[0]],i=1;i<e.length;i++){var s=e[i],a=r[r.length-1];s[t]>a[t]+a[n]?r.push(s):s[t]+s[n]>a[t]+a[n]&&(a[n]+=s[t]+s[n]-(a[t]+a[n]))}return r}(e.chunkInfo,"offset","size"),e.trigger("UPDATED",e.buffer)})),M()(w()(e),"createBuffer",(function(e){return e=e||S.defaultBufferSize,new ArrayBuffer(e)})),M()(w()(e),"findNextBufferEndPos",(function(t){for(var n=0;n<e.chunkInfo.length;n++){var r=e.chunkInfo[n];if(r.offset<=t&&r.offset+r.size>=t)return r.offset+r.size}return t})),M()(w()(e),"release",(function(){e.buffer=null,e.chunkInfo=[],e.offset=0})),e.buffer=null,e.offset=0,e.chunkInfo=[],e.events=["UPDATED"],e}return l()(n,[{key:"startPosition",get:function(){return this.buffer?this.offset:0}},{key:"endPosition",get:function(){return this.buffer?this.offset+this.buffer.byteLength:0}}]),n}(E);var It,Ct=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e){var r;return a()(this,n),r=t.call(this),M()(w()(r),"_stopBufferChecking",(function(){r.timeoutId&&(window.clearTimeout(r.timeoutId),r.timeoutId=null)})),M()(w()(r),"_startBufferChecking",(function(){r._eof||r.paused?r._stopBufferChecking():(r.isEnough?r.trigger("BUFFER_ENOUGH",null):r.trigger("BUFFER_UNENOUGH",null),r.timeoutId=window.setTimeout((function(){r._startBufferChecking()}),r._checkingInterval))})),r.el=e,r.timeoutId=null,r.paused=!0,r._eof=!1,r.rebufferCount=0,r._initEnoughTime=b.bufferEnoughTime,r._enoughTime=b.bufferEnoughTime,r._maxTime=b.bufferMaxTime,r._checkingInterval=b.bufferCheckingInterval,r.events=["BUFFER_ENOUGH","BUFFER_UNENOUGH"],r}return l()(n,[{key:"start",value:function(){this.paused=!1,this._startBufferChecking()}},{key:"stop",value:function(){this.paused=!0}},{key:"release",value:function(){this.stop(),this._stopBufferChecking(),this._eof=!1,this._enoughTime=this._initEnoughTime,this.rebufferCount=0}},{key:"countRebuffer",value:function(){this.rebufferCount++,this._enoughTime<this._maxTime&&(this._enoughTime+=.5)}},{key:"checkAvailable",value:function(e){for(var t=this.isEnough,n=0;n<this.el.buffered.length;n++){var r=this.el.buffered.start(n),i=this.el.buffered.end(n);if(e>=r&&e<=i)return{requestTime:t?e:i,isEnough:t}}return{requestTime:e,isEnough:!1}}},{key:"enoughTime",set:function(e){e&&(this._initEnoughTime=e,this._enoughTime=e)}},{key:"maxTime",set:function(e){e&&(this._maxTime=e)}},{key:"checkingInterval",set:function(e){e&&(this._checkingInterval=e)}},{key:"eof",set:function(e){this._eof=e,e&&this._stopBufferChecking()}},{key:"ranges",get:function(){for(var e=[],t=0;t<this.el.buffered.length;t++){var n=this.el.buffered.start(t),r=this.el.buffered.end(t);e.push([n,r])}return e}},{key:"pendingBufferDuration",get:function(){for(var e=-1,t=0;t<this.el.buffered.length;t++){var n=this.el.buffered.start(t),r=this.el.buffered.end(t);if(this.el.currentTime>=n&&this.el.currentTime<r){e=r;break}}return e<0?0:e-this.el.currentTime}},{key:"isEnough",get:function(){return!!this._eof||this.pendingBufferDuration>=this._enoughTime}}]),n}(E),Lt=["loadstart","downloaderError","downloaderChunkReady","memoryCompleted"],Ot=new Uint8Array(16);function At(){if(!It&&!(It="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return It(Ot)}for(var Gt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Bt=[],Nt=0;Nt<256;++Nt)Bt.push((Nt+256).toString(16).substr(1));var $t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Bt[e[t+0]]+Bt[e[t+1]]+Bt[e[t+2]]+Bt[e[t+3]]+"-"+Bt[e[t+4]]+Bt[e[t+5]]+"-"+Bt[e[t+6]]+Bt[e[t+7]]+"-"+Bt[e[t+8]]+Bt[e[t+9]]+"-"+Bt[e[t+10]]+Bt[e[t+11]]+Bt[e[t+12]]+Bt[e[t+13]]+Bt[e[t+14]]+Bt[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&Gt.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n},Ut=function(e,t,n){var r=(e=e||{}).random||(e.rng||At)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return $t(r)};var Ft=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(){var e,r,i,s,o,l;return a()(this,n),(l=t.call(this)).indexedDB="undefined"==typeof window?null:(null===(e=window)||void 0===e?void 0:e.indexedDB)||(null===(r=window)||void 0===r?void 0:r.webkitIndexedDB)||(null===(i=window)||void 0===i?void 0:i.mozIndexedDB)||(null===(s=window)||void 0===s?void 0:s.OIndexedDB)||(null===(o=window)||void 0===o?void 0:o.msIndexedDB),l.request=null,l.db=null,l.store=null,l}return l()(n,[{key:"init",value:function(){var e=this;return this.indexedDB?new Promise((function(t,n){var r=e.indexedDB.open(e.dbName,e.dbVersion);r.onsuccess=function(n){e.db=n.target.result,t()},r.onerror=function(e){n()},r.onupgradeneeded=function(t){e.store=t.currentTarget.result.createObjectStore(e.dbStoreName)}})):null}},{key:"setData",value:function(e,t){var n=this;return new Promise((function(r,i){n.db||i();var s=n.db.transaction(n.dbStoreName,"readwrite").objectStore(n.dbStoreName).put(t,e);s.onsuccess=function(){r()},s.onerror=function(){i()}}))}},{key:"getData",value:function(e){var t=this;return new Promise((function(n,r){t.db||r();var i=t.db.transaction(t.dbStoreName,"readonly").objectStore(t.dbStoreName).get(e);i.onsuccess=function(e){var t=e.target.result;n(t)},i.onerror=function(){r()}}))}},{key:"hasData",value:function(e){var t=this;return new Promise((function(n,r){t.db||r();var i=t.db.transaction(t.dbStoreName,"readonly").objectStore(t.dbStoreName).getKey(e);i.onsuccess=function(e){var t=e.target.result;n(t)},i.onerror=function(){r()}}))}},{key:"clearData",value:function(){var e=this;return new Promise((function(t,n){e.db||n();var r=e.db.transaction(e.dbStoreName,"readwrite").objectStore(e.dbStoreName).clear();r.onsuccess=function(e){t()},r.onerror=function(){n()}}))}}]),n}(function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(){var e;return a()(this,n),(e=t.call(this)).dbName="tiktok",e.dbVersion=1,e.dbStoreName="playback",e}return l()(n,[{key:"init",value:function(){}},{key:"setData",value:function(e,t){}},{key:"getData",value:function(e){}},{key:"clearData",value:function(){}}]),n}(E));var Ht=new(function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(){var e;return a()(this,n),(e=t.call(this)).impl=new Ft,e.readyPromise=e.impl.init(),e}return l()(n,[{key:"save",value:function(e,t){var n=this;if(this.readyPromise)return this.readyPromise.then((function(){return n.impl.setData(e,t)}))}},{key:"export",value:function(e){var t=this;if(this.readyPromise)return this.readyPromise.then((function(){return t.impl.getData(e)}))}},{key:"check",value:function(e){var t=this;if(this.readyPromise)return this.readyPromise.then((function(){return t.impl.hasData(e)}))}},{key:"clear",value:function(){var e=this;if(this.readyPromise)return this.readyPromise.then((function(){return e.impl.clearData()}))}}]),n}(E));var Vt=function(e){d()(u,e);var t,n,r,s,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(u);function u(e){var t;return a()(this,u),(t=o.call(this,"Stream",e,Lt)).id=Ut(),t._initMemory(),t._initEvents(),t._initConf(),t._initDownloader(),t._initDemuxer(),t._initRemuxer(),t._initBuffer(),t._initMSE(),t}return l()(u,[{key:"_initMemory",value:function(){var e=this;this.memory=new Dt,this.memory.on("UPDATED",function(){var t=i()(y.a.mark((function t(n){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.downloader.eof&&e.eventManager.trigger("MEMORY_COMPLETED",n);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"_initEvents",value:function(){var e=this;c()(m()(u.prototype),"_initEvents",this).call(this),this.eventManager.proxy("canplay",(function(e){})),this.eventManager.proxy("waiting",(function(t){e.buffer.countRebuffer(),e.downloader.loading||e.downloader.eof||e.downloader.resume()})),this.eventManager.proxy("play",(function(t){e.buffer.start()})),this.eventManager.proxy("pause",(function(t){e.buffer.stop()})),this.eventManager.proxy("seeking",(function(e){}))}},{key:"_initMSE",value:function(){var e=this;this.mse=new Rt(this.el),this.mse.on("OPENED",(function(){})),this.mse.on("CLOSED",(function(){})),this.mse.on("UPDATED",(function(t){e.buffer.isEnough&&e.downloader.pause()}))}},{key:"_initConf",value:function(){var e=this;this.conf=new xt,this.conf.on("CONF_READY",(function(t){e.mse.init(t),e.remuxer.initFromConf(t)}))}},{key:"_initBuffer",value:function(){var e=this;this.buffer=new Ct(this.el),this.config.bufferEnoughTime&&(this.bufferEnoughTime=this.config.bufferEnoughTime),this.config.bufferMaxTime&&(this.buffer.maxTime=this.config.bufferMaxTime),this.config.bufferCheckingInterval&&(this.buffer.checkingInterval=this.config.bufferCheckingInterval),this.buffer.on("BUFFER_UNENOUGH",(function(){e.el.playbackRate=.9,e.downloader.resume()})),this.buffer.on("BUFFER_ENOUGH",(function(){e.el.playbackRate=1,e.downloader.pause()}))}},{key:"_initDemuxer",value:function(){var e=this;this.demuxer=new Mt(this.memory),this.demuxer.on("FTYP_READY",(function(t){e.conf.inputFTYP(t)})),this.demuxer.on("MOOV_READY",(function(t){e.conf.inputMOOV(t),e.downloader.switchToCommonSize()}))}},{key:"_initRemuxer",value:function(){var e=this;this.remuxer=new Et(this.memory),this.remuxer.on("META_READY",(function(t){e.mse.inputBuffer(t.trackId,t),e.remuxer.start()})),this.remuxer.on("DATA_READY",(function(t){e.mse.inputBuffer(t.trackId,t)})),this.remuxer.on("PAUSED",(function(e){}))}},{key:"_initDownloader",value:function(){var e=this;this.downloader=new L({withCredentials:this.config.withCredentials}),this.metaChunkSize=Math.ceil(this.config.metaChunkSize||b.metaChunkSize),this.dataChunkSize=Math.ceil(this.config.dataChunkSize||b.dataChunkSize),this.downloader.on("FILE_SIZE",(function(t){e.conf.fileSize=t})),this.downloader.on("CHUNK_READY",(function(t){e.demuxer.inputBuffer(t),e.remuxer.start(),e.eventManager.trigger("downloaderChunkReady",{chunkSize:t.chunkSize,networkDuration:t.networkDuration,speed:t.networkDuration?8*t.chunkSize/1024/t.networkDuration:0})})),this.downloader.on("EOF",(function(){e.buffer.eof=!0})),this.downloader.on("ERROR",(function(t){e.eventManager.trigger("downloaderError",t)}))}},{key:"loadFromLocal",value:(s=i()(y.a.mark((function e(t){var n,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ht.check(t);case 2:if(!(n=e.sent)){e.next=8;break}return e.next=6,Ht.export(t);case 6:r=e.sent,this.loadFromBuffer(r);case 8:return e.abrupt("return",!!n);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"loadFromBuffer",value:function(e){this.release(),this.demuxer.inputBuffer({chunkOffset:0,data:e}),this.remuxer.start(),this.eventManager.trigger("loadstart",{target:this.el,type:"loadstart"})}},{key:"saveToLocal",value:(r=i()(y.a.mark((function e(t,n){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ht.save(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"exportFromLocal",value:(n=i()(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ht.export(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"load",value:(t=i()(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.downloader){e.next=2;break}return e.abrupt("return");case 2:if(this.downloader.url!=t){e.next=4;break}return e.abrupt("return");case 4:this.release(),this.downloader.url=t,this.eventManager.trigger("loadstart",{target:this.el,type:"loadstart"}),this.downloader.start();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"pause",value:function(){this.mse.stop()}},{key:"seek",value:function(e){if(this.demuxer.moovReady){this.element.currentTime=e,this.remuxer.pause();var t=this.buffer.checkAvailable(e);if(!t.isEnough){e=t.requestTime,this.pause(),this.downloader.pause(),this.mse.clearPendingBuffers();var n=this.conf.getDataOffsetWithTime(e);n=this.memory.findNextBufferEndPos(n),this.downloader.resume(n)}}}},{key:"release",value:function(){c()(m()(u.prototype),"release",this).call(this),this.downloader.release(),this.demuxer.release(),this.remuxer.release(),this.mse.release(),this.conf.release(),this.memory.release(),this.buffer.release()}},{key:"metaChunkSize",set:function(e){this.downloader.initChunkSize=e}},{key:"dataChunkSize",set:function(e){this.downloader.commonChunkSize=e}},{key:"bufferEnoughTime",set:function(e){this.buffer.enoughTime=e}},{key:"element",get:function(){return this.el}},{key:"data",get:function(){return this.memory.buffer}}]),u}(C);Vt.storage=Ht;var jt=Vt,zt=[];var Xt=function(e){d()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}(n);function n(e){var r;return a()(this,n),(r=t.call(this,"Basic",e,zt))._initEvents(),r}return l()(n,[{key:"_initEvents",value:function(){c()(m()(n.prototype),"_initEvents",this).call(this)}}]),n}(C)}])},53385:(e,t,n)=>{"use strict";n.d(t,{A:()=>M});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},s(e,t)},a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a.apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))}function l(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}var u=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.code=t,i.message=n,i.originError=r,i.name="StarlingError",i.code=t,i.message=n,i.originError=r,Error.captureStackTrace&&Error.captureStackTrace(i,i.constructor),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error),c={ERROR_CODE:103,ERROR_MESSAGE:"Request failed, confirm your apiKey and namespace is correct"},h={ERROR_CODE:110,ERROR_MESSAGE:"Check your params, parameter apiKey, namespace and zoneHost is required!"},d={ERROR_CODE:111,ERROR_MESSAGE:"Check your params, parameter request and store is required!"},f=112,p={ERROR_CODE:120,ERROR_MESSAGE:"Version is not found, please check your param [version]!"},g={zone:"CN",locale:"zh",timeout:15e3,test:!1,mode:"normal",format:"merged",lazyUpdate:!1,fallbackLang:["zh"],tracker:function(){},cache:!0},m=function(){function e(e){this.options=e,this.options=e}return e.prototype.getText=function(e,t){return o(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,this._request(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.getTexts=function(e){var t=this;return Promise.all(e.map((function(e){var n=e[0],r=e[1];return t.getText(n,r)})))},e.prototype._request=function(e,t){return o(this,void 0,void 0,(function(){var n,r,i,s,a,o,h,d,f,g,m,v,y,_;return l(this,(function(l){switch(l.label){case 0:return n=this.options.getReleaseVersion,r=n(e),e&&r&&t?[2,{}]:(i=this.getUrl(e,t),s=this.options,a=s.request,o=s.timeout,[4,a(i,{timeout:o})]);case 1:if(h=l.sent(),d=h.data,f=d.status,g=d.message,200==+f)return[2,this._mapResponse(g)];if(1001==+f)throw v=(m=p).ERROR_CODE,new u(v,m.ERROR_MESSAGE);throw _=(y=c).ERROR_CODE,new u(_,y.ERROR_MESSAGE)}}))}))},e.prototype.getUrl=function(e,t){var n=this.options,r=n.apiKey,i=n.locale,s=n.fallbackLang,a=n.zoneHost,o=n.mode,l=n.getReleaseVersion,u=[i].concat(s),c=a+"/check_and_get_text/"+r+"/"+o+"/"+e+"?lang="+u,h=l(e);return h&&(c=a+"/text_by_release_version/"+r+"/"+o+"/"+e+"/"+h+"?lang="+u),"string"==typeof t&&(c+="&version="+t),c},e.prototype._mapResponse=function(e){return e?Object.keys(e).reduce((function(t,n){return t[n.toLowerCase()]=e[n],t}),{}):{}},e}(),v=function(){function e(e){this.options=e,this.options=e}return e.prototype._setCache=function(e,t,n){try{return this.options.store.set(e,t)}catch(e){var r=f;return this.options.tracker("cache_error",{code:r,message:e.message,stack:e.stack}),void(n&&n())}},e.prototype._getCache=function(e){var t=this.options,n=t.store,r=t.cache;try{return r&&n.get(e)}catch(e){var i=f;return void this.options.tracker("cache_error",{code:i,message:e.message,stack:e.stack})}},e.prototype.getVersion=function(e){var t=this.options,n="version."+t.apiKey+"."+e+"."+t.locale,r=(0,t.getReleaseVersion)(e);r&&(n+="."+r);var i=this.getText(e);return i&&"object"==typeof i?"object"==typeof i&&i.then?this._getCache(n):"object"==typeof i&&0===Object.keys(i||{}).length?null:this._getCache(n):null},e.prototype.getVersions=function(e){var t=this;return Promise.all(e.map((function(e){return t.getVersion(e)})))},e.prototype.getText=function(e){var t=this.options,n="text."+t.apiKey+"."+e+"."+t.locale,r=(0,t.getReleaseVersion)(e);return r&&(n+="."+r),this._getCache(n)},e.prototype.getTexts=function(e){var t=this;return Promise.all(e.map((function(e){return t.getText(e)})))},e.prototype.refresh=function(e,t,n,r){return o(this,void 0,void 0,(function(){var i,s,a,o,u,c=this;return l(this,(function(l){switch(l.label){case 0:return i=this.options,s=i.apiKey,a=i.getReleaseVersion,o=i.cache,u=[],t.forEach((function(i,l){var h="text."+s+"."+e[l]+"."+r[l],d="version."+s+"."+e[l]+"."+r[l],f=a(e[l]);f&&(h+="."+f,d+="."+f),o&&(u.push(c._setCache(h,t[l],(function(){c.options.store.set(h,{})}))),u.push(c._setCache(d,n[l])))})),[4,Promise.all(u)];case 1:return l.sent(),[2,t.reduce((function(e,t){return Object.assign(e,t)}),{})]}}))}))},e}(),y=function(){function e(e){void 0===e&&(e=[]),this._list=[],this._list=e}return Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),e.prototype.getList=function(){return this._list},e.prototype.getNamespaces=function(){return this._list.map((function(e){return e.namespace}))},e.prototype.addNamespace=function(e){this._list.push(e)},e.prototype.insertTexts=function(e){this._list.forEach((function(t,n){t.texts=e[n]}))},e.prototype.sortByPrior=function(){return this._list.sort((function(e,t){return e.prior-t.prior})),this._list},e.prototype.concat=function(t){return new e(this._list.concat(t.getList()))},e}(),_=function(){function e(e,t,n){this._promiseRefresh=Promise.resolve(null),this.remote=e,this.local=t,this.options=n}return e.prototype._checkVersions=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i,s,a;return l(this,(function(o){switch(o.label){case 0:return t=this.options.locale,[4,this.local.getVersions(e)];case 1:return n=o.sent(),r=e.map((function(e,t){return[e,n[t]]})),[4,this.remote.getTexts(r)];case 2:return i=o.sent(),s=new y,a=new y,e.forEach((function(e,r){var o=i[r],l=o.updated,u=o.version,c=o.data,h=o.lang;l?a.addNamespace({namespace:e,prior:r,version:u,texts:c,lang:h}):s.addNamespace({namespace:e,prior:r,version:n[r],lang:t})})),[2,{equalNs:s,diffNs:a}]}}))}))},e.prototype.waitForRefresh=function(){return this._promiseRefresh},e.prototype._refresh=function(e){var t=e.getList(),n=[],r=[],i=[],s=[];return t.forEach((function(e){n.push(e.namespace),r.push(e.version),i.push(e.texts),s.push(e.lang)})),this.local.refresh(n,i,r,s)},e.prototype._getLocalTexts=function(e){return o(this,void 0,void 0,(function(){var t;return l(this,(function(n){switch(n.label){case 0:return[4,this.local.getTexts(e.getNamespaces())];case 1:return t=n.sent(),e.insertTexts(t),[2,t]}}))}))},e.prototype.load=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i,s;return l(this,(function(a){switch(a.label){case 0:return t=this.options.format,[4,this._checkVersions(e)];case 1:return n=a.sent(),r=n.equalNs,i=n.diffNs,r.length?[4,this._getLocalTexts(r)]:[3,3];case 2:return a.sent(),[3,4];case 3:a.label=4;case 4:return s=this._formatTexts(t,i.concat(r)),i.length?[4,this._refresh(i)]:[3,6];case 5:a.sent(),a.label=6;case 6:return[2,{texts:s,diffNs:i.getNamespaces(),equalNs:r.getNamespaces()}]}}))}))},e.prototype._getCacheText=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i,s,a,o;return l(this,(function(l){switch(l.label){case 0:return t=this.options,n=t.locale,r=t.format,[4,this.local.getTexts(e)];case 1:return i=l.sent(),[4,this.local.getVersions(e)];case 2:return s=l.sent(),a=i.map((function(t,r){if(t)return{namespace:e[r],version:s[r],lang:n,texts:t}})).filter((function(e){return!!e})),o=new y(a),[2,{texts:this._formatTexts(r,o),cacheAllLoaded:a.length===i.length}]}}))}))},e.prototype.lazyLoad=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i,s;return l(this,(function(a){switch(a.label){case 0:return[4,this._getCacheText(e)];case 1:return t=a.sent(),n=t.texts,r=t.cacheAllLoaded,i=0===Object.keys(n).length||!r,this._promiseRefresh=this.load(e),i?[4,this._promiseRefresh]:[3,3];case 2:s=a.sent(),n=s.texts,a.label=3;case 3:return[2,{texts:n,diffNs:i?s&&s.diffNs:[],equalNs:i?s&&s.equalNs:e}]}}))}))},e.prototype._formatTexts=function(e,t){return"splitted"===e?t.getList().reduce((function(e,t){var n=t.namespace,r=t.lang,i=t.texts,s=t.version;return e[n]={lang:r,texts:i,version:s},e}),{}):t.sortByPrior().map((function(e){return e.texts})).reduce((function(e,t){return Object.assign(e,t)}),{})},e}();"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},writable:!0,configurable:!0});var T,b="client_load";!function(e){e.AfterLoad="afterLoad"}(T||(T={}));var S=function(){function e(e){this.afterLoadPlugins=[],this.setConfig(e)}return e.prototype._init=function(e){var t=this;this.options=function(e){var t=(e=Object.assign({},g,e)).namespace,n=e.apiKey,r=e.request,i=e.store,s=e.zoneHost;if(e.test&&(e.mode="test"),e.namespace=t=t?Array.isArray(t)?t:[t]:[],e.apiKey=n=n||e.api_key,!r||!i){var a=d.ERROR_CODE,o=d.ERROR_MESSAGE;throw new u(a,o,null)}if(!n||!t.length||!s){throw new u(a=h.ERROR_CODE,o=h.ERROR_MESSAGE,null)}return e}(e);var n=this.options,r=n.apiKey,i=n.locale,s=n.zoneHost,o=n.request,l=n.timeout,c=n.fallbackLang,f=n.store,p=n.lazyUpdate,y=n.test,T=n.mode,b=n.format,S=n.cache,P={mode:p?"lazy":y?"test":"prod",zone:s,locale:i,apiKey:r};this._tracker=function(e,n){try{t.options.tracker(e,a(a({},P),n))}catch(e){console.log(e)}};var w=this._getReleaseVersionByNamespace.bind(this),k=new m({request:o,timeout:l,apiKey:r,locale:i,zoneHost:s,fallbackLang:c,mode:T,getReleaseVersion:w}),M=new v({apiKey:r,locale:i,store:f,tracker:this._tracker,getReleaseVersion:w,cache:S});this._textManager=new _(k,M,{locale:i,format:b}),this.initPlugin()},e.prototype.initPlugin=function(){var e=this,t=this.options.plugins||[];Array.isArray(t)&&t.every((function(e){return"object"==typeof e}))&&t.forEach((function(t){t.type===T.AfterLoad&&e.afterLoadPlugins.push(t)}))},e.prototype._getReleaseVersionByNamespace=function(e){var t=this.options.namespace,n=this.options.version,r=null;return Array.isArray(n)?r=n[t.findIndex((function(t){return t===e}))]:n&&"object"==typeof n?r=n[e]:"string"==typeof n&&(r=n),r},e.prototype.setConfig=function(e){var t=Object.assign({},this.options,e);this._init(t)},e.prototype.waitForRefresh=function(){return o(this,void 0,void 0,(function(){var e;return l(this,(function(t){switch(t.label){case 0:return[4,this._textManager.waitForRefresh()];case 1:return[2,(e=t.sent())?e.texts:null]}}))}))},e.prototype._load=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,i;return l(this,(function(s){switch(s.label){case 0:return e=this.options,t=e.namespace,n=e.lazyUpdate,r=t,n?[4,this._textManager.lazyLoad(r)]:[3,2];case 1:return i=s.sent(),[3,4];case 2:return[4,this._textManager.load(r)];case 3:i=s.sent(),s.label=4;case 4:return[2,i]}}))}))},e.prototype.load=function(e,t){return o(this,void 0,void 0,(function(){var n,r,i,s,a,o,u,c,h,d,f,p,g,m,v=this;return l(this,(function(l){switch(l.label){case 0:n=Date.now(),r=this.options.namespace,l.label=1;case 1:return l.trys.push([1,5,,10]),this._tracker(b,{state:"start",version:"0.5.13"}),[4,this._load()];case 2:return i=l.sent(),s=i.diffNs,a=i.equalNs,o=i.texts,u=this.afterLoadPlugins,Array.isArray(u)&&u.length?[4,u.reduce((function(e,t){return e.then((function(e){return"function"==typeof t.process?t.process(e||o,v.options):e}))}),Promise.resolve(o))]:[3,4];case 3:c=l.sent(),o=c||o,l.label=4;case 4:return e&&e(o),this._tracker("client_load_time",{time:Date.now()-n}),this._tracker(b,{state:"success",version:"0.5.13"}),h=s.length,d=a.length,f=r.length,p=(d/f).toFixed(2),this._tracker("client_cache",{diffLen:h,diff:s.join(","),equalLen:d,equal:a.join(","),namespaces:a.join(","),namespacesLen:f,ratio:p}),[2,o];case 5:if(g=l.sent(),this._tracker(b,{state:"fail"}),this._tracker("client_exception",{code:g.code,message:g.message,stack:g.stack}),!(g||{}).useWebCache)return[3,9];l.label=6;case 6:return l.trys.push([6,8,,9]),[4,this._textManager._getCacheText(r)];case 7:return m=l.sent().texts,g.response.data=m&&"object"==typeof m?m:{},[3,9];case 8:return l.sent(),[3,9];case 9:return t?(t(g),[3,10]):[2,Promise.reject(g)];case 10:return[2]}}))}))},e}(),P=new(function(){function e(){}return e.prototype.get=function(e){if(localStorage&&localStorage.getItem)return function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e||void 0}}(localStorage.getItem(e))},e.prototype.set=function(e,t){localStorage&&localStorage.setItem&&localStorage.setItem(e,function(e){return JSON.stringify(e)}(t))},e}()),w=function(e){function t(t,n,r,i,s,a){var o=e.call(this,t)||this;return o.url=n,o.code=r,o.request=i,o.response=s,o.useWebCache=a,o.url=n,o.code=r,o.request=i,o.response=s,o.useWebCache=!!a,o}return i(t,e),t}(Error);function k(e,t){var n=t.timeout;return new Promise((function(t,r){var i=new XMLHttpRequest;i.open("GET",e),i.overrideMimeType("application/json; charset=utf-8"),i.withCredentials=!1,i.onreadystatechange=function(){if(i&&4===i.readyState&&(0!==i.status||i.responseURL&&0===i.responseURL.indexOf("file:"))){var n,s=function(e){try{return JSON.parse(e)}catch(e){return{}}}(i.responseText),a=(n=s).message&&"object"==typeof n.message?n:null;if(i.status<200||i.status>=300||!a)return function(e,t,n,r){var i=(r||{}).message||"";i=i?", reason is: ".concat(i):"",t(new w("Request failed with status code "+e.status+i,n,null,e,{data:{}},!0))}(i,r,e,s),void(i=null);var o={data:a,status:i.status,statusText:i.statusText,request:i};t(o),i=null}},i.onerror=function(){r(new w("Network Error",e,null,i,{data:{}},!0)),i=null},i.timeout=n,i.ontimeout=function(){r(new w("timeout of "+n+"ms exceeded",e,"ECONNABORTED",i,{data:{}},!0)),i=null},i.send()}))}var M=function(e){function t(t){return t.store||(t.store=P),t.request||(t.request=k),e.call(this,t)||this}return i(t,e),t}(S)},17283:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=class{constructor(e){this.type="afterLoad",this.condition={},this.tccUrl=e.tccUrl,this.condition=e.condition,this.tccKey=e.tccKey||"text_custom_config",this.expiredTime=e.expiredTime||1e4}createRequest(e,t){const{timeout:n}=t,r=this.tccKey;return new Promise((function(t,i){e||i("[@ies/starling_client_text_replace_plugin]: tccUrl is required");const s=new XMLHttpRequest;s.open("GET",e),s.withCredentials=!1,s.onreadystatechange=function(){if(!s||4!==s.readyState)return;let e=[];try{const t=JSON.parse(s.responseText);e=JSON.parse(t.data[r])}catch(e){i(e)}s.status<200||s.status>=300?i("server error"):t({data:e})},s.onerror=function(e){i(e)},s.timeout=n,s.ontimeout=function(e){i(e)},s.send()}))}async getWithCache(e){const t=`starling_tcc_${e}`,n=(e=>{try{return JSON.parse(localStorage.getItem(e)||"")}catch(e){return{}}})(t);try{if(n&&n.data&&n.expiredTime&&Date.now()-+n.expiredTime<this.expiredTime)return n.data;const e=await this.createRequest(this.tccUrl,{timeout:1e4});return((e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.log(e)}})(t,{data:e.data,expiredTime:Date.now()}),e.data}catch(e){return n&&n.data?n.data:(console.error(e),[])}}validate(e){return Array.isArray(e)?!(!this.condition||"object"!=typeof this.condition||!Object.keys(this.condition).length)||(console.warn("condition should be an object"),!1):(console.warn("tcc error: tcc config should be an array"),!1)}createRule(e){return e.reduce(((e,t)=>{if(!Array.isArray(t.condition))return e;const n=t.condition.reduce(((e,t)=>e||this.condition[t.type]==t.value),!1),r=Object.assign({},e.replace,t.rule.replace||{}),i=e.whitelist.concat(t.rule.whitelist||[]);return n?{replace:r,whitelist:i}:e}),{replace:{},whitelist:[]})}replaceByRule(e,t){let n="";if(Object.keys(e).forEach((e=>{RegExp(e,"i").test(t)&&(n=e.length>n.length?e:n)})),n){const r=RegExp(n,"ig");t=t.replace(r,e[n])}return t}async process(e,t){const n=await this.getWithCache(t.apiKey||"");if(!this.validate(n))return e;const{replace:r,whitelist:i}=this.createRule(n);return Object.keys(e).reduce(((t,n)=>{let s=e[n];return i.includes(n)||(s=this.replaceByRule(r,s)),t[n]=s,t}),{})}processSync(e,t,n){if(!this.validate(t))return e;const{replace:r,whitelist:i}=this.createRule(t);return i.includes(n)||(e=this.replaceByRule(r,e)),e}}},77966:(e,t,n)=>{"use strict";n.d(t,{F2:()=>xe,OV:()=>Re,Ay:()=>De});var r=n(30878),i=n(451),s=n(22523),a=n(2303),o=n(17480),l=n(69236),u=n(76439),c=n(28803),h={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},d=new(function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.A)(this,e),this.init(t,n)}return(0,a.A)(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||h,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,n,r){return r&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,(0,i.A)({},{prefix:"".concat(this.prefix,":").concat(t,":")},this.options))}}]),e}()),f=function(){function e(){(0,s.A)(this,e),this.observers={}}return(0,a.A)(e,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach((function(e){n.observers[e]=n.observers[e]||[],n.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.observers[e]&&[].concat(this.observers[e]).forEach((function(e){e.apply(void 0,n)})),this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(t){t.apply(t,[e].concat(n))}))}}]),e}();function p(){var e,t,n=new Promise((function(n,r){e=n,t=r}));return n.resolve=e,n.reject=t,n}function g(e){return null==e?"":""+e}function m(e,t,n){function r(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function i(){return!e||"string"==typeof e}for(var s="string"!=typeof t?[].concat(t):t.split(".");s.length>1;){if(i())return{};var a=r(s.shift());!e[a]&&n&&(e[a]=new n),e=Object.prototype.hasOwnProperty.call(e,a)?e[a]:{}}return i()?{}:{obj:e,k:r(s.shift())}}function v(e,t,n){var r=m(e,t,Object);r.obj[r.k]=n}function y(e,t){var n=m(e,t),r=n.obj,i=n.k;if(r)return r[i]}function _(e,t,n){var r=y(e,n);return void 0!==r?r:y(t,n)}function T(e,t,n){for(var r in t)"__proto__"!==r&&"constructor"!==r&&(r in e?"string"==typeof e[r]||e[r]instanceof String||"string"==typeof t[r]||t[r]instanceof String?n&&(e[r]=t[r]):T(e[r],t[r],n):e[r]=t[r]);return e}function b(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function P(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return S[e]})):e}var w="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,k=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return(0,s.A)(this,t),n=(0,o.A)(this,(0,l.A)(t).call(this)),w&&f.call((0,u.A)(n)),n.data=e||{},n.options=r,void 0===n.options.keySeparator&&(n.options.keySeparator="."),n}return(0,c.A)(t,e),(0,a.A)(t,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,s=[e,t];return n&&"string"!=typeof n&&(s=s.concat(n)),n&&"string"==typeof n&&(s=s.concat(i?n.split(i):n)),e.indexOf(".")>-1&&(s=e.split(".")),y(this.data,s)}},{key:"addResource",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},s=this.options.keySeparator;void 0===s&&(s=".");var a=[e,t];n&&(a=a.concat(s?n.split(s):n)),e.indexOf(".")>-1&&(r=t,t=(a=e.split("."))[1]),this.addNamespaces(t),v(this.data,a,r),i.silent||this.emit("added",e,t,n,r)}},{key:"addResources",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var i in n)"string"!=typeof n[i]&&"[object Array]"!==Object.prototype.toString.apply(n[i])||this.addResource(e,t,i,n[i],{silent:!0});r.silent||this.emit("added",e,t,n)}},{key:"addResourceBundle",value:function(e,t,n,r,s){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},o=[e,t];e.indexOf(".")>-1&&(r=n,n=t,t=(o=e.split("."))[1]),this.addNamespaces(t);var l=y(this.data,o)||{};r?T(l,n,s):l=(0,i.A)({},l,n),v(this.data,o,l),a.silent||this.emit("added",e,t,n)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?(0,i.A)({},{},this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"toJSON",value:function(){return this.data}}]),t}(f),M={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,n,r,i){var s=this;return e.forEach((function(e){s.processors[e]&&(t=s.processors[e].process(t,n,r,i))})),t}},E={},R=function(e){function t(e){var n,r,i,a,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.A)(this,t),n=(0,o.A)(this,(0,l.A)(t).call(this)),w&&f.call((0,u.A)(n)),r=["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],i=e,a=(0,u.A)(n),r.forEach((function(e){i[e]&&(a[e]=i[e])})),n.options=c,void 0===n.options.keySeparator&&(n.options.keySeparator="."),n.logger=d.create("translator"),n}return(0,c.A)(t,e),(0,a.A)(t,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}},n=this.resolve(e,t);return n&&void 0!==n.res}},{key:"extractFromKey",value:function(e,t){var n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");var r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,i=t.ns||this.options.defaultNS;if(n&&e.indexOf(n)>-1){var s=e.match(this.interpolator.nestingRegexp);if(s&&s.length>0)return{key:e,namespaces:i};var a=e.split(n);(n!==r||n===r&&this.options.ns.indexOf(a[0])>-1)&&(i=a.shift()),e=a.join(r)}return"string"==typeof i&&(i=[i]),{key:e,namespaces:i}}},{key:"translate",value:function(e,n,s){var a=this;if("object"!==(0,r.A)(n)&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),n||(n={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var o=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,l=this.extractFromKey(e[e.length-1],n),u=l.key,c=l.namespaces,h=c[c.length-1],d=n.lng||this.language,f=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(d&&"cimode"===d.toLowerCase()){if(f){var p=n.nsSeparator||this.options.nsSeparator;return h+p+u}return u}var g=this.resolve(e,n),m=g&&g.res,v=g&&g.usedKey||u,y=g&&g.exactUsedKey||u,_=Object.prototype.toString.apply(m),T=void 0!==n.joinArrays?n.joinArrays:this.options.joinArrays,b=!this.i18nFormat||this.i18nFormat.handleAsObject;if(b&&m&&"string"!=typeof m&&"boolean"!=typeof m&&"number"!=typeof m&&["[object Number]","[object Function]","[object RegExp]"].indexOf(_)<0&&("string"!=typeof T||"[object Array]"!==_)){if(!n.returnObjects&&!this.options.returnObjects)return this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(v,m,n):"key '".concat(u," (").concat(this.language,")' returned an object instead of string.");if(o){var S="[object Array]"===_,P=S?[]:{},w=S?y:v;for(var k in m)if(Object.prototype.hasOwnProperty.call(m,k)){var M="".concat(w).concat(o).concat(k);P[k]=this.translate(M,(0,i.A)({},n,{joinArrays:!1,ns:c})),P[k]===M&&(P[k]=m[k])}m=P}}else if(b&&"string"==typeof T&&"[object Array]"===_)(m=m.join(T))&&(m=this.extendTranslation(m,e,n,s));else{var E=!1,R=!1,x=void 0!==n.count&&"string"!=typeof n.count,D=t.hasDefaultValue(n),I=x?this.pluralResolver.getSuffix(d,n.count):"",C=n["defaultValue".concat(I)]||n.defaultValue;!this.isValidLookup(m)&&D&&(E=!0,m=C),this.isValidLookup(m)||(R=!0,m=u);var L=D&&C!==m&&this.options.updateMissing;if(R||E||L){if(this.logger.log(L?"updateKey":"missingKey",d,h,u,L?C:m),o){var O=this.resolve(u,(0,i.A)({},n,{keySeparator:!1}));O&&O.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var A=[],G=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if("fallback"===this.options.saveMissingTo&&G&&G[0])for(var B=0;B<G.length;B++)A.push(G[B]);else"all"===this.options.saveMissingTo?A=this.languageUtils.toResolveHierarchy(n.lng||this.language):A.push(n.lng||this.language);var N=function(e,t,r){a.options.missingKeyHandler?a.options.missingKeyHandler(e,h,t,L?r:m,L,n):a.backendConnector&&a.backendConnector.saveMissing&&a.backendConnector.saveMissing(e,h,t,L?r:m,L,n),a.emit("missingKey",e,h,t,m)};this.options.saveMissing&&(this.options.saveMissingPlurals&&x?A.forEach((function(e){a.pluralResolver.getSuffixes(e).forEach((function(t){N([e],u+t,n["defaultValue".concat(t)]||C)}))})):N(A,u,C))}m=this.extendTranslation(m,e,n,g,s),R&&m===u&&this.options.appendNamespaceToMissingKey&&(m="".concat(h,":").concat(u)),R&&this.options.parseMissingKeyHandler&&(m=this.options.parseMissingKeyHandler(m))}return m}},{key:"extendTranslation",value:function(e,t,n,r,s){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,n,r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init((0,i.A)({},n,{interpolation:(0,i.A)({},this.options.interpolation,n.interpolation)}));var o,l=n.interpolation&&n.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;if(l){var u=e.match(this.interpolator.nestingRegexp);o=u&&u.length}var c=n.replace&&"string"!=typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(c=(0,i.A)({},this.options.interpolation.defaultVariables,c)),e=this.interpolator.interpolate(e,c,n.lng||this.language,n),l){var h=e.match(this.interpolator.nestingRegexp);o<(h&&h.length)&&(n.nest=!1)}!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return s&&s[0]===r[0]&&!n.context?(a.logger.warn("It seems you are nesting recursively key: ".concat(r[0]," in key: ").concat(t[0])),null):a.translate.apply(a,r.concat([t]))}),n)),n.interpolation&&this.interpolator.reset()}var d=n.postProcess||this.options.postProcess,f="string"==typeof d?[d]:d;return null!=e&&f&&f.length&&!1!==n.applyPostProcessor&&(e=M.handle(f,e,t,this.options&&this.options.postProcessPassResolved?(0,i.A)({i18nResolved:r},n):n,this)),e}},{key:"resolve",value:function(e){var t,n,r,i,s,a=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!a.isValidLookup(t)){var l=a.extractFromKey(e,o),u=l.key;n=u;var c=l.namespaces;a.options.fallbackNS&&(c=c.concat(a.options.fallbackNS));var h=void 0!==o.count&&"string"!=typeof o.count,d=void 0!==o.context&&"string"==typeof o.context&&""!==o.context,f=o.lngs?o.lngs:a.languageUtils.toResolveHierarchy(o.lng||a.language,o.fallbackLng);c.forEach((function(e){a.isValidLookup(t)||(s=e,!E["".concat(f[0],"-").concat(e)]&&a.utils&&a.utils.hasLoadedNamespace&&!a.utils.hasLoadedNamespace(s)&&(E["".concat(f[0],"-").concat(e)]=!0,a.logger.warn('key "'.concat(n,'" for languages "').concat(f.join(", "),'" won\'t get resolved as namespace "').concat(s,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach((function(n){if(!a.isValidLookup(t)){i=n;var s,l,c=u,f=[c];for(a.i18nFormat&&a.i18nFormat.addLookupKeys?a.i18nFormat.addLookupKeys(f,u,n,e,o):(h&&(s=a.pluralResolver.getSuffix(n,o.count)),h&&d&&f.push(c+s),d&&f.push(c+="".concat(a.options.contextSeparator).concat(o.context)),h&&f.push(c+=s));l=f.pop();)a.isValidLookup(t)||(r=l,t=a.getResource(n,e,l,o))}})))}))}})),{res:t,usedKey:n,exactUsedKey:r,usedLng:i,usedNS:s}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,r):this.resourceStore.getResource(e,t,n,r)}}],[{key:"hasDefaultValue",value:function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&"defaultValue"===t.substring(0,12)&&void 0!==e[t])return!0;return!1}}]),t}(f);function x(e){return e.charAt(0).toUpperCase()+e.slice(1)}var D=function(){function e(t){(0,s.A)(this,e),this.options=t,this.whitelist=this.options.supportedLngs||!1,this.supportedLngs=this.options.supportedLngs||!1,this.logger=d.create("languageUtils")}return(0,a.A)(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],n=e.split("-");return this.options.lowerCaseLng?n=n.map((function(e){return e.toLowerCase()})):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=x(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=x(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=x(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isWhitelisted",value:function(e){return this.logger.deprecate("languageUtils.isWhitelisted",'function "isWhitelisted" will be renamed to "isSupportedCode" in the next major - please make sure to rename it\'s usage asap.'),this.isSupportedCode(e)}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,n=this;return e?(e.forEach((function(e){if(!t){var r=n.formatLanguageCode(e);n.options.supportedLngs&&!n.isSupportedCode(r)||(t=r)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var r=n.getLanguagePartFromCode(e);if(n.isSupportedCode(r))return t=r;t=n.options.supportedLngs.find((function(e){if(0===e.indexOf(r))return e}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}},{key:"toResolveHierarchy",value:function(e,t){var n=this,r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],s=function(e){e&&(n.isSupportedCode(e)?i.push(e):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(e))):"string"==typeof e&&s(this.formatLanguageCode(e)),r.forEach((function(e){i.indexOf(e)<0&&s(n.formatLanguageCode(e))})),i}}]),e}(),I=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],C={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}},L=function(){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.A)(this,e),this.languageUtils=t,this.options=r,this.logger=d.create("pluralResolver"),this.rules=(n={},I.forEach((function(e){e.lngs.forEach((function(t){n[t]={numbers:e.nr,plurals:C[e.fc]}}))})),n)}return(0,a.A)(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=this.getRule(e);return t&&t.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){return this.getSuffixes(e).map((function(e){return t+e}))}},{key:"getSuffixes",value:function(e){var t=this,n=this.getRule(e);return n?n.numbers.map((function(n){return t.getSuffix(e,n)})):[]}},{key:"getSuffix",value:function(e,t){var n=this,r=this.getRule(e);if(r){var i=r.noAbs?r.plurals(t):r.plurals(Math.abs(t)),s=r.numbers[i];this.options.simplifyPluralSuffix&&2===r.numbers.length&&1===r.numbers[0]&&(2===s?s="plural":1===s&&(s=""));var a=function(){return n.options.prepend&&s.toString()?n.options.prepend+s.toString():s.toString()};return"v1"===this.options.compatibilityJSON?1===s?"":"number"==typeof s?"_plural_".concat(s.toString()):a():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===r.numbers.length&&1===r.numbers[0]?a():this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString()}return this.logger.warn("no plural rule found for: ".concat(e)),""}}]),e}(),O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.A)(this,e),this.logger=d.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return(0,a.A)(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:P,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?b(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?b(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?b(t.nestingPrefix):t.nestingPrefixEscaped||b("$t("),this.nestingSuffix=t.nestingSuffix?b(t.nestingSuffix):t.nestingSuffixEscaped||b(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(e,t,n,r){var i,s,a,o=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function u(e){return e.replace(/\$/g,"$$$$")}var c=function(e){if(e.indexOf(o.formatSeparator)<0){var i=_(t,l,e);return o.alwaysFormat?o.format(i,void 0,n):i}var s=e.split(o.formatSeparator),a=s.shift().trim(),u=s.join(o.formatSeparator).trim();return o.format(_(t,l,a),u,n,r)};this.resetRegExp();var h=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,d=r&&r.interpolation&&r.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return u(e)}},{regex:this.regexp,safeValue:function(e){return o.escapeValue?u(o.escape(e)):u(e)}}].forEach((function(t){for(a=0;i=t.regex.exec(e);){if(void 0===(s=c(i[1].trim())))if("function"==typeof h){var n=h(e,i,r);s="string"==typeof n?n:""}else{if(d){s=i[0];continue}o.logger.warn("missed to pass in variable ".concat(i[1]," for interpolating ").concat(e)),s=""}else"string"==typeof s||o.useRawValueToEscape||(s=g(s));if(e=e.replace(i[0],t.safeValue(s)),t.regex.lastIndex=0,++a>=o.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var n,r,s=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=(0,i.A)({},a);function l(e,t){var n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;var r=e.split(new RegExp("".concat(n,"[ ]*{"))),s="{".concat(r[1]);e=r[0],s=(s=this.interpolate(s,o)).replace(/'/g,'"');try{o=JSON.parse(s),t&&(o=(0,i.A)({},t,o))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(n).concat(s)}return delete o.defaultValue,e}for(o.applyPostProcessor=!1,delete o.defaultValue;n=this.nestingRegexp.exec(e);){var u=[],c=!1;if(n[0].includes(this.formatSeparator)&&!/{.*}/.test(n[1])){var h=n[1].split(this.formatSeparator).map((function(e){return e.trim()}));n[1]=h.shift(),u=h,c=!0}if((r=t(l.call(this,n[1].trim(),o),o))&&n[0]===e&&"string"!=typeof r)return r;"string"!=typeof r&&(r=g(r)),r||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),r=""),c&&(r=u.reduce((function(e,t){return s.format(e,t,a.lng,a)}),r.trim())),e=e.replace(n[0],r),this.regexp.lastIndex=0}return e}}]),e}(),A=function(e){function t(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,s.A)(this,t),i=(0,o.A)(this,(0,l.A)(t).call(this)),w&&f.call((0,u.A)(i)),i.backend=e,i.store=n,i.services=r,i.languageUtils=r.languageUtils,i.options=a,i.logger=d.create("backendConnector"),i.state={},i.queue=[],i.backend&&i.backend.init&&i.backend.init(r,a.backend,a),i}return(0,c.A)(t,e),(0,a.A)(t,[{key:"queueLoad",value:function(e,t,n,r){var i=this,s=[],a=[],o=[],l=[];return e.forEach((function(e){var r=!0;t.forEach((function(t){var o="".concat(e,"|").concat(t);!n.reload&&i.store.hasResourceBundle(e,t)?i.state[o]=2:i.state[o]<0||(1===i.state[o]?a.indexOf(o)<0&&a.push(o):(i.state[o]=1,r=!1,a.indexOf(o)<0&&a.push(o),s.indexOf(o)<0&&s.push(o),l.indexOf(t)<0&&l.push(t)))})),r||o.push(e)})),(s.length||a.length)&&this.queue.push({pending:a,loaded:{},errors:[],callback:r}),{toLoad:s,pending:a,toLoadLanguages:o,toLoadNamespaces:l}}},{key:"loaded",value:function(e,t,n){var r=e.split("|"),i=r[0],s=r[1];t&&this.emit("failedLoading",i,s,t),n&&this.store.addResourceBundle(i,s,n),this.state[e]=t?-1:2;var a={};this.queue.forEach((function(n){var r,o,l,u,c;r=n.loaded,o=s,(u=(l=m(r,[i],Object)).obj)[c=l.k]=u[c]||[],u[c].push(o),function(e,t){for(var n=e.indexOf(t);-1!==n;)e.splice(n,1),n=e.indexOf(t)}(n.pending,e),t&&n.errors.push(t),0!==n.pending.length||n.done||(Object.keys(n.loaded).forEach((function(e){a[e]||(a[e]=[]),n.loaded[e].length&&n.loaded[e].forEach((function(t){a[e].indexOf(t)<0&&a[e].push(t)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",a),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:350,a=arguments.length>5?arguments[5]:void 0;return e.length?this.backend[n](e,t,(function(o,l){o&&l&&i<5?setTimeout((function(){r.read.call(r,e,t,n,i+1,2*s,a)}),s):a(o,l)})):a(null,{})}},{key:"prepareLoading",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var s=this.queueLoad(e,t,r,i);if(!s.toLoad.length)return s.pending.length||i(),null;s.toLoad.forEach((function(e){n.loadOne(e)}))}},{key:"load",value:function(e,t,n){this.prepareLoading(e,t,{},n)}},{key:"reload",value:function(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}},{key:"loadOne",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=e.split("|"),i=r[0],s=r[1];this.read(i,s,"read",void 0,void 0,(function(r,a){r&&t.logger.warn("".concat(n,"loading namespace ").concat(s," for language ").concat(i," failed"),r),!r&&a&&t.logger.log("".concat(n,"loaded namespace ").concat(s," for language ").concat(i),a),t.loaded(e,r,a)}))}},{key:"saveMissing",value:function(e,t,n,r,s){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null!=n&&""!==n&&(this.backend&&this.backend.create&&this.backend.create(e,t,n,r,null,(0,i.A)({},a,{isUpdate:s})),e&&e[0]&&this.store.addResource(e[0],t,n,r))}}]),t}(f);function G(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.whitelist&&(e.whitelist&&e.whitelist.indexOf("cimode")<0&&(e.whitelist=e.whitelist.concat(["cimode"])),e.supportedLngs=e.whitelist),e.nonExplicitWhitelist&&(e.nonExplicitSupportedLngs=e.nonExplicitWhitelist),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function B(){}const N=new(function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;if((0,s.A)(this,t),e=(0,o.A)(this,(0,l.A)(t).call(this)),w&&f.call((0,u.A)(e)),e.options=G(n),e.services={},e.logger=d,e.modules={external:[]},r&&!e.isInitialized&&!n.isClone){if(!e.options.initImmediate)return e.init(n,r),(0,o.A)(e,(0,u.A)(e));setTimeout((function(){e.init(n,r)}),0)}return e}return(0,c.A)(t,e),(0,a.A)(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;function s(e){return e?"function"==typeof e?new e:e:null}if("function"==typeof t&&(n=t,t={}),t.whitelist&&!t.supportedLngs&&this.logger.deprecate("whitelist",'option "whitelist" will be renamed to "supportedLngs" in the next major - please make sure to rename this option asap.'),t.nonExplicitWhitelist&&!t.nonExplicitSupportedLngs&&this.logger.deprecate("whitelist",'options "nonExplicitWhitelist" will be renamed to "nonExplicitSupportedLngs" in the next major - please make sure to rename this option asap.'),this.options=(0,i.A)({},{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===(0,r.A)(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===(0,r.A)(e[2])||"object"===(0,r.A)(e[3])){var n=e[3]||e[2];Object.keys(n).forEach((function(e){t[e]=n[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,n,r){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!1}},this.options,G(t)),this.format=this.options.interpolation.format,n||(n=B),!this.options.isClone){this.modules.logger?d.init(s(this.modules.logger),this.options):d.init(null,this.options);var a=new D(this.options);this.store=new k(this.options.resources,this.options);var o=this.services;o.logger=d,o.resourceStore=this.store,o.languageUtils=a,o.pluralResolver=new L(a,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),o.interpolator=new O(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new A(s(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit.apply(e,[t].concat(r))})),this.modules.languageDetector&&(o.languageDetector=s(this.modules.languageDetector),o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=s(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new R(this.services,this.options),this.translator.on("*",(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit.apply(e,[t].concat(r))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&"dev"!==l[0]&&(this.options.lng=l[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments)}})),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments),e}}));var u=p(),c=function(){var t=function(t,r){e.isInitialized&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),u.resolve(r),n(t,r)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?c():setTimeout(c,0),u}},{key:"loadResources",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B,r="string"==typeof e?e:this.language;if("function"==typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&"cimode"===r.toLowerCase())return n();var i=[],s=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){i.indexOf(e)<0&&i.push(e)}))};r?s(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(e){return s(e)})),this.options.preload&&this.options.preload.forEach((function(e){return s(e)})),this.services.backendConnector.load(i,this.options.ns,n)}else n(null)}},{key:"reloadResources",value:function(e,t,n){var r=p();return e||(e=this.languages),t||(t=this.options.ns),n||(n=B),this.services.backendConnector.reload(e,t,(function(e){r.resolve(),n(e)})),r}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&M.addPostProcessor(e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"changeLanguage",value:function(e,t){var n=this;this.isLanguageChangingTo=e;var r=p();this.emit("languageChanging",e);var i=function(e){var i="string"==typeof e?e:n.services.languageUtils.getBestMatchFromCodes(e);i&&(n.language||(n.language=i,n.languages=n.services.languageUtils.toResolveHierarchy(i)),n.translator.language||n.translator.changeLanguage(i),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage(i)),n.loadResources(i,(function(e){!function(e,i){i?(n.language=i,n.languages=n.services.languageUtils.toResolveHierarchy(i),n.translator.changeLanguage(i),n.isLanguageChangingTo=void 0,n.emit("languageChanged",i),n.logger.log("languageChanged",i)):n.isLanguageChangingTo=void 0,r.resolve((function(){return n.t.apply(n,arguments)})),t&&t(e,(function(){return n.t.apply(n,arguments)}))}(e,i)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),r}},{key:"getFixedT",value:function(e,t){var n=this,s=function e(t,s){var a;if("object"!==(0,r.A)(s)){for(var o=arguments.length,l=new Array(o>2?o-2:0),u=2;u<o;u++)l[u-2]=arguments[u];a=n.options.overloadTranslationOptionHandler([t,s].concat(l))}else a=(0,i.A)({},s);return a.lng=a.lng||e.lng,a.lngs=a.lngs||e.lngs,a.ns=a.ns||e.ns,n.t(t,a)};return"string"==typeof e?s.lng=e:s.lngs=e,s.ns=t,s}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var r=this.languages[0],i=!!this.options&&this.options.fallbackLng,s=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;var a=function(e,n){var r=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===r||2===r};if(n.precheck){var o=n.precheck(this,a);if(void 0!==o)return o}return!!this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||!(!a(r,e)||i&&!a(s,e))}},{key:"loadNamespaces",value:function(e,t){var n=this,r=p();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){n.options.ns.indexOf(e)<0&&n.options.ns.push(e)})),this.loadResources((function(e){r.resolve(),t&&t(e)})),r):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var n=p();"string"==typeof e&&(e=[e]);var r=this.options.preload||[],i=e.filter((function(e){return r.indexOf(e)<0}));return i.length?(this.options.preload=r.concat(i),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){return e||(e=this.languages&&this.languages.length>0?this.languages[0]:this.language),e?["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>=0?"rtl":"ltr":"rtl"}},{key:"createInstance",value:function(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}},{key:"cloneInstance",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B,s=(0,i.A)({},this.options,n,{isClone:!0}),a=new t(s);return["store","services","language"].forEach((function(t){a[t]=e[t]})),a.services=(0,i.A)({},this.services),a.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},a.translator=new R(a.services,a.options),a.translator.on("*",(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a.emit.apply(a,[e].concat(n))})),a.init(s,r),a.translator.options=a.options,a.translator.backendConnector.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},a}}]),t}(f));var $,U=n(58632),F=n(60657),H=n(9829);!function(e){e.MISSING_VALUE="MISSING_VALUE",e.INVALID_VALUE="INVALID_VALUE",e.MISSING_INTL_API="MISSING_INTL_API"}($||($={}));var V,j=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.code=n,i.originalMessage=r,i}return(0,U.__extends)(t,e),t.prototype.toString=function(){return"[formatjs Error: "+this.code+"] "+this.message},t}(Error),z=function(e){function t(t,n,r,i){return e.call(this,'Invalid values for "'+t+'": "'+n+'". Options are "'+Object.keys(r).join('", "')+'"',$.INVALID_VALUE,i)||this}return(0,U.__extends)(t,e),t}(j),X=function(e){function t(t,n,r){return e.call(this,'Value for "'+t+'" must be of type '+n,$.INVALID_VALUE,r)||this}return(0,U.__extends)(t,e),t}(j),K=function(e){function t(t,n){return e.call(this,'The intl string context variable "'+t+'" was not provided to the string "'+n+'"',$.MISSING_VALUE,n)||this}return(0,U.__extends)(t,e),t}(j);function W(e){return"function"==typeof e}function Q(e,t,n,r,i,s,a){if(1===e.length&&(0,F.eW)(e[0]))return[{type:V.literal,value:e[0].value}];for(var o=[],l=0,u=e;l<u.length;l++){var c=u[l];if((0,F.eW)(c))o.push({type:V.literal,value:c.value});else if((0,F.jA)(c))"number"==typeof s&&o.push({type:V.literal,value:n.getNumberFormat(t).format(s)});else{var h=c.value;if(!i||!(h in i))throw new K(h,a);var d=i[h];if((0,F.Im)(c))d&&"string"!=typeof d&&"number"!=typeof d||(d="string"==typeof d||"number"==typeof d?String(d):""),o.push({type:"string"==typeof d?V.literal:V.object,value:d});else if((0,F.tv)(c)){var f="string"==typeof c.style?r.date[c.style]:(0,F.Tu)(c.style)?c.style.parsedOptions:void 0;o.push({type:V.literal,value:n.getDateTimeFormat(t,f).format(d)})}else if((0,F.Qh)(c))f="string"==typeof c.style?r.time[c.style]:(0,F.Tu)(c.style)?c.style.parsedOptions:void 0,o.push({type:V.literal,value:n.getDateTimeFormat(t,f).format(d)});else if((0,F.oF)(c))(f="string"==typeof c.style?r.number[c.style]:(0,F.N1)(c.style)?c.style.parsedOptions:void 0)&&f.scale&&(d*=f.scale||1),o.push({type:V.literal,value:n.getNumberFormat(t,f).format(d)});else{if((0,F.xm)(c)){var p=c.children,g=c.value,m=i[g];if(!W(m))throw new X(g,"function",a);var v=m(Q(p,t,n,r,i,s).map((function(e){return e.value})));Array.isArray(v)||(v=[v]),o.push.apply(o,v.map((function(e){return{type:"string"==typeof e?V.literal:V.object,value:e}})))}if((0,F.Jp)(c)){if(!(y=c.options[d]||c.options.other))throw new z(c.value,d,Object.keys(c.options),a);o.push.apply(o,Q(y.value,t,n,r,i))}else if((0,F.N6)(c)){var y;if(!(y=c.options["="+d])){if(!Intl.PluralRules)throw new j('Intl.PluralRules is not available in this environment.\nTry polyfilling it using "@formatjs/intl-pluralrules"\n',$.MISSING_INTL_API,a);var _=n.getPluralRules(t,{type:c.pluralType}).select(d-(c.offset||0));y=c.options[_]||c.options.other}if(!y)throw new z(c.value,d,Object.keys(c.options),a);o.push.apply(o,Q(y.value,t,n,r,i,d-(c.offset||0)))}}}}return(T=o).length<2?T:T.reduce((function(e,t){var n=e[e.length-1];return n&&n.type===V.literal&&t.type===V.literal?n.value+=t.value:e.push(t),e}),[]);var T}function q(e){return{create:function(){return{has:function(t){return t in e},get:function(t){return e[t]},set:function(t,n){e[t]=n}}}}}!function(e){e[e.literal=0]="literal",e[e.object=1]="object"}(V||(V={}));const Y=function(){function e(t,n,r,i){var s,a=this;if(void 0===n&&(n=e.defaultLocale),this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(e){var t=a.formatToParts(e);if(1===t.length)return t[0].value;var n=t.reduce((function(e,t){return e.length&&t.type===V.literal&&"string"==typeof e[e.length-1]?e[e.length-1]+=t.value:e.push(t.value),e}),[]);return n.length<=1?n[0]||"":n},this.formatToParts=function(e){return Q(a.ast,a.locales,a.formatters,a.formats,e,void 0,a.message)},this.resolvedOptions=function(){return{locale:Intl.NumberFormat.supportedLocalesOf(a.locales)[0]}},this.getAst=function(){return a.ast},"string"==typeof t){if(this.message=t,!e.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");this.ast=e.__parse(t,{ignoreTag:null==i?void 0:i.ignoreTag})}else this.ast=t;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=function(e,t){return t?Object.keys(e).reduce((function(n,r){var i,s;return n[r]=(i=e[r],(s=t[r])?(0,U.__assign)((0,U.__assign)((0,U.__assign)({},i||{}),s||{}),Object.keys(i).reduce((function(e,t){return e[t]=(0,U.__assign)((0,U.__assign)({},i[t]),s[t]||{}),e}),{})):i),n}),(0,U.__assign)({},e)):e}(e.formats,r),this.locales=n,this.formatters=i&&i.formatters||(void 0===(s=this.formatterCache)&&(s={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:(0,H.A)((function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new((e=Intl.NumberFormat).bind.apply(e,(0,U.__spreadArray)([void 0],t)))}),{cache:q(s.number),strategy:H.W.variadic}),getDateTimeFormat:(0,H.A)((function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new((e=Intl.DateTimeFormat).bind.apply(e,(0,U.__spreadArray)([void 0],t)))}),{cache:q(s.dateTime),strategy:H.W.variadic}),getPluralRules:(0,H.A)((function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new((e=Intl.PluralRules).bind.apply(e,(0,U.__spreadArray)([void 0],t)))}),{cache:q(s.pluralRules),strategy:H.W.variadic})})}return Object.defineProperty(e,"defaultLocale",{get:function(){return e.memoizedDefaultLocale||(e.memoizedDefaultLocale=(new Intl.NumberFormat).resolvedOptions().locale),e.memoizedDefaultLocale},enumerable:!1,configurable:!0}),e.memoizedDefaultLocale=null,e.__parse=F.qg,e.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},e}();var J,Z=function(){return Z=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Z.apply(this,arguments)};function ee(e,t,n){function r(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function i(){return!e||"string"==typeof e}void 0===n&&(n=null);for(var s="string"!=typeof t?[].concat(t):t.split(".");s.length>1;){if(i())return{};var a=r(s.shift());!e[a]&&n&&(e[a]=new n),e=e[a]}return i()?{}:{obj:e,k:r(s.shift())}}!function(e){e.keepRaw="keepRaw",e.replaceAnyway="replaceAnyway"}(J||(J={})),J.replaceAnyway;var te={memoize:!1,memoizeFallback:!1,bindI18n:!1,bindI18nStore:!1,onParseError:J.replaceAnyway},ne=function(){function e(){this.mem={}}return e.staticInit=function(t){e._i18nextInstance=t},e.prototype.init=function(t,n){var r=this;void 0===t&&(t=e._i18nextInstance);var i={};if((null==t?void 0:t.options)&&(t.options.i18nFormat&&(i=t.options.i18nFormat),i.onParseError=t.options.onParseError,i.missingInterpolationHandler=t.options.missingInterpolationHandler,i.icuConfig=t.options.icuConfig,i.ignoreWarning=!!t.options.ignoreWarning),this.options=Object.assign(te,n,i),this.formats=this.options.formats,t){var s=this.options,a=s.bindI18n,o=s.bindI18nStore,l=s.memoize;t.IntlMessageFormat=Y,this.IntlMessageFormat=Y,t.ICU=this,l&&(a&&t.on(a,(function(){return r.clearCache()})),o&&t.store.on(o,(function(){return r.clearCache()})))}this.options.localeData&&("[object Array]"===Object.prototype.toString.apply(this.options.localeData)?this.options.localeData.forEach((function(e){return r.addLocaleData(e)})):this.addLocaleData(this.options.localeData))},e.prototype.addLocaleData=function(e){("[object Array]"===Object.prototype.toString.apply(e)?e:[e]).forEach((function(e){e&&e.locale&&Y.__addLocaleData(e)}))},e.prototype.addUserDefinedFormats=function(e){this.formats=this.formats?Z(Z({},this.formats),e):e},e.prototype.checkMissingInterpolation=function(e,t,n,r,i){if(!1===(this.options.icuConfig||{}).strict)return n;for(var s={},a=0,o=e;a<o.length;a++){var l=o[a];if(1===l.type){var u=l.value;if(null===n[u]||void 0===n[u]){if("function"==typeof this.options.missingInterpolationHandler){var c=this.options.missingInterpolationHandler({key:i,text:t,locale:r,interpolation:{key:u,val:n[u]}});if("string"==typeof c){s[u]=c;continue}}switch(this.options.onParseError){case J.keepRaw:throw new Error;case J.replaceAnyway:s[u]="{"+u+"}";continue}if("function"==typeof this.options.onParseError){console.warn("[DEPRECATED] onParseError is deprecated, please use 'missingInterpolationHandler' instead of");var h=this.options.onParseError(t,u,r,this.IntlMessageFormat);if(!0===h)throw new Error;s[u]="string"==typeof h?h:"{"+u+"}"}else this.options.ignoreWarning||console.warn('[Starling ICU Warning] The interpolation parameter "{'+u+'}" is missing in the translation text "'+t+'" for the key "'+i+"\"\nSuggestions: check whether the value is null or undefined. Try using empty string '' as fallback! e.g I18n.t('key', { apple: count || '' })"),s[u]="{"+u+"}"}}}return Object.assign({},n,s)},e.prototype.parse=function(e,t,n,r,i,s){var a,o,l,u,c=s&&s.resolved&&s.resolved.res,h=this.options.memoize&&n+"."+r+"."+i.replace(/\./g,"###");!c&&t.thirdParamFallback&&t.fallbackText&&(e=t.fallbackText),this.options.memoize&&(a=function(e,t){var n=ee(e,t),r=n.obj,i=n.k;if(r)return r[i]}(this.mem,h));try{return a||(a=new this.IntlMessageFormat(e,n,this.formats,(this.options.icuConfig||{}).formatOptions),this.options.memoize&&(this.options.memoizeFallback||!s||c)&&(o=this.mem,l=a,(u=ee(o,h,Object)).obj[u.k]=l)),a.format(this.checkMissingInterpolation(a.getAst(),e,t||{},n,i))}catch(t){return e}},e.prototype.addLookupKeys=function(e,t,n,r,i){return e},e.prototype.clearCache=function(){this.mem={}},e.type="i18nFormat",e._i18nextInstance=null,e}(),re=(ne.name,function(){return re=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},re.apply(this,arguments)}),ie=/^\s*\[\[__starling_(\d+)_(.*)__\]\]\s*$/;"undefined"!=typeof window&&(window.__STARLING_INCONTEXT_GLOBAL__HOOK__=re({},window.__STARLING_INCONTEXT_GLOBAL__HOOK__||{payload:{}}));var se={name:"inContext",type:"postProcessor",process:function(e,t,n,r){if(window&&document.getElementById("INCONTEXT-KEY-MATCH")&&!n.__STARLING_INCONTEXT_FLAG__){window.__STARLING_INCONTEXT_GLOBAL_I18N__||(window.__STARLING_INCONTEXT_GLOBAL_I18N__=r),delete n.keySeparator,delete n.lngs;var i,s=0;if(t=t.toString(),ie.test(t)&&((i=t.match(ie))[0],s=i[1],t=i[2]),ie.test(e))(i=e.match(ie))[0],i[1],e=i[2];if(window.__STARLING_INCONTEXT_GLOBAL__HOOK__.payload[t]){var a=window.__STARLING_INCONTEXT_GLOBAL__HOOK__.payload[t].findIndex((function(e){return JSON.stringify(e.options)===JSON.stringify(n)}));a>-1?(window.__STARLING_INCONTEXT_GLOBAL__HOOK__.payload[t][a].default=e,s=a):s=window.__STARLING_INCONTEXT_GLOBAL__HOOK__.payload[t].push({options:n,default:e})-1}else window.__STARLING_INCONTEXT_GLOBAL__HOOK__.payload[t]=[{options:n,default:e}],s=0;return"[[__starling_"+s+"_"+t+"__]]"}return e}};function ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t,n){return t&&oe(e.prototype,t),n&&oe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ue(e){return function(e){if(Array.isArray(e))return he(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ce(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){if(e){if("string"==typeof e)return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?he(e,t):void 0}}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}for(var de=["AFN","EUR","ALL","DZD","USD","AOA","XCD","ARS","AMD","AWG","AUD","AZN","BSD","BHD","BDT","BBD","BYN","BZD","XOF","BMD","INR","BTN","BOB","BOV","BAM","BWP","NOK","BRL","BND","BGN","BIF","CVE","KHR","XAF","CAD","KYD","CLP","CLF","CNY","COP","COU","KMF","CDF","NZD","CRC","HRK","CUP","CUC","ANG","CZK","DKK","DJF","DOP","EGP","SVC","ERN","ETB","FKP","FJD","XPF","GMD","GEL","GHS","GIP","GTQ","GBP","GNF","GYD","HTG","HNL","HKD","HUF","ISK","IDR","XDR","IRR","IQD","ILS","JMD","JPY","JOD","KZT","KES","KPW","KRW","KWD","KGS","LAK","LBP","LSL","ZAR","LRD","LYD","CHF","MOP","MKD","MGA","MWK","MYR","MVR","MRO","MUR","XUA","MXN","MXV","MDL","MNT","MAD","MZN","MMK","NAD","NPR","NIO","NGN","OMR","PKR","PAB","PGK","PYG","PEN","PHP","PLN","QAR","RON","RUB","RWF","SHP","WST","STD","SAR","RSD","SCR","SLL","SGD","XSU","SBD","SOS","SSP","LKR","SDG","SRD","SZL","SEK","CHE","CHW","SYP","TWD","TJS","TZS","THB","TOP","TTD","TND","TRY","TMT","UGX","UAH","AED","USN","UYU","UYI","UZS","VUV","VEF","VND","YER","ZMW","ZWL","XBA","XBB","XBC","XBD","XTS","XXX","XAU","XPD","XPT","XAG"],fe={},pe=0;pe<de.length;pe++)fe[de[pe]]={style:"currency",currency:de[pe]};var ge={number:fe},me="languageTransformer";function ve(e){return function(t){return t.type===e}}function ye(e,t){var n=e;return(t||[]).map((function(t){n=t.process(e)||n})),n}var _e,Te={lng:"zh-CN",fallbackLng:["en-US"],inContext:!0},be=[ne,se],Se=function(){function e(t,n){var r=this;ae(this,e),this._waitingToAddResourceBundle=[],this.t=function(e,t,n){var i=Array.isArray(e)?Array.from(e).map((function(){return" "})).join(""):Array(e.length).fill(" "),s=Object.assign({keySeparator:i,nsSeparator:i},t);return"thirdParamFallback"in r.config&&r.config.thirdParamFallback&&(s.thirdParamFallback=!0),r.instance.t(e,n,s)},this._handlePlugins(n),this._handleConfigs(t),this.instance=N.createInstance(),this.instance.isInitialized=!1}return le(e,[{key:"_handlePlugins",value:function(e){var t,n;!1===(null===(t=this.config)||void 0===t||null===(n=t.icuConfig)||void 0===n?void 0:n.open)&&be.shift(),this.plugins=Array.isArray(e)?e.concat(be):be}},{key:"_handleConfigs",value:function(e){this.userLng=(null==e?void 0:e.lng)||null,this.config=Object.assign({},Te,e||{})}},{key:"language",get:function(){return(this.instance||{}).language}},{key:"createInstance",value:function(){var e=this;return new Promise((function(t,n){"undefined"!=typeof window&&!window.CocosEngine&&e.config.inContext&&(e.config.postProcess=[].concat(["inContext"],e.config.postProcess||[]),window.__STARLING_DEVTOOLS_I18N=e.instance),e.plugins.map((function(t){"IES_INTL_ICU_PLUGIN"===t.name&&t.staticInit(e.instance),e.instance.use(t)}));var r=e.config;e.config.formats=Object.assign({},e.config.formats,ge);var i=ye(r.lng,e.plugins.filter(ve(me)));e.instance.init(Object.assign({},r,{lng:i,i18nFormat:{formats:e.config.formats}}),(function(r,i){try{var s,a=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ce(e))){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==t.return||t.return()}finally{if(a)throw i}}}}(e._waitingToAddResourceBundle);try{for(a.s();!(s=a.n()).done;){var o,l=s.value;(o=e.instance).addResourceBundle.apply(o,ue(l))}}catch(r){a.e(r)}finally{a.f()}e._waitingToAddResourceBundle=[]}catch(r){}r||(e._updateLanguages(),t({t:i,err:r})),e.init=!0,n({t:i,err:r})}))}))}},{key:"_updateLanguages",value:function(){this.languages=this.instance?Array.from(new Set([this.instance.language].concat(ue(this.instance.languages)))):null}},{key:"getLanguages",value:function(){return this.languages}},{key:"changeLanguage",value:function(e,t){var n=this;this.config.lng=e,this.instance.changeLanguage(e,(function(e,r){e||n._updateLanguages(),t&&t(e,r)}))}},{key:"changeLanguageWithPromise",value:function(e){var t=this;return new Promise((function(n,r){t.config.lng=e,t.instance.changeLanguage(e,(function(e,i){e&&r({err:e,t:i}),t._updateLanguages(),n({err:e,t:i})}))}))}},{key:"getDir",value:function(e){return this.instance.dir(e)}},{key:"addResourceBundle",value:function(e,t,n,r,i){return this.instance.isInitialized?this.instance.addResourceBundle(e,t,n,r,i):(this._waitingToAddResourceBundle.push([e,t,n,!!r,!!i]),this.instance)}}]),e}(),Pe="Starling_intl:",we=function(){for(var e,t="".concat(Pe," [ERROR]"),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];(e=console).error.apply(e,[t].concat(r))};function ke(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function Me(){}function Ee(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}!function(e){e.intl3rdParty="intl3rdParty",e.backend="backend",e.logger="logger",e.languageDetector="languageDetector",e.postProcessor="postProcessor",e.i18nFormat="i18nFormat",e["3rdParty"]="3rdParty"}(_e||(_e={}));var Re=function(){function e(){var t=this;ae(this,e),this.t=function(e,n,r){return t.ignoreWarning||t.i18nInstance&&t.i18nInstance.init?!e||"string"==typeof e&&!e.trim()?"":t.i18nInstance.t(e,n,r):(we("The instance has not been initialized: i18n.t('".concat(e,"'").concat(n?","+JSON.stringify(n):"",");")),null!=r?r:Array.isArray(e)?e[0]:e)},this.plugins=[],this.i18nInstance=new Se}return le(e,[{key:"use",value:function(e){return this.plugins.includes(e)?(function(){for(var e,t="".concat(Pe," [WARNING]"),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];(e=console).warn.apply(e,[t].concat(r))}("Plugin: ".concat(e.name," has beeninit installed.")),this):(this.plugins.push(e),this)}},{key:"init",value:function(e,t){try{var n=this;return n.ignoreWarning=e.ignoreWarning,n.i18nInstance._handleConfigs(e),n.i18nInstance._handlePlugins(n.plugins),ke(function(e,r){try{var i=ke(n.i18nInstance.createInstance(),(function(e){var r,i=e.err,s=e.t,a=n.plugins.filter((function(e){return e.type===_e.intl3rdParty}));return ke((r=a.map(Ee((function(e){if(e&&"function"==typeof e.init)return(t=(e.init instanceof Promise?e.init:Ee((function(t){return Promise.resolve(e.init(t))})))(n))&&t.then?t.then(Me):Promise.resolve();var t}))),new Promise((function(e,t){if(Array.isArray(r)||(r=Array.from(r)),r.length<=0)return e([]);var n=[];r=r.map((function(i,s){return function(){("function"==typeof i?new Promise(i):Promise.resolve(i)).then((function(t){n[s]=t,s===r.length-1?e(n):r[s+1]()}),t)}})),r[0]()}))),(function(){return"function"==typeof t&&t(i,s),{err:i,t:s}}))}))}catch(e){return r(e)}return i&&i.then?i.then(void 0,r):i}(0,(function(e){return we("The instance init error: ".concat(e)),{err:e,t:function(e){return e}}})))}catch(e){return Promise.reject(e)}}},{key:"language",get:function(){return(this.i18nInstance||{}).language}},{key:"setLang",value:function(e,t){var n=ye(e,this.plugins.filter(ve(me)));this.i18nInstance.changeLanguage(n,t)}},{key:"getLanguages",value:function(){return this.i18nInstance.getLanguages()}},{key:"setLangWithPromise",value:function(e){var t=ye(e,this.plugins.filter(ve(me)));return this.i18nInstance.changeLanguageWithPromise(t)}},{key:"dir",value:function(e){return this.i18nInstance.getDir(e)}},{key:"addResourceBundle",value:function(e,t,n,r,i){return this.i18nInstance.addResourceBundle(e,t,n,r,i)}}]),e}(),xe=new Re;const De=xe},93545:(e,t,n)=>{"use strict";n.d(t,{A:()=>V});var r=n(55371),i=n(95689),s=n(57923),a=n(78647),o=n(51611),l=n(16960),u=n(14444),c=n(40099),h=n(18499);function d(e){var t=[];return c.Children.forEach(e,(function(e){t.push(e)})),t}function f(e,t){var n=null;return e&&e.forEach((function(e){n||e&&e.key===t&&(n=e)})),n}function p(e,t,n){var r=null;return e&&e.forEach((function(e){if(e&&e.key===t&&e.props[n]){if(r)throw new Error("two child with same key for <rc-animate> children");r=e}})),r}var g=n(33726);const m=function(e){return e.transitionName&&e.transitionAppear||e.animation.appear},v=function(e){return e.transitionName&&e.transitionEnter||e.animation.enter},y=function(e){return e.transitionName&&e.transitionLeave||e.animation.leave},_=function(e){return e.transitionAppear||e.animation.appear},T=function(e){return e.transitionEnter||e.animation.enter},b=function(e){return e.transitionLeave||e.animation.leave};var S=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),P={enter:"transitionEnter",appear:"transitionAppear",leave:"transitionLeave"};const w=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),S(t,[{key:"componentWillUnmount",value:function(){this.stop()}},{key:"componentWillEnter",value:function(e){v(this.props)?this.transition("enter",e):e()}},{key:"componentWillAppear",value:function(e){m(this.props)?this.transition("appear",e):e()}},{key:"componentWillLeave",value:function(e){y(this.props)?this.transition("leave",e):e()}},{key:"transition",value:function(e,t){var n=this,r=h.findDOMNode(this),i=this.props,s=i.transitionName,a="object"==typeof s;this.stop();var o=function(){n.stopper=null,t()};if((g._||!i.animation[e])&&s&&i[P[e]]){var l=a?s[e]:s+"-"+e,u=l+"-active";a&&s[e+"Active"]&&(u=s[e+"Active"]),this.stopper=(0,g.A)(r,{name:l,active:u},o)}else this.stopper=i.animation[e](r,o)}},{key:"stop",value:function(){var e=this.stopper;e&&(this.stopper=null,e.stop())}},{key:"render",value:function(){return this.props.children}}]),t}(c.Component);var k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},M=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),E="rc_animate_"+Date.now();function R(e){var t=e.children;return c.isValidElement(t)&&!t.key?c.cloneElement(t,{key:E}):t}function x(){}var D=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return I.call(n),n.currentlyAnimatingKeys={},n.keysToEnter=[],n.keysToLeave=[],n.state={children:d(R(e))},n.childrenRefs={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),M(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.showProp,n=this.state.children;t&&(n=n.filter((function(e){return!!e.props[t]}))),n.forEach((function(t){t&&e.performAppear(t.key)}))}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.nextProps=e;var n=d(R(e)),r=this.props;r.exclusive&&Object.keys(this.currentlyAnimatingKeys).forEach((function(e){t.stop(e)}));var i,s,a,o,l=r.showProp,u=this.currentlyAnimatingKeys,h=r.exclusive?d(R(r)):this.state.children,g=[];l?(h.forEach((function(e){var t,r,i,s,a=e&&f(n,e.key);(s=a&&a.props[l]||!e.props[l]?a:c.cloneElement(a||e,(i=!0,(r=l)in(t={})?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t)))&&g.push(s)})),n.forEach((function(e){e&&f(h,e.key)||g.push(e)}))):(i=n,s=[],a={},o=[],h.forEach((function(e){e&&f(i,e.key)?o.length&&(a[e.key]=o,o=[]):o.push(e)})),i.forEach((function(e){e&&Object.prototype.hasOwnProperty.call(a,e.key)&&(s=s.concat(a[e.key])),s.push(e)})),g=s=s.concat(o)),this.setState({children:g}),n.forEach((function(e){var n=e&&e.key;if(!e||!u[n]){var r=e&&f(h,n);if(l){var i=e.props[l];r?!p(h,n,l)&&i&&t.keysToEnter.push(n):i&&t.keysToEnter.push(n)}else r||t.keysToEnter.push(n)}})),h.forEach((function(e){var r=e&&e.key;if(!e||!u[r]){var i=e&&f(n,r);if(l){var s=e.props[l];i?!p(n,r,l)&&s&&t.keysToLeave.push(r):s&&t.keysToLeave.push(r)}else i||t.keysToLeave.push(r)}}))}},{key:"componentDidUpdate",value:function(){var e=this.keysToEnter;this.keysToEnter=[],e.forEach(this.performEnter);var t=this.keysToLeave;this.keysToLeave=[],t.forEach(this.performLeave)}},{key:"isValidChildByKey",value:function(e,t){var n=this.props.showProp;return n?p(e,t,n):f(e,t)}},{key:"stop",value:function(e){delete this.currentlyAnimatingKeys[e];var t=this.childrenRefs[e];t&&t.stop()}},{key:"render",value:function(){var e=this,t=this.props;this.nextProps=t;var n=this.state.children,r=null;n&&(r=n.map((function(n){if(null==n)return n;if(!n.key)throw new Error("must set key for <rc-animate> children");return c.createElement(w,{key:n.key,ref:function(t){e.childrenRefs[n.key]=t},animation:t.animation,transitionName:t.transitionName,transitionEnter:t.transitionEnter,transitionAppear:t.transitionAppear,transitionLeave:t.transitionLeave},n)})));var i=t.component;if(i){var s=t;return"string"==typeof i&&(s=k({className:t.className,style:t.style},t.componentProps)),c.createElement(i,s,r)}return r[0]||null}}]),t}(c.Component);D.isAnimate=!0,D.defaultProps={animation:{},component:"span",componentProps:{},transitionEnter:!0,transitionLeave:!0,transitionAppear:!1,onEnd:x,onEnter:x,onLeave:x,onAppear:x};var I=function(){var e=this;this.performEnter=function(t){e.childrenRefs[t]&&(e.currentlyAnimatingKeys[t]=!0,e.childrenRefs[t].componentWillEnter(e.handleDoneAdding.bind(e,t,"enter")))},this.performAppear=function(t){e.childrenRefs[t]&&(e.currentlyAnimatingKeys[t]=!0,e.childrenRefs[t].componentWillAppear(e.handleDoneAdding.bind(e,t,"appear")))},this.handleDoneAdding=function(t,n){var r=e.props;if(delete e.currentlyAnimatingKeys[t],!r.exclusive||r===e.nextProps){var i=d(R(r));e.isValidChildByKey(i,t)?"appear"===n?_(r)&&(r.onAppear(t),r.onEnd(t,!0)):T(r)&&(r.onEnter(t),r.onEnd(t,!0)):e.performLeave(t)}},this.performLeave=function(t){e.childrenRefs[t]&&(e.currentlyAnimatingKeys[t]=!0,e.childrenRefs[t].componentWillLeave(e.handleDoneLeaving.bind(e,t)))},this.handleDoneLeaving=function(t){var n=e.props;if(delete e.currentlyAnimatingKeys[t],!n.exclusive||n===e.nextProps){var r,i,s,a,o=d(R(n));if(e.isValidChildByKey(o,t))e.performEnter(t);else{var l=function(){b(n)&&(n.onLeave(t),n.onEnd(t,!1))};r=e.state.children,i=o,s=n.showProp,(a=r.length===i.length)&&r.forEach((function(e,t){var n=i[t];e&&n&&(e&&!n||!e&&n||e.key!==n.key||s&&e.props[s]!==n.props[s])&&(a=!1)})),a?l():e.setState({children:o},l)}}}};const C=function(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");return"function"!=typeof t.componentWillReceiveProps?e:c.Profiler?(t.UNSAFE_componentWillReceiveProps=t.componentWillReceiveProps,delete t.componentWillReceiveProps,e):e}(D);var L=n(61978),O=n.n(L);var A=function(e){(0,o.A)(d,e);var t,n,r=(t=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,u.A)(t);if(n){var i=(0,u.A)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,l.A)(this,e)});function d(){var e;return(0,s.A)(this,d),(e=r.apply(this,arguments)).closeTimer=null,e.close=function(t){t&&t.stopPropagation(),e.clearCloseTimer();var n=e.props.onClose;n&&n()},e.startCloseTimer=function(){e.props.duration&&(e.closeTimer=window.setTimeout((function(){e.close()}),1e3*e.props.duration))},e.clearCloseTimer=function(){e.closeTimer&&(clearTimeout(e.closeTimer),e.closeTimer=null)},e}return(0,a.A)(d,[{key:"componentDidMount",value:function(){this.startCloseTimer()}},{key:"componentDidUpdate",value:function(e){(this.props.duration!==e.duration||this.props.update)&&this.restartCloseTimer()}},{key:"componentWillUnmount",value:function(){this.clearCloseTimer()}},{key:"restartCloseTimer",value:function(){this.clearCloseTimer(),this.startCloseTimer()}},{key:"render",value:function(){var e=this,t=this.props,n=t.prefixCls,r=t.className,s=t.closable,a=t.closeIcon,o=t.style,l=t.onClick,u=t.children,d=t.holder,f="".concat(n,"-notice"),p=Object.keys(this.props).reduce((function(t,n){return"data-"!==n.substr(0,5)&&"aria-"!==n.substr(0,5)&&"role"!==n||(t[n]=e.props[n]),t}),{}),g=c.createElement("div",Object.assign({className:O()(f,r,(0,i.A)({},"".concat(f,"-closable"),s)),style:o,onMouseEnter:this.clearCloseTimer,onMouseLeave:this.startCloseTimer,onClick:l},p),c.createElement("div",{className:"".concat(f,"-content")},u),s?c.createElement("a",{tabIndex:0,onClick:this.close,className:"".concat(f,"-close")},a||c.createElement("span",{className:"".concat(f,"-close-x")})):null);return d?h.createPortal(g,d):g}}]),d}(c.Component);A.defaultProps={onClose:function(){},duration:1.5,style:{right:"50%"}};var G=n(83100),B=n(54042);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var U=0,F=Date.now(),H=function(e){(0,o.A)(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,u.A)(t);if(n){var i=(0,u.A)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,l.A)(this,e)});function i(){var e;return(0,s.A)(this,i),(e=r.apply(this,arguments)).state={notices:[]},e.hookRefs=new Map,e.add=function(t,n){var r;t.key=t.key||(r=U,U+=1,"rcNotification_".concat(F,"_").concat(r));var i=t.key,s=e.props.maxCount;e.setState((function(e){var r=e.notices,a=r.map((function(e){return e.notice.key})).indexOf(i),o=r.concat();return-1!==a?o.splice(a,1,{notice:t,holderCallback:n}):(s&&r.length>=s&&(t.updateKey=o[0].notice.updateKey||o[0].notice.key,o.shift()),o.push({notice:t,holderCallback:n})),{notices:o}}))},e.remove=function(t){e.setState((function(e){return{notices:e.notices.filter((function(e){return e.notice.key!==t}))}}))},e}return(0,a.A)(i,[{key:"getTransitionName",value:function(){var e=this.props,t=e.prefixCls,n=e.animation,r=this.props.transitionName;return!r&&n&&(r="".concat(t,"-").concat(n)),r}},{key:"render",value:function(){var e=this,t=this.state.notices,n=this.props,r=n.prefixCls,i=n.className,s=n.closeIcon,a=n.style,o=t.map((function(n,i){var a=n.notice,o=n.holderCallback,l=Boolean(i===t.length-1&&a.updateKey),u=a.updateKey?a.updateKey:a.key,h=function(){var e=[].slice.call(arguments,0);return 1===e.length?e[0]:function(){for(var t=0;t<e.length;t++)e[t]&&e[t].apply&&e[t].apply(this,arguments)}}(e.remove.bind(e,a.key),a.onClose),d=$($($({prefixCls:r,closeIcon:s},a),a.props),{},{key:u,update:l,onClose:h,onClick:a.onClick,children:a.content});return o?c.createElement("div",{key:u,className:"".concat(r,"-hook-holder"),ref:function(t){void 0!==u&&(t?(e.hookRefs.set(u,t),o(t,d)):e.hookRefs.delete(u))}}):c.createElement(A,Object.assign({},d))}));return c.createElement("div",{className:O()(r,i),style:a},c.createElement(C,{transitionName:this.getTransitionName()},o))}}]),i}(c.Component);H.defaultProps={prefixCls:"rc-notification",animation:"fade",style:{top:65,left:"50%"}},H.newInstance=function(e,t){var n=e||{},i=n.getContainer,s=(0,r.A)(n,["getContainer"]),a=document.createElement("div");i?i().appendChild(a):document.body.appendChild(a);var o=!1;h.render(c.createElement(H,Object.assign({},s,{ref:function(e){o||(o=!0,t({notice:function(t){e.add(t)},removeNotice:function(t){e.remove(t)},component:e,destroy:function(){h.unmountComponentAtNode(a),a.parentNode&&a.parentNode.removeChild(a)},useNotification:function(){return t=e,n=c.useRef({}),r=c.useState([]),s=(i=(0,B.A)(r,2))[0],a=i[1],[function(e){t.add(e,(function(e,t){var r=t.key;if(e&&!n.current[r]){var i=c.createElement(A,Object.assign({},t,{holder:e}));n.current[r]=i,a((function(e){return[].concat((0,G.A)(e),[i])}))}}))},c.createElement(c.Fragment,null,s)];var t,n,r,i,s,a}}))}})),a)};const V=H},94982:(e,t,n)=>{"use strict";function r(e){return"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)}function i(){const e=arguments.length;let t=arguments[0];r(t)||(t={});for(let n=1;n<e;n++){const e=arguments[n];if(r(e))for(const n in e)"__proto__"===n||t===e[n]||(r(e[n])&&"instance"!==n?t[n]=i(t[n],e[n]):t[n]=e[n])}return t}n.d(t,{C:()=>s,a:()=>a,d:()=>i});const s="g_ven",a="g_exp"},6607:(e,t,n)=>{"use strict";n.d(t,{V:()=>d,_:()=>y,a:()=>_,b:()=>v,g:()=>m,p:()=>p});var r=n(94982);const i=/ANGLE\s+\((?:[^,]+,\s+)?(?:[^:]*:)?([^,/]+)?(?:[^,]*)(?:[,\s]+)(Direct\S+|OpenGL[\d.\s]+|Unspecified)/,s=/ANGLE\s+\((?:[^,]+,\s+)?([^,]+)?(?:[,\s]+)(Direct\S+|OpenGL[\d.\s]+)/,a=/ANGLE\s+\((?:[^,]+,\s+)?(?:[^:]+:\s+)?([^,]+)?(?:[,\s]+)(Direct\S+|OpenGL[\d.\s]+)?/,o="OpenGL Engine",l="Unknow",u=4318,c=32902,h=4098;var d=(e=>(e.CpuDeriver="CpuDeriver",e.Intel="Intel",e.Nvidia="NVIDIA",e.Amd="AMD",e.Apple="Apple",e.Adreno="Adreno",e[e.Unknow=l]="Unknow",e))(d||{});function f(e){return"NVIDIA"===e?u:"AMD"===e?h:"Intel"===e?c:0}function p(e){const t=function(e){const t=/(SwiftShader|Intel|NVIDIA|AMD|Radeon|Apple|Adreno)/.exec(e);return t?"Radeon"===t[0]?"AMD":"SwiftShader"===t[0]?"CpuDeriver":t[0]:d.Unknow}(e);return t===d.Unknow||"CpuDeriver"===t?{vendor:t,vendorId:0,model:e,backupModel:e,api:l,origin:e}:/^ANGLE/.test(e)?function(e,t){let n,r=l,u=l,c=l;return("Intel"===e||"NVIDIA"===e)&&(n=i.exec(t)),("AMD"===e||"Adreno"===e)&&(n=s.exec(t)),"Apple"===e&&(n=a.exec(t)),null!=n&&n[1]&&(r=n[1].replace(/(AMD|NVIDIA)/,"").trim()),null!=n&&n[2]&&(c=n[2].trim()),r=r.split("(0x00")[0].trim(),u="Intel"===e?r=r.split(o)[0].trim():r.split(o)[0].trim(),{vendor:e,vendorId:f(e),model:r,backupModel:u,api:c,origin:t}}(t,e):"Intel"===t?{vendor:t,vendorId:f(t),model:e.split(o)[0].trim(),backupModel:e.split(o)[0].trim(),api:l,origin:e}:{vendor:t,vendorId:f(t),model:e.replace(/(AMD|NVIDIA)/,"").trim(),backupModel:e.split(o)[0].replace(/(AMD|NVIDIA)/,"").trim(),api:l,origin:e}}let g="";function m(e){if(g)return g;g=localStorage.getItem(r.C)||"";const t=Number(localStorage.getItem(r.a));if(g){const n=t?Date.now()-t:0;if(null==e||!e.expiration||n<e.expiration)return g;n>e.expiration&&(localStorage.removeItem(r.C),localStorage.removeItem(r.a))}return g=function(){try{let e,t;const n=document.createElement("canvas").getContext("webgl");if(n)return t=n.getExtension("WEBGL_debug_renderer_info"),e=t?n.getParameter(t.UNMASKED_RENDERER_WEBGL):"",e}catch{}return""}(),localStorage.setItem(r.C,g),localStorage.setItem(r.a,""+Date.now()),g}function v(e,t){let n=[];switch(t){case d.Intel:n=e.split("\n").map((e=>`Intel(R) ${e}`.replace("#","Graphics").replace("*","HD")));break;case d.Amd:n=e.split("\n").map((e=>e.replace("@","Radeon").replace("*","HD").replace("^","RX")));break;case d.Nvidia:n=e.split("\n").map((e=>e.replace("$","GeForce").replace("%","RTX").replace("&","GTX")))}return n.map((e=>e.split("|")))}function y(e,t){let n=e.filter((e=>e[0]===t.model));n.length||(n=e.filter((e=>e[0]===t.backupModel))),!n.length&&t.vendor===d.Intel&&!/^Intel(R)/.test(t.model)&&(n=e.filter((e=>e[0]==="Intel(R) "+t.model)));let r="-1";if(n.length){const e=n[0][1];r="-1"===e?"0":e}return parseInt(r)}function _(e){return 0===e?0:-1===e?-1:parseFloat(Math.log2(e).toFixed(2))}},24220:(e,t,n)=>{"use strict";n.d(t,{r:()=>H});var r=n(94982),i=Object.defineProperty,s=(e,t,n)=>((e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class a{constructor(e){s(this,"options"),s(this,"nodes"),this.options=e,this.nodes=[],this._init()}_init(){this.options.plugins&&Object.keys(this.options.plugins).forEach((e=>{const t=this.options.plugins&&this.options.plugins[e];if(t&&!t.ignore&&(!t.instance&&t.plugins&&Object.keys(t.plugins).length>0?t.instance=new a(t):t.cls&&(t.instance=new t.cls(t)),t.instance)){const n=typeof t.weight>"u"?1:t.weight;this.nodes.push({key:e,weight:n,instance:t.instance})}}))}getScore(){return new Promise((e=>{const t=[];this.nodes.forEach((e=>{t.push(new Promise((t=>{e.instance.getScore().then((n=>{t({key:e.key,weight:e.weight,val:n})}))})))})),Promise.all(t).then((t=>{const n={};let r=0,i=0;t.forEach((({weight:e,val:t})=>{t.score>0&&(i+=e)})),i=0===i?1:i;for(let e=0;e<t.length;e++){const s=t[e];s.val.score>0&&(r+=s.weight/i*s.val.score),n[s.key]=s.val}n.score=r,e(n)})).catch(console.log)}))}getScoreSync(e){const t={};let n=0,r=0;const{nodes:i}=this;i.forEach((t=>{const{weight:n,instance:i}=t,{score:s}=t.val=i.getScoreSync(e);s>0&&(r+=n)})),r=0===r?1:r;for(let e=0;e<i.length;e++){const s=i[e];s.val.score>0&&(n+=s.weight/r*s.val.score),t[s.key]=s.val}return t.score=n,t}}class o extends a{get version(){return"0.1.11"}constructor(e){super((0,r.d)({},e))}setPlayer(e,t){var n,r,i;null!=(r=null==(n=this.options.plugins)?void 0:n.render)&&r.instance&&(null==(i=this.options.plugins.render)||i.instance.setPlayer(e,t))}scoreAsync(){return this.getScore()}scoreSync(){return this.getScoreSync()}}var l=Object.defineProperty,u=(e,t,n)=>((e,t,n)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class c{constructor(e){u(this,"mappingFn"),this.mappingFn=e.mapping}getScore(){return new Promise((e=>{e(this.getScoreSync())}))}getScoreSync(){try{const e=navigator.hardwareConcurrency;let t=0;return this.mappingFn&&(t=this.mappingFn(e)),{score:t,origin:e}}catch{return{score:0,origin:-1}}}}class h{constructor(e){u(this,"mappingFn"),u(this,"score",0),u(this,"origin",-1),u(this,"url"),u(this,"_getScoreCallback",(()=>{})),this.url=e.url,this.mappingFn=e.mapping}getScore(){return new Promise((e=>{if(this.url)try{const t=new Image;t.src=this.url,t.onload=()=>{const n=Date.now();"function"==typeof t.decode?t.decode().then((()=>{const t=1e3/(Date.now()-n);let r=0;this.mappingFn&&(r=this.mappingFn(t)),this.score=r,this.origin=t,e({score:r,origin:t})})):e(this.getScoreSync())},t.onerror=()=>{e(this.getScoreSync())}}catch{e(this.getScoreSync())}else e(this.getScoreSync())}))}getScoreSync(e){let t=0;return this.mappingFn&&(t=this.mappingFn(-1,null==e?void 0:e.ignoreCachedImg)),t>0?{score:t,origin:-1}:{score:this.score,origin:this.origin}}}class d{constructor(e){u(this,"mappingFn"),u(this,"score",0),u(this,"origin",-1),this.mappingFn=e.mapping}getScore(){return new Promise((e=>{const t=performance.now();setTimeout((()=>{const n=performance.now()-t;let r=0;this.mappingFn&&(r=this.mappingFn(n)),this.origin=n,this.score=r,e({score:r,origin:n})}),0)}))}getScoreSync(){let e=0;return this.mappingFn&&(e=this.mappingFn(-1)),e>0?{score:e,origin:-1}:{score:this.score,origin:this.origin}}}var f=n(6607),p=Object.defineProperty;const g="Arc(TM) A770M #|995\nArc(TM) A770 #|980\nArc(TM) A770 #|970\nArc(TM) A580 #|940\nArc(TM) A730M #|820\nArc(TM) A750 #|770\nArc(TM) A750 #|770\nArc(TM) A550M #|660\nArc(TM) A550M #|630\nXe # ReleaseInternal|560\nArc(TM) A770M #|500\nArc(TM) A380 #|470\nArc(TM) A380 #|470\nArc(TM) A370M #|340\nArc(TM) A370M #|340\nXe #|320\nHD # 630 GT2|310\nArc(TM) A350M #|280\nIris(R) Xe MAX #|210\nIris(R) Xe # RI|205\nIris(R) Xe # ReleaseInternal|180\nIris(R) Xe #|180\nGen12 Desktop # Controller|180\nIris(R) Xe #|180\nIris(R) Xe MAX #|170\nCorporation Iris Xe #|170\nCorporation TigerLake-LP GT2 [Iris Xe #]|160\nXe #|160\nArc(TM) A350M #|150\nCorporation TigerLake GT2 [Iris Xe #]|150\nUHD # 770|140\nUHD # ReleaseInternal|140\nIris(R) Pro # P580|140\nIris(R) Plus #|130\nIris Plus #|130\nIris(R) Pro # 580|130\nUHD # 770|125\nUHD # 750|125\nRadeong 0.4 on AMD TONGA (DRM 3.1.0, LLVM 3.9.0)|120\nCorporation Iris Plus # G7|120\nIris(R) Plus #|120\nIris(R) Plus # 940|120\nIris(R) Plus # 650|120\nIris(R) Plus # 655|120\nIris(R) Plus # 655|120\nHD # P4600|120\nIris(TM) Pro # 6200|120\nIris(R) Plus #|120\nIris(R) Plus # 650|120\nIris(R) Plus # 655|115\nIris(R) Pro # 580|110\nCorporation Iris Pro # 580|110\nIris(R) Plus # 645|110\nIris(TM) Pro # 6200|110\nIris(TM) Pro # P580|110\nCorporation Iris Plus # 655|110\nArc(TM) # RI|110\nIris(R) Plus # 655|110\nIris(R) Plus # 655|110\nIris(R) Plus #|110\nUHD #|110\nIris Plus # 655|110\nIris(R) Plus # 650|110\nIris(R) Plus # 650|110\nIris(TM) Pro # 580|110\nIris(TM) Pro # 6200|110\nIris # 6100|110\nIris(TM) Pro # 6200|110\nIris(R) Plus # 645|110\nUHD # 730|110\nIris(TM) Pro # 6200|100\nIris Pro # 580|100\nCorporation Iris Pro # 6200|100\nIris(R) Plus # gfx-driver-user-comp_media-21486 DC ReleaseInternal|100\nIris(R) Pro # 580|100\nIris Plus # 645|100\nUHD # 750|100\nIris(TM) Pro # 580|100\nIris(TM) # 550|100\nIris(TM) Pro # P6300|100\nIris(R) Plus # 650|100\nIris(TM) Pro # 5200|100\nIris(R) # 550|100\nIris(R) Plus #|100\nIris(R) Plus # 650|100\nIris(R) Plus # 655|100\nIris(R) # 550|100\nIris(R) Plus # 645|95\nIris Plus # 650|95\nIris(R) # 550|95\nIris # 550|90\nIris(R) Plus # 650|90\nIris(R) Pro # 580|90\nIris(TM) Plus # 650|90\nIris(TM) # 550|90\nIris(R) Plus # 640|90\nIris(TM) Plus # 650|90\nIris(TM) Pro # P6300|90\nIris(TM) Plus # 650|90\nIris(TM) # 550|90\nUHD # 730|90\nCorporation Iris Plus # 650|90\nIris(TM) Pro # 5200|90\nCorporation CometLake-H GT2 [UHD #]|90\nIris(R) # 540|90\nUHD # P630|90\nUHD # 630|85\nIris(TM) # 540|85\nIris(TM) Plus # 640|80\nIris(TM) # 540|80\nUHD # 630|80\nUHD # 630|80\nUHD # P630|80\nIris(TM) Plus # 640|80\nUHD # 630|80\nUHD # 630|80\nIris Plus # 640|80\nIris(TM) # 540|80\nUHD # 630|80\nUHD # 630|80\nIris(TM) Pro # 5200|80\nUHD # 630|80\nHD # 630|80\nUHD # 630|80\nUHD # 630|80\nUHD # 630|80\nUHD # 630|80\nUHD # 630|80\nIris Pro # 6200|80\nUHD # 630|80\nIris # 540|80\nHD # 630|80\nIris(TM) # 540|80\nIris(TM) Pro # 5200|79\nUHD # 630|79\nUHD # 630|79\nUHD # 630|79\nIris # 540|79\nUHD # 630|79\nUHD #|78\nCorporation Sky Lake Integrated #|78\nIris(TM) Pro # 6200|78\nCorporation WhiskeyLake-U GT2 [UHD # 620]|78\nRadeong 0.4 on AMD BONAIRE (DRM 2.43.0, LLVM 3.8.0)|78\nUHD # 710|78\nUHD # 630|78\nUHD # P630|77\nUHD # 630|77\nUHD # 630 (Desktop 9 Series)|77\nUHD # 630|77\nCoffee Lake UHD #|77\nIris(TM) Pro # 5200|77\nUHD # 630|76\nIris(R) Plus # 640|76\nIris(TM) Pro # 5200|76\nUHD # 630|76\nUHD #|76\nUHD # 630|76\nIris(TM) Pro # 5200|75\nUHD # 630|75\nUHD # P630|75\nHD # P530|75\nHD # 630|75\nIris(TM) Pro # 5200|75\nUHD # 630|75\nIris(TM) Pro # 5200|75\nHD # 620|74\nUHD # 630|74\nHD # 630|74\nHD # 630|74\nCoffee Lake HD #|74\nUHD # 630|74\nIris(TM) # 540|74\nUHD 630|74\nIris(R) # 540|73\nUHD # 620|73\nIris # 6200|73\nCorporation CoffeeLake-H GT2 [UHD # 630]|73\nUHD # 630 (Desktop)|73\nHD # ICL RVP|73\nUHD # 630|73\nHD # 630|72\nIris Pro|72\nKBL Unknown|72\nUHD # 630|72\nIris(TM) Pro # 5200|72\nHD # 530|72\nCorporation UHD # 630 (Desktop 9 Series)|72\nRadeon Pro Vega 16|72\nIris(TM) # 540|72\nIris(R) # 540|72\nUHD # 630|71\nHD # 630|71\nIris(TM) Pro # 5200|71\nUHD # 630|71\nIris Pro|71\nCometLake UHD # 630|71\nHD # 630|71\nUHD #|71\nIris(TM) Plus # 640|71\nUHD #|71\nCorporation UHD #|70\nIris Pro # 6200|70\nIris(R) # 540|70\n#|70\nUHD # 630|70\nHD # ICL RVP BigSur|70\nUHD # ReleaseInternal|70\nHD # 530|70\nUHD # 630|70\nUHD #|70\nUHD # gfx-driver-user-comp_core-23599|70\nUHD # 630|69\nUHD #|69\nIris(TM) Pro # 5200|69\nCorporation Iris Plus # G1 (Ice Lake)|69\nHD # 630|69\nHD # 630|69\nIris(R) Plus #|69\nIris(TM) Pro # 5200|69\nUHD # 620|69\nUHD #|69\nIris(R) Plus # 640|69\nIris Pro # 6200|69\nHD # 630|69\nUHD # 630 (Mobile)|68\nIris(TM) Pro # 5200|68\nCorporation UHD # 630 (Desktop)|68\nHD # 630|68\nUHD # 630|68\nUHD # 620|68\nUHD # 630|68\nIris(TM) Plus # 640|68\nUHD #|67\nIris Pro # 580|67\nIris(TM) # 540|67\nUHD # 620|67\nIris(TM) Pro # 5200|67\nUHD #|66\nHD # P530|66\nCorporation UHD # 630 (Mobile)|66\nIris(R) Plus # 640|66\nUHD # 630|66\nIris(R) Plus # 640|65\nHD # 630|65\nHD 530|65\nUHD # 620|65\nSKL Unknown|65\nHD # 630|64\nIris(TM) # 540|64\nMesa DRI Intel(R) UHD # 620 (Kabylake GT2)|64\nUHD # 630|64\nHD # 530|63\nHD # 530|63\nHD # 530|63\nMesa Intel(R) HD # 530 (SKL GT2)|63\nUHD #|63\nHD # 530|63\nIris # 550|63\nHD # 530|63\nIris Plus # 655|63\nHD # 630|63\nUHD #, Gen11 LP|63\nCorporation 8th Gen Core Processor Gaussian Mixture Model|63\nUHD # 630|63\nIris(TM) # 650|63\nIris(R) Plus # 640|62\nHD # 530|62\nMesa DRI Intel(R) Iris # 540 (Skylake GT3e)|62\nIris(R) Plus #|61\nIris(TM) Pro # 5200|61\nIris Pro|61\nHD # 620|61\nUHD # 620|61\nUHD # 630|61\nUHD #|61\nHD # 530|60\nIris Plus # G1|60\nIris(TM) Pro # 5200|60\nIris Plus # 650|60\nUHD #|60\nHD # 620|60\nUHD # 620|60\nUHD # 630|60\nMesa DRI Intel(R) HD # 630 (Kaby Lake GT2)|60\nUHD # 620|60\nHD # 630|60\nHD # 630|59\nIris # 540|59\nIris Plus # 640|59\nCoffeeLake-H GT2 [UHD # 630]|59\nHD # 630|59\nUHD #|59\nHD # 620|59\nUHD # 620|59\nHD # 630|59\nCorporation UHD # 620 (Whiskey Lake)|59\nIris(R) Plus # 650|59\nUHD # 620|59\nMesa Intel(R) HD # 520 (SKL GT2)|58\nHD # 630|58\nHD # P530|58\nIris(TM) Plus # 640|58\nCorporation HD # 630|58\nUHD # 620|58\nUHD # 630|58\nHD # P630|58\nMesa DRI Intel(R) UHD # 630 (Coffeelake 3x8 GT2)|58\nCorporation CometLake-S GT2 [UHD # 630]|58\nHD # 530|58\nIris # 540|58\nHD # 530|58\nCorporation Device|58\nHD # CFL CRB|57\nHD # 620 macOS Edition|57\nHD # 530|57\nMesa DRI Intel(R) HD # 520 (SKL GT2)|57\nIris Pro #|56\nIris(TM) Pro # 5200|56\nIris(R) Plus # 655|56\nCoffee Lake UHD #|56\nIris(TM) # 640|55\nIris Pro|55\nUHD # 630|55\nUHD # 620|55\nHD # 530|55\nHD # 520|54\nHD # 530|54\nUHD # 620|54\nHD # 530|54\nCorporation UHD # 620|54\nUHD #|54\nIris Plus # G7|54\nCorporation Skylake GT2 [HD # 520]|53\nUHD # 630|53\nHD # 630|53\nCorporation HD # 530|53\nUHD # 617|53\nHD # 520|52\nHD # 620|52\nHD # 620|52\nHD # 620|52\nHD # 620|52\nHD # 630|52\nHD # 630|52\nHD # 5600|51\nHD # 530|51\nHD # 630|51\nUHD # 615|51\nMesa DRI Intel(R) HD # 520 (Skylake GT2)|51\nHD # 630|50\nHD # 620|50\nUHD #|50\nHD # P4600/P4700|50\nHD # 520|50\nHD # 530|50\nHD # 620|50\nHD # 530|50\nCorporation HD # 620|50\nHD # 530|50\nUHD # 620|49\nUHD # 620|49\nHD # 530|49\nIris(TM) # 6100|49\nHD # 4600|49\nHD # 630|49\nUHD # 617|49\nUHD # RI|48\nHD # 520|48\nUHD # 617|48\nHD # 5600|48\nHD # 620|48\nUHD #, Gen11 LP|47\nUHD # 617|47\nMesa DRI Intel(R) HD # 620 (Kaby Lake GT2)|47\nHD # 615|47\nUHD # RI|47\nHD # 630|47\nHD # 4600|46\nHD # 520|46\nCorporation Skylake GT2 [HD # 520]|46\nHD # 520|46\nCorporation Device|46\nHD # 4600|46\nHD # 615|45\nHD # 4600|45\nIris(TM) # 6100|45\nHD # 615|45\nUHD # 615|45\nHD # 630 GT2|45\nHD # 4600|45\nHD # 630|45\nIris(TM) # 6100|45\nHD # 4600|45\nHD # 620|45\nIris(TM) # 6100|45\nHD # 520|45\nHD # 4600|45\nIris(TM) # 540|44\nHD # 530|44\nHD # 4600|44\nIris(TM) # 5100|44\nKabylake HD # ULT GT2|44\nIris # 6100|44\nUHD # 630|44\nHD # 520|44\nHD # KBL CRB|44\nHD # 530 (Skylake GT2)|44\nCorporation HD # 620|44\nHD # 515|44\nUHD #|44\nUHD # 620|44\nIris(TM) Pro # P580|43\nUHD # 615|43\nHD # 4600|43\nHD # 4600|43\nCorporation Skylake Integrated #|43\nHD # 530|43\nUHD # 615|43\nUHD # 630|43\nHD # 615|42\nHD # 620|42\nHD # 4600|42\nHD # 615|42\nHD # 4600|42\nHD # 4600|42\nMesa DRI Intel(R) Kabylake GT2|42\nHD # 620|42\nCorporation HD # 6000|42\nUHD # 615|42\nHD # 4600|41\nCorporation HD # 520|41\nHD # P4600/P4700|41\nCorporation, Series Chipset Iris Plus # 655|41\nHD # 4600|41\nMesa DRI Intel(R) HD # 530 (Skylake GT2)|41\nHD # 4600|41\nIris(TM) # 640|41\nHD # 4600|41\nHD # 630|40\nIris(TM) # 5100|40\nIris(TM) # 6100|40\nUHD # 610|40\nHD # 4600|40\nHD # 4600|40\nUHD # 615|40\nUHD # 610|40\nHD # 530|40\nUHD # 605|40\nHD # 615|40\nHD # 4600|40\nUHD # 615|40\nHD # 505|39\nPHDGD Ivy 4|39\nUnknown|39\nIris(TM) # 5100|39\nIris|39\nCorporation Iris # 6100|39\nHD # 6000|39\nIris(TM) # 5100|39\nHD # 615|39\nHD # 5500|39\nSkylake GT2 [HD # 520]|39\nCorporation Broadwell-U Integrated #|38\nHD # 615|38\nHD # 5500|38\nHD # 4600|38\nMesa DRI Intel(R) HD # P4000 (IVB GT2)|38\nHD # 4600|38\nHD # 615|38\nCorporation HD # 610|38\nHD # 4600|38\nHD # 4600|38\nIris(TM) # 5100|38\nIris # 6100|38\nHD # 515|38\nHD # 6000|38\nUHD #, Gen11 LP|38\nIris(TM) # 5100|38\nHD # 4600|37\nHD # 610|37\nHD # 4600|37\nHD # 515|37\nHD # 4600|37\nHD # 4600|37\nIris # P580|37\nIris(TM) Pro # P6300|37\nHD # 5500|37\nHD # 4600|37\nIris # 6100|37\nUHD # 610|37\nHD # 4600|37\nHD # 4600|37\nUHD # 610|37\nHD # 530|37\nHD # 5500|37\nHD # 515|36\nHD # P4600/P4700|36\nHD # 515|36\nHD # 4600|36\nUHD # 615|36\nIris # 6100|36\nHD # 4600|36\nHD # 4600|36\nHD # 4600|36\nHD # 520|36\nHD # 520|36\nHD # 5500|36\nCorporation HD # 5500|35\nIris|35\nHD5500 # PG7|35\nHD # 515|35\nIris|35\n# gfx-driver-user-feature_dg1_poweron-27723 DCH ReleaseInternal|35\nHD # 615|35\nHD # P630|35\nHD # 510|35\nHD # 6000|35\nHD # 5000|35\nCorporation HD # 5300|35\nHD # 6000|35\nHD # 4600|35\nHD5500 Broadwell PG7|35\n# HD 4600|35\nHD # 6000|35\nHD # 510|34\nHD # 610|34\nHD # 4600|34\nHD # Family (PHDGD Skylake v2.9)|34\nCorporation Device|34\nHD # 610|34\nUHD # 610|34\nHD # 5300|34\nHD # 5000|34\nHD # 4600|34\nUHD # 610|33\nHD # 4600|33\nUHD # 620|33\nCorporation UHD # 615|33\nHD # 5000|33\nKabylake HD # ULX GT2|33\nHD # 620|33\nUHD # 615|33\nHD # 4600|33\nHD # 5500|33\nHD # 515|33\nUHD #|33\nHD # 4600|33\nHD # 520|33\nHD # 6000|33\nHD # 615|33\nHD # KBL CRB|33\nHD # 4600|33\nUHD # 610|33\nIris # 6100|33\nHD # 515|33\nIris|32\nIris|32\nHD # 5000|32\nIris|32\nHD # 5000|32\nIris(TM) # 5100|32\nHD # 4600|32\nHD # 4600|32\nCorporation Xeon E3-1200 v3/4th Gen Core Processor Integrated # Controller|32\nHD # 5500 (PHDGD Skylake v2.9)|32\nHD # 610|32\nHD # 6000|31\nHD # 5500|31\nIris|31\nHD # 6000|31\nUHD # 610|31\nHD # 510|31\nHD #|31\nHD # 6000|31\nHD # 4400|31\nHD # 5000|31\nHD # 4600|30\nHD # 515|30\nHD # 5600|30\nHD # 4600|30\nHD # 4400|30\nHD # 530|30\nGeForce GTX 960|30\nUHD # 610|30\nGeForce GTX 960|30\nHD # 510|30\nHD # 6000|30\nCorporation HD # 515|30\nHD # 610|29\nHD # 510|29\nHD # 5000|29\nHD # 4600|29\nIris(TM) Pro # 6200|29\nHD # 510|29\nHD # 5000|29\nHD # 6000|29\nIris|29\nHD # 4400|29\nHD # 4400|29\nHD # 4000|29\nHD # 510|29\nHD # 5000|29\nHD # 4400|28\nHD # 610|28\nHD # 5300|28\nHD # 510|28\nHD #|28\nHD # 610|28\nHD # 4400|28\nHD # 610|28\nHD # 4600|28\nHD # 4600|28\nHD # 5000|28\nHD # 4400|28\nHD # 4400|28\nCorporation Xeon E3-1200 v3/4th Gen Core Processor Integrated # Controller|28\nHD # 4400|28\nHD # 5300|28\nHD # 5000|28\nUHD # 605|28\nHD # 4400|28\nHD # 5500|28\nHD # 4000|28\nHD # 4400|27\nHD # 615|27\nHD # Family(PHDGD Skylake v2.0)|27\nHD # 4400|27\nHD # 4400|27\nHD # 610|27\nCorporation HD # 510|27\nIris|27\nHD # 520|27\nHD # 5000|27\nHD # 5300|27\nHD # 6000|27\nHD # 4000|27\nHD # 610|27\nHD # 5000|27\nHD # 4600|27\nMesa DRI Intel(R) HD # 505 (Broxton)|27\nHD # 5500|27\nHD #|27\nHD # 5000|26\nUHD # 600|26\nHD # 4600|26\nMesa DRI Intel(R) Haswell Mobile|26\nHD # 4000|26\nHD # 5300|26\nIris(TM) # 540|26\nHD # 4000|26\nHD # 4600|26\nHD #|26\nHD # 4400|26\nHD # 4600|26\nHD # 6000|26\nCorporation Celeron N3350/Pentium N4200/Atom E3900 Series Integrated # Controller|26\nHD # 530|26\nHD # 5500|25\nBroxton-P HD #|25\nCorporation Xeon E3-1200 v3/4th Gen Core Processor Integrated # Controller|25\nHD 4000|25\nHD # 4400|25\nHD # 4600|25\nHD # 5500|25\nHD 4000|25\nCorporation Xeon E3-1200 v3/4th Gen Core Processor Integrated # Controller|25\nCorporation HD #|25\nHD # 4400|25\nMesa DRI Intel(R) HD # 5500 (Broadwell GT2)|25\nHD # 4400|25\nHD #|25\nUHD # 600|24\nArc(TM) #|24\nHD # 4600|24\nHD # 5300|24\nHD # 4400|24\nHD # 4400|24\nHD # 4400|24\nHD # 4000|24\nUHD # 605|24\nHD # 5000|23\nCorporation Xeon E3-1200 v2/3rd Gen Core processor # Controller|23\nUHD #, LKF|23\nUHD # 605|23\nHD # 4400|23\nHD # 4400|23\nHD # 4000|23\nHD # 4400|23\nMesa DRI Intel(R) Ivybridge Desktop|23\n0x496e74656c2048442047726170686963000732034343|23\nHD # 5300|22\nHD # 615|22\nKabylake HD # ULX GT2|22\nHD # 5300|22\nHD #|22\nHD #|22\nHD # 4000|22\nHD #|22\nHD # 515|22\nHD #|22\nHD # 5300|22\nCorporation Xeon E3-1200 v3/4th Gen Core Processor Integrated # Controller|22\nHD # 5300|22\nCorporation Xeon E3-1200 v3/4th Gen Core Processor Integrated # Controller|22\nHD # 4000|21\nUHD # 605|21\nCorporation Xeon E3-1200 v3/4th Gen Core Processor Integrated # Controller|21\nHD # 4400|21\nHD #|21\nHD # 4400|21\nCorporation Xeon E3-1200 v3/4th Gen Core Processor Integrated # Controller|21\nHD #|21\nHD # 5300|21\nHD # 4400|21\nHD # 5300|21\nHD # P4600/P4700|21\nHD #|21\nCorporation Xeon E3-1200 v3/4th Gen Core Processor Integrated # Controller|21\nCorporation UHD # 605|20\nUHD # 600|20\nHD # 4000|20\nHD #|20\nUHD # 600 Universal|20\nHD # 4600|20\nHD # 500|20\nUHD # 600|20\nHD #|20\nHD # 5000|20\nHD # 4400|20\nHD # 5300|19\nHD # 4000|19\nMesa DRI Intel(R) Sandybridge Mobile|19\nHD # 505|19\nHD # 4000|19\nHD # 4400|19\nUHD # 600|19\nHD # 3000|19\nHD # 615|19\nHD #|19\nCorporation Atom/Celeron/Pentium Processor N4200/N3350/E3900 Series Integrated # Controller|19\nHD # 4000|19\nHD #|19\nUHD # 600|19\nHD #|19\nCorporation Haswell-ULT Integrated # Controller|19\nHD # 4400|19\nCorporation GeminiLake [UHD # 600]|19\nHD # 4000|18\nHD #|18\nHD #|18\nHD # 500|18\nHD # 4000|18\nCherryView HD #|17\nCorporation Xeon E3-1200 v2/3rd Gen Core processor # Controller|17\nXeon E3-1200 v3/4th Gen Core Processor Integrated # Controller|17\nCorporation Xeon E3-1200 v3/4th Gen Core Processor Integrated # Controller|17\nUHD # 600|17\nUHD # 600|17\nCorporation Xeon E3-1200 v2/3rd Gen Core processor # Controller|16\nHD #|16\nUHD # 600|16\nHD #|16\nHD # 5000 (Android)|16\nHD #|16\nUHD # 600|16\nHD #|16\nHD #, Gen10|16\nHD # (PHDGD IvyDrive 3.0)|16\nHD #|15\nUHD # 600|15\nCorporation Atom/Celeron/Pentium Processor x5-E8000/J3xxx/N3xxx Integrated # Controller|15\nHD # 500|15\nHD # 505|15\nHD #|15\nCorporation 3rd Gen Core processor # Controller|15\nHD # 4400|15\nHD #|14\nHD #|14\nHD #|14\nHD # 505|14\nHD #|14\nHD #|14\nHD #|14\nHD #|13\nHD # 530|13\nHD # 500|13\nCorporation 3rd Gen Core processor # Controller|13\nHD # 4400|12\nHD # 5500|12\nHD #|12\nHD #|12\nCorporation HD # 500|12\nHD # 500|12\n3rd Gen Core processor # Controller|12\nHD #|11\nCorporation Atom/Celeron/Pentium Processor x5-E8000/J3xxx/N3xxx Series PCI Configuration Registers|11\nCorporation 2nd Gen Core Processor Family Integrated # Controller|11\nHD # 510|11\nHD # 4600 (PHDGD Skylake v2.9)|9\nCorporation Atom Processor Z36xxx/Z37xxx Series # & Display|8\nCorporation Atom Processor Z36xxx/Z37xxx Series # & Display|8\nMesa DRI Intel(R) Bay Trail|8\nUHD #, Gen12 LP ReleaseInternal|5\nCorporation D3D12 (Intel(R) UHD # 630)|3\nHD # 3000|2\n(PE64) Intel(R) 4th Generation Haswell HD # Family|-1\n4 Series Internal Chipset|-1\n7 Series/C216 Chipset Family MEI Controller #1|-1\nB43 Express Chipset|-1\nCometLake-S GT2 [UHD # 630]|-1\nHD # 5500|-1\nHD # 620|-1\nG35 Express Chipset Family|-1\nG41 Express Chipset|-1\nG45/G43 Express Chipset|-1\n# Media Accelerator HD|-1\nHD # (PHDGD Omega 5.0)|-1\nHD # 4400|-1\nHD # P3000|-1\nHD # P3000 (PHDGD Omega 5.0)|-1\nIncrediblE HD # 3000|-1\nIris Pro # 5200|-1\nMesa DRI Intel(R) HD # (CHV)|-1\nMesa DRI Intel(R) Ivybridge Mobile|-1\nMobile Intel(R) 4 Series Express Chipset Family|-1\nMobile Intel(R) 965 Express Chipset Family|-1\nMobile Intel(R) HD #|-1\nPHDGD Quantic C3|-1\nQ45/Q43 Express Chipset|-1\nRadeong 0.4 on AMD CAPE VERDE (DRM 2.43.0, LLVM 3.7.0)|-1\nRadeong 0.4 on AMD CAPE VERDE (DRM 3.9.0 / 4.9.0-rc1+, LLVM 4.0.0)|-1\nRadeong 0.4 on AMD FIJI (DRM 3.2.0 / 4.7.0-rc5+, LLVM 4.0.0)|-1\nUHD #, Gen12 LP ReleaseInternal|-1",m="\n$ % 4090|1950\n$ % 4090 Laptop GPU|1790\n$ % 4070 Ti|1520\n$ % 3090 Ti|1465\n$ % 4080|1430\n$ % 4060 Laptop GPU|1410\n$ % 3080 Ti Laptop GPU|1390\n$ % 3080|1325\n$ % 3080 Ti|1300\n% A5500 Laptop GPU|1240\n$ % 3090|1235\n$ % 3070 Ti|1230\n$ % 3070|1230\n$ % 3060 Ti|1160\n$ % 3080 Laptop GPU|1140\n% A4000 Laptop GPU|1130\n$ % 2080 Ti|1120\n$ % 3070 Laptop GPU|1080\nTITAN V|1070\n$ % 2080 SUPER|1060\nQuadro % 8000|1050\n% A6000|1050\nTITAN %|1050\n$ % 3070 Ti Laptop GPU|1030\n% A5000 Laptop GPU|1030\n$ % 4090 Laptop GPU|1020\n$ % 3060|1015\nTITAN X (Pascal)|1010\nTITAN Xp|995\n$ & 1080 Ti|990\n$ % 4070 Laptop GPU|990\n$ % 4090|980\n$ % 2070 SUPER|980\n$ % 4080|975\n$ % 3060|970\n$ % 2080|970\n$ % 4080 Laptop GPU|970\n$ % 3060 Laptop GPU|910\n$ % 2060 SUPER|890\n$ % 4060 Laptop GPU|880\n$ % 2070|880\n$ % 2080 Super with Max-Q Design|870\n$ % 2080 with Max-Q Design|870\nQuadro % 5000|870\n$ % 3080 Ti Laptop GPU|860\nQuadro % 5000 with Max-Q Design|840\nAsus $ & 1080|840\n$ & 1080|840\n$ % 2070 Super with Max-Q Design|840\n% A3000 Laptop GPU|835\nQuadro % 4000 with Max-Q Design|830\n$ % 3070 Ti Laptop GPU|830\nQuadro % 4000|820\n% A6000|810\n$ & 1070 Ti|785\n$ % 4070 Ti|784\n$ % 4050 Laptop GPU|784\n% A5500 Laptop GPU|780\nTITAN Xp COLLECTORS EDITION|770\n$ % 2070 with Max-Q Design|765\n$ % 3050|760\n$ % 2060|760\n$ & 980 Ti|755\nQuadro P6000|750\n$ & 1080|750\nQuadro % 6000|744\n$ & 1070|740\n% A4000|740\n$ % 3090|740\n$ % 3080 Ti|730\n$ & 1080 Ti|730\nQuadro P4200|710\n$ & 1080 with Max-Q Design|707\n$ % 3060 Lite Hash Rate|705\nEIZO MED-XN83|700\n$ % 3080 Ti|700\n$ & 1660 SUPER|700\nTITAN Xp|700\nEVGA $ & 1070|700\n$ % 3090 Ti|700\nQuadro GV100|695\nQuadro P4000|695\n$ & 1660 Ti|690\n$ % 3070 Ti|690\n% 6000 Ada Generation|690\n$ % 3070|690\nQuadro % 8000|685\n% A2000 12GB|680\n$ % 2080|680\n$ & TITAN X|680\nQuadro M6000 24GB|680\n$ & 1660 SUPER|670\nTITAN V|670\nQuadro % 3000|670\nGraphics Device|670\n% A5000|670\n$ % 3090|670\nTITAN Xp COLLECTORS EDITION|670\n$ & 1070 A17|670\n$ % 3080 Laptop GPU|667\n% A4500 Embedded GPU|660\n% A5000 Laptop GPU|660\n$ % 3080|660\n$ % 3050 Ti Laptop GPU|650\n$ & 1070 with Max-Q Design|650\n$ % 3060 Ti|650\nQuadro P4200 with Max-Q Design|650\n$ % 3080|650\n$ % 2080 SUPER|650\n$ & 1070 Ti|648\n$ & 1070 with MaxQ Design|642\n% A3000 Laptop GPU|641\n$ % 3070 Laptop GPU|641\n$ & 1070|640\nGA104GL [% A4000]|639\n$ & 980 Ti|637\n$ % 2070 Mobile / Max-Q Refresh|637\n% A4000 Laptop GPU|634\n$ % 3060|633\nMicrosoft Virtual Render Driver|633\n$ % 3050 Laptop GPU|631\n% A2000|629\n$ % 2070 Mobile / Max-Q|626\n$ % 3070|625\nQuadro P5000|625\nQuadro P4000|621\n$ % 3060 Laptop GPU|621\n$ % 2060 with Max-Q Design|618\nGV102|614\n$ % 2070 SUPER|612\n$ & 1660|606\n$ % 2070|604\n$ & 1660 Ti with Max-Q Design|601\n$ & TITAN X|598\n% A2000 8GB Laptop GPU|598\n$ & TITAN Xp|595\n$ & 980|593\n$ % 2080 SUPER|591\n& 1060 HL|589\nTesla T4|589\nGRID P4-1Q|585\n% A4000|581\n$ % 2080 Ti|577\n$ % 2080 Super with Max-Q Design|576\nQuadro % 4000 Mobile / Max-Q|576\nTU102 [TITAN %]|574\n$ & 1060 with Max-Q Design|571\n$ % 2070 SUPER|570\n$ & 1060 6GB|570\n$ % 2080 Mobile|568\n$ % 2060|568\nQuadro P3200|565\nP106-100|564\nGRID V100DX-1Q|564\n% A2000|562\n$ % 2080 Ti Rev. A|561\n$ % 2080 Rev. A|559\nGV100 [TITAN V]|557\n$ % 2080|556\n$ & 1650 SUPER|554\nP106-100 Custom|553\n$ % 2070 Super with Max-Q Design|553\nGV100|553\n$ % 2070 Mobile|550\nGP102 [TITAN X]|548\n% A2000 12GB|546\n$ & 1060 5GB|542\nMSI $ & 1060|542\n$ % 2060 SUPER|542\nGRID T4-1Q|539\nQuadro % 5000 Mobile / Max-Q|538\n$ % 3050|538\n$ & 1060 3GB|538\nQuadro % 5000 with Max-Q Design|537\nQuadro M6000|536\n% A2000 Laptop GPU|536\n$ & 1660 SUPER|533\nA10-2B|530\nTITAN X (Pascal)|530\nQuadro P5000|527\n$ % 2070|526\n$ & 1080|525\n$ % 2060 Mobile|524\nPNY $ & 980|524\n$ & 1080 Mobile|523\n$ % 2060 SUPER|520\n$ & 780 Ti|518\n% A4500|516\n$ % 2060 Rev. A|515\nMSI $ & 980|515\nQuadro P3200 with Max-Q Design|513\n$ % 2070 with Max-Q Design|513\n$ % 3050 Ti Laptop GPU|510\nQuadro % 3000 Mobile / Max-Q|509\n$ & 1660 SUPER|508\nQuadro % 4000|508\n$ & 1060|506\n$ % 2080 with Max-Q Design|505\n$ & 1080 Ti|505\n$ & 1660 Ti Rev. A|504\n$ & 1660 Ti Mobile|504\n$ % 3050 Laptop GPU|503\n$ % 2060|503\nQuadro % 4000 with Max-Q Design|500\nEIZO MED-XN83|499\n$ & 970|499\n$ & 1080|495\n$ & 1070 Ti|492\n$ & 980|491\nA100-PCIE-40GB|489\n$ & 1070|487\n$ & 1660 Ti|487\nQuadro P2200|485\n$ & TITAN Black|484\nTITAN Xp COLLECTORS EDITION|483\nTITAN %|482\nQuadro P5200|482\n$ & 1060 with Max-Q Design|480\n% A1000 Laptop GPU|479\n$ & 1060 6GB|479\nQuadro % 5000|475\nTITAN V|475\nGRID P100-4Q|474\nEVGA $ & 970|472\n$ & 1650 SUPER|471\n$ & 1650 Ti|470\nQuadro % 3000|470\nQuadro M5000|469\nQuadro % 3000 with Max-Q Design|468\n$ & 980 Ti|467\n$ & TITAN|467\nQuadro P4200|466\n$ & 1070 with Max-Q Design|466\nQuadro M5000|466\n$ & 1080 Ti|466\nTesla M60|462\n$ & 1660|457\n$ & 1660|455\n$ % 2050|453\n$ & 1060|453\n$ % 2060 with Max-Q Design|453\nQuadro P3200 with Max-Q Design|452\nQuadro P4000|450\n$ & 1060 3GB|449\n$ & 1070|448\n$ & 1060 6GB Rev. 2|447\nGigabyte $ & 780 Ti|447\nTITAN Xp|444\n$ & 980M|440\nA10-4Q|439\n$ & 1080 with Max-Q Design|437\n$ & 1650 SUPER|435\nQuadro P5000|435\nQuadro P3000|434\n% A6000|434\n$ & 1060 3GB|433\n$ & 1070 Ti|432\n$ & 780|432\n$ & 1060 Mobile|432\nGigabyte $ & 970|431\n$ & TITAN Z|431\nQuadro K6000|429\n$ & 1650|425\n$ & 970|421\nTesla K20m|420\nQuadro GV100|419\nQuadro P4000|419\nQuadro P3200|417\n& 1060 HL|415\n% A2000 Laptop GPU|415\n$ & 780 by St3Phl3|414\nP102-100|412\nT1200 Laptop GPU|412\n$ & 780 Ti|411\n$ & 1060 6GB|408\n$ & 1650 Ti with Max-Q Design|407\nQuadro T2000 with Max-Q Design|407\nQuadro P2000|406\nQuadro P2200|406\n$ % 2060 Max-Q|405\n$ & 1650 Ti Mobile|403\n$ & 1060 Mobile 6GB|403\n$ & 1060 with Max-Q Design|401\n$ & 980|398\n$ % 2070 Rev. A|397\n$ & TITAN X|397\nTesla T4|395\nQuadro P6000|394\n$ & 1060 3GB|394\nQuadro M5000|393\n$ & 1060 with Max-Q Design|392\nPNY $ & 970|392\nQuadro T2000|391\nQuadro T1000 with Max-Q Design|391\nGRID P40-8Q|390\n$ & 780 Rev. 2|389\nQuadro GP100|387\n$ & 980|387\nP104-100|387\n$ & 1650 Ti|386\nGRID P40-4Q|384\n$ & 780 Ti|383\nDevice|383\nTU117M|381\nQuadro P2000|380\nQuadro % 6000|379\n$ & 1070 Mobile|378\nQuadro T1000|377\n$ % 3070 Mobile / Max-Q|376\n$ & 1060|376\nGRID V100-1Q|375\n$ & 780 Rev. 2|372\n$ % 2050|370\n$ & 770|370\n$ & 970|368\n$ & 1650 Ti|368\nGRID T4-2B4|368\nAsus $ & 780|366\nP106-100|365\nQuadro % 8000|365\n$ & TITAN Black|365\nGRID RTX6000-2Q|365\n$ & TITAN Black|363\nQuadro M4000|363\n$ & 1060 6GB|362\nQuadro P5000|361\n$ & 1650|361\nQuadro M5500|361\n$ & 780|360\n$ & 780|360\n$ & 980M|358\n$ & 1650|358\n$ & 1050 Ti|357\nQuadro P3200 Mobile|357\n$ & 1650 with Max-Q Design|356\nTesla T4|356\nQuadro P2000|356\n$ & TITAN|355\n$ & 970|355\n$ & 980 Ti|354\n$ & 1660 Ti with Max-Q Design|354\n$ & 780 Rev. 2|352\nGRID P4-4Q|351\n$ & TITAN X|351\nT1200 Laptop GPU|350\nGRID T4-8Q|350\n$ & 1060|349\n$ & 1050 Ti with Max-Q Design|348\n$ & 970M|346\nT1000 8GB|346\n$ % 3080 Mobile / Max-Q 8GB/16GB|346\n$ & 780 Ti|346\n$ & 680|346\n$ & 1660 Ti|345\n$ & 780|345\nQuadro M6000|344\nGRID T4-16Q|344\n$ % 2080 Ti|344\nGRID T4-1B|343\nQuadro K5200|342\nQuadro P2200|341\nT1000 8GB|341\nTesla K80|341\nQuadro T2000 Mobile / Max-Q|338\nTU107|337\n$ & 780 Mac|336\n$ & TITAN|336\n$ & 980M|335\nGRID P40-2Q|335\nEVGA $ & 780|334\n$ & TITAN Z|334\nTITAN X (Pascal)|332\n$ & 960|331\nTesla P40|331\n$ & 1650 Ti with Max-Q Design|330\nTesla P40|330\n$ & 1060se 3GB|329\n$ & 1650 Mobile / Max-Q|329\nQuadro T2000 with Max-Q Design|328\nT1000|327\n% A5500|326\nA40-8Q|326\n$ % 3060 Mobile / Max-Q|326\n$ & 690|326\nTesla V100-SXM2-16GB|326\nQuadro M5000|325\nA16-2B|323\n$ & 1050 Ti with Max-Q Design|321\n$ & 1050 Ti Mobile|321\n$ & 980M|319\nQuadro M3000M|318\n$ & 1650 with Max-Q Design|318\n$ & 670|316\nQuadro P3000|316\nT600 Laptop GPU|315\nQuadro T1000 with Max-Q Design|313\nTesla K80|312\nTesla K20m|311\n$ & 770|311\nTesla P100-PCIE-16GB|311\nQuadro M5000M|311\nTesla K80|309\nEVGA $ & 1070|309\nQuadro T1000|309\n$ & 1050 Ti|309\n$ & TITAN Z|308\nQuadro T2000|308\nQuadro M6000 24GB|308\n$ & 760 Ti|308\n$ % 2080 SUPER Mobile / Max-Q|308\n$ & 1050 Ti|307\nQuadro P2000|304\nQuadro P6000|304\n$ & 770 Mac Edition|303\nMSi $ & 1050 Ti|303\nA40|303\nT600|303\nP106-090|302\nP106-090|301\nQuadro K5200|300\n$ & 770|299\n$ & 680|299\n$ & TITAN|299\n$ & 680|297\nGRID M60-4Q|296\nQuadro M4000|296\nGRID M60-2Q|295\n$ & 760|294\nGRID V100DX-16Q|293\nQuadro % 6000/8000|293\n$ & 770|293\nGP104|292\n$ & 780 Rev. 2|290\n$ & 1050 Ti|288\n$ & 950|288\nEVGA $ & 1050 Ti|288\n$ & 1650 with Max-Q Design|286\n$ & 880M|285\n%NVIDIA_DEV.13D7.0580.1028%|283\nGP104GL|283\nGigabyte $ & 960|282\nQuadro K5200|281\n$ & 660 Ti|281\n$ & 670|281\nQuadro M4000|280\n$ & 580|280\nMSi $ & 960|280\nTesla M6|278\nPNY $ & 680|278\nT500|277\n$ & 1050|276\n$ & 1050 Ti with Max-Q Design|276\n$ & 690|276\n$ & 680|276\n$ & 670|275\n$ & 760 Ti|274\n$ & 1050 3GB|272\n$ & 880M|272\nTesla M60|272\nAsus $ & 960|271\nQuadro M4000|269\nT600|268\nTesla K20m|268\n$ & 760|268\nGP102 [TITAN Xp]|267\n$ & 960|267\n$ & 670|265\nQuadro T1000 Mobile|265\n$ & 1050|264\nTesla M60|264\nEVGA $ & 1080 Ti|263\n$ & 970M|263\n$ & 780M|262\n$ & 690|262\nAsus $ & 770|261\n$ & 1070 with MaxQ Design|261\nEVGA $ & 960|261\n$ & 960|260\nGRID T4-2Q|259\n$ & 970M|259\n$ & 960|259\nQuadro M3000M|258\n$ & 1060se 3GB|257\nTesla K10|257\nQuadro M3000M|257\nQuadro M2200|256\n$ & 690|255\n$ & 760|254\n$ & 880M|254\nQuadro K4200|253\nQuadro P2000 with Max-Q Design|253\nT550 Laptop GPU|253\nQuadro K5200|252\nMSI $ & 760|250\n$ & 580|249\n$ & 780M Mac Edition|249\n$ & 570|249\nTesla V100-PCIE-16GB|248\n$ GTX880M|248\n$ & 760|247\n$ & 570 Rev. 2|247\nAsus $ & 670|246\n$ & 580|246\n$ & 1050|245\nTesla P4|244\n$ & 680MX|244\n$ & 480|242\n$ & 1050|242\nQuadro 7000|241\nQuadro M4000M|241\n$ & 1050 Mobile|240\n$ & 660|240\n$ & 760 (192-bit)|239\nQuadro K5000|239\n$ & 760 OEM|238\n$ & 660 Ti|238\n$ & 775M Mac Edition|238\n$ & 965M|237\n$ & 870M|236\n$ & 950|236\n$ & 560 Ti 448 Cores|236\n$ & 780M|236\nQuadro P2000 with Max-Q Design|234\nMSI $ & 980 TI|234\nGRID K2|233\n$ & 1060 6GB OpenGL Engine|233\nPNY $ & 1060|233\nEVGA $ & 980|232\nGRID RTX6000P-6Q|232\n$ & 950|232\n$ & 950|232\n$ & 590|231\n$ & 1070 OpenGL Engine|231\nTITAN X (Pascal)|229\n$ & 1050 with Max-Q Design|229\n$ & TITAN Black|228\nQuadro K4200|227\n$ & 660 OEM|227\n$ MX450|225\n$ & 1050 with Max-Q Design|225\nQuadro P1000|225\nGraphics Device|225\nQuadro M2000|222\n$ & 1630|222\nQuadro M4000M|221\nQuadro K5100M|221\nEVGA $ & 760|221\n$ & 1070 Ti|221\n$ & 660 Ti|220\n$ & 570|220\n$ & 660 Ti|219\nQuadro K6000|219\n$ & 570 Rev. 2|219\n$ & 1050 with Max-Q Design|219\nTesla M40|218\n$ & 680M|217\n$ & 780M by Nick[D]vB|217\nAsus $ & 980 TI|217\n$ & 1060 3GB|217\nGraphics Device|217\n$ & 570 Rev. 2|216\n$ & 1060 3GB OpenGL Engine|216\n$ & 660|215\nPoint of View $ & 660 Ti|214\nGigabyte $ & 980|214\nQuadro K5000|213\nQuadro P1000|213\n$ & 480|213\n$ MX450|212\nQuadro K4200|211\nGRID K280Q|211\nAsus $ & 760|210\nQuadro P1000|210\n$ & 680MX|209\n$ & 1060 6GB|209\n$ & 660|209\n$ & 750 Ti|208\n$ & 780M Mac Edition|208\n$ & 775M Mac Edition|208\nGRID K520|208\nQuadro M2200|207\nGRID M60-8Q|207\nGRID K2|207\n$ & 775M Mac Edition|206\n$ & 560 Ti 448 Cores|205\n$ & 760 (192-bit)|205\nQuadro K5000|205\nGigabyte $ & 980 TI|204\n$ & 780M Mac Edition|204\nAsus $ & 660|204\nGRID M60-1B|202\n$ & 650 Ti BOOST|202\n$ & 480|202\n$ & 960M|201\n$ & 660 OEM|201\n$ & 780 Ti|201\nQuadro K5000|201\n$ & 780M Mac Edition|201\n$ & 870M|200\n$ & 680MX|200\n$ & 680MX|199\nQuadro P1000|198\nTesla P100 PCIe 16GB|198\nQuadro K5100M|198\n$ & 470|198\nQuadro P620|197\nAsus $ & 780|197\nQuadro 6000|196\nQuadro M1200|195\nQuadro K2200|195\n$ & 590|195\nQuadro M2000M|194\nQuadro M4000 OpenGL Engine|194\n$ & 870M|194\n$ & 1070|194\nEVGA $ & 750 Ti|194\nZotac $ & 680|193\nQuadro % 3000 with Max-Q Design|193\nT400|193\nQuadro M2200|193\nQuadro K4100M by nikey22|192\nGRID K2|192\n& 865M by iMacGFX|191\nQuadro M2000|191\n$ & 980M|190\n$ & 560 Ti|190\nPalit $ & 660|190\nGRID K260Q|189\nGRID M10-2Q|189\n$ & 660|189\n$ & 965M|189\n$ & 650 Ti BOOST|188\n$ & 675MX Mac Edition|188\nQuadro K5100M by nikey22|187\n$ & 680M|187\nZotac $ & 660|186\n$ & 650 Ti BOOST|186\n$ & 760 (192-bit)|185\nGRID M60-1Q|184\nGigabyte $ & 960|184\nQuadro M2000M Special Edition|184\n$ & 560 Ti|184\nInno3D $ GTX660|183\n$ & 1060|183\n$ & 675MX Mac Edition|182\nQuadro P600|181\n$ & 1080|181\n$ & 675MX Mac Edition|181\nQuadro P620|180\nGK104 Board - 20530501|180\nAshley|180\nQuadro M2000|179\n$ & 860M|179\nMSi $ & 1050 Ti|179\nAsus $ & 750 Ti|178\n$ & 750 Ti|178\n$ & 750 Ti|177\nEVGA $ & 980 TI|177\nAsus $ & 770|177\n$ & 760 OEM|176\n$ & 750|176\nQuadro P2000 Mobile|176\nQuadro K4100M|175\nT400 4GB|174\n$ & 1080 Ti OpenGL Engine|174\nQuadro K5000M|173\n$ & 960A|173\n$ & 560 Ti|172\nTesla M10|172\n$ & 1080 Ti|172\nGRID RTX6000P-6|172\nGK104 Board - 2051b502|172\n$ & 770M|172\n$ & 960M|172\n$ & 970|172\nGRID M10-2Q|171\n$ & 560 Ti OEM|171\nMSi $ & 970|171\nGK104GL [GRID K2]|171\n$ & 470|170\n$ & 560 Ti|170\nTITAN Xp|170\n$ & 870M|170\n$ MX350|169\nMSi $ & 580|169\n$ & 960M|169\nEVGA $ & 760|169\nQuadro K4000M|169\nT400|169\n$ MX350|168\n$ & 470|168\n$ & 560|167\nQuadro 6000|167\n$ & 1050 Ti OpenGL Engine|167\nQuadro M1200|167\nGigabyte $ & 970|166\n$ GT 1030|166\n$ GTX780M by nikey22|166\n$ GTX870M by nikey22|166\nTesla V100-PCIE-32GB|165\nQuadro K2200|165\nQuadro M1000M|165\nQuadro K2200|165\nAsus $ & 970|164\n$ & 750 Ti|164\nQuadro M2000M|164\n$ & 1050|164\n$ & 1050 Ti|163\nQuadro K5000|163\nGraphics Device|162\n$ MX250|162\nT500|161\nEVGA $ & 570|161\nQuadro M2000M|161\nQuadro K1200|159\n$ & 860M|159\n$ & 770M|159\nQuadro M1200|158\n$ & 675MX|158\n$ MX330|158\nQuadro K2200M|157\nQuadro K4000|157\n$ & 690|157\n$ & 860M|157\nMSi $ & 670|156\nQuadro K2200|156\nQuadro K4100M|156\n$ & 770M by Nick[D]vB|155\nTesla V100-SXM2-32GB|155\n$ & 1080 OpenGL Engine|155\nGigabyte $ & 670|155\nEVGA $ & 960|155\n$ & 750|155\n$ Pre-Release TITAN X (Pascal) OpenGL Engine|154\n$ & TITAN Xp|154\nAsus $ & 950|154\nQuadro K4100M|153\n$ & 960|153\n$ & 770M|153\n$ MX330|153\nQuadro M2200 Mobile|153\n$ MX250|153\n$ Pre-Release TITAN Xp OpenGL Engine|153\nQuadro P600|153\nQuadro M620|152\n$ & 1070 Ti OpenGL Engine|152\n$ & 770|152\n$ GT 1030|152\nTesla C2070|152\n$ & 650 Ti|152\nGRID K240Q|151\n$ & 480 OpenGL Engine|151\n$ & 750|151\n$ & TITAN|151\n$ & 760 (192-bit)|151\n$ & 560|151\n$ GT 1030|151\nQuadro K5000M|151\nQuadro P1000 Mobile|151\nZotac $ & 660|151\n$ & 460 v2|150\nGRID & P40-6|150\nMSi $ & 660|149\n$ & 780M|149\nMSI $ & 760|149\nP106-090|149\n$ & 950A|149\n$ MX150|149\nAsus $ & 1060|149\nUnknown|149\n$ & 980 Ti|148\nGRID T4-4Q|148\n$ & 465|147\nColorful $ & 960|147\nGigabyte $ & 750|147\nQuadro M1000M|147\n$ & 780 Mac|147\n$ & 460|146\nMSi $ & 960|146\n$ & 560|146\nQuadro K4000|145\n$ & 970M|145\nQuadro M1000M|145\nUnknown|145\n$ & 980|144\n$ & 950|144\n$ & 675M|144\nZotac $ & 960|144\n$ Pre-Release Graphics Device|144\n$ & 670 OpenGL Engine|143\nQuadro K4000|143\nEVGA $ & 580|143\n$ & 950M|143\n$ & TITAN Black OpenGL Engine|142\n$ & 760|142\nQuadro 5000|142\nMSI $ & 570 HD|142\n$ Pre-Release TITAN Xp COLLECTORS EDITION OpenGL E|142\n$ & 1050 OpenGL Engine|142\n$ & TITAN X|142\n$ & 880M|141\nGV-N660OC-2GD|141\n$ & 750|141\nQuadro M5000M|140\n$ & 970 OpenGL Engine|140\n$ & 675MX|140\nAsus $ & 760|140\nQuadro P5000 OpenGL Engine|139\n$ & 580|139\n$ & 675MX|139\nZotac $ & 750|139\nQuadro K1200|139\n$ MX150|139\n$ & 650 Ti|139\nQuadro K1200|139\n$ & 980 Ti OpenGL Engine|139\n$ & 580M|138\nAsus $ & 580|138\n$ & 770 OpenGL Engine|138\n$ GT 1010|138\n$ & 780 Rev. 2|138\nQuadro P2000 OpenGL Engine|138\n$ MX250|138\nQuadro K4000|137\n$ & 460 v2|137\n$ & 770M|137\nGigabyte $ & 570 HD|136\n$ & 465|136\n$ & 460 v2|136\n$ & 670|136\n$ & 590 OpenGL Engine|136\n$ & 780|135\n$ & TITAN Black|135\n$ & 660 Ti|135\nZotac $ & 560 Ti|134\n$ & 880M OpenGL Engine|134\n$ & 650 Ti|134\n$ & 760 OpenGL Engine|134\nnull Graphics Device|134\nQuadro M620|133\n$ & 780M Mac Edition|133\n$ MX150|132\nAsus $ & 570 HD|132\n$ & 775M OpenGL Engine|132\n$ & 850M|132\nAsus $ & 570|132\nQuadro K6000 OpenGL Engine|131\n$ & 850M|131\n$ & 460|131\n$ & 950A|130\n$ & 780M OpenGL Engine|130\nPoint of View $ & 660 Ti|130\n$ & 775M Mac Edition|130\nEVGA $ & 650 Ti|130\nEVGA $ & 750 Ti|129\n$ & 460|129\nQuadro P520|129\nGainward $ & 570|129\nAsus $ & 750 Ti|129\nQuadro K3100M|128\nQuadro K2200|128\nAsus $ & 560 Ti|127\n$ & 680|127\n$ & 680 OpenGL Engine|127\n$ & 950M|127\nGRID V100-2B|127\nGigabyte $ & 660 Ti|127\nN15E-GT|126\nQuadro K1200|126\n$ & 650 Ti|126\nGigabyte $ & 770|126\n$ & 660|126\nQuadro 5000|125\n$ GT 1030|125\n$ & 950M|125\n$ & 765M|125\nQuadro M5000|125\nGigabyte $ & 560 Ti|125\n$ & 580M|125\nQuadro M2000|124\n$ & 850M|124\n$ & 570 OpenGL Engine|123\nGainward $ & 750 Ti|123\nQuadro K2200M|123\n$ & 780M Mac Edition|123\n$ & 680MX OpenGL Engine|123\nQuadro K4200|123\n$ & 460 OEM|122\n$ & 670MX|122\nMSi $ & 560 Ti|122\n$ & 460 SE|122\nQuadro M4000|122\n$ GTX880M OpenGL Engine|122\nQuadro P620|121\n$ & 560 SE|121\n$ GTX880M by nikey22|121\n$ & 555|121\n$ & 965M OpenGL Engine|121\n$ & 850A|121\nQuadro K5000 OpenGL Engine|120\n$ & 580 OpenGL Engine|120\nQuadro K3100M|120\n$ & 650 Ti BOOST|119\n$ & 570M|119\n$ & 675MX OpenGL Engine|119\n$ & 775M Mac Edition|119\nZotac $ & 1050 Ti|118\n$ & 965M|117\nQuadro M600M|117\n$ & 780M by Nick[D]vB|117\n$ & 460 SE|117\n$ & 555|116\n$ & 670M|116\nQuadro K3000M|116\n$ & 780 Ti OpenGL Engine|116\nQuadro K4000M|115\n$ & 860M|115\nAsus $ & 660|115\nTesla C2075|114\n$ & 675MX Mac Edition|114\nZotac $ & 770|114\nGigabyte $ & 750 Ti|114\n$ MX330|114\n$ GT 1030|113\n$ & TITAN OpenGL Engine|113\n$ & 590|113\nQuadro K620|113\n$ & 780M|112\n$ & 560 Ti|112\nQuadro 6000|112\nEVGA $ & 560 Ti|112\nAsus $ & 960|112\nQuadro K5000|112\nPoint of View $ & 470|111\nPNY $ & 580|111\n$ & 770M|111\n$ GT 120|111\nMSi $ & 660|111\nGigabyte $ & 560|111\n$ & 680MX|110\n$ 945M|110\n$ & 765M|110\n$ & 950 OpenGL Engine|110\n$ Pre-Release Tesla C2075 OpenGL Engine|109\n$ & 550 Ti|109\n$ & 765M|108\nPNY $ & 750|108\n$ & 560 Ti 448 Cores|108\nQuadro P500|108\n$ & 670MX|108\n$ & 680MX|107\n$ & 460 SE|107\n$ & 675MX Mac Edition|107\n$ & 770M OpenGL Engine|107\n$ 945M|107\n$ & 675MX|107\nPNY $ & 570 HD|106\n$ & 745|106\n$ MX230|106\n$ & 670MX|106\n$ 845M|106\nQuadro K3100M OpenGL Engine|105\nQuadro P2000|105\n$ MX570 A|105\n$ & 750 Ti|104\n$ & 660 OEM|104\nQuadro M600M|104\n$ & 750|104\n$ & 645|104\nGP108|104\nQuadro P520|104\nZotac $ & 460|103\nChip Model|103\n$ & 670M|103\nQuadro T1000|103\n$ & 670M|103\n$ & 650|103\nZotac $ & 750|102\n$ & 460 OpenGL Engine|102\n$ & 860M OpenGL Engine|102\nQuadro 4000|102\nAsus $ & 480|102\nZotac $ & 650 Ti|102\n$ GT 755M|101\nGF100 Board - 10220000|101\n$ & 470M|101\n$ & 570 Rev. 2|101\n$ & 775M by iDopt Mac|101\n$ & 765M by Nick[D]vB|101\n$ & 570|101\n$ & 645|101\n$ & 550 Ti|100\n$ & 760M|100\n$ GT 1030 OpenGL Engine|100\n$ & 650|100\nQuadro P400|100\n$ & 480|99\nEVGA $ & 650|99\nEVGA $ & 560|99\n$ MX130|99\n$ MX130|98\nAsus $ & 460|98\nElitegroup $ & 460|98\nTesla V100-SXM2-32GB|98\n$ GT 755M|98\n$ & 760 Ti OpenGL Engine|98\nQuadro P520|97\n$ GT 755M Mac Edition|97\n$ & 1060 5GB|97\nPalit $ & 650 Ti|97\nMSi $ & 460|96\n$ & 650|96\nGigabyte $ & 580|96\nGigabyte $ & 460|96\n$ & 745|96\nEVGA $ & 550 Ti|96\n$ & 465|96\n$ & 460 SE|96\n$ & 765M|96\n$ GT 755M Mac Edition|96\nQuadro M520|95\nQuadro K620|95\nT1000|95\n$ & 745|95\nQuadro K620|95\n$ GT 755M|94\n$ & 660 Ti OpenGL Engine|94\nQuadro K3000M|94\nQuadro K4000|94\nQuadro K4000 OpenGL Engine|94\n$ & 560|94\n$ & 650 Ti OpenGL Engine|94\nZotac $ & 560|94\nAsus $ & 560|93\n$ & 650 Ti|93\n$ GPU|92\n$ & 460|92\nMSi $ & 650 Ti|92\n$ & 645|92\nGigabyte $ & 760|92\n$ & 660M|92\n$ GTS 450|92\n$ & 765M|92\nQuadro K2000D|92\nQuadro K2000|91\n$ GT 740|91\n$ & 650|91\nGRID M6-0B|91\nHP Quadro K620|91\n$ MX130|91\nQuadro K3000M by ST3PHL3|91\nQuadro 4000|90\n$ MX230|90\nQuadro K620|90\nQuadro K2100M by Nick[D]vB|90\nQuadro K3000M by nikey22|89\n$ GT 650M OpenGL Engine|89\nQuadro 4000|89\nQuadro K3000M|88\n$ & 660M|88\nQuadro K6000|87\n$ GT 755M Mac Edition|87\nPalit $ & 650|87\nQuadro P500|87\n$ & 570M|86\nGainward $ & 460|86\n$ & 950M|86\nQuadro K2000D|86\n$ & 650 Ti BOOST|86\nQuadro K2100M|86\n$ & 470|85\nQuadro K2000|85\nQuadro K2000|85\n$ GT 750M Mac Edition|85\n$ & 745|85\nGRID K220Q|85\n$ & 750 OpenGL Engine|85\nQuadro 5000M|84\nQuadro P400|84\n$ GTS 450|84\n$ GT 640 Rev. 2|84\n$ & 660M Mac Edition|84\nQuadro P400|84\nAsus $ & 560 SE|84\nPNY $ & 460|83\n$ GT 640 Rev. 2|83\n$ GTS 450 Rev. 2|83\n$ GTS 450|83\n$ GTS 450 Rev. 2|83\n$ & 645|82\n$ GPU|82\n$ & 560M|82\nQuadro K3000M|82\nQuadro K2100M by nikey22|82\nGigabyte $ & 750|82\n$ GT 740|82\n$ GT 750M Mac Edition|82\n$ & 765M OpenGL Engine|82\n$ & 645 OpenGL Engine|82\nQuadro K620|81\n$ & 550 Ti OpenGL Engine|81\nQuadro 4000M|81\nPNY $ & 550 Ti|81\n$ MX110|80\n$ & 760M|80\nMSi $ & 745|80\nQuadro K2100M OpenGL Engine|80\nQuadro K2000|80\nQuadro 5000|80\nQuadro K620 OpenGL Engine|80\nMSi $ & 745|80\n$ GT 755M OpenGL Engine|80\n$ & 660M|79\nGigabyte $ & 550 Ti|79\nMSi $ & 650|79\n$ & 560M|79\nQuadro P400|78\nQuadro K2100M|78\nQuadro K2100M|78\nZotac $ & 1050 Ti|78\nQuadro 3000M|77\n$ 940A|77\n$ & 460M|77\n$ & 550 Ti|77\n$ GT 545|77\n$ GT 650M Mac Edition|77\n$ 940MX|76\n$ & 650 OEM|76\n$ & 550 Ti|76\n$ GT 755M Mac Edition|76\n$ GT 740 OpenGL Engine|75\nGainward $ & 550 Ti|75\nQuadro K1200|75\n$ GT 650M Mac Edition|75\nEVGA $ & 650|75\n$ GT 750M Mac Edition|74\n$ & 745|73\n$ & 555|73\n$ & 650|73\nGainward $ GTS 450|73\n$ GT 650M|73\n$ GT 755M Mac Edition|73\n$ & 460M|72\n$ 930A|72\n$ 930MX|72\n$ 940MX|72\n$ MX110|72\n$ GT 750M Mac Edition|72\nQuadro 2000|72\n$ 845M|71\nQuadro 2000D|71\n$ GT 640 Rev. 2|71\n$ MX110|71\n$ GT 1010|71\n$ GT 545|71\nQuadro K1200 OpenGL Engine|71\n$ 940MX|71\n$ & 650 OpenGL Engine|71\nEVGA $ & 650 Ti BOOST|71\nQuadro K2100M|70\n$ GT 1010|70\nQuadro M500M|70\n$ GT 650M Mac Edition|70\n$ GT 640 OEM|70\nQuadro K2000D|70\nQuadro K2000 OpenGL Engine|70\n$ GT 750M Mac Edition|70\n$ GT 650M|69\nQuadro K1100M by Nick[D]vB|69\n$ GT 650M|69\n$ 940M|69\n$ GT 650M|69\nQuadro 4000|69\n$ GT 650M Mac Edition|69\n$ GT 745M|69\nGainward $ & 560 Ti|68\n$ 920MX|68\nQuadro M520|68\n$ GT 640|68\n$ 840M|68\n$ 9800 & / 9800 &+|68\n$ & 770M by Nick[D]vB|67\nZotac $ & 650|67\nAsus $ & 550 Ti|67\n$ GT 750M|67\nQuadro K3100M by nikey22|67\n$ GT 750M|67\n$ & 760 (192-bit) OpenGL Engine|67\nHP Quadro 4000|67\nQuadro K2000|67\n$ GTS 450 Rev. 2|67\n$ 930MX|67\n$ & 660M Mac Edition|66\n$ & 570|66\n$ GT 750M|66\n$ GT 650M Mac Edition|66\n$ GT 650M OpenGL Engine|65\n$ & 660M OpenGL Engine|65\n$ 930M|65\nPalit $ & 650|65\n$ & 760M|65\n$ GT 650M Mac Edition|65\n$ 940M|65\n$ GT 750M Mac Edition|64\n$ 940M|64\n$ GT 740|63\n$ 930MX|63\nQuadro 3000M|63\n$ GT 730|63\nQuadro K1100M|63\n$ GT 750M|63\n$ 840M|63\n$ GT 640 OEM|63\n$ 840M|63\n$ GT 640 Rev. 2|62\n$ GTS 450|62\nQuadro 2000|62\n$ GT 745M|62\n$ GT 740|62\n$ GT 640|62\nQuadro 2000|62\n$ & 660M Mac Edition|62\nQuadro K1100M OpenGL Engine|62\nQuadro K2000M|62\n$ & 680MX OpenGL Engine|61\nEVGA $ GT 730|61\nQuadro 2000D|61\n$ 840A|61\nMSi $ & 660 Ti|61\nQuadro K1100M|61\n$ GT 645M|61\n$ & 780M OpenGL Engine|61\nHP $ GT 730|61\nQuadro K5000M OpenGL Engine|61\nEVGA $ GT 640|61\n$ 920MX|60\nQuadro M500M|60\nQuadro K620M|60\n$ 930M|60\n$ 930A|60\n$ GT 640 OEM|60\n$ GT 640|60\nQuadro 2000M|60\n$ GT 640|60\n$ GT 640M Mac Edition|60\n$ GT 640M Mac Edition|60\n$ GT 640M Mac Edition|59\n$ GT 645M|59\n$ 930M|59\nGigabyte $ & 650 Ti|59\n$ GT 640 OEM|59\n$ 830M|59\nAsus $ GT 640|58\nMSI $ & 1070|58\n$ GT 555M|58\nQuadro K2000M|58\nQuadro K1100M|57\n$ GT 650M Mac Edition|57\nQuadro K2000M by Nick[D]vB|57\nEVGA $ & 650 Ti|57\n$ GT 640M|56\n$ GT 650M Mac Edition|56\n$ GT 445M|56\n$ 830A|56\n$ 9800 GT|56\nAsus $ GTS 450|55\n$ 830M|55\n$ 920MX|55\nQuadro 2000|55\nEVGA $ GT 545|54\nQuadro K2000M|54\n$ GT 650M Mac Edition|54\n$ & 280|54\n$ GT 640|53\nQuadro FX 2800M|53\nQuadro 3000M OpenGL Engine|53\n$ GT 740|53\nnull $ 920A|53\n$ GT 640M Mac Edition|52\n$ GT 635|52\nGraphics Device|52\n$ GT 640M|52\n$ & 660M Mac Edition|52\nQuadro 2000M|52\nQuadro 5010M|52\n$ GTS 250|52\n$ GT 445M|51\n$ GT 640M OpenGL Engine|51\n$ GT 640M|50\nEVGA $ GT 740|50\n$ GT 640M Mac Edition|50\n$ 730A|50\n$ 920M|49\nHP Quadro 2000|49\n$ GT 730M|49\nnull $ 920A|49\n$ GT 555M|49\n$ GT 640M LE|49\n$ GT 730M|49\n$ GT 730M|48\n$ GT 640M Mac Edition|48\nQuadro K2000M OpenGL Engine|48\n$ GT 640M LE|48\n$ GT 740M|47\n$ & 460M|47\n$ GT 440|47\n$ GT 440|46\n$ GT 640M Mac Edition|46\nQuadro P400|46\n$ GT 730|46\nDell Quadro 2000M|45\n$ GT 740M|45\n$ GT 740M|45\n$ GTS 450 Rev. 2|45\n$ 920M|45\n$ 920M|45\n$ 910M|44\n$ & 680M|44\n$ GT 730|44\nQuadro 2000M|44\n$ GT 635|43\n$ GT 720 OpenGL Engine|43\n$ GT 635|43\nQuadro K5200 OpenGL Engine|43\nZotac $ & 650|43\n$ GT 440|43\n$ GT 435M|42\n$ GT 735M|42\nGainward $ GT 630|42\nQuadro 1000M|42\n$ 820M|41\n$ & 680M OpenGL Engine|41\nMSI $ GT 635|41\n$ 820A|41\nTesla M10|41\nAsus $ GT 440|40\nAsus $ GT 630|40\n$ GT 820M|40\n$ 910M|40\n$ GT 820M|40\n$ GT 730|40\n$ GT 550M|40\n$ GT 430|40\n$ GT 540M|39\nAsus $ GT 720|39\n$ GT 630|39\n$ GT 530|39\n$ GT 635M|39\n$ GT 620M/630M/635M/640M LE|39\nNVS 5400M|39\nQuadro K600|39\nQuadro K610M|39\nAsus $ GT 730|39\n$ GT 630|39\n$ GT 440|39\n$ GT 630M|38\n$ 820M|38\nQuadro K420|38\nQuadro K610M|38\n$ GT 625M|38\nQuadro K1000M|38\nNVS 5200M|38\nGRID K1|38\nQuadro K600|38\nQuadro K420|38\n$ GT 630|38\nQuadro K600|37\nQuadro 600|37\nHP Quadro 600|37\nQuadro K1000M|37\nQuadro K610M|37\nGRID K180Q|37\nGRID K160Q|37\n$ GT 635M|37\nGigabyte $ GT 440|37\n$ 820M|37\n$ GT 530|37\n$ GT 540M|37\n$ GT 630 OEM|37\nQuadro K610M by Nick[D]vB|37\nNVS 510|37\n$ GT 630M|37\nQuadro 1000M|37\n$ GT 540M|37\n$ GT 530|37\nQuadro K1100M|37\nQuadro K620M|37\nQuadro 1000M|36\n$ GT 730|36\n$ 820M|36\n$ GT 430|36\nGRID K1|36\n$ GT 525M|36\nNVS 5200M|36\nNVS 510|36\nZotac $ GT 430|36\nQuadro K600|36\nAsus $ GT 730|36\nHP Quadro K4000|35\n$ GT 755M Mac Edition|35\n$ GT 630|35\nNVS 5400M|35\nNVS 5400M|35\n$ GT 640 OpenGL Engine|35\n$ GT 625M|35\n$ GT 630|35\n$ GT 430|35\nQuadro K600 OpenGL Engine|35\nQuadro K1000M|35\nZotac $ GT 630|35\nGigabyte $ GT 630|35\nGRID K140Q vGPU|35\n$ GT 710M|35\n$ GT 620M|35\n$ GT 720M|34\n$ 710M|34\nQuadro 1000M,|34\nQuadro K510M|34\n$ 9400 GT|34\nQuadro K1000M|34\n$ GT 635M|34\nQuadro K420|34\nGRID K180Q|34\nAsus $ GT 430|34\nQuadro K4100M|34\nGigabyte $ GT 730|34\n$ GT 620M|34\n$ GT 525M|34\nQuadro K420|34\nDell NVS 5200M|34\n$ 710A|34\n$ GT 425M|33\n$ GT 710B|33\n$ GT 525M|33\nQuadro 600|33\n$ GT 620M|33\nQuadro K600|33\nQuadro 600|33\n$ 610M/710M/810M/820M / GT 620M/625M/630M/720M|33\nMSI $ GT 730|33\n$ GT 710|33\n$ GT 435M|33\nNVS 510|33\nAsus $ GT 710|33\nNVS 510|32\n$ 710M|32\n$ GT 720M|32\n$ GT 730A|32\n$ GT 710M|32\nGIGABYTE $ & 660|31\nEVGA $ GT 710|31\n$ GT 710|31\n$ GT 710|31\n$ GT 425M|31\n$ GT 720|31\nEVGA $ GT 710|31\nQuadro K1000M by Nick[D]vB|31\nAsus $ GT 710|31\n$ GT 720|31\n$ GT 420M|30\n$ GT 710|30\nnull Graphics Device|30\n$ GT 240|30\n$ 810M|29\n$ GT 720M|29\n$ GT 710|29\nQuadro 600|29\n$ 810M|29\n$ GT 420M|28\nQuadro 410|28\n$ & 660M|28\nMSI $ GT 710|28\n$ GT 720|28\n$ GT 735M|27\n$ GT 720|27\n$ GT 720|27\n$ GT 630 OpenGL Engine|27\nQuadro 410|27\n$ GT 330M|26\n$ GT 420M|26\n$ GT 430|26\n$ 615|25\n$ & 760A|25\nToshiba $ GT 525M|25\n$ GT 520MX|25\n$ GT 620|25\n$ GT 625|25\n$ GT 710|24\nQuadro NVS 4200M|24\n$ 840A|24\n$ 610M|24\n$ 800M|24\n$ GT 420|24\n$ 705M|23\n$ GT 705|23\n$ 800M|23\n$ 610M|23\n$ GT 620 OEM|23\n$ GT 625|23\n$ GT 420|23\nQuadro NVS 4200M|23\n$ GT 520M|22\nNVS 4200M|22\n$ GT 620 OEM|22\nNVS 5200M|22\n$ GT 620 OEM|22\n$ GT 620|22\n$ GT 705|21\n$ GT 620|21\n$ GT 630 Rev. 2|21\nQuadro NVS 4200M|21\n$ GT 520M|20\n& 980M SLI|20\n$ GT 620|20\n$ GT 520M|20\n$ GT 520|19\n$ 410M|19\n$ 730A|19\n$ GT 520|19\n$ GT 610|19\nAsus $ GT 610|19\nNVS 310|18\n$ 410M|18\nNVS 315|18\n$ 605|18\n$ GT 610|18\n$ GT 520|17\n$ MX550|17\nNVS 4200M|17\nNVS 315|17\nNVS 310|17\n$ 410M|17\nPalit $ & 660|17\n$ 605|17\nNVS 310|17\n$ GT 415M|17\nZotac $ GT 610|17\n$ & 675M|17\n$ GT 610|16\nQuadro 4000M|16\nPNY $ GT 610|16\n$ GT 610|16\n$ 510|15\nMSi $ GT 610|15\n$ GT 735M|15\n$ GT 520|15\n$ 510|15\n$ GT 320M|14\n$ 9600M GT|14\n$ & 570M|14\nCorporation D3D12 (NVIDIA $ % 3080 Ti)|13\n$ 510|13\nQuadro FX 1800M|12\nAsus $ GT 520|12\n$ GT 705|12\nMSi $ GT 630|11\nQuadro 3000M|10\nGigabyte $ GT 610|10\nPegatron $ GT 420|9\n$ 210|8\n$ 9300 / nForce 730i|7\nNVS 3100M|7\n$ 8600 GT|5\n$ 8400 GS Rev. 3|4\n$ 8400 GS|3\n$ 9600 GT|2\n$ GT 550M|-1\n$ 8600 GTS|-1\n$ GT 520MX|-1\nEVGA $ & 460|-1\nEVGA $ & 970|-1\nGP106|-1\nGRID P4-2B|-1\nGainward $ & 650|-1\n$ 210|-1\n$ 310|-1\n$ 310M|-1\n$ 315|-1\n$ 315M|-1\n$ 320M|-1\n$ 405|-1\n$ 610M|-1\n$ 820A|-1\n$ 8300 GS|-1\n$ 8400 GS|-1\n$ 8400 GS Rev. 2|-1\n$ 8400 GS Rev. 3|-1\n$ 8400M GS|-1\n$ 8400M GT|-1\n$ 8500 GT|-1\n$ 8600 GT|-1\n$ 8600M GS|-1\n$ 8600M GT|-1\n$ 8700M GT|-1\n$ 8800 GT|-1\n$ 8800 GTS|-1\n$ 8800 GTS 512|-1\n$ 8800 &|-1\n$ 8800M &|-1\n$ 9200M GE|-1\n$ 9200M GS|-1\n$ 9300 / nForce 730i|-1\n$ 9300 GE|-1\n$ 9300 GS|-1\n$ 9300M GS|-1\n$ 9400|-1\n$ 9400M|-1\n$ 9500 GT|-1\n$ 9500M GS|-1\n$ 9600 GS|-1\n$ 9600 GSO|-1\n$ 9600 GSO 512|-1\n$ 9600 GT|-1\n$ 9600M GS|-1\n$ 9600M GT|-1\n$ 9600M GT / $ GT 220M|-1\n$ 9800 GT|-1\n$ 9800 &+|-1\n$ 9800 &/9800 &+|-1\n$ 9800M GTS|-1\n$ G 103M|-1\n$ G 105M|-1\n$ G105M|-1\n$ G205M|-1\n$ G210|-1\n$ G210M|-1\n$ GT 120|-1\n$ GT 120M|-1\n$ GT 130|-1\n$ GT 130M|-1\n$ GT 220|-1\n$ GT 220M|-1\n$ GT 230|-1\n$ GT 230M|-1\n$ GT 240|-1\n$ GT 240M|-1\n$ GT 240M|-1\n$ GT 320|-1\n$ GT 320M|-1\n$ GT 325M|-1\n$ GT 330|-1\n$ GT 330M|-1\n$ GT 335M|-1\n$ GT 435M|-1\n$ GT 520M|-1\n$ GT 525M|-1\n$ GT 555M/635M|-1\n$ GTS 240|-1\n$ GTS 250|-1\n$ GTS 360M|-1\n$ & 1180|-1\n$ & 260|-1\n$ & 260M|-1\n$ & 275|-1\n$ & 280|-1\n$ & 285|-1\n$ & 295|-1\n$ & 560 SE|-1\n$ & 750 v2|-1\n$ % T10-16|-1\n$ % T10-8|-1\nGigabyte $ & 1050 Ti|-1\nION|-1\nMSI $ GT 710|-1\nNVS 300|-1\nNVS 3100M|-1\nNVS 4200M|-1\nNVS 5100M|-1\nPalit & 680 JetStream|-1\nQuadro FX 1700|-1\nQuadro FX 1700M|-1\nQuadro FX 1800|-1\nQuadro FX 1800M|-1\nQuadro FX 2700M|-1\nQuadro FX 2800M|-1\nQuadro FX 3600M|-1\nQuadro FX 360M|-1\nQuadro FX 370|-1\nQuadro FX 3700|-1\nQuadro FX 3700M|-1\nQuadro FX 380 LP|-1\nQuadro FX 3800|-1\nQuadro FX 3800M|-1\nQuadro FX 4600|-1\nQuadro FX 4800|-1\nQuadro FX 4800|-1\nQuadro FX 5600|-1\nQuadro FX 570M|-1\nQuadro FX 580|-1\nQuadro FX 770M|-1\nQuadro FX 880M|-1\nQuadro K1100M by Nick[D]vB|-1\nQuadro K2000D|-1\nQuadro K2000M|-1\nQuadro K2100M by Nick[D]vB|-1\nQuadro NVS 135M|-1\nQuadro NVS 140M|-1\nQuadro NVS 160M|-1\nQuadro NVS 290|-1\nQuadro NVS 295|-1\nQuadro NVS 4200M|-1\nQuadro P4000 OpenGL Engine|-1\nSony $ 410M|-1\nZotac $ & 780|-1\n",v="\n@ ^ 7900 XT|2200\n@ ^ 7900 XT|1970\n^ 6800 XT|1960\n@ ^ 6900 XT (XTXH)|1930\n@ ^ 6900XT|1925\n@ PRO W6900X|1890\n^ 6900 XT|1850\n@ ^ 6900|1810\n@ ^ 7900 XTX|1770\nRX6800|1690\nFreddyVGA|1600\n@ PRO W6800|1560\n@ ^ 7900 XTX|1430\n@ ^ 6950 XT|1380\n@ ^ 6800 XT|1360\n@ ^ 6750 XT|1310\n@(TM) ^ 6850M XT|1290\n@ ^ 6700|1290\n@ ^ 6900 XT|1270\nSapphire Nitro+ ^ 6800|1260\n@ PRO W6800X|1250\n@ PRO W6800X Duo|1220\n@ ^ 6700|1210\n@ ^ 6800 XT|1180\nSapphire Nitro @ RX6650XT|1180\n@(TM) ^ 6750 XT|1160\n@ ^ 6800|1160\n@ ^ 6900 XT|1160\nASRock ^ 6650 XT Phantom Gaming|1160\n@ Navi23|1140\n@ ^ 6650 XT|1130\n@ ^ 6950 XT|1130\n@ 6800|1120\n@ ^ 6700 XT|1110\n@ Pro W6600X|1100\n@ ^ 6700M|1080\n@ ^ 6800M|1080\n@ ^ 5700 XT PJM|1060\n@ ^ 6800|1050\n@ ^ 6600 XT|1040\n@ ^ 6600 XT|1030\nASUS ^ 6600XT macOS Edition|1020\n@ ^ 6800M|1020\n@ Pro Vega II Duo|1015\n@ ^ 5700 Series|960\n@ ^ 6800/6800 XT / 6900 XT|960\n@ ^ 6600 XT|960\n@ Pro Vega II|955\n@ ^ 6650 XT|950\nNavi 10 5700 XT|950\n@ Pro Vega II|950\n@ ^ 5700 Series|950\n@ Pro W5700X|930\n@ ^ 6600|930\nASUS @ ^ 5700 XT|930\n@ Pro W5700X|920\n@ Pro 5700 XT|920\n@ ^ 6900 XT|920\n@ ^ 5700 XT|910\n@ Pro W5700|895\n@ ^ 6600/6600 XT/6600M|890\n@ ^ 6750 XT|880\n@ ^ 6600|870\n@ ^ 5700|855\n@ ^ 5700 XT 50th Anniversary|850\n@ VII|850\n@ ^ 5700 XT 50th Anniversary|840\n@ PRO W6800|840\n@ Pro Vega 64|820\n@ Navi10|820\n@ ^ 5600 XT|820\n@ ^ 6600M|800\n@ ^ 6800S|790\n@ Pro 5700 XT|780\n@ ^ Vega 64 8GB|770\n@ Pro 5700|770\n@ Vega Frontier Edition|770\n@ ^ Vega|760\n@ ^ Vega 56/64|760\n@(TM) ^ Vega|760\n@ Pro Vega 64X|740\n@ ^ 5600 XT|740\n@ PRO W6600|740\n@ Vega 64 LC|735\n@ ^ Vega 64.1|730\n@ ^ 6600M|730\n@ Pro 5700|720\n@ Vega Frontier Edition|710\n@ Vega Frontier|700\n@ Vega FE|700\n@ ^ 5700 XT|690\n@ Pro Vega 64|670\n@ Vega 64|670\n@ VII|660\n@ Pro WX9100|660\nSapphire @ ^ Vega 64 8GB|650\n@(TM) PRO W6600M|650\n@ ^ 5700 XT 50th Anniversary|650\n@ ^ 5700|640\n@ Pro W5700|640\n@(TM) Pro WX 9100|635\n@ ^ Vega 56|630\n@ ^ Vega 56|620\n@ Pro 5500 XT|620\n@ ^ 5600 OEM/5600 XT / 5700/5700 XT|620\n@ ^ 5500|620\n@ ^ 5500 XT|620\n@ Vega Frontier Edition|620\n@ ^ 5500M Series|610\n^ xxx|610\n@ Pro Vega 64X|610\n@ ^ Vega 64|610\n@ ^ 5600 XT|610\n@ Pro Vega 64|610\n@ ^ 6500 XT|600\n@ Vega|600\n@ Pro W5500|600\n@ ^ 5600M|600\n@ Pro Vega 56|600\n@ Pro Vega 64|590\n@ Pro 5600M|590\n@ Pro Vega 48|590\n@ Pro Vega II Duo|590\n@ ^ 590 Series|590\n@ ^ Vega 56 8GB|590\n@ Pro 5600M|590\n@ Pro WX 9100|590\n@ Pro 5300|580\n@(TM) R9 Fury Series|580\n@ ^ 6800 XT 16GB|570\n@ Pro 5600M|570\n@ Pro W5500X|560\n@(TM) ^ 5500M|560\n@ * 7870|560\n@ Pro W5500|550\n@ ^ 5500M|550\n@ R9 290X Series|550\n66AF:F0|550\n@ Pro 5500 XT|550\n@ ^ 580 Series|550\n@ ^ 5500XT|550\n@(TM) ^ 580X|540\n@ Pro 5500 XT|540\n@(TM) Pro W5500M|540\n@ Pro W5500X|540\n@ Pro W5500|540\nRadeonT ^ 5300|540\n@(TM) ^ 570 Graphics|520\n@ Pro 5300|520\n@(TM) ^ 6500M|520\n@ ^ Vega M GL|520\nASUS @ ^ 570 Series|520\nASUS @ ^ 580 Series|520\n@(TM) ^ 580|520\n@(TM) Pro V7350x2|520\n@(TM) ^ 480 Graphics|520\n@(TM) ^ 570 Graphics|515\n@ ^ 6400|510\n@ Pro 580X|510\n@(TM) R9 390 Series|500\n@ Pro 5300|500\n@ ^ 580 2048SP|500\n@ PRO W6400|500\n@ ^ 570 Series|500\n@ PRO W6800X Duo|500\n@ Pro 580|500\n@ ^ 5500 XT|500\n@ ^ 6400|490\n@ Pro 580|485\n@(TM) Pro WX 7100 Graphics|485\n@(TM) R9 290X|480\nSapphire @ ^ 580 Pulse|480\n@ ^ 6700/6700 XT / 6800M|470\n@(TM) ^ 580|475\n@ ^ 6700S|475\n@ R9 290X|470\n@(TM) ^ 470 Graphics|470\n@ R9 FURY / NANO Series|470\n@ Embedded E9560|470\nKamen Rider Black ^|460\n@(TM) E9550|460\n@(TM) ^ 580 Graphics|460\n@ ^ Vega 56/64|460\n@(TM) ^ 480|460\n@ ^ 6800 XT|460\n@ ^ 470 Series|460\n@ RX480|455\n66AF:F1|455\n@ Pro 480/575|455\n@ Embedded E9560|450\n@ FURY|450\n@ ^ 5600 OEM/5600 XT / 5700/5700 XT|450\n@ ^ 6600 XT|450\n@ * 6800 Series|445\n@ Pro 570X|440\n@(TM) ^ 470 Graphics|440\n@ Pro 575X|440\n@ ^ 470/480/570/570X/580/580X/590|440\n@ ^ 6600|440\n@ ^ Vega M GH Graphics|440\n^ 580|440\n@ ^ 570|440\n@ Pro 570|440\n@ ^ 590|440\n@(TM) ^ 470 Series|435\n@ ^ 6900 XT|435\n@ FURY X|430\n^ 590|430\n@ Pro 5500M|430\n???|430\n@(TM) ^ 570|430\n@ ^ 580|430\n@ * 8xxx|430\n@ R9 290|425\n@ Pro 5500M|420\n@ Pro 580X|420\n@ ^ 6700 XT|420\n@ ^ 480|420\n@ R9 290/390|420\n@ Pro 580X|420\n@(TM) Pro Duo|415\nEllesmere @ ^ 570|410\n@ R9-290X|410\n@ Pro 580|410\n@ R9 200 Series|400\n@ ^ 570|400\n@ Pro 470/570|400\n@ ^ 6800M|400\n@ ^ 5300M|400\n@ ^ 580 Series (POLARIS10, DRM 3.40.0, 5.11.9-141-tkg-pds, LLVM 11.1.0)|400\n@ Pro 5300M|400\n@ R9 285|400\n@ ^ 470|400\n@ Pro 575|390\n@ Pro 575X|390\n@ Pro WX 7100|390\n@ ^ 6700M|390\n@ ^ 470/480/570/570X/580/580X/590|380\n@ PRO W6600|380\n@ Polaris|370\n@ ^ 6500 XT|370\n@ Pro Vega 20|370\n@ * 7970|370\n@ Pro Vega 16|370\n@ ^ 6800|370\n@ Pro Vega 64 OpenGL Engine|370\n@(TM) R9 380 Series|360\n@ ^ 5700XT|360\nFirePro W8100|360\n@ Pro Vega 64|365\n@ Pro 570|365\n@ Pro 570X|360\n@ Pro Vega 64 OpenGL Engine|360\n@ R9 280x|360\n@ R9 380|360\n@ R9 280x|360\n@ R9 280x|360\n@ Pro Vega 56|360\nR9 280X Dual-X|360\n@ Pro Vega 56 OpenGL Engine|350\n@ * 7970|350\n@ * 7970X/8970/R9 280X|350\n@ R9 285|350\n@ R9 380X|350\n@ ^ 480|350\n@ ^ 5700 XT Series|350\nASUS @ ^ 470 Series|350\n@ Pro Vega 64|350\n@ R9 200 / * 7900 Series|340\nASUS @ ^ 470 Series|340\n@ Vega 56|340\n@ ^ 580 Series (AMD POLARIS10 / DRM 3.15.0 / 4.12.0-1-amd64, LLVM 4.0.1)|340\n@ Pro Vega 20|340\nR9 380|340\n@ * 7970|340\n@ ^ 5700 XT|330\n@ D700|330\nAsus @ R9 280|330\n@ R9 285|330\n@ R9 M395X|330\n@ ^ 5600 XT|330\nPowerColor @ R9 280|330\n@ R9 280|330\nFirePro W7100 Graphics Adapter|330\n@ R9 M295X Mac Edition|330\nASUS @ ^ 5700|330\n@ R9 380|330\n@ Pro Vega 16|325\n@ R9 290X|325\n@ RX5600|320\nASUS @ ^ 5500 XT|320\n@ R9 280|320\n@ * 7950/8950 / R9 280|320\n@ R9 M395|320\n@ ^ 6800/6800 XT / 6900 XT|320\nFirePro D700 (FireGL V)|320\n@ ^ 5500/5500M / Pro 5500M|320\nMSI @ ^ 6600 XT Gaming X|320\nFirePro W8000|315\n@ * 7950|315\n@ Pro W5700|315\nFirePro W7170M|310\n@ PRO W6800|310\n@ ^ 5500|310\n@ ^ 580 Special Edition|310\nRadeonT ^ 5500M|310\n@ R9 M395 (Bootcamp XG edition by bootcampdrivers.com)|310\n@ R9 360|310\n@ Pro WX 7100|310\n@ Pro WX 7100 Mobile|310\n@ ^ 5700 XT 50th Anniversary|310\nR9 xxx|300\n@ ^ 5700XT|300\n@ PRO W6400|300\n@(TM) R9 370 Series|300\n@ ^ 470/480/570/570X/580/580X/590|300\n@(TM) PRO W6600M|300\n@ * 8950|300\n@ R9 M395X|300\n@ R9 M395X|300\n^ Vega 64|300\n@ ^ Vega 11 Graphics|295\n@ Pro 270X|290\n@ ^ 580 2048SP|290\n@ * 7950|290\nVideo Controller (VGA Compatible)|290\n@(TM) R7 370 Series Graphics|290\n@ * 7950|290\nAsus @ R9 270X|290\n@ ^ 580X Series|290\n@(TM) ^ 5500M|285\n@ R9 270X|285\n^ xxx|285\nASUS R7 265 Series|280\n@(TM) R9 270|280\n731F:C1|280\n@ R9 M395X|280\n@(TM) R7 370 Series|280\n@ Pro V520 MxGPU|280\n@ R9 M395|280\nFirePro D700|280\n@ R9 270X|280\n@(TM) R9 200 Series|270\n@ ^ 5700|275\nRadeong 0.4 on AMD POLARIS10 (DRM 3.8.0 / 4.9.11-1-ARCH, LLVM 3.9.1)|270\n@ * 7870 XT|270\n@ R9 390X|270\n@(TM) ^ 570 Graphics|270\n@ * 7870 GHz Edition|270\n@ R9 390|270\nFirePro D700|270\n@ R9 M395|270\n@ R9 270|270\n@ ^ 5700 / 5700 XT|270\nASUS R7 370 Series|270\nFirePro W7000|270\n@(TM) Pro V7350x2|270\n@(TM) ^ 470 Series|270\n@ ^ Vega 64 OpenGL Engine|270\n@ ^ 5500M|265\n@ * 7950/8950 OEM / R9 280|265\n@ Vega Frontier Edition OpenGL Engine|265\n@ 7950 x2|263\n@ R9 270|263\n@ VII|263\n@ * 7xxx|262\nVideo Controller (VGA Compatible)|262\n@(TM) ^ 570|261\n@ ^ 5500 XT|261\n@ R9 M295X|261\nFirePro W7000 (FireGL V) Graphics Adapter|260\n@ R9 M390|260\n@ * 7870 GHz Edition|260\n@ R9 M390 (Bootcamp edition by bootcampdrivers.com)|260\n@ R9 370|259\nMetal|259\n@ * 7870|259\n@ ^ 470/570|258\n@(TM) R9 370|257\n@(TM) ^ 460|257\n@ ^ 560 Series|256\n@ R9 290|255\n@(TM) ^ 560 Series|255\n@ ^ 5300M|254\nFirePro W7000|254\n@ R9 290X|253\n67EF:E7|253\n@ * 7850|253\n@(TM) ^ 460 Graphics|253\nMSI @ ^ 580|251\n@ R9 290/390|250\nFirePro W8100 (FireGL V)|249\n@ Pro WX 9100 OpenGL Engine|248\n@(TM) ^ 560|247\n@(TM) ^ 560 Series|247\n@ Pro Vega II Duo|247\n@ * 7970M|246\n@ R9 290|245\n@ ^ 5600M|245\nFirePro D300|245\n@(TM) ^ 5600M Series|244\n@ ^ 590 Series|244\n@ R7 370 Series|244\n@(TM) ^ 560|243\nFirePro D300|243\n@ R9 390|243\n@ ^ 470/480/570/570X/580/580X|243\nFirePro D300|243\n@(TM) R7 370 Series|242\n@ R9 M390|241\n@ ^ 560X Series|241\nFirePro D300|241\n@ ^ 560|240\n@ R9 M290X|240\nGigabyte Vega 64 macOS Edition|239\n@ Pro 580|238\n@ Pro WX 4100|236\n@ Pro WX 7100 OpenGL Engine|236\n@ * - FirePro D300|235\nFirePro D500|234\n@ Pro 580 OpenGL Engine|234\n@(TM) E9260|234\n@ Pro WX 2100|233\nFirePro D500|232\nFirePro D500|232\n@(TM) ^ 6500 XT|232\n@ Pro 580X|231\n@ * 7850|231\n@ Pro 575|231\n@ Pro Vega 64X|231\nASUS R9 270 Series|230\n@ Pro 450|230\n@(TM) ^ 560 Graphics|230\n@ R9 M290|229\n@ Pro 560X|228\n@ Pro 480/575|228\nPitcairn PRO @ * 7850|228\nASUS @ ^ 5700 XT|227\n@ * 7870|227\n@(TM) Pro WX 5100 Graphics|226\n@ R9 370X|225\n@(TM) ^ 480|224\n@ HD7970M|224\nFirePro S9000 (FireGL V)|223\n@ ^ 550 640SP / ^ 560/560X|222\nMSI / AMD ^ 560 4G|222\n@ ^ 570 OpenGL Engine|222\nMSI RX650|222\n^ 480|221\nMSI / AMD ^ 560|221\nBaffin AMD @ ^ 560|221\nMSI Baffin RX650|220\n@ Pro 5700 XT|220\n@ Pro 570|220\n@ Pro 575 OpenGL Engine|219\nAsus @ R9 270X|219\n@ ^ ^ 560|218\n@ ^ 560 [Baffin]|218\n^ 460|218\n@ R9 370X|218\n@(TM) Pro WX 4100|217\nASUS R9 390 Series|217\n@ Pro 5600M|217\nR9 xxx|217\n@ * 7870 Series|217\n@ Pro ^ 560|216\nR9 280X Dual-X|215\n@ Pro 570 OpenGL Engine|214\n^ 560|213\n@ Pro WX 5100|213\nFirePro D700|213\n@(TM) R9 390 Series|213\n@ ^ 480|212\n@ ^ 560|212\n@ ^ 5500/5500M / Pro 5500M|212\n@ ^ 550 640SP / ^ 560/560X|211\n@ R9 FURY / NANO Series|211\nSapphire @ ^ 560|211\n@ ^ 460|210\n@ RX550/550 Series|210\ninc. @ ^ 480|209\n@(TM) ^ 550|208\n@ R9 M290X|206\n@ Pro 560 (Bootcamp XG edition by bootcampdrivers.com)|206\n@ RX460|206\n@ ^ 550 Series|205\nCustom GPU 0405|204\n@(TM) ^ 460|204\nASUS AMD @ R9-990X|204\n@ Pro 555X|203\n@ ^ 460/560|203\n@ * 7970X/8970/R9 280X|202\nASUS @ ^ 550 Series|201\n@ * 8950|201\nFirePro D500 (FireGL V)|201\n^ 5700XT|200\n@ 550 Series|200\n@ * 8470 + 7660D Dual Graphics|200\n@ * 7990|200\n@ ^ 560X|199\n@ ^ Vega|199\n@ * 7950 Series|198\n@(TM) ^ 540|197\n@ * 6970|197\n@ * 7970/8970 / R9 280X|197\n@ Navi14|197\n@ Pro 560|197\n@ ^ 550|197\n@ R9 285|196\n@ Pro W5500|195\n@ Pro Vega 56|195\n@ Pro 460|195\n@ ^ 470/480|194\n@ PRO Graphics|194\n@(TM) RX550|194\n@ Pro 560X|193\n@ Pro 570X|192\n66AF:F1|192\n@ ^ Vega M GH|190\n@ R9 M280X|190\n@ ^ 460/560D / Pro 450/455/460/555/555X/560/560X|189\n@ R9 280,|188\nCustom GPU 0405|188\n@ * 7790|187\n@(TM) ^ 480 Graphics|187\n@ Pro 455|186\n@ R9 260|186\n@ ^ 580 Series|186\n@ * 7950/8950 OEM / R9 280|186\n@ R9 290X|185\n@ R9 M290X|184\n@(TM) R9 370 Series|184\n@ Pro 555|184\n@ R7 260X|184\n@ * 6950|183\nFirePro W5000|183\n@(TM) R9 390X|182\nR9 270X Devil|182\n@(TM) ^ 470 Graphics (AMD POLARIS10 / DRM 3.23.0 / 4.15.0-1-MANJARO, LLVM 5.0.0)|182\n@ R9 380|182\n@(TM) Pro WX 9100|182\n@(TM) R7 360 Series|181\n@ ^ 570 Series|181\n@(TM) R9 M470X|181\n@(TM) R7 360 Series|181\n@ RX480|180\n@ R7 200 Series|180\n@ Pro WX 4150|180\n@ Pro WX 4100|179\n@ * 8xxx|179\nASUS R9 295X2 Series|179\n@ R9 390X|178\n@ * 5870|176\n@ Pro 560|176\n@ ^ 580 OpenGL Engine|175\n@ * 8950|175\nFirePro V(FireGL V) Graphics Adapter|175\nASUS @ ^ 580 Series|174\n@ Pro WX 4100|174\n@ Pro 460|173\n@ * 2600 XT|173\n@ Pro WX 4100|172\n@ * 8280|172\n@ Pro 575|171\n@ Pro 555X|171\n@ Pro WX 4130/4150|170\n@ ^ Vega M GH Graphics|170\nFirePro W5100|170\n@(TM) PRO WX 8200|169\n@ Vega Frontier Edition|169\n@ Pro 555X|168\nFirePro D700|168\n@ * 6990|167\n@ ^ 470 OpenGL Engine|167\n@ * 7870 XT|167\n@ ^ 580|167\n@ Polaris|167\nFirePro V8800 (FireGL V)|166\n@ ^ 550|165\n@ * 6900 Series|165\nFirePro W9100 (FireGL V)|164\n^ 580|163\n@(TM) ^ 580X|163\n@ ^ 550|163\n@ * 6870|163\n@ R9 M395X OpenGL Engine|163\n@(TM) R9 360|163\n@(TM) * 8490|162\n@ R9 M295X|162\n@ * 7970M|162\n@ R9 M380|161\nFirePro W5100 (FireGL V) Graphics Adapter|161\nASUS HD7850 Series|161\nFirePro M6100 FireGL V|161\n@ Pro 455|160\n@ ^ 460/560D / Pro 450/455/460/555/555X/560/560X|160\n@ R9 M395X|159\n@ ^ 560X|159\n@ Pro 555|158\nRadeonT ^ 560X|158\n@ Pro Vega 48|158\nASUS @ ^ Vega|158\n@ Pro WX 9100|158\n@ Pro Vega 64|157\nPowered By QiongB A9999999999|157\n@(TM) Pro Duo|157\nFirePro D700|157\n@ Pro WX 7100|156\n@ ^ 460|156\n@ * - FirePro D700 OpenGL Engine|156\n@ R9 M290X|156\n@ R9 M395 OpenGL Engine|155\n@ Pro SSG|155\nFirePro D300|155\nASUS R9 380 Series|155\n@(TM) R9 Series|153\n@ ^ 470/480/570/580|153\nFirePro W8000|153\nCezanne|153\n@(TM) Graphics|153\nFirePro D300|153\n@(TM) R9 Fury Series|153\n@ R9 M395|152\n@ ^ 570|152\n@ R9 270X Series|152\n@ Pro 5300M|152\nR9 xxx|152\n@ Pro 555|152\nFirePro D500|151\n@ * 5850|151\nFirePro D300|150\n@(TM) R9 290X|150\n66AF:F0|149\n@(TM) ^ 560|149\n@ R9 M290|148\n@ Instinct MI25 MxGPU|148\nFirePro V7800 (FireGL) Graphics Adapter|148\n@(TM) R9 M470|147\nAdvanced Micro Devices, Inc. [AMD/ATI] Fiji [@ R9 FURY / NANO Series]|147\n@ * 5870 Series|147\n@(TM) E9550|147\n@ * 7850|147\n@ * 7770|147\n@ Pro Vega 20|146\n@ R9 290/390|146\n@ Pro 450|146\n@ ^ 560X Series|146\n@ * 6850|146\n@ R9 270 1024SP|145\nASUS R9 280X Series|145\n@ Pro 450|145\n@(TM) R9 390 Series|145\nFirePro V7900 (FireGL V)|145\n@ R9 370X|145\n@(TM) ^ 560 Series|144\nASUS R7 250X|144\n@ ^ 480 OpenGL Engine|144\n@ R9 290X|144\n@ ^ 550X|144\n@(TM) ^ 580|144\nASUS @(TM) ^ 470 Series|143\nBaffin @ ^ 560|143\n@ R9 M295X (Bootcamp edition by bootcampdrivers.com)|143\n@ R9 M295X Mac Edition|143\n@ R7 Series / * 9000 Series|142\nAdvanced Micro Devices [AMD] nee ATI Device|142\n@(TM) Pro WX 7100 Graphics|142\n@ ^ 640|142\nFirePro D500|141\n@ * 7900 Series|141\n@ R9 290|141\n@ R7 250X|141\n@(TM) ^ Vega|140\n@ 630 Series|140\nFirePro W8100 Graphic Adapter|140\n@ R9 FURY / NANO Series|140\n@ R9 M390|140\n@ Pro WX 3100|140\n@ R9 290|140\n@(TM) R9 370|140\nFirePro V7900|139\n@ * 7970|139\n@ * - FirePro D500 OpenGL Engine|139\n@ * - FirePro D300 OpenGL Engine|139\n@ Pro 580|139\n@ * 7770|139\n@ * - FirePro D500 OpenGL Engine|139\n@ 540/540X/550/550X / ^ 540X/550/550X|138\nFirePro S9050|138\n@(TM) ^ 480 Graphics|138\n@(TM) R9 M390X|137\n@ Vega 64|137\n@(TM) Graphics|137\nTonga PRO GL [FirePro W7100]|136\nHD7950 Martin Ver.|136\n@ * 7990|135\n@ R9 280x|135\n@ RX550/550 Series|135\nHD7950 MARTIN REV.|134\n@ RX560|134\n@ R7 250X Series|134\n@ R9 M390 OpenGL Engine|134\nASUS R7 250X|134\n@ HD6870|134\n@ R9 270X|134\n@ Pro 5500 XT|134\n@(TM) ^ 480|133\n@ R9 270|133\nASUS HD7970 Series|133\n@ ^ 540|133\n@ 500 Series|132\n@ * 5970|132\n@ * 7770 GHz Edition|132\n@ * 5870|132\n@ 540X Series|132\n@ * 6870 Series|132\n@(TM) ^ 470 Graphics|132\n@ * - FirePro D300 OpenGL Engine|132\n@ * 7xxx|131\n@ * 5970|131\nRadeonT 540X|131\n@ R7 Graphics + R7 350 Dual Graphics|131\n@ R9 M295X Mac Edition / R9 380X|131\nFirepro M5100|131\n@(TM) R9 M375X|131\n@ R9 280x|130\n@(TM) ^ 560X|130\n@ * 6990|130\n@ Pro 5500M|130\n@ Pro WX 5100 OpenGL Engine|129\n@ R9 M395X (Bootcamp edition by bootcampdrivers.com)|129\n@ R9 M380|128\nFirePro W5170M|128\n@ R9 280|128\nFirePro W5000 (FireGL V)|128\n@(TM) ^ 5600M Series|128\n@ ^ 560D|128\nFirePro D500 (FireGL V)|128\n@(TM) Pro WX 5100 Graphics|128\n@(TM) ^ Vega 11 Graphics|128\n@ * 7970|127\n@ R9 370|127\n@ * 7770|127\n@ R9 M395X|126\n@ * 7660D|126\n@ * 8970|126\n@ R9 200 Series|126\n@ Pro WX 3200 Series|126\n@ * 7800 Series|125\n@ R9 285/380|125\n@ R9 270X|124\nFirePro W2100|124\nFirePro W7170M|124\n@ * 7870 GHz Edition|123\nRadeong 0.4 on AMD TONGA (DRM 3.1.0, LLVM 3.9.0)|123\n@ ^ 460|123\n@ * 5970 Series|123\n@ R9 M380|122\n@ R9 M395|122\nAsus @ R9 280|122\n@ * 6850 Series|122\n@(TM) ^ 540|122\n@ * 6900 Series|122\nDevice|122\n67DF:C4|121\n@ * 6950|121\nFirePro D300 (FireGL V)|121\n@ ^ 570|121\n@ * 5850 Series|121\n@ * 7870 XT|121\n@ * 7950|121\nFirePro V7800 (FireGL) Graphics Adapter|121\n@ * 6850|121\n@ * 7950|120\n@ * 7870 GHz Edition|120\n@ R7 370 / R9 270X/370X|120\n@ * 6870|120\n@ Pro V340|120\nASUS @ ^ 570 Series|119\n@(TM) R7 370 Series Graphics|119\n@(TM) ^ 580 Graphics|119\n@(TM) ^ 470 Graphics|119\n@ * 5870|119\n@ * 7950/8950 / R9 280|119\n@ * 6790|119\n@(TM) RX580|119\nASUS ARES2|119\n@(TM) R9 380 Series|118\n@ * 7750|118\n@ Pro 560X|118\n@ R7 250E|118\n@ 550 Series|118\n@ ^ 560|118\n@ Pro WX 5100|117\n@ R7 370 / R9 270X/370|117\n@ * 7800 Series|117\nFirePro W5000 (FireGL V) Graphics Adapter|117\n@ * 7750 Series|116\n@ * 5870|116\n@ R7 450|115\nFirePro R5000|115\n@ R7 370 Series|115\nFirePro W9100|114\n@ R7 370 / R9 270/370|114\n@(TM) 540 Graphics|114\n@ * 6510 Series|114\n@(TM) R7 370 Series|113\nSapphire @ HD6870|113\nFirepro M5100|113\n@(TM) ^ 550|113\n@(TM) Pro Duo|113\n@ 540/540X/550/550X / ^ 540X/550/550X|113\n@ Pro 570|112\n@ R9 280|112\nFirePro D700 (FireGL V)|112\n(ATI) FirePro M6000 (FireGL V) Mobility Pro Graphics|112\nRenoir|112\n@ 540X Series (POLARIS12, DRM 3.40.0, 5.10.56-1-MANJARO, LLVM 12.0.1)|112\n@ * 6970|112\n@ * 8770|112\n@ Pro WX3200 Graphics|112\n@(TM) R9 270|111\n@ R9 270X|111\n@ R9 285|111\n@ * 7800M Series|111\n@(TM) R7 370 Series|111\n@ * 7870M Series|111\n@ Pro 450/550|110\n@ * 7000 series|110\n@ * 7870|110\n@ Pro 555X|110\n@ RX590 GME|109\nFirePro S10000|109\n@ * 7870M|109\n@ * 5800 Series|109\n@ * 6970M|108\nASUS HD7770 Series|108\n@(TM) R9 M360|108\n@(TM) ^ 550X|107\n@ R9 285|107\n@ * 6900M Series|107\n@ * 7870 GHz Edition|107\nFirePro S7000|107\n@ R9 M370X|106\n@ Pro WX 4100|106\n@ * 6800 Series|106\n@ * 7750|106\n@ Pro 455 OpenGL Engine|106\nASUS R7 370 Series|106\n@ Pro 560|105\n@ * 6870|105\nFirePro D300 (FireGL V)|105\n@ * 6970M|105\n@ * 7850|105\n@(TM) R9 200 Series|104\nASUS HD7750 Series|104\n@ * 6970M OpenGL Engine|104\nAsus @ R7 250|104\n@ R7 370 / R9 270X/370|104\n@ R9 M395X (Bootcamp XG edition by bootcampdrivers.com)|103\n@(TM) ^ 560|103\n@ ^ Vega|103\n@(TM) Pro W5500M|103\n@ R9 270|103\n@ Pro 560X|103\n@ * 5850|103\nFirePro S7150|103\n@(TM) ^ 580|103\n@(TM) R9 370 Series|103\nASUS @(TM) ^ 480 Series|102\n@ Graphics Processor|102\n@ R9 M370X|102\nFirePro W7100|102\n@ R9 M370X|101\n@ Pro 460 OpenGL Engine|101\n@ ^ 580 Series|101\n@ 500 Series|100\n@ Pro 555|100\n@(TM) Pro WX 4100|100\nAsus @ R7 260X|100\n@(TM) ^ Vega 10 Graphics|100\n@ * 7790|99\n@ Pro 450 OpenGL Engine|99\n@ * 7790/8770 / R7 360 / R9 260/360|99\nFirePro M4000 Mobility Pro Graphics|99\n@ * 7970M|99\n@ R9 M270X|99\n@ ^ 550|98\n@ * 6850|98\n@(TM) ^ 460|98\n@(TM) ^ Vega11 Graphics|98\n@(TM) ^ 460 Graphics|98\n@ Pro 460|97\n@ * 7800 Series|97\nMatrox C680 PCIe x16|97\n@(TM) ^ 550|97\n@ * 5770|96\n@ * 8670D + 7700 Dual Graphics|96\n@ * 7790|96\n@ 630 Series|96\n@ ^ 560 Series|96\nFirepro M6100|95\n@ * 6700 Series|95\n67EF:E7|95\n@(TM) Vega 10 Graphics|95\n@ * 6900M Series|94\n@ Pro 455|94\nFirePro M4000|94\n@ R9 260|94\nFirePro W7000|94\n@ Instinct MI25|93\n@ * 8870M|93\n@(TM) Vega 11 Graphics|93\n@ Pro 450|93\nFirePro W5000|92\n@ * 6770|92\n@(TM) RX560|92\n@(TM) Graphics|91\nASUS @(TM) ^ 460 Series|91\n@(TM) Vega 8 Graphics|91\n@(TM) Graphics|91\nFirePro W5100 Graphics Adapter|90\n@(TM) Pro WX Series|90\nRenoir|90\nSTRATO XT (6646)|89\n@(TM) Pro WX 4150 Graphics|89\n@ E8870MXM|89\n@ * 8970M|89\nFirePro M6100 FireGL V|89\n@ * 7770|89\nFirePro W5100 (FireGL V) Graphics Adapter|89\n@ * 6970M|89\n@ Pro 460|88\n@ ^ Vega 8 Graphics|88\n@ * 7700 Series|88\n@(TM) R9 M360|88\nASUS R7 265 Series|88\n@ ^ Vega M GL Graphics|88\nASUS @ ^ 550 Series|88\n@ R7 360 / R9 360|88\n@ * 6950|86\n@ * 6790|86\n@ Pro WX 2100|86\nASUS @ ^ 560 Series|86\n@ * 5750|86\n@(TM) ^ 640|86\n@ * 8870M|85\n@ R7 260X|85\n@ Pro WX 7100|85\n@(TM) R7 360 Series|85\n@ Infoshock™ ^ 460 Graphics|85\nFirePro W5170M|85\n@ R9 M295X|85\nFirePro W8100|85\n@ * 6750|85\nFirePro W5170M|85\nFirePro V5800 (FireGL) Graphics Adapter|84\nASUS R7 250X|84\n67E8:00|84\n@(TM) ^ 550X|84\n@(TM) R7 350|84\n@(TM) E9260|84\n@ Sky 500|84\n@ R9 M270X|83\n@(TM) R9 350|83\n@(TM) ^ Vega 11 Graphics|83\nFirepro M6100|83\n@ R9 360|82\nFirePro V7900|82\nFirePro V5800 (FireGL V)|82\n@ * 8830M|82\n@ Pro 450|82\n@ * 8950|82\n6980:00|82\nFirePro W5100 (FireGL V)|81\n@ E8870|81\n@ * 7750 Series|81\n@ * 7850 / R7 265 / R9 270 1024SP|81\nFirePro™ W4190M|80\n@ * 5770|80\n@(TM) R7 360 Series|80\nFirePro M5100 FireGL V|80\n@ ^ 470/480/580|80\n@(TM) ^ 460 Graphics|79\n@ * 6700 Series|79\nMobility @ * 5870|79\n@ R9 255|79\n@ 535 Series|79\n@ R9 M380 OpenGL Engine|78\n@(TM) ^ 550|78\n@ R9 M380|78\n@ R7 250X|78\nSaphire @ ^ 580|78\nRadeong 0.4 on AMD BONAIRE (DRM 2.43.0, LLVM 3.8.0)|78\n@ * 5000|78\n@ * 5770|77\n@ ^ 460|77\nFirePro W4300|77\n@ 530 Series|77\n@(TM) 540X|77\n@ R9 M370X OpenGL Engine|77\nFirePro V5900 (FireGL V)|77\n@ Pro WX 4100|77\nSAPPHIRE * 5770|77\n@ Pro WX 3100|76\nFirePro W5100|76\n@(TM) Pro Graphics|76\n@ Pro WX 3100|76\n67FF:C8|76\n@(TM) HD8970M|76\nFirepro M5100|76\n@(TM) R9 M375X|75\n@ 550X Series|75\n@ R9 M390|75\n@(TM) Vega 9 Graphics|75\nFirePro V5900 (FireGL V) Graphics Adapter|74\n@ * 8570|74\n@(TM) ^ 475M|74\n@ * 6770|74\n@ ^ 550 Series|74\n@ ^ 550|74\nFirePro M4000|74\n@ ^ 460/560D / Pro 450/455/460/560|74\n@ Pro 560|74\n@ Vega Series / @ Vega Mobile Series|74\n@ Pro 455|74\n@ * 7870M Series|74\n@(TM) R7 430|74\n@ 620 Series|73\n@ * 7770 GHz Edition|73\n@ * 7770|73\n@(TM) R9 360 Series|73\n@ * 7770/8760 / R7 250X|73\n@(TM) 530|73\n15DD Graphics|73\n@ ^ Vega M GL Graphics|73\n@(TM) R9 380|72\n@(TM) 530 series|72\n@ R7 200 Series|72\nEmbedded @ E9171|72\n@ Pro WX3200 Graphics|71\n@ * 8800M Series|71\n@ R9 M375|70\n@ * 5770|70\n@ Pro 555|70\n@ R7 250E|70\n@ * 7750|70\n@ Pro 555X|70\n@(TM) Vega 8 Mobile Graphics|70\n@(TM) R9 M380|69\n@ R7 260X/360|69\nBarco MXRT 7600 (WDDM)|69\n@(TM) Vega 10 Graphics|69\n@ * 7750|69\n@ R9 M370X|69\n@(TM) R2E Graphics|69\n@ R9™ M370X|68\nFirePro V4900 (FireGL V)|68\n@(TM) ^ Vega11 Graphics|68\n@ * 5770|68\n@(TM) Renoir Graphics D1|68\n@ * 7600 Series|67\n@ R5 340|67\n@(TM) Vega 9 Graphics|67\nFirePro W4100 (FireGL V) Graphics Adapter|67\n694E:C0|67\n694C:C0|67\n@ R7 250|66\n@ * 6750|66\nRAVEN (DRM 3.36.0, 5.6.5-AMD, LLVM 9.0.1)|66\nFirePro W600|66\n@ R9 255|66\n@ ^ 470|66\n@(TM) R7 250|66\nFirePro V5900|65\n@(TM) 530|65\n@ Pro WX Vega M GL Graphics|65\n@ ^ 470/480|65\n@ * 5750|65\n@ R7 260X|65\nFirePro V5900 (FireGL V) Graphics Adapter|65\nFirePro W4100 Graphics Adapter|65\n@ * 6700 Green Edition|65\n@ R9 M370X|65\n@(TM) R7 350X|64\n@(TM) R7 350X|64\n@ * 7670|64\n@ R9 M200X Series|64\n@ R9 M370X|64\n@ * 6670|63\n@(TM) * 8350|63\n@ 530X Series|63\n@(TM) R9 360|63\n@(TM) Pro WX 4150 Graphics|63\n67EF:C5|63\n@ R7 Graphics + R5 340 Dual Graphics|62\n@ * 5670|62\n@ ^ 470/570|62\n@ 530 Series|62\n@ R7 250 Series|62\n@ R7 430|62\n@ * 6750 Graphics|62\n@(TM) R9 M385X|62\n@(TM) Vega 10 Mobile Graphics|62\nFirePro V5900 (FireGL V)|61\nFirePro V5800 (FireGL V)|61\n@(TM) Vega 8 Graphics|61\nFirePro V4800 (FireGL V)|61\n@ * 7600 Series|61\n@(TM) Vega 6 Graphics|61\n@(TM) R9 200 Series|61\n@ * 8850M|61\n@ RX460|61\n@ R7 M460|61\n@ ^ 640 Series|60\n@ 530|60\n@ * 5600/5700|60\n@ * 5750 Series|60\n@ R7 Graphics + R7 200 Dual Graphics|60\n@ R7 450|60\nFirePro V4900|60\nFirepro W6150M|60\nASUS R7 250 Series|60\n@(TM) ^ 560 Graphics|60\n@(TM) R7 M370|59\nFirePro M4000 Mobility Pro Graphics|59\n@ R5 430|59\n@ R9 M275X|59\nFirePro V5800 (FireGL) Graphics Adapter|59\nMobility @ * 5870|59\n@(TM) R9 M385X|58\n@ * 7750M|58\n@ * 5670|58\n@ * 8850M|58\n@ * 7700M Series|58\n@ * 8670D + R7 200 Dual Graphics|58\n@ R7 Series / * 9000 Series|57\n@ * 6730M/6770M|57\n@(TM) 625|57\n@(TM) R9 M385|57\n@ * 5870M|56\n@ 610 Series|56\nFirePro W4100|56\nFirePro M6000 Mobility Pro Graphics|56\n@ ^ 540 Series|56\n@ R7 240|56\n@ * 7560D + * 7700 Dual Graphics|56\n@ R9 M370X (Bootcamp XG edition by bootcampdrivers.com)|56\nFirePro V4900 (ATI FireGL)|55\n@(TM) R7 M350|55\nFirePro M6000 Mobility Pro Graphics|55\n67FF:08|55\n@ * 5750|55\n@ * 7570|55\n@(TM) Vega 11 Graphics|55\n@ R7 M460|55\n@ * 5750 OpenGL Engine|55\n@(TM) R7 M370|55\n@ * 6730M/6770M/7690M XT|55\n@ E8860|55\n@ * 8790M|54\n@ * 6770M|54\n@ R7 M440|54\n@(TM) R7 350|54\n@(TM) R7 350X|54\n@ * 7870 XT|54\n@ * 7800M Series|54\n@ 520|54\n@ R7 M370|53\nFirePro W4150M FireGL V|53\n(ATI) FirePro M4000 (FireGL V) Mobility Pro Graphics|53\n@ R9 M200X Series|53\n@ * 6700M/7700M/7900M Series|53\n@(TM) 620|53\nPicasso|53\n@(TM) ^ Vega 10 Graphics|53\n67EF:CF|53\n@(TM) Vega 3 Graphics|53\n@ R7 250|53\nFirePro W4190M|53\n@(TM) Vega 8 Graphics|53\n694C:C0|52\n@ * 5670 Series|52\n@(TM) ^ Vega 11 Graphics|52\n@ * 6770M OpenGL Engine|52\n@(TM) M535DX|52\nFirePro V4800 (FireGL V)|52\n@ R7 350 Series|52\nBarco MXRT 5600 (WDDM)|51\n@ 630|51\nFirePro V4900 (FireGL V)|51\nFirePro V4900 (FireGL V) Graphics Adapter|51\n@(TM) Vega 3 Mobile Graphics|51\n@ 535 Series|51\n@ R7 Graphics|51\n@ * 5670|51\nFirePro W4170M|50\n@ * 8700M Series|50\n@ * 8670 / R7 250/350|50\nPicasso|50\nFirePro V4800 (FireGL) Graphics Adapter|50\nMobility @ * 5850|49\nOPAL XT/GL (6604)|49\n@ R5 M335|49\nMatrox C900 PCIe x16|49\n@ * 7670|49\n@ * 6750M|49\n@(TM) 535|49\n@ 540X Series|49\n@ R9 M275|49\n@(TM) ^ 640|49\n@ * 5700 Series|48\n@ R5 M230 Series|48\nFirepro M6100|48\n@(TM) R9 M375|48\n@ R5 430|48\n@(TM) R7 250|47\n@ R9 M265X|47\n@ * 6730M/6770M|47\n@ * 8670D|47\n@ R5 340|47\n@ 520|47\n@(TM) 520|47\nFirePro V (FireGL V) Graphics Adapter|47\nFirePro M5100 FireGL V|46\n@ * 6670|46\n@ R7 M260X|46\n@ * 8550|46\nFirePro M4150|46\n@ * 6670|46\n@ * 7700 Series|46\nFirePro M4170|46\n@ * 7570|46\n@ * 8670D + * 6670 Dual Graphics|45\n699F:C1|45\n@ R7 Graphics|45\n@(TM) R7 M340|45\nFirePro W4170M (FireGL V)|45\n@(TM) * 8500M/8700M|45\n@ R7 M340|44\nFirePro M5950|44\n@ * 8570D + R7 240 Dual Graphics|44\n@ * 6770M|44\n@ * 7730M|44\n@ * 8790M|44\n@ * 7750|44\n@ * 8690A|44\nMobility @ * 5730 / 6570M|44\n@ R9 A375|44\n@(TM) R8 M445DX|43\nFirePro V (FireGL V) Graphics Adapter|43\n@ * 7750/8740 / R7 250E|43\nFirePro V3900|43\n@ * 7600A Series|43\n@(TM) R7 200 Series Graphics|43\n@ R7 Graphics|43\n@ * 6770M|43\n@ R7 M260 Series|43\n@ R7 M360|43\n@ * 8970M|43\n@(TM) Vega 6 Graphics|43\n@ * 8570|42\n@ R7 M440|42\n@ * 8670A/8670M/8750M|42\nMobility @ * 5850|42\n@ * 8750M|42\nEmbedded @ E9173|42\n@(TM) R7 M440|42\n@ * 8730M|42\n@ R7 240 + * 8570D Dual Graphics|42\nFirePro V3900|42\n@(TM) 535DX|42\n@(TM) 520|42\n@(TM) Vega 8 Mobile Graphics|42\n@(TM) Vega 8 Graphics|42\n@(TM) Vega 2 Graphics|42\n@(TM) R9 M375|42\n@(TM) R8 M445DX|41\n@ * 6750M|41\nRadeonT 540X|41\n@(TM) 530|41\n@ * 7560D + * 6670 Dual Graphics|41\n@ R7 240|41\n@(TM) R7 M360|41\n@ R9 M280X|41\n@ * 7520G + * 7600M Dual Graphics|41\n@(TM) R7 M445|41\n@ Vega 8 Mobile|40\n@(TM) R9 255|40\n@ R7 M260X|40\n@ R8 M535DX|40\n@ R7 240/340|40\n@(TM) R9 M375|40\n@(TM) R7 Graphics|40\n@(TM) R5 M420|40\n@ * 6750M|40\n@ R9 M265X|40\n@ R7 M340|40\n@ * 6570|40\n@ * 7500/7600 Series|39\n@ R7 430|39\nFirePro W2100|39\n@ * 7730M|39\n@ * 8670D|39\n@ R5 M255|39\n@ * 7560D + * 6570 Dual Graphics|39\n@ ^ Vega|39\n@ R7 240 Series|39\n@(TM) R7 M445|39\n@ * 6800M Series|39\n@ * 8690M|39\n@ * 7660D + * 6570 Dual Graphics|39\n@ R7 M370|39\n@(TM) * 6650M|38\n@ R5 M435|38\n@ * 6500 Series|38\n@ R7 Graphics|38\nFirePro M7820|38\n@(TM) R8 M445DX Graphics|38\n@ * 5570|38\n@ * 8650G + 8750M Dual Graphics|38\n@ * 8670A/8670M/8750M|38\n@ * 6650M|38\n@ R7 M260 Series|38\n@ * 7660G + 7600M Dual Graphics|38\n@ * 7600M Series|38\n@ * 7670M|37\n@. * 7670M|37\n@(TM) R7 M265|37\nMobility @ * 5000|37\n@ * 7500M/7600M Series|37\n@ R5/R6/R7 Graphics|37\n@ R7 M270|37\n@ * 8650G + * 7600M Dual Graphics|37\nFirepro M5100|37\n@ * 7730M|37\n@ * 8570D|37\n@(TM) * 7650A Graphics|37\n@ R7 Graphics|37\n@(TM) ^ Vega 10 Graphics|37\n@ * 7600A Series|36\n@ R7 M270|36\n@ * 7660D + * 6670 Dual Graphics|36\n@ * 7570M/* 7670M Graphics|36\n@ 6600M and 6700M Series|36\n@ R7 Graphics + R7 200 Dual Graphics|36\n@ * 7570 Series|36\n@ * 8750M|36\n@ * 6550D|36\nFirePro M5950|36\n@ * 7660G + 7600M Dual Graphics|36\n@ * 6550D|36\n@ * 7600M/7700M Series|36\n@(TM) Vega 3 Graphics|36\n@(TM) 625|36\nMobility @ * 5570|36\n@ HD8730|36\n@(TM) R9 M380|36\n@(TM) R5 240|36\n@ * 7650M|35\n@ * 7560D|35\n@ * 8690M|35\n@ * 8650G + 8750M Dual Graphics|35\n@ * 8650G + * 8750M Dual Graphics|35\n@ * 8650G + * 8570M Dual Graphics|35\n@ * 6570|35\n@ * 7650M|35\n@ * 6630M/6650M/6750M/7670M/7690M|35\n@ * 6500 Series|35\n@(TM) 520|35\n@ * 8570D|35\n@ * 7600M Series|35\n@ R7 Graphics|35\n@ * 7660G + 8670M Dual Graphics|35\n@ R7 200 Series|35\n@ * 6630M/6650M/6750M/7670M/7690M|35\n@ R7 M265|35\n@ * 8650G + * 8750M Dual Graphics|35\n@ * 8650G + 8670M Dual Graphics|35\n@ R7 Graphics|34\n@ * 6630M Series|34\n@(TM) 520|34\n@ * 7660D|34\nASUS R7 240 Series|34\n@ R9 M280X|34\n@(TM) R5 340|34\n@ * 8550G + 8600/8700M Dual Graphics|34\n@ R7 Graphics|34\n@(TM) * 8500M/8700M|34\n@ * 7660G + * 7600M Dual Graphics|34\n@ * 7670M|34\n@(TM) R5 M430|34\n@ * 8650G + 8500M Dual Graphics|34\n@(TM) R5 340X|34\n@(TM) R5 230 series|34\n@ * 8550|34\nFirePro W2100 (FireGL V)|34\nFirepro M4100 FireGL V|34\n@ * 6550D|34\n@ * 6630M|34\n@(TM) R9 M375|34\n@ * 5670 OpenGL Engine|33\n@ * 5670|33\n@ R7 Graphics|33\n@ * 7660G|33\n@ * 5570|33\n@ * 7550M/7650M Graphics|33\n@ * 7660D|33\n@ * 7560D|33\n@ * 7560D|33\n@ R5 M445 Series|33\n@ R5 M315|33\n@ * 8570D|33\n@ R7 M265|33\n@ * 7640G + * 7500/7600 Dual Graphics|33\n@ R7 Graphics|33\n@ * 8500M Series|33\nMobility @ * 5000|33\n@(TM) R7 M360|33\nFirepro M4100|33\n@(TM) Vega 10 Graphics|32\n@ * 7500M/7600M Series|32\n@ * 8550G + * 8600/8700M Dual Graphics|32\n@ * 7660G|32\n@ * 7350|32\n@ * 8470D + * 6450 Dual Graphics|32\n@ R7 Graphics|32\n@ * 8730M|32\n@ * 7640G + * 7400M Dual Graphics|32\n@ * 8690A|32\n@ * 8650G + 8600/8700M Dual Graphics|32\n@ R7|32\n@(TM) Vega 11 Graphics|32\n@(TM) Vega 8 Graphics|32\n@ R5 M200 Series|32\n@(TM) R5 M335|32\n@(TM) R5 M430|32\n@ * 8550G + * 8570M Dual Graphics|32\n@ * 7650M Series|32\n@ R7 250 Series|32\n@(TM) R7 M460|32\n@ * 6550D|32\n@ * 7660G + * 7600M Dual Graphics|32\n@(TM) Vega 3 Graphics|32\n@ * 8470D|32\n@ R8 M365DX|31\nMadison [Mobility @ * 5650/5750 / 6530M/6550M]|31\n@ * 6630M/6650M/6750M/7670M/7690M|31\n@ R7 Graphics|31\n@ E6760|31\n@ R7 Graphics|31\n@(TM) Vega 8 Graphics|31\n@(TM) R5 M330|31\n@ * 8670A/8670M/8690M|31\n@ R7 A360|31\n@ * 8650G + * 8600M Dual Graphics|31\n@ R5 M200 / * 8500M Series|31\n@(TM) R8 M435DX|30\n@ * 7640G + * 7670M Dual Graphics|30\n@(TM) Vega 10 Mobile Graphics|30\n@ R7 Graphics|30\n@ Pro 450/550|30\n@ * 8800M Series|30\n@ * 8470D|30\n@ * 7660D|30\n@ * 8610G + * 8600M Dual Graphics|30\n@ * 7660G + 7670M Dual Graphics|30\n@(TM) Vega 8 Mobile Graphics|30\n@ 610 Series|30\n@(TM) R5 M330|30\n@ * 7660G|30\n@ * 7640G|30\n@ R8 M365DX|30\n@ * 8550G|29\n@ * 7540D|29\n@ * 7640G|29\n@ * 8650G|29\n@(TM) R7 Graphics|29\n@(TM) ^ Vega 11 Graphics|29\n@ * 6650M|29\n@ * 7660G|29\n@ 6600M and 6700M Series|29\n@ * 7640G + * 7400M Dual Graphics|29\n@(TM) R5 340X|29\n@ R5 435|29\n@ * 6500M/5600/5700 Series|29\nFirepro M4100 FireGL V|29\n@ R7 Graphics|29\n@(TM) 535|29\n@ R7 240 Series|29\n@(TM) R7|29\n@ * 8550G + 8500M Dual Graphics|28\n@(TM) 530|28\n@ * 5650 Series|28\n@ * 7570M|28\n@ * 7570M|28\nASUS R7 240 Series|28\n@ * 6570|28\n@(TM) Vega 8 Graphics|28\n@ E8860|28\n@(TM) 530 series|28\n@(TM) R5 M315|28\n@ * 5500 Series|28\n@ * 8610G + * 8670M Dual Graphics|28\n@(TM) R6|28\n@ R9 M275X|28\n@ * 8550G + R5 M230 Dual Graphics|28\n@ * 8470D|28\n@ * 8670D|28\n@ * 7620G|28\n@(TM) R8 M350DX|28\n@ * 8470D|27\n@(TM) R8 M445DX|27\n@(TM) R7 Graphics|27\n@(TM) R5 Graphics|27\n@(TM) R7 M340|27\n@(TM) R6 Graphics|27\n@ R6 Graphics|27\n@ R5 M230 Series|27\n@ * 8650G|27\n@ * 7480D|27\n@(TM) R8 M445DX Graphics|27\n@(TM) R6 Graphics|27\n@ R7 Graphics|27\n@ R6|27\n@ R5 M255|27\n@(TM) Vega 3 Graphics|27\n@ 550X|27\n@(TM) Vega 3 Graphics|27\n@ * 7500/7600 Series|27\n@ * 8650G|27\n@ * 5500 Series|27\n@ * 7610M|27\n@ Instinct MI25 MxGPU|27\n@(TM) HD8530M|27\n@ R7 M260|27\n@(TM) R8 M445DX|27\n@ R7 Graphics|26\n@ * 8500M|26\n@(TM) R7 M260DX|26\n@ * 8410G|26\n@ * 8670A/8670M/8690M|26\n@(TM) R7 M360|26\n@(TM) R7 M360|26\n@ * 8670D|26\n@ R9 M275|26\n@ * 7640G|26\n@(TM) R7 Graphics|26\nMxGPU|26\n@ * 8370D|26\n@ * 6620G|25\n@ * 7560D|25\n@ * 8570 / R5 430 / R7 240/340 / @ 520|25\n@ R4 Graphics|25\n@ R6 Graphics|25\n@ R7 Graphics|25\n@(TM) 535DX|25\n@(TM) 540 Graphics|25\n@(TM) R5 M330|25\n@ * 6530D|25\n@ R6 Graphics|25\n@ * 8510G|25\n@ * 6620G|25\n@ R7 M360|24\n@(TM) R6 Graphics|24\n@ R7 M260|24\n@ * 8610G + * 8600M Dual Graphics|24\n@(TM) R6 Graphics|24\n@ R5 M200 / * 8500M Series|24\n@ R7 Graphics|24\n@ * 7600G|24\n@ R7 Graphics|24\n@ * 6620G|24\n@ R5 M330|24\n@(TM) R5 240|24\n@(TM) * 6620G|24\nFirePro V3800 (FireGL V)|24\n@ * 6520G|24\n@ R7 Graphics|24\n@ * 7520G|24\n@(TM) R6 Graphics|24\n@(TM) R7 M260|24\n@ ^ 540 Series|24\n@(TM) R5 M320|24\n@ * 8500M|23\n@ R5 M230|23\n@ * 8670M|23\n@ * 8550G + * 8750M Dual Graphics|23\n@ * 8600M Series (HAINAN, DRM 3.40.0, 5.11.13-arch1-1, LLVM 11.1.0)|23\n@ * 8550G|23\n@ R5 M240|23\n@ R5 M240 Series|23\n@ * 7540D|23\n@(TM) R5 M430|23\n@ R5 Graphics|23\n@(TM) R5 M430|23\n@ R6 Graphics|23\n@ * 7520G|23\n@ R7 Graphics|23\n@ * 8610G|22\nFirePro 3800 (FireGL) Graphics Adapter|22\n@ * 7570M/* 7670M Graphics|22\n@ * 7480D|22\n@(TM) R7 Graphics|22\n@ * 8650G + * 8600M Dual Graphics|22\n@(TM) Vega 6 Graphics|22\n@ R7 Graphics|22\n@ R5 Graphics|22\n@ * 7660G + * 8600M Dual Graphics|22\nFirePro M2000|22\n@ R7 Graphics|22\n@ * 7870M|22\n@ R5 M335|22\n@ R5|22\n@ * 8500M Series|22\n@(TM) * 8490|22\n@ * 8670M|22\n@ * 7660G + * 7670M Dual Graphics|22\n@ 7500M/7600M Series|22\n@ R5 Graphics|21\n@(TM) R4 Graphics|21\n@ * 8490|21\n@ * 8490|21\n@ R7 Graphics|21\n@ * 8570M|21\n@(TM) R5 M320|21\n@ R2|21\n@ * 6530D|21\n@(TM) * 6470M|21\nMxGPU|21\n@ * 7000 series|21\n@ * 7470|21\n@(TM) R8 M350DX|21\n@ R7 Graphics|21\n@ * 7520G + * 7400M Dual Graphics|21\n@(TM) R5 M335|21\n@ * 7400G|21\n@ * 7640G + * 8500M Dual Graphics|21\n@ * 7000 series|21\n@(TM) R5 Graphics|20\n@(TM) R7 M520 (R17M-M1-30)|20\n@ * 8470|20\n@ * 7480D|20\n@ * 6400M/7400M Series|20\n@(TM) R3 Graphics|20\n@ R6 M255DX|20\n@ * 8370D|20\n@ R5 Graphics|20\n@ R7 Graphics|20\n@ * 6410D|20\n@(TM) R5 Graphics|20\n@ R5 M330|20\n@ R7 M260DX|20\n@(TM) R5 Graphics|20\n@ * 7480D|20\n@ * 6470M|20\n@ Hybrid (Blocked)|20\n@(TM) R7 Graphics|20\n@(TM) R6 M340DX|20\n@ R5 235|20\n@ * 7520G|19\n@(TM) R6 M255DX|19\n@ R5 M240|19\n@(TM) R3 Graphics|19\n@ R7E Graphics|19\n@ R5 M200 Series|19\n@ * 7470|19\n@ * 7640G + 8500M Dual Graphics|19\n@(TM) R5 M330|19\n@ * 6470M|19\n@ R3 Graphics|19\n@ * 8400E|19\n@ * 7640G + * 8570M Dual Graphics|19\n@ * 8400|19\n@ * 8400 / R3 Series|19\n@ R5 Graphics|19\n@(TM) R7 M265|19\n@ R5 M230|19\n@ R5 Graphics|19\n@ * 7620G|19\n@ R5 Graphics|19\n@(TM) * 6470M|19\n@ * 7480D|18\n@ R7 Graphics|18\n@(TM) R5 Graphics|18\n@ * 8550G|18\n@ * 8370D|18\n@ R5 Graphics|18\n@(TM) * 7450|18\n@ * 6530D|18\n@ * 8570M|18\n@ R6 Graphics|18\n@ * 7650A|18\n@ * 8450G|18\n@ * 8550G + R5 M230 Dual Graphics|18\n@ * 7640G + 7470M Dual Graphics|18\n@ * 8370D|18\n@ * 7400M Series|18\n@ * 8670D + R5 200 Dual Graphics|17\n@ * 7500G|17\n@ * 7790|17\n@ * 7450M|17\n@(TM) * 7450A Graphics|17\n@(TM) R5 Graphics|17\n@(TM) R6 Graphics|17\n@(TM) R4 Graphics|17\n@ * 8650G + * 8500M Dual Graphics|17\n@ * 7400M Series|17\n@ * 8450G|17\n@ * 6520G|17\n@ * 8470D|17\n@(TM) R5 Graphics|17\n@(TM) R4E Graphics|17\n@ * 8330|17\n@ * 8400|17\n@(TM) * 8510G|17\n@(TM) R5 Graphics|17\n@ * 8650G|17\n@ * 6490M|17\n@ R7 Graphics|16\n@ * 6400 Series|16\n@ * 8510G|16\n@ * 7400 Series|16\n@ * 7400 Series|16\n@(TM) * 8510G|16\n@ * 6370D|16\n@ * 7420G|16\n@ * 7520G + * 7600M Dual Graphics|16\n@ R9 260|16\n@ * 7640G + 7600M Dual Graphics|16\n@ * 7470M|16\n@(TM) R2 Graphics|16\nRADEON * 6450|16\n@(TM) R1E Graphics|16\n@ R5 Graphics|16\n@ * 7420G|16\n@(TM) R4 Graphics|16\n@(TM) R4 Graphics|16\n@(TM) R4 Graphics|16\n@ * 7480D|16\n@ * 6490M|15\nRADEON * 6450|15\n@(TM) * 8610G|15\n@(TM) * 8610G|15\n@ * 8610G + 8600M Dual Graphics|15\n@ * 7350|15\n@(TM) * 6480G|15\n@ * 8650G + 8600M Dual Graphics|15\n@ * 8570D|15\n@ * 6370M|15\nMobility @ * 5000 Series|15\n@ R2 Graphics|15\n@ * 8240 / R3 Series|15\n@ * 8650G + R5 M200 Dual Graphics|15\n@ * 8400E|15\n@(TM) R4 Graphics|15\n@ R5 Graphics|15\n@ * 8610G|15\n@ * 8650G + * 8500M Dual Graphics|15\n@(TM) R7 M260|15\nASUS EAH6450 Series|15\n@ R3 Graphics|15\n@(TM) R6 M340DX|15\n@ R6E Graphics|15\n@ R5 Graphics|15\n@ R2 Series|14\n@ * 6450/7450/8450/R5 230|14\n@ * 8200 / R3 Series|14\n@(TM) R3 Graphics|14\n@ R5 230|14\n@(TM) * 8510G|14\n@(TM) R4 Graphics|14\n@ R5 M435|14\n@ * 8240|14\nASUS R5 230 Series|14\nFirePro M2000|14\n@ * 7500G|14\n@ * 7450|14\nRADEON * 6450|14\n@ * 8400E|14\nRADEON * 6350|14\n@ * 6480G|14\n@(TM) R5E Graphics|14\nCARRIZO 9874|14\nMobility @ * 5000 Series|14\n@ * 6630M|14\n@ * 6370M|14\n@ * 8400 / R3 Series|14\n@(TM) R2 Graphics|14\nASUS EAH6450 Series|14\n@ * 7470M|13\nMobility @ * 5470|13\nMobility @ * 5400 Series|13\n@(TM) R5E Graphics|13\n@(TM) R2 Graphics|13\n@ * 6540|13\n@ * 7450|13\n@ * 5450|13\n@ * 8600M Series|13\n@ * 8400 / R3 Series|13\nKaveri|13\n@(TM) * 6480G|13\n@ * 5400 Series|13\n@ * 8330|13\nRADEON * 6350|13\n@ R4/R5 Graphics|13\n@ * 7600G +™ * Dual Graphics|13\n@ R3 Graphics|13\nASUS R5 230 Series|13\n@(TM) R7 Graphics|13\n@ * 7620G|13\n@ * 8250|13\n@(TM) R7 Graphics|12\n@ * 6450/7450/8450 / R5 230|12\n@ * 6480G|12\n@(TM) R7 Graphics|12\n@ * 5450 Series|12\n@ * 8400 / R3 Series|12\n@(TM) * 6400 Series|12\n@(TM) R4 Graphics|12\nRADEON HD5450|12\n@ R5 Graphics|12\n@ R5 Graphics|12\n@(TM) R6 Graphics|12\n@(TM) R4 Graphics|12\n@(TM) R2 Graphics|12\n@ * 8210|12\n@ R5 230|12\n@ R3 Graphics|12\nFirePro 2270|12\n@(TM) R2E Graphics|12\n@ * 8400 / R3 Series|12\n@ * 8350G|12\n@ * 8400|12\n@ R2 Graphics|12\n@ * 8210 Graphics|12\n@ E6460|12\n@(TM) * 8280E|12\n@ R2 Graphics|11\n@ * 8450G + * 8750M Dual Graphics|11\n@ * 8330|11\n@ * 5470|11\n@ * 7600G + 7500M/7600M Dual Graphics|11\n@ R5 220|11\n@ * 8200 / R3 Series|11\n@ * 8240|11\n@ * 8400 / R3 Series|11\n@ * 8200 / R3 Series|11\n@ * 5450|11\n@(TM) 620|11\n@(TM) Vega 8 Mobile Graphics|11\n@ * 6530D|11\n@(TM) * 6520G|11\n@ * 6300M Series|11\nASUS EAH5450|11\n@ R5 220|11\n@ * 8250|11\n@ * 7340|11\n@ * 7340M|11\n@ * 8210|11\n@ * 7700 Series|10\n@ * 6380G|10\n@ * 5400 Series|10\n@ * 8240|10\n@ * 7640G + 7670M Dual Graphics|10\n@(TM) R6 Graphics|10\nASUS EAH5450 Series|10\n@ * 6320|10\n@ * 7340G|10\n@ * 6410D|10\n@ * 7340|10\n@ * 6320|10\n@(TM) R2 Graphics|10\n@ * 8180|9\nMobility @ * 5430|9\n@ R2 Graphics|9\n@ R2 Series|9\n@ * 8210|9\nFirePro 2270|9\n@ R2E Graphics|9\n@ * 7340|9\n@ * 6320|9\n@ * 7310|9\n@ * 6310|9\n@ R7 Graphics|9\n@ * 7310|8\n@ * 8250|8\n@ * 8180|8\n@ * 6630M|8\n@ * 6230|8\n@ * 6320|8\n@ * 6400M Series|8\n@ * 7290 Graphics|7\n@ * 6290|7\n@ * 6310|7\n@ * 8180|7\nASUS EAH5450 Series|7\n@(TM) R2 Graphics|6\n@ * 6310|6\n@ * 7500G|6\n@ * 8240 / R3 Series|6\n@ * 6250|6\n@ * 6380G|6\n@ * 6300M Series|5\n@ * 7310|5\n@ R3 Graphics|5\n@(TM) R6 Graphics|5\n@ * 6250|5\n@ * 6290|5\n@ * 6250|5\n@ * 7290 Graphics|4\n@ * 5000/6000/7350/8350 Series|3\n@ ^ Vega 56 OpenGL Engine|-1\nFirePro V4800 (FireGL) Graphics Adapter|-1\n@ * 7670M|-1\n@ * 8570D|-1\n7340:C5|-1\n@ * 8550G|-1\n@ R5 Graphics|-1\nASUS R7 360 Series|-1\nBonaire [FirePro W5100]|-1\n@ * 6380G|-1\n@ R7 Graphics|-1\nFireGL V8650|-1\nFirePro S7150|-1\nFirePro V3900 (FireGL V)|-1\nFirePro V7800 (FireGL V)|-1\nFirePro W4100 Graphics Adapter|-1\nFirePro W4170M (FireGL V)|-1\nGigabyte @ ^ 580|-1\nMobility FireGL V5700|-1\nMobility @ 4100|-1\nMobility @ * 2400|-1\nMobility @ * 2400 XT|-1\nMobility @ * 2600|-1\nMobility @ * 2600 XT|-1\nMobility @ * 3200|-1\nMobility @ * 3400 Series|-1\nMobility @ * 3430|-1\nMobility @ * 3470|-1\nMobility @ * 3650|-1\nMobility @ * 4200 Series|-1\nMobility @ * 4250|-1\nMobility @ * 4300 Series|-1\nMobility @ * 4500 Series|-1\nMobility @ * 4500/5100 Series|-1\nMobility @ * 4650|-1\nMobility @ * 4670|-1\nMobility @ * 4850|-1\nR9 270X Devil|-1\n^ 560X|-1\n@|-1\n@(TM) HD8530M|-1\n@ 3000|-1\n@ 3100 Graphics|-1\n@ * 2400 PRO|-1\n@ * 2400 XT|-1\n@ * 2600 Pro|-1\n@ * 2600 XT|-1\n@ * 2900 GT|-1\n@ * 3200 Graphics|-1\n@ * 3300|-1\n@ * 3450|-1\n@ * 3470|-1\n@ * 3600 Series|-1\n@ * 3650|-1\n@ * 3850|-1\n@ * 3870|-1\n@ * 3870 X2|-1\n@ * 4200|-1\n@ * 4250|-1\n@ * 4290|-1\n@ * 4300/4500 Series|-1\n@ * 4550|-1\n@ * 4600 Series|-1\n@ * 4650|-1\n@ * 4670|-1\n@ * 4830|-1\n@ * 4850|-1\n@ * 4870|-1\n@ * 4890|-1\n@ * 5670 640SP Edition|-1\n@ * 5800 Series|-1\n@ * 5850|-1\n@ * 6490M|-1\n@ * 6730M/6770M|-1\n@ * 6750|-1\n@ * 6800M Series|-1\n@ * 7540D + * 6670 Dual Graphics|-1\n@ * 7700M Series|-1\n@ * 7800 Series|-1\n@ * 8350|-1\n@ * 8370D|-1\n@ * 8600/8700M|-1\n@ Pro WX Vega M GL Graphics|-1\n@ R5 200 Series|-1\n@ R7 A370|-1\n@ R9 200 Series|-1\n@ R9 290X/390X|-1\n@ R9 380X|-1\n@ ^ 480|-1\n@ ^ 550X|-1\n@ ^ 6650M|-1\n@ RX6600XT|-1\n@(TM) R8 M435DX|-1\n@(TM) R9 290X|-1\n@(TM) RX540|-1\ninc. @ * 7970|-1\nRadeong 0.4 on AMD CAPE VERDE (DRM 2.43.0, LLVM 3.7.0)|-1\nRadeong 0.4 on AMD CAPE VERDE (DRM 3.9.0 / 4.9.0-rc1+, LLVM 4.0.0)|-1\nRadeong 0.4 on AMD FIJI (DRM 3.2.0 / 4.7.0-rc5+, LLVM 4.0.0)|-1\nRadeong 0.4 on AMD TAHITI (DRM 2.43.0, LLVM 3.9.0)|-1\n";let y=[],_=[],T=[];function b(e){if(!e)return 0;const t=function(e){if(e===f.V.Intel&&y.length)return y;if(e===f.V.Nvidia&&_.length)return _;if(e===f.V.Amd&&T.length)return T;try{const t=function(e){return e===f.V.Intel?g:e===f.V.Nvidia?m:e===f.V.Amd?v:""}(e),n=(0,f.b)(t,e);return e===f.V.Intel&&(y=n),e===f.V.Nvidia&&(_=n),e===f.V.Amd&&(T=n),n}catch{}return[]}(e.vendor);return(0,f.a)((0,f._)(t,e))}const S=class e{static setConfig(t){e.cfg=t}static getGPUVendor(){return(0,f.g)(e.cfg)}static getGPUParsedVendor(t){return(0,f.p)(t||e.getGPUVendor())}static parseVendor(t){try{const n=e.getGPUParsedVendor(t);return n?{...n,score:b(n)}:null}catch{}return null}};(e=>{"cfg"in e?p(e,"cfg",{enumerable:!0,configurable:!0,writable:!0,value:null}):e.cfg=null})(S);let P=S;var w=Object.defineProperty,k=(e,t,n)=>((e,t,n)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class M{constructor(){k(this,"origin",""),k(this,"score",0)}getScore(){return new Promise((e=>{e(this.getScoreSync())}))}getScoreSync(){const e=P.parseVendor();return e?(this.score=e.score,this.origin=e.origin,{origin:this.origin,score:this.score,vendorParsedInfo:e}):{origin:this.origin,score:this.score}}}var E=Object.defineProperty;class R{constructor(e){((e,t,n)=>{((e,t,n)=>{t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n)})(this,"mappingFn"),this.mappingFn=e.mapping}getScore(){return new Promise((e=>{e(this.getScoreSync())}))}getScoreSync(){try{const e=navigator.deviceMemory;let t=0;return this.mappingFn&&(t=this.mappingFn(e)),{score:t,origin:e}}catch{return{score:0,origin:-1}}}}var x=Object.defineProperty,D=(e,t,n)=>((e,t,n)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class I{constructor(e){D(this,"mappingFn"),this.mappingFn=e.mapping}getScore(){return new Promise((e=>{e(this.getScoreSync())}))}getScoreSync(){var e;try{const t=null==(e=null==navigator?void 0:navigator.connection)?void 0:e.downlink;let n=0;return this.mappingFn&&(n=this.mappingFn(t)),{score:n,origin:t}}catch{return{score:0,origin:-1}}}}class C{constructor(e){D(this,"mappingFn"),this.mappingFn=e.mapping}_getBandwidth(){if(!performance.getEntries)return-1;const e=performance.getEntries().filter((({initiatorType:e,decodedBodySize:t,responseEnd:n,responseStart:r})=>("img"===e||"script"===e)&&t>0&&n!==r)),t=e.reduce(((e,{decodedBodySize:t,responseEnd:n,responseStart:r})=>{const i=8e3*t/(n-r)/1024/1024;return e+(i<1e5?i:0)}),0);return e.length?t/e.length:-1}getScore(){return new Promise((e=>{e(this.getScoreSync())}))}getScoreSync(){try{const e=this._getBandwidth();let t=0;return this.mappingFn&&(t=this.mappingFn(e)),{origin:e,score:t}}catch{return{score:0,origin:-1}}}}const L="xg-decodeimg-scores-map",O=()=>{let e={};try{const t=localStorage.getItem(L);t&&(e=JSON.parse(t))}catch{}return e},A=(e,t)=>{let n=[];return t&&e[t]&&(n=e[t]),n},G=e=>{let t=0;return e>0&&(t=e<=1?0:e<4?3*Math.log2(e):e<8?1.6*(Math.log2(e)-2)+6:.523*(Math.log2(e)-3)+7.6),t},B=e=>(t,n)=>{let r=0;if(!e)return r;const i=(e=>{const t=new URL(e);return t.origin+t.pathname})(e);if(t>0){const e=Math.log10(t+1);r=e<=1?6*e:e<=2?1.6*(e-1)+6:2.4*(e-2)+7.6,r=Math.round(100*r)/100,r=((e,t)=>{try{let n=e;const r=O(),i=A(r,t);return i.length>0?(i.push(e),n=i.reduce(((e,t)=>e+t),0)/i.length,i.length>10&&i.shift()):i.push(e),t&&(r[t]=i),(e=>{try{localStorage.setItem(L,JSON.stringify(e))}catch{}})(r),n}catch{return e}})(r,i)}else!0!==n&&(r=(e=>{const t=O(),n=A(t,e);let r=0;return n.length>0&&(r=n.reduce(((e,t)=>e+t),0)/n.length),r})(i));return r},N=e=>{let t=0;return e>0&&e<1e6&&(t=e>64?6-1.5*(Math.log2(e)-6):e>8?7.6-.533*(Math.log2(e)-3):7.6+.03*(8-e)),t},$=e=>{let t=0;return e>1&&(t=e<=4?3*Math.log2(e):e<8?2*(Math.log2(e)-2)+6:.65*(Math.log2(e)-3)+8),t},U=e=>{let t=0;return e>0&&e<1e6&&(t=e<=1?0:e<10?6*Math.log10(e):10),t},F=e=>{let t=0;return e>0&&e<1e6&&(t=e<=1?0:e<40?3.745*Math.log10(e):e<100?4.02*(Math.log10(e)-1.602)+6:5.03*(Math.log10(e)-2)+7.6),t};class H extends o{constructor(e){var t;super((t=e.decodeImgUrl,{plugins:{performance:{plugins:{cpu:{plugins:{cpuCoreNumber:{instance:new c({mapping:G})},decodeImg:{instance:new h({url:t,mapping:B(t)})},timer:{instance:new d({mapping:N})}}},memory:{instance:new R({mapping:$})},gpu:{instance:new M}}},net:{plugins:{downlink:{instance:new I({mapping:U})},performanceNet:{instance:new C({mapping:F})}}}}}))}scoreAsync(){return this.getScore()}scoreSync(e){return this.getScoreSync(e)}}},4629:(e,t,n)=>{"use strict";n.d(t,{lg:()=>h,Zo:()=>c});var r=n(6607),i=Object.defineProperty;let s=[],a=[],o=[];const l=class e{static setConfig(t){e.cfg=t}static getGPUVendor(){return(0,r.g)(e.cfg)}static getGPUParsedVendor(t){return(0,r.p)(t||e.getGPUVendor())}static parseVendorAsync(t){const n=e.getGPUParsedVendor(t);if(!n)return Promise.resolve(null);if(!e.cfg)throw new Error("need specify config, call setConfig() method");return function(e,t){return e?async function(e,t){let n;if(e===r.V.Intel){if(s.length)return s;n=t.intelPath}if(e===r.V.Nvidia){if(a.length)return a;n=t.nvidiaPath}if(e===r.V.Amd){if(o.length)return o;n=t.amdPath}if(!n)return Promise.resolve([]);try{const t=await fetch(n).then((e=>e.text())),i=(0,r.b)(t,e);return e===r.V.Intel&&(s=i),e===r.V.Nvidia&&(a=i),e===r.V.Amd&&(o=i),i}catch{}return[]}(e.vendor,t).then((t=>(0,r._)(t,e))).then(r.a):Promise.resolve(0)}(n,e.cfg).then((e=>({...n||{},score:e}))).catch((()=>null))}};((e,t)=>{t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:null}):e[t]=null})(l,"cfg");let u=l;function c(){let e=!1;if(typeof MediaSource>"u"||!MediaSource.isTypeSupported||function(){if(typeof navigator>"u")return!1;const e=navigator.userAgent.match(/Edg\/(\d+)\./);if(e&&e.length>=2){const t=parseInt(e[1]);return t>=117&&t<=122}return!1}())return e;if(e=MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'),e){const t=u.getGPUParsedVendor();e=!!t&&t.vendor!==r.V.CpuDeriver}return e}async function h(e){const{url:t,minDroppedFramesRate:n,minTotalVideoFrames:r}=Object.assign({url:"",minDroppedFramesRate:0,minTotalVideoFrames:0},e);let i,s,a,o;const l=new Promise((e=>{function l(t=1001,n){e({status:!1,errCode:t,robustErr:2101===t||2001===t||3e3===t,...n||{}})}!t||0===n&&0===r?l(1e3):(s=()=>{let t="";try{if(!i.getVideoPlaybackQuality)return l(2001);const{totalVideoFrames:t,droppedVideoFrames:s}=i.getVideoPlaybackQuality(),a=s/t,o={droppedFrameRate:a,droppedVideoFrames:s,totalVideoFrames:t};return void((n?a<=n:r&&t>r)?e({status:!0,...o}):l(3e3,o))}catch(e){t=(null==e?void 0:e.message)||e||"empty err msg"}l(2200,{errMsg:t})},a=()=>{const e=i.error;l(2e3,{errMsg:`${e.code}-${e.message}`})},o=()=>{const e=i.play();e&&e.then((e=>{})).catch((e=>{const t=e.message;let n=2100;/no supported source/gi.test(t)||/The media resource indicated by the src attribute or assigned media provider object was not suitable/gi.test(t)||/NotSupportedError/gi.test(t)?n=2101:/video-only background media was paused to save power/gi.test(t)?n=2103:(/the user didn't interact with the document first/gi.test(t)||/user denied permission/gi.test(t))&&(n=2102),l(n,{errMsg:t})}))},i=function(e){const t=document.createElement("video");return t.style.cssText="width:50px;height:50px;position:absolute;top:0;left:0;z-index:999999;opacity:.001;pointer-events:none;",t.muted=!0,t.autoplay=!1,t.src=e,t}(t),i.addEventListener("loadedmetadata",o,!1),i.addEventListener("ended",s,!1),i.addEventListener("error",a,!1),i.load(),document.body.append(i))}));return l.finally((()=>{i&&(s&&a&&o&&(i.removeEventListener("loadedmetadata",o,!1),i.removeEventListener("ended",s,!1),i.removeEventListener("error",a,!1),s=null,a=null,o=null),document.body.removeChild(i),i=null)})),await l}},61906:(e,t,n)=>{"use strict";n.d(t,{M:()=>R,a:()=>T,b:()=>P,m:()=>M});var r=n(5267),i=n(65350),s=n(4629),a=n(90543),o=n(24220);function l(){return void 0===typeof window}function u(e,t=2){return Math.floor(e*Math.pow(10,t))/Math.pow(10,t)}function c(){if(l())return!1;const e=window.navigator.userAgent;if(!/iPad|iPhone|iPod/.test(e))return!(null==window||!window.MediaSource)&&((null==window?void 0:window.MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"'))||(null==window?void 0:window.MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"'))||(null==window?void 0:window.MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"'))||(null==window?void 0:window.MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"')));try{const e=document.createElement("video");return[e.canPlayType('video/mp4; codecs="hvc1.1.L0.0"'),e.canPlayType('video/mp4;codecs="hev1.1.6.L120.90"'),e.canPlayType('video/mp4;codecs="hev1.2.4.L120.90"'),e.canPlayType('video/mp4;codecs="hev1.3.E.L120.90"'),e.canPlayType('video/mp4;codecs="hev1.4.10.L120.90"')].some((e=>"probably"===e||"maybe"===e))}catch{return console.error("check hevc error"),!1}}const h="ttplayer_focus_disable_hevc",d="ttplayer_hevc_result",f="MultiMediaHevcPloy",p=["video_detail","one_column","browser_mode"],g=["video_detail","homepage_hot","homepage_follow","others_homepage"],m=["Intel","AMD","NVIDIA","Apple"];function v(e,t=1,n=[]){return!(!e||"unknown"===e)&&((!n||n.length<1)&&(n=2===t?g:p),n.filter((t=>e===t)).length>0)}function y(e,t=[]){return!(t.length<1||!e)&&t.filter((t=>e===t)).length>0}function _(e,t,n,r){const i=v(e,2,n),s=v(t,1,r);return i&&s}class T{constructor(){this.dropedRate=0,this.hevcDropedRate=0,this.minDif=10,this.minFrames=60,this.maxDropedRate=10,this.forceNotHevc=!1,this._needPersist=!0,this.hevcDisableInfo={hevcMsg:"",hevcCode:0,hevcF:0},this.effectiveConditions={},this.robustnessTestResult=!1,this.configure={url:"",minDroppedFramesRate:.1,minTotalVideoFrames:10},this.hevcRobustnessResult={isSupportBase:!1,supportRobustness:"unknown",droppedFrameRate:0,droppedVideoFrames:0,totalVideoFrames:0,status:!1,errCode:0,errMsg:"",robustErr:!1,date:0};const e=this.getLocalDisableInfo();(0,a.l)(f,"localDisableInfo",e),e&&(this.forceNotHevc=e.disable>0,this.hevcDisableInfo={hevcMsg:e.hevcMsg,hevcCode:e.hevcCode,hevcF:2}),this.detectCallBack=null}getLocalDisableInfo(){try{return(0,a.g)(h)||null}catch{return null}}getLocalHevcResult(){const e=(0,a.g)(d);if(!e)return null;try{return e}catch{return null}}set needPersist(e){this._needPersist=e,e||(0,a.r)(d)}get needPersist(){return this._needPersist}setRobustnessResult(e){const{hevcRobustnessResult:t}=this;if(e.errCode?(t.errCode=e.errCode,t.errMsg=e.errMsg,t.robustErr=e.robustErr,t.status=e.status,t.supportRobustness="error"):(t.droppedFrameRate=e.droppedFrameRate,t.droppedVideoFrames=e.droppedVideoFrames,t.totalVideoFrames=e.totalVideoFrames,t.status=e.status,t.supportRobustness=e.status?"supported":"unSupported"),t.date=(new Date).getTime(),this.detectCallBack){const{forceNotHevc:e,hevcRobustnessResult:t}=this,n=(0,s.Zo)()&&c()&&!e&&!!t.status;this.detectCallBack(n)}}static getInstance(){return T.instance||(T.instance=new T),T.instance}static setDropRate(e,t,n){(0,a.l)(f,"setDropRate",e,t,n);const r=T.getInstance();if(t<1||n<r.minFrames)return;const i=t/n*100;e.startsWith("h265")?r.hevcDropedRate=i:r.dropedRate=i;const{hevcDropedRate:s,dropedRate:o,minDif:l,maxDropedRate:u}=r;(s-o>l||s>u)&&(r.forceNotHevc=!0)}static useHevc(e=1){const{forceNotHevc:t,hevcRobustnessResult:n}=T.getInstance(),r=(0,s.Zo)()&&c()&&!t;return e<2?r:r&&n.status}static focusDisableHevc(e,t=!0){const n=T.getInstance();!n||n.forceNotHevc||(n.forceNotHevc=!0,n.hevcDisableInfo={...e,hevcF:1},(0,a.l)(f,"focusDisableHevc",t,n.forceNotHevc,e),t&&(0,a.s)(h,{disable:1,...e,timestamp:(new Date).getTime()},6048e5))}static setDetectCallback(e){T.getInstance().detectCallBack=e}static setEffectiveConditions(e){const t=T.getInstance();Object.keys(e).forEach((n=>{t.effectiveConditions[n]=e[n]}))}static getHevcDisableInfo(){const e=T.getInstance();if(!e)return null;const{hevcDisableInfo:t,hevcRobustnessResult:n}=e;return{...t,rcode:n.errCode||0,rmsg:n.errMsg||"",rstatus:n.status?1:0}}static async hevcDeviceDetect(e,t=2,n){const r=T.getInstance();let i=r.needPersist;void 0!==n&&(r.needPersist=n,i=n);const{configure:o,hevcRobustnessResult:l}=r;l.isSupportBase=(0,s.Zo)(),i||(0,a.r)(d);const u=r.getLocalHevcResult();if(l.date>0)return l;if(u)return r.setRobustnessResult(u),l;const c=e?"https://lf16-tiktok-web.tiktokcdn-us.com/obj/tiktok-web-tx/tiktok/webapp/main/webapp-desktop/playback1.mp4":"https://sf16-website-login.neutral.ttwstatic.com/obj/tiktok_web_login_static/tiktok/webapp/main/webapp-desktop/playback1.mp4";return void 0===typeof window?l:t<2||!c?(l.isSupportBase=(0,s.Zo)(),l):(l.date=(new Date).getTime(),o.url=c,void(0,s.lg)(o).then((e=>(r.setRobustnessResult(e),i&&e.status&&(0,a.s)(d,l,6048e5),l))).catch((e=>(r.setRobustnessResult(e),l))))}}function b(e){const{performance:t,net:n}=e;if(!t&&!n)return{score:0};const r={score:0};try{if(n){const{downlink:e={},performanceNet:t={},score:i=0}=n;r.link_s=u((null==e?void 0:e.score)||0),r.link_o=u((null==e?void 0:e.origin)||0),r.netper_s=u((null==t?void 0:t.score)||0),r.netper_o=u((null==t?void 0:t.origin)||0),r.net_s=u(i)}if(t){const{cpu:e,memory:n,gpu:i,score:s}=t,a=null==i?void 0:i.vendorParsedInfo;r.memory_s=u((null==n?void 0:n.score)||0),r.gpu_s=u((null==i?void 0:i.score)||0),r.gpu=(null==i?void 0:i.origin)||"",r.vendor=(null==a?void 0:a.vendor)||"",r.gpu_m=(null==a?void 0:a.model)||"",r.cpu_s=u((null==e?void 0:e.score)||0);const{cpuCoreNumber:o,decodeImg:l,timer:c}=e;r.core_s=u((null==o?void 0:o.score)||0),r.decdeimg_s=u((null==l?void 0:l.score)||0),r.decdeimg_o=u((null==l?void 0:l.origin)||0),r.timer_s=u((null==c?void 0:c.score)||0),r.timer_o=u((null==c?void 0:c.origin)||0),r.score=u(s||0)}return r}catch{return r}}function S(e){var t;const n=null==(t=null==e?void 0:e.performance)?void 0:t.gpu;if(!n)return null;const{vendorParsedInfo:r}=n;return{score:n.score||-2,gpu:n.origin||"",vendor:(null==r?void 0:r.vendor)||""}}class P{constructor(){this._asyncDate=0,this._syncDate=0,this.deviceScore=0,this.score=0,this.netScore=0,this.markData={},this.shortData={},this._mark=null,this.curImgUrl="",this.gpuScoreData={score:-2,vendor:"",gpu:""},!l()&&this.syncMark()}syncMark(){var e;if(0!==this._syncDate)return;this._mark||(this._mark=new o.r({decodeImgUrl:this.curImgUrl})),this._syncDate=(new Date).getTime(),this.markData=this._mark.scoreSync({ignoreCachedImg:!0});const t=b(this.markData);this.deviceScore=t.score,this.score=t.score,this.netScore=u(0|(null==(e=this.markData.net)?void 0:e.score)),this.shortData={...t,d_score:this.deviceScore};const n=S(this.markData);n&&(this.gpuScoreData=n)}async asyncMark(e){if(0!==this._asyncDate)return;this.curImgUrl=e?"https://lf16-tiktok-web.tiktokcdn-us.com/obj/tiktok-web-tx/tiktok/webapp/main/assets/perf_images/performance.jpeg":"https://sf16-website-login.neutral.ttwstatic.com/obj/tiktok_web_login_static/tiktok/webapp/main/assets/perf_images/performance.jpeg";const t=new o.r({decodeImgUrl:this.curImgUrl});this._mark=t,this._asyncDate=(new Date).getTime();const n=await(null==t?void 0:t.scoreAsync());this.markData=n;const r=b(n);this.shortData={...r,d_score:this.deviceScore},this.score=this.shortData.score;const i=S(n);i&&(this.gpuScoreData=i)}get markScore(){const{score:e,deviceScore:t,gpuScoreData:n,shortData:r}=this;return{score:e,deviceScore:t,gpuScoreData:n,shortData:r}}static getInstance(){return P.instance||(P.instance=new P),P.instance}static syncMark(){return P.getInstance().syncMark()}static async asyncMark(e){return P.getInstance().asyncMark(e)}static get shortData(){return P.getInstance().shortData}static get gpuScoreData(){return P.getInstance().gpuScoreData}static get markScore(){return P.getInstance().markScore}static markData(){return P.getInstance().markData}}class w{constructor(){this.config={t1:5,t2:20,minWeight:.2,maxCount:25,minSize:20480,maxSize:10485760},this._record=[]}updateConfig(e){this.config={...this.config,...e}}setSpeed(e){const{speed:t,size:n,duration:r}=e,{maxSize:i,minSize:s,maxCount:a}=this.config;!t||n<=0||r<=1||n<s||n>i||(this._record.push({speed:t,size:n,duration:r,t:Date.now()}),this._record.length>a&&this._record.shift())}getTimeWeight(e,t){const{t1:n=5,t2:r=20,minWeight:i=.2}=this.config,s=Math.round((t-e)/1e3);return s<=n?1:s>=r?i:Math.round((100-100*i)/(r-n)*(r-s))/100}getSpeed(){const e=Date.now(),{_record:t}=this;let n=0;const r=t.map((t=>{const r=t.size*this.getTimeWeight(t.t||0,e);return n+=n,{weight:r,speed:t.speed}}));r.sort(((e,t)=>e.speed-t.speed));const i=n/2;let s=-1,a=-1;for(let e=0;e<r.length;e++){const t=r[e],n=Math.abs(t.weight-i);(n<a||a<0)&&(s=e,a=n)}return s>=0?r[s].speed:0}getAvgSpeed(){const{_record:e}=this;let t=0;for(let n=0;n<e.length;n++)t+=e[n].speed;return e.length>0?Math.round(t/e.length):0}}const k="unknown",M=new i.A,E=class e{constructor(){this.isTTP=null,this.abTestVersion="",this.hevcAbVersion="",this.logInitInfo={},this.logConfig={},this.dropCount=0,this.totalCount=0,this.deviceMark=P.getInstance(),this.networkSpeed=new w,this.channelInfo={channel:"",domain:"",type:""},this.regionInfo={region:"",uid:"",isLogin:!1},this.hevcTestData={vid:"v0",open:!1,onlySrc:!1,score:-2,playModes:[],pageNames:[],qualityType:20,hevcQualityType:28,closePreload:!1,level:2},this.abTestData={},this.prePlayMode=k,this.curPlayMode=k,this.curPageName=k,this.prePageName=k}static get version(){return r.v}static set channelInfo(t){e.getInstance().channelInfo=t}static get channelInfo(){return e.getInstance().channelInfo}static set regionInfo(t){e.getInstance().regionInfo=t}static get regionInfo(){return e.getInstance().regionInfo}static set playMode(t){const{instance:n}=e;n.prePlayMode=n.curPlayMode,n.curPlayMode=t}static get playMode(){return e.getInstance().curPlayMode}static get prePlayMode(){return e.getInstance().prePlayMode}static set pageName(t){const n=e.getInstance();t!==n.curPageName&&(n.prePageName=n.curPageName,n.curPageName=t)}static get pageName(){return e.getInstance().curPageName}static get prePageName(){return e.getInstance().prePageName}static getInstance(){return e.instance||(e.instance=new e),e.instance}static checkHevcResult(t=!1){const{hevcTestData:n,curPageName:r,curPlayMode:i,deviceMark:s}=e.getInstance(),{gpuScoreData:a,score:o,deviceScore:l}=s,{device:u}=e;return function(e,t,n=!1){const{curPlayMode:r,curPageName:i,browser:s}=t,a=t.score,o=t.vendor||"",l=t.dScore||-1,u={qualityType:20,hevcQualityType:28,open:!1,openSrc:!1,closePreload:!1,vid:(null==e?void 0:e.vid)||"v0",data:e},{effectiveConditions:c}=T.getInstance(),h=c[s];if(h||!e||"v1"===e.vid||"v0"===e.vid){const e=function(e,t,n){const r={open:!1,openSrc:!1,hevcQualityType:28},{score:i,dScore:s,deviceScore:a,curPageName:o,curPlayMode:l,cpuCore:u,vendor:c}=e,h=n,d=T.useHevc((null==h?void 0:h.checkLevel)||2);if(r.hevcQualityType=(null==h?void 0:h.hevcQualityType)||28,!d||!h||!u||u<h.cpuCore)return r;const{pageNames:f=[],playModes:p=[]}=h;return(!!t||_(o,l,f,p))&&(s>0&&h.score&&s>=h.score||a>0&&h.dScore>0&&a>=h.dScore||h.gpuScore>0&&i>=h.gpuScore||i<0&&y(c,m))&&(r.open=!0,r.openSrc=!0),r}(t,n,h);if(e.open)return{...u,...e}}const d=(null==e?void 0:e.level)||2;if(!T.useHevc(d)||!e||!e.open||a<-1||!o)return u;u.closePreload=e.closePreload;const{playModes:f=[],pageNames:p=[],closePreload:g=!1,onlySrc:v=!1}=e;let{qualityType:b,hevcQualityType:S}=e;28===b&&!S&&(b=20,S=28);const P=!!n||_(i,r,p,f);if(!P)return u;const w=function(e,t,n,r){const{score:i=-2,dScore:s=-2,vendor0:a=[],vendor1:o=[]}=r;return t>0&&s>=0?s<=t:e>0?!i||i<=e:y(n,0===e?a:o)}(a,l,o,e)&&P;return{...u,qualityType:b,hevcQualityType:S||28,closePreload:g||!1,open:w&&!v,openSrc:w}}(n,{curPageName:r,curPlayMode:i,score:a.score||-2,vendor:a.vendor||"",dScore:o,deviceScore:l,cpuCore:u.cpu,browser:u.browserType},t)}static forceDisableHevc(e){var t;t=e,(0,a.l)(f,"forceDisableHevc",t),T.focusDisableHevc(t)}static setHevcTestData(t){const{hevcTestData:n}=e.getInstance();Object.keys(t).forEach((e=>{n[e]=t[e]}))}static getHevcTestData(){const{hevcTestData:t}=e.getInstance();return t}static setABTest(t){const{abTestData:n}=e.getInstance();Object.keys(t).forEach((e=>{n[e]=t[e]}))}static getABTest(){const{abTestData:t}=e.getInstance();return t}static reset(){this.instance.abTestVersion=""}static setHevcAbVersion(t){const n=e.getInstance();n&&(n.hevcAbVersion=t)}static getAbVersions(){const t=e.getInstance();return t?`${t.hevcAbVersion},${t.abTestVersion}`:""}static setHevcEffectiveConditions(e){var t;t=e,T.setEffectiveConditions(t)}static getDeviceScore(){const{deviceMark:t}=e.getInstance();return{dScore:t.deviceScore,score:t.score,netScore:t.netScore}}static setSpeed(t){e.getInstance().networkSpeed.setSpeed(t)}static getSpeed(){return e.getInstance().networkSpeed.getSpeed()}static updateSpeedConfig(t){e.getInstance().networkSpeed.updateConfig(t)}static getAvgSpeed(){return e.getInstance().networkSpeed.getAvgSpeed()}};E.device=M;let R=E},65350:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(5267),i=n(4629);const s=['video/mp4;codecs="hvc1.1.L0.0"','video/mp4;codecs="hvc1.1.6.L120"','video/mp4;codecs="hev1.1.6.L120.90"','video/mp4;codecs="hev1.1.6.L120.90"','video/mp4;codecs="hev1.2.4.L120.90"','video/mp4;codecs="hev1.3.E.L120.90"','video/mp4;codecs="hev1.4.10.L120.90"'];class a{constructor(e=""){this.rawUA=e,this.platformType=null,this.platformVersion=0,this.browserType=null,this.browserVersion=0,this.isChromium=!1,this.chromiumVersion=0,this.isMobile=!1,this.parseRowUA(this.rawUA)}parseRowPlatform(e=""){if(/Windows NT 10\.0/.test(e))this.platformType="Windows",this.platformVersion=10;else if(/Windows NT 6\.3/.test(e))this.platformType="Windows",this.platformVersion=8.1;else if(/Windows NT 6\.2/.test(e))this.platformType="Windows",this.platformVersion=8;else if(/Windows NT 6\.1/.test(e))this.platformType="Windows",this.platformVersion=7;else if(/Windows NT 6\.0/.test(e))this.platformType="Windows";else if(/Windows NT 5\.1/.test(e))this.platformType="Windows";else if(/Windows NT 5\.0/.test(e))this.platformType="Windows";else if(/Windows Phone/.test(e))this.platformType="Windows",this.isMobile=!0;else if(/Android/.test(e)){this.platformType="Android";const t=e.match(/Android\s([0-9\.]+)/);t&&t.length>1&&(this.platformVersion=parseFloat(t[1])),this.isMobile=!0}else if(/Linux/.test(e))this.platformType="Linux";else if(/CrOS/.test(e)){this.platformType="ChromeOS";const t=e.match(/CrOS ([a-zA-Z0-9_]+) (\d+\.\d+\.\d+\.\d+)/);t&&t.length>2&&(this.platformVersion=parseFloat(t[2]))}else if(/iPad|iPhone|iPod/.test(e)){this.platformType="iOS";const t=e.match(/OS (\d+)_(\d+)_?(\d+)?/);t&&t.length>2&&(this.platformVersion=parseFloat(t[1]+"."+t[2]+"."+(t[3]||"0"))),this.isMobile=!0}else if(/Mac OS X|Macintosh/.test(e)){this.platformType="MacOS";const t=e.match(/Mac OS X (10[._]\d+(?:[._]\d+)?)/);t&&t.length>1&&(this.platformVersion=parseFloat(t[1].replace(/_/g,".")))}}parseTVPlatform(e=""){e.toLowerCase&&(e=e.toLowerCase()),/tizen/.test(e)?this.platformType="Tizen":/webos/.test(e)?this.platformType="WebOS":/vstvb/.test(e)?this.platformType="VSTVB":/fetchtv/.test(e)?this.platformType="FetchTV":/netgemtv/.test(e)?this.platformType="NetGemTV":/vizio/.test(e)?this.platformType="VIZIO":/wpe/.test(e)?this.platformType="WPE":/vodafone/.test(e)?this.platformType="VODAFONE":/philips/.test(e)?this.platformType="Philips":/netrangemmh/.test(e)?this.platformType="NETRANGEMMH":/cva/.test(e)?this.platformType="CVA":/tlc/.test(e)?this.platformType="TLC":/openmw/.test(e)?this.platformType="OpenMW":/totalplay/.test(e)?this.platformType="Totalplay":/vidaa/.test(e)?this.platformType="VIDAA":/megacable/.test(e)?this.platformType="megacable":/lge/.test(e)&&(this.platformType="LGE")}parseRowBrowser(e=""){if(/MSIE|Trident/.test(e))this.browserType="IE";else if(/Edg|Edge/.test(e)){this.browserType="Edge";const t=e.match(/(?:Edg|Edge)\/(\d+\.?\d*)/);t&&t.length>1&&(this.browserVersion=parseFloat(t[1]))}else if(/Opera|OPR/.test(e)){this.browserType="Opera";const t=e.match(/(?:Opera|OPR)\/(\d+\.?\d*)/);t&&t.length>1&&(this.browserVersion=parseFloat(t[1]))}else if(/Firefox/.test(e)){this.browserType="Firefox";const t=e.match(/Firefox\/(\d+\.?\d*)/);t&&t.length>1&&(this.browserVersion=parseFloat(t[1]))}else if(/Safari/.test(e)&&!/Chrome/.test(e)){this.browserType="Safari";const t=e.match(/Version\/(\d+(\.\d+)+).*Safari/);t&&t.length>1&&(this.browserVersion=parseFloat(t[1]))}else if(/Chrome/.test(e)){this.browserType="Chrome";const t=e.match(/(?:CriOS|Chrome)\/(\d+\.?\d*)/);t&&t.length>1&&(this.browserVersion=parseFloat(t[1]))}if(/Chrome/.test(e)){this.isChromium=!0;const t=e.match(/(?:CriOS|Chrome)\/(\d+\.?\d*)/);t&&t.length>1&&(this.chromiumVersion=parseFloat(t[1]))}}parseRowUA(e=""){this.parseRowPlatform(e),this.parseTVPlatform(e),this.parseRowBrowser(e)}}class o extends r.C{constructor(){super(),this._isMSEAvailable=()=>!(typeof window>"u")&&"MediaSource"in window,this._checkUA=()=>{if("Linux"==this.ua.platformType||"ChromeOS"==this.ua.platformType||"Firefox"==this.ua.browserType||"Opera"==this.ua.browserType||"Edge"==this.ua.browserType&&this.ua.browserVersion<107)return!1;if(this.ua.isChromium){if(this.ua.chromiumVersion<107||"Chrome"==this.ua.browserType&&("Android"==this.ua.platformType&&(this.ua.platformVersion<5||this.ua.browserVersion<117)||"Windows"==this.ua.platformType&&this.ua.platformVersion<8))return!1}else if("Safari"==this.ua.browserType&&this.ua.browserVersion<13)return!1;return!0},this._isHEVCAvailable=()=>!(typeof window>"u"||!window.MediaSource)&&s.reduce(((e,t)=>e||window.MediaSource.isTypeSupported(t)),!1),this.checkHEVCWithPlaybackQuality=(e="",t=.2,n)=>{(0,i.lg)({url:e,minDroppedFramesRate:t,minTotalVideoFrames:10}).then((e=>{n(e)}))},this._player=null,this._element=null,this.ua=new a(this.userAgent),this.isMSESupported=this._isMSEAvailable(),this.isHEVCSupported=this._isHEVCAvailable()&&(0,i.Zo)(),this.shouldUseHEVC=this.isHEVCSupported&&this._checkUA()}static get version(){return r.v}get playbackQuality(){var e,t;return this._element?this._element.getVideoPlaybackQuality?this._element.getVideoPlaybackQuality():{corruptedVideoFrames:0,creationTime:performance.now(),droppedVideoFrames:(null==(e=this.el)?void 0:e.webkitDroppedFrameCount)||0,totalVideoFrames:(null==(t=this.el)?void 0:t.webkitDecodedFrameCount)||0}:null}get cpu(){return typeof navigator>"u"||!navigator.hardwareConcurrency?0:navigator.hardwareConcurrency}get memory(){return typeof navigator>"u"||!navigator.deviceMemory?0:navigator.deviceMemory}get userAgent(){return typeof navigator>"u"||!navigator.userAgent?"":navigator.userAgent}get bandwidth(){return typeof navigator>"u"||!navigator.connection?0:navigator.connection.downlink||0}get networkType(){return typeof navigator>"u"||!navigator.connection?"":navigator.connection.effectiveType||""}get platformType(){return this.ua.platformType||""}get platformVersion(){return this.ua.platformVersion}get browserType(){return this.ua.browserType||""}get browserVersion(){return this.ua.browserVersion}get isChromium(){return this.ua.isChromium}get chromiumVersion(){return this.ua.chromiumVersion}set player(e){var t;this._player=e,this._element=(null==(t=this._player)?void 0:t.el)||null}set element(e){this._element=e}}},90543:(e,t,n)=>{"use strict";function r(e){try{const t=localStorage.getItem(e);if(!t)return t;const n=JSON.parse(t);return void 0===n.expire||void 0===n.timestamp||n.expire>0&&(new Date).getTime()-n.timestamp>n.expire?(localStorage.removeItem(e),null):n.val}catch{return null}}function i(e,t,n){try{if(t){const r={val:t,expire:n||0,timestamp:(new Date).getTime()};localStorage.setItem(e,JSON.stringify(r))}}catch(e){console.error(e)}}function s(e){try{localStorage.removeItem(e)}catch(e){console.error(e)}}n.d(t,{c:()=>c,g:()=>r,i:()=>l,l:()=>u,r:()=>s,s:()=>i});let a=-1,o=-1;function l(){return a>=0?a:a<0?(a="1"===r("ttplayer_focus_src_play")?1:0,a):0}function u(e,...t){o<0&&function(){const e=r("ttplayer_debug");o=e?parseInt(e||"0"):0}(),!(o<1)&&console.log(e,...t)}function c(e){return parseInt((1e3*e).toFixed(0),10)}},27111:(e,t,n)=>{"use strict";n.d(t,{A:()=>M,E:()=>R,G:()=>E,M:()=>D,P:()=>P,R:()=>b,V:()=>w,a:()=>S,b:()=>k});var r=n(5267),i=n(90543),s=Object.defineProperty,a=(e,t,n)=>((e,t,n)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);const o=[new RegExp("(\\?|&)expire=([^&]*)(&|$)"),new RegExp("(\\?|&)x-tos-expires=([^&]*)(&|$)"),new RegExp("(\\?|&)x-expires=([^&]*)(&|$)")];function l(e){if(!e||"string"!=typeof e)return 0;let t=0;try{const n=[];if(o.forEach((t=>{const r=e.match(t);r&&n.push(r)})),n.length>0)t=parseInt(n[0][2],10);else{const n=e.split("/");n.length>5&&8===n[4].length&&(t=parseInt(n[4],16))}if(t>0){const e=new Date;return t<=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),0)/1e3?1:2}return 0}catch{return 0}}const u={v360:{width:640,height:360},v480:{width:800,height:480},v540:{width:960,height:540},v720:{width:1280,height:720},v864:{width:1536,height:864},v960:{width:1706,height:960},v1080:{width:1920,height:1080},v2k:{width:2560,height:1440},v4k:{width:3840,height:2160}};class c{constructor(){this.ladder=null,this._mvmaf="",this._vqscore=0,this.width=0,this.height=0,this.playedDuration=0}set mvmaf(e){if(!e)return;this._mvmaf=e;let t=JSON.parse(e);t["v2.0"]&&(this.ladder=t["v2.0"])}get mvmaf(){return this._mvmaf}set vqscore(e){e&&(this._vqscore=e)}get vqscore(){return this._vqscore}_findNearestPlaybackScore(){let e=0;if(!this.ladder)return 0;let t=this.width*this.height,n="v540",r=Number.MAX_VALUE;for(let e in u){const i=u[e];let s=t-i.width*i.height;Math.abs(s)<r&&(r=Math.abs(s),n=e)}const i=u[n].width*u[n].height;if(Math.abs(i-t)<=.1*i&&this.ladder&&this.ladder.ori&&this.ladder.ori[n])return this.ladder.ori[n];if(this.ladder&&this.ladder.ori){let t=this.ladder.ori,r=Object.keys(t);if(1==r.length)return t[r[0]];{r.sort();let i=u[r[0]].width*u[r[0]].height,s=t[r[0]],a=u[r[r.length-1]].width*u[r[r.length-1]].height,o=t[r[r.length-1]],l=u[n].width*u[n].height;e=s+((l-i)*o-(l-i)*s)/(a-i)}}return e}exportData(){if(this.playedDuration<=0)return{};const e=this._findNearestPlaybackScore();let t=100-(100-e)*Math.exp(this._vqscore/100-1);return{vqs:this._vqscore,vms:e,vods:t,mvmaf:this._mvmaf,pr:"w:"+this.width+",h:"+this.height+",srf:0,wt:"+this.playedDuration,v:2}}reset(){this._mvmaf="",this._vqscore=0,this.ladder=null,this.width=0,this.height=0,this.playedDuration=0}}class h{constructor(e,t){this.name=e,t&&this.reset()}startTimer(){this.started=!0;const e=window.performance;this.startTime=e?e.now():Date.now()}stopTimer(){if(this.started){const e=window.performance;this.endTime=e?e.now():Date.now(),this.duration=this.endTime-this.startTime,this.started=!1}}reset(){this.started=!1,this.startTime=-1,this.endTime=-1,this.duration=0}exportData(){return{duration:this.duration,gpu:"",score:-2,vendor:""}}}class d extends h{constructor(){super("VideoRequest",!0)}}class f extends h{constructor(){super("VideoRequestResponse",!0)}}class p extends h{constructor(){super("BlockStart",!0),this.blockType=0}setBlockType(e){if(e&&e.element){const{readyState:t,seeking:n}=e.element;this.blockType=t<1?1:n?2:0}}exportData(e){var t;const n=(null==(t=null==e?void 0:e.element)?void 0:t.currentTime)||0;return{blockType:this.blockType,currentTime:n,...super.exportData()}}}class g extends h{constructor(){super("Block",!0)}exportData(e,t={blockType:0}){var n;return{...t,currentTime:(null==(n=null==e?void 0:e.element)?void 0:n.currentTime)||0,...super.exportData()}}}class m extends h{constructor(){super("PlayQuality",!0),this.loadedTime=0,this.durationFromLoaded=0,this.durationWithLoaded=0}reset(){super.reset(),this.loadedTime=0,this.durationFromLoaded=0,this.durationWithLoaded=0}}class v extends h{constructor(e){super("PlayEnded",!1),this.videoQualityHelper=new c,this.currentTime=0,this.status=e,this.reset()}startPauseTimer(){const e=window.performance;this.pauseStartTime=e?e.now():Date.now(),this.paused=!0}stopPauseTimer(){if(this.paused){const e=window.performance;this.pauseStopTime=e?e.now():Date.now(),this.pauseDuration+=this.pauseStopTime-this.pauseStartTime}}reset(){super.reset(),this.paused=!1,this.pauseStartTime=-1,this.pauseStopTime=-1,this.pauseDuration=0,this.currentTime=0,this.videoQualityHelper&&this.videoQualityHelper.reset()}exportData(){let e=super.exportData();this.videoQualityHelper.playedDuration=this.duration-this.pauseDuration;let t=this.videoQualityHelper.exportData();return Object.assign({},e,{pauseDuration:this.pauseDuration,currentTime:this.currentTime,vqm:t})}copy(e){this.duration=e.duration,this.currentTime=e.currentTime,this.pauseDuration=e.pauseDuration,e.videoQualityHelper&&(this.videoQualityHelper.mvmaf=e.videoQualityHelper.mvmaf,this.videoQualityHelper.vqscore=e.videoQualityHelper.vqscore,this.videoQualityHelper.width=e.videoQualityHelper.width,this.videoQualityHelper.height=e.videoQualityHelper.height,this.videoQualityHelper.playedDuration=e.videoQualityHelper.playedDuration)}set mvmaf(e){e&&(this.videoQualityHelper.mvmaf=e)}set vqscore(e){e&&(this.videoQualityHelper.vqscore=e)}set width(e){this.videoQualityHelper.width=e}set height(e){this.videoQualityHelper.height=e}}class y extends h{constructor(){super("PlayFailed",!0),this.loadStartRetry=[]}getRetryData(){return{retryCount:this.loadStartRetry.length,retryList:this.loadStartRetry}}exportData(e,t,n){let r=super.exportData(),i=-1,s="",a=-1,o="";return e&&e.element&&(i=e.element.currentTime,s=e.element.currentSrc,e.element.error&&(a=e.element.error.code,o=e.element.error.message)),t&&(t.url&&(s=t.url),a=t.errorCode,o=t.message),Object.assign({},r,{status:n,code:a,message:o,url:s,isExpired:l(s),currentTime:i,retryCount:this.loadStartRetry.length,retryList:this.loadStartRetry})}}class _ extends h{constructor(){super("FirstFrame",!0)}}class T extends h{constructor(){super("VideoDataSize",!0)}}var b=(e=>(e.DEFAULT="default",e.ACTIVE="active",e.RETAIN="retain",e.RELEASE="release",e.BACKUP="backup",e))(b||{}),S=(e=>(e.XG="XG",e.TT="TT",e.RAW="RAW",e.NEW_TT="NEW_TT",e))(S||{});const P={NoInteract:"failed because the user didn't interact with the document first.",SafariNoInteract:"The request is not allowed by the user agent or the platform in the current context",FireFox:"The play method is not allowed by the user agent or the platform in the current context, possibly because the user denied permission.",LoadInterrupt:"request was interrupted by a new load request",Abort:"The operation was aborted"};var w=(e=>(e.H5="H5",e.MSE="MSE",e.AUDO="AUTO",e))(w||{});const k="autoplay_started",M="autoplay_was_prevented",E=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],R=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],x="MultimediaMetrics";class D extends r.C{constructor(e,t){super(),a(this,"_onPlay",(()=>{this.playEnded.paused&&this.playEnded.stopPauseTimer()})),a(this,"_onPause",(()=>{this.block.started&&this.block.reset(),this.playEnded.startPauseTimer()})),a(this,"_onPlaying",(()=>{if(this.status=3,this.block.started){this.block.stopTimer();const{blockType:e}=this.blockStart;this.trigger(this.block.name,this.block.exportData(this._player,{blockType:e}))}this._player.element&&(this.playEnded.width=this._player.element.videoWidth,this.playEnded.height=this._player.element.videoHeight)})),a(this,"_onTimeupdate",(()=>{!this._player||!this._player.element||(this.playEnded.currentTime=this._player.element.currentTime)})),a(this,"_onEnded",(()=>{this.status=2})),a(this,"_onWaiting",(()=>{!this._player||!this._player.element||3==this._status&&(this._player.element.paused||this._player.state!==b.ACTIVE||(this.blockStart.setBlockType(this._player),this.trigger(this.blockStart.name,this.blockStart.exportData()),this.block.startTimer()))})),a(this,"_onError",(e=>{this.trigger(this.playFailed.name,this.playFailed.exportData(this._player,e,this._status))})),a(this,"_onSourceError",(e=>{const{host:t,errorCode:n,message:r,src:i}=e;this.playFailed.loadStartRetry.push({host:t,code:n,message:r,isExpired:l(i)})})),a(this,"_onLoadstart",(()=>{this.status=1,this.trigger(this.videoRequest.name,this.videoRequest.exportData()),this.playQuality.startTimer(),this.videoRequestResponse.startTimer(),this.firstFrame.startTimer()})),a(this,"_onLoadeddata",(()=>{this.videoRequestResponse.stopTimer(),this._loadedTime=window.performance?window.performance.now():Date.now(),this.playQuality.durationWithLoaded=this._loadedTime-this.playQuality.startTime,this.trigger(this.videoRequestResponse.name,this.videoRequestResponse.exportData())})),a(this,"_onPlayCatch",(()=>{this.xgDowngraded=!0})),a(this,"_onDownloaderChunkReady",(e=>{this.trigger(this.videoDataSize.name,e)})),a(this,"_onProgress",(()=>{if(!this._player||!this.xgDowngraded&&"RAW"!=this._player.type||!this.config||!this.config.bitrate)return;const e=this._player.element.buffered;let t=0;for(let n=0;n<e.length;n++)t+=e.end(n)-e.start(n);const n=t*this.config.bitrate/8;this.trigger(this.videoDataSize.name,{chunkSize:n,speed:this.config.bitrate/1024})})),a(this,"initEvent",(e=>{const t=e||this.event;t&&(t.on("play",this._onPlay),t.on("pause",this._onPause),t.on("playing",this._onPlaying),t.on("timeupdate",this._onTimeupdate),t.on("ended",this._onEnded),t.on("waiting",this._onWaiting),t.on("error",this._onError),t.on("source_error",this._onSourceError),t.on("loadstart",this._onLoadstart),t.on("loadeddata",this._onLoadeddata),t.on("playCatch",this._onPlayCatch),t.on("downloaderChunkReady",this._onDownloaderChunkReady),t.on("progress",this._onProgress))})),a(this,"removeEvent",(e=>{const t=e||this.event;t&&(t.off("play",this._onPlay),t.off("pause",this._onPause),t.off("playing",this._onPlaying),t.off("timeupdate",this._onTimeupdate),t.off("ended",this._onEnded),t.off("waiting",this._onWaiting),t.off("error",this._onError),t.off("source_error",this._onSourceError),t.off("loadstart",this._onLoadstart),t.off("loadeddata",this._onLoadeddata),t.off("playCatch",this._onPlayCatch),t.off("downloaderChunkReady",this._onDownloaderChunkReady),t.off("progress",this._onProgress))})),a(this,"stop",(()=>{-1!=this._status&&(this.reset(),this.lastPlayEnded&&(this.trigger(this.lastPlayEnded.name,this.lastPlayEnded.exportData()),this.lastPlayEnded=null))})),a(this,"reset",(()=>{(0,i.l)(x,"reset"),this.playEnded.started&&this.playEnded.stopTimer(),this.lastPlayEnded=new v(this._status),this.lastPlayEnded.copy(this.playEnded),this.status=-1,this.xgDowngraded=!1,this.videoRequest.reset(),this.videoRequestResponse.reset(),this.blockStart.reset(),this.block.reset(),this.playQuality.reset(),this.playEnded.reset(),this.playFailed.reset(),this.firstFrame.reset(),this._loadedTime=0})),this.event=e,this.config=t,this._status=-1,this.initEvent(),this._player=null,this.xgDowngraded=!1,this.videoRequest=new d,this.videoRequestResponse=new f,this.blockStart=new p,this.block=new g,this.playQuality=new m,this.lastPlayEnded=null,this.playEnded=new v(this._status),this.playFailed=new y,this.firstFrame=new _,this.videoDataSize=new T,this.events=[this.videoDataSize.name,this.videoRequest.name,this.videoRequestResponse.name,this.blockStart.name,this.block.name,this.playQuality.name,this.playEnded.name,this.playFailed.name,this.firstFrame.name],this.startInitInfo={},this._loadedTime=0}static get version(){return r.v}getCommonData(e){const{element:t,config:n,type:r,state:i}=e;return{currentTime:(null==t?void 0:t.currentTime)||0,videoDuration:(null==t?void 0:t.duration)||0,codecType:(null==n?void 0:n.codecType)||"h264",vtype:(null==n?void 0:n.vtype)||"MP4",playerType:r||"default",renderState:i||b.ACTIVE}}setConfig(e){e&&e.bitrate&&(this.config.bitrate=e.bitrate)}set player(e){this._player=e,e&&(this._player.mvmaf&&(this.playEnded.mvmaf=this._player.mvmaf),this._player.vqscore&&(this.playEnded.vqscore=this._player.vqscore))}set status(e){if(1===this._status&&3===e){this.playQuality.stopTimer(),this.playEnded.startTimer(),this.firstFrame.stopTimer(),this.playQuality.durationFromLoaded=this.playQuality.endTime-this._loadedTime;const{durationWithLoaded:e,durationFromLoaded:t}=this.playQuality,n={...this.playQuality.exportData(),...this.playFailed.getRetryData(),durationWithLoaded:e,durationFromLoaded:t};this.trigger(this.playQuality.name,n),this.trigger(this.firstFrame.name,n)}this._status=e}setStartInitInfo(e){(0,i.l)(x,"setStartInitInfo",e),this.startInitInfo=e}trigger(e,t){const n=this.getCommonData(this._player);super.trigger(e,{...n,...t,startInfo:this.startInitInfo||{}})}release(){const{_callbacks:e}=this;Object.keys(e).forEach((t=>{(e[t]||[]).forEach((e=>{this.off(t,e)}))})),this.removeEvent(),this._player=null,this._events=[],this.event=null}}},85264:(e,t,n)=>{"use strict";n.d(t,{Tz:()=>Ed,IH:()=>Ad,Vb:()=>Kd,SX:()=>tf,SN:()=>qd,mx:()=>_f});var r=n(90170),i="play",s="seeked",a="timeupdate",o="canplay",l="volumechange",u="loadeddata",c="loadedmetadata",h="ratechange",d="progress",f="focus",p="blur",g="autoplay_started",m="autoplay_was_prevented",v="fullscreen_change",y="cssFullscreen_change",_="after_definition_change",T="user_action",b=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","loadedmetadata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"];function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function P(e,t,n){return t=x(t),O(e,I()?Reflect.construct(t,n||[],x(e).constructor):t.apply(e,n))}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,N(r.key),r)}}function M(e,t,n){return t&&k(e.prototype,t),n&&k(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function E(e,t,n){return(t=N(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(){return R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},R.apply(null,arguments)}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&A(e,t)}function I(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(I=function(){return!!e})()}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function A(e,t){return(A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function G(e,t,n,r){var i=R(x(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function B(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}function $(e){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var U=n(42990),F=n.n(U),H="undefined"!=typeof window&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,V={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},j="%c[xgplayer]",z={config:{debug:H?3:0},logInfo:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.config.debug>=3&&(t=console).log.apply(t,[j,V.info,e].concat(r))},logWarn:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.config.debug>=1&&(t=console).warn.apply(t,[j,V.warn,e].concat(r))},logError:function(e){var t;if(!(this.config.debug<1)){for(var n=this.config.debug>=2?"trace":"error",r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];(t=console)[n].apply(t,[j,V.error,e].concat(i))}}},X=function(){return M((function e(t){w(this,e),this.bufferedList=t}),[{key:"start",value:function(e){return this.bufferedList[e].start}},{key:"end",value:function(e){return this.bufferedList[e].end}},{key:"length",get:function(){return this.bufferedList.length}}])}(),K={};function W(e){var t=$(e);return null!==e&&("object"===t||"function"===t)}K.createDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=r,i.innerHTML=t,Object.keys(n).forEach((function(t){var r=t,s=n[t];"video"===e||"audio"===e||"live-video"===e?s&&i.setAttribute(r,s):i.setAttribute(r,s)})),i},K.createDomFromHtml=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{var r=document.createElement("div");r.innerHTML=e;var i=r.children;return r=null,i.length>0?(i=i[0],n&&K.addClass(i,n),t&&Object.keys(t).forEach((function(e){i.setAttribute(e,t[e])})),i):null}catch(e){return z.logError("util.createDomFromHtml",e),null}},K.hasClass=function(e,t){if(!e||!t)return!1;try{return Array.prototype.some.call(e.classList,(function(e){return e===t}))}catch(r){var n=e.className&&"object"===$(e.className)?e.getAttribute("class"):e.className;return n&&!!n.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}},K.addClass=function(e,t){if(e&&t)try{t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.add(t)}))}catch(n){K.hasClass(e,t)||(e.className&&"object"===$(e.className)?e.setAttribute("class",e.getAttribute("class")+" "+t):e.className+=" "+t)}},K.removeClass=function(e,t){if(e&&t)try{t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.remove(t)}))}catch(n){K.hasClass(e,t)&&t.split(/\s+/g).forEach((function(t){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className&&"object"===$(e.className)?e.setAttribute("class",e.getAttribute("class").replace(n," ")):e.className=e.className.replace(n," ")}))}},K.toggleClass=function(e,t){e&&t.split(/\s+/g).forEach((function(t){K.hasClass(e,t)?K.removeClass(e,t):K.addClass(e,t)}))},K.classNames=function(){for(var e=arguments,t=[],n=function(n){"String"===K.typeOf(e[n])?t.push(e[n]):"Object"===K.typeOf(e[n])&&Object.keys(e[n]).map((function(r){e[n][r]&&t.push(r)}))},r=0;r<arguments.length;r++)n(r);return t.join(" ")},K.findDom=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,n=arguments.length>1?arguments[1]:void 0;try{e=t.querySelector(n)}catch(r){z.logError("util.findDom",r),0===n.indexOf("#")&&(e=t.getElementById(n.slice(1)))}return e},K.getCss=function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]},K.padStart=function(e,t,n){for(var r=String(n),i=0|t,s=Math.ceil(i/r.length),a=[],o=String(e);s--;)a.push(r);return a.join("").substring(0,i-o.length)+o},K.format=function(e){if(window.isNaN(e))return"";e=Math.round(e);var t=K.padStart(Math.floor(e/3600),2,0),n=K.padStart(Math.floor((e-3600*t)/60),2,0),r=K.padStart(Math.floor(e-3600*t-60*n),2,0);return("00"===t?[n,r]:[t,n,r]).join(":")},K.event=function(e){if(e.touches){var t=e.touches[0]||e.changedTouches[0];e.clientX=t.clientX||0,e.clientY=t.clientY||0,e.offsetX=t.pageX-t.target.offsetLeft,e.offsetY=t.pageY-t.target.offsetTop}e._target=e.target||e.srcElement},K.typeOf=function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},K.deepCopy=function(e,t){if("Object"===K.typeOf(t)&&"Object"===K.typeOf(e))return Object.keys(t).forEach((function(n){"Object"!==K.typeOf(t[n])||t[n]instanceof Node?"Array"===K.typeOf(t[n])?e[n]="Array"===K.typeOf(e[n])?e[n].concat(t[n]):t[n]:e[n]=t[n]:void 0===e[n]||void 0===e[n]?e[n]=t[n]:K.deepCopy(e[n],t[n])})),e},K.deepMerge=function(e,t){return Object.keys(t).map((function(n){var r;"Array"===K.typeOf(t[n])&&"Array"===K.typeOf(e[n])?"Array"===K.typeOf(e[n])&&(r=e[n]).push.apply(r,B(t[n])):K.typeOf(e[n])!==K.typeOf(t[n])||null===e[n]||"Object"!==K.typeOf(e[n])||t[n]instanceof window.Node?null!==t[n]&&(e[n]=t[n]):K.deepMerge(e[n],t[n])})),e},K.getBgImage=function(e){var t=(e.currentStyle||window.getComputedStyle(e,null)).backgroundImage;if(!t||"none"===t)return"";var n=document.createElement("a");return n.href=t.replace(/url\("|"\)/g,""),n.href},K.copyDom=function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,(function(e){t.setAttribute(e.name,e.value)})),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},K.setInterval=function(e,t,n,r){e._interval[t]||(e._interval[t]=window.setInterval(n.bind(e),r))},K.clearInterval=function(e,t){clearInterval(e._interval[t]),e._interval[t]=null},K.setTimeout=function(e,t,n){e._timers||(e._timers=[]);var r=setTimeout((function(){t(),K.clearTimeout(e,r)}),n);return e._timers.push(r),r},K.clearTimeout=function(e,t){var n=e._timers;if("Array"===K.typeOf(n)){for(var r=0;r<n.length;r++)if(n[r]===t){n.splice(r,1),clearTimeout(t);break}}else clearTimeout(t)},K.clearAllTimers=function(e){var t=e._timers;"Array"===K.typeOf(t)&&(t.map((function(e){clearTimeout(e)})),e._timerIds=[])},K.createImgBtn=function(e,t,n,r){var i,s,a,o=K.createDom("xg-".concat(e),"",{},"xgplayer-".concat(e,"-img"));return o.style.backgroundImage='url("'.concat(t,'")'),n&&r&&(["px","rem","em","pt","dp","vw","vh","vm","%"].every((function(e){return!(n.indexOf(e)>-1&&r.indexOf(e)>-1&&(i=parseFloat(n.slice(0,n.indexOf(e)).trim()),s=parseFloat(r.slice(0,r.indexOf(e)).trim()),a=e,1))})),o.style.width="".concat(i).concat(a),o.style.height="".concat(s).concat(a),o.style.backgroundSize="".concat(i).concat(a," ").concat(s).concat(a),o.style.margin="start"===e?"-".concat(s/2).concat(a," auto auto -").concat(i/2).concat(a):"auto 5px auto 5px"),o},K.Hex2RGBA=function(e,t){var n=[];if(/^\#[0-9A-F]{3}$/i.test(e)){var r="#";e.replace(/[0-9A-F]/gi,(function(e){r+=e+e})),e=r}return/^#[0-9A-F]{6}$/i.test(e)?(e.replace(/[0-9A-F]{2}/gi,(function(e){n.push(parseInt(e,16))})),"rgba(".concat(n.join(","),", ").concat(t,")")):"rgba(255, 255, 255, 0.1)"},K.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},K.checkIsFunction=function(e){return e&&"function"==typeof e},K.checkIsObject=function(e){return null!==e&&"object"===$(e)},K.hide=function(e){e.style.display="none"},K.show=function(e,t){e.style.display=t||"block"},K.isUndefined=function(e){if(null==e)return!0},K.isNotNull=function(e){return!(null==e)},K.setStyleFromCsstext=function(e,t){t&&("String"===K.typeOf(t)?t.replace(/\s+/g,"").split(";").map((function(t){if(t){var n=t.split(":");n.length>1&&(e.style[n[0]]=n[1])}})):Object.keys(t).map((function(n){e.style[n]=t[n]})))},K.filterStyleFromText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],n=e.style.cssText;if(!n)return{};var r=n.replace(/\s+/g,"").split(";"),i={},s={};return r.map((function(e){if(e){var n=e.split(":");n.length>1&&(function(e,t){for(var n=0,r=t.length;n<r;n++)if(e.indexOf(t[n])>-1)return!0;return!1}(n[0],t)?i[n[0]]=n[1]:s[n[0]]=n[1])}})),e.setAttribute("style",""),Object.keys(s).map((function(t){e.style[t]=s[t]})),i},K.getStyleFromCsstext=function(e){var t=e.style.cssText;if(!t)return{};var n=t.replace(/\s+/g,"").split(";"),r={};return n.map((function(e){if(e){var t=e.split(":");t.length>1&&(r[t[0]]=t[1])}})),r},K.preloadImg=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e){var r=new window.Image;r.onload=function(e){r=null,t&&t(e)},r.onerror=function(e){r=null,n&&n(e)},r.src=e}},K.stopPropagation=function(e){e&&e.stopPropagation()},K.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},K.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0},K.checkTouchSupport=function(){return"ontouchstart"in window},K.getBuffered2=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=[],r=0;r<e.length;r++)n.push({start:e.start(r)<.5?0:e.start(r),end:e.end(r)});n.sort((function(e,t){return e.start-t.start||t.end-e.end}));var i=[];if(t)for(var s=0;s<n.length;s++){var a=i.length;if(a){var o=i[a-1].end;n[s].start-o<t?n[s].end>o&&(i[a-1].end=n[s].end):i.push(n[s])}else i.push(n[s])}else i=n;return new X(i)},K.getEventPos=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.touches&&e.touches.length>0&&(e=e.touches[0]),{x:e.x/t,y:e.y/t,clientX:e.clientX/t,clientY:e.clientY/t,offsetX:e.offsetX/t,offsetY:e.offsetY/t,pageX:e.pageX/t,pageY:e.pageY/t}},K.requestAnimationFrame=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(t)return t(e)},K.getHostFromUrl=function(e){if("String"!==K.typeOf(e))return"";var t=e.split("/"),n="";return t.length>3&&t[2]&&(n=t[2]),n},K.cancelAnimationFrame=function(e){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;t&&t(e)},K.isMSE=function(e){return e.media&&(e=e.media),!!(e&&e instanceof HTMLMediaElement)&&(/^blob/.test(e.currentSrc)||/^blob/.test(e.src))},K.isBlob=function(e){return"string"==typeof e&&/^blob/.test(e)},K.generateSessionId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=(new Date).getTime();try{e=parseInt(e)}catch(t){e=0}t+=e,window.performance&&"function"==typeof window.performance.now&&(t+=parseInt(window.performance.now()));var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)}));return n},K.createEvent=function(e){var t;return"function"==typeof window.Event?t=new Event(e):(t=document.createEvent("Event")).initEvent(e,!0,!0),t},K.adjustTimeByDuration=function(e,t,n){return t&&e&&(e>t||n&&e<t)?t:e},K.createPositionBar=function(e,t){var n=K.createDom("xg-bar","",{"data-index":-1},e);return t.appendChild(n),n},K.getTransformStyle=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,scale:1,rotate:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n={scale:"".concat(e.scale||1),translate:"".concat(e.x||0,"%, ").concat(e.y||0,"%"),rotate:"".concat(e.rotate||0,"deg")};return Object.keys(n).forEach((function(e){var r=new RegExp("".concat(e,"\\([^\\(]+\\)"),"g"),i="".concat(e,"(").concat(n[e],")");r.test(t)?(r.lastIndex=-1,t=t.replace(r,i)):t+="".concat(i," ")})),t},K.convertDeg=function(e){return Math.abs(e)<=1?360*e:e%360},K.getIndexByTime=function(e,t){var n=t.length,r=-1;if(n<1)return r;if(e<=t[0].end||n<2)r=0;else if(e>t[n-1].end)r=n-1;else for(var i=1;i<n;i++)if(e>t[i-1].end&&e<=t[i].end){r=i;break}return r},K.getOffsetCurrentTime=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if((n=r>=0&&r<t.length?r:K.getIndexByTime(e,t))<0)return-1;var i=t.length,s=t[n],a=s.start,o=s.end,l=s.cTime,u=s.offset;return e<a?l:e>=a&&e<=o?e-u:e>o&&n>=i-1?o:-1},K.getCurrentTimeByOffset=function(e,t){var n=-1;if(!t||t.length<0)return e;for(var r=0;r<t.length;r++)if(e<=t[r].duration){n=r;break}if(-1!==n){var i=t[n].start;return n-1<0?i+e:i+(e-t[n-1].duration)}return e};var Q=/(Android)\s([\d.]+)/,q=/(Version)\/([\d.]+)/,Y=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],J={get device(){return J.os.isPc?"pc":"mobile"},get browser(){if("undefined"==typeof navigator)return"";var e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter((function(n){return t[n].test(e)})))[0]},get os(){if("undefined"==typeof navigator)return{};var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),n=/(?:SymbianOS)/.test(e)||t,r=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),s=/(?:iPad|PlayBook)/.test(e)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,a=s||r&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e),o=/(?:iPhone)/.test(e)&&!a;return{isTablet:a,isPhone:o,isIpad:s,isIos:o||s,isAndroid:r,isPc:!(o||r||n||a),isSymbian:n,isWindowsPhone:t,isFireFox:i}},get osVersion(){if("undefined"==typeof navigator)return 0;var e=navigator.userAgent,t="",n=(t=/(?:iPhone)|(?:iPad|PlayBook)/.test(e)?q:Q)?t.exec(e):[];if(n&&n.length>=3){var r=n[2].split(".");return r.length>0?parseInt(r[0]):0}return 0},get isWeixin(){return"undefined"!=typeof navigator&&!!/(micromessenger)\/([\d.]+)/.exec(navigator.userAgent.toLocaleLowerCase())},isSupportMP4:function(){var e={isSupport:!1,mime:""};if("undefined"==typeof document)return e;if(this.supportResult)return this.supportResult;var t=document.createElement("video");return"function"==typeof t.canPlayType&&Y.map((function(n){"probably"===t.canPlayType('video/mp4; codecs="'.concat(n,'"'))&&(e.isSupport=!0,e.mime+="||".concat(n))})),this.supportResult=e,t=null,e},isMSESupport:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if("undefined"==typeof MediaSource||!MediaSource)return!1;try{return MediaSource.isTypeSupported(e)}catch(t){return this._logger.error(e,t),!1}},isHevcSupported:function(){return!("undefined"==typeof MediaSource||!MediaSource.isTypeSupported)&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))},probeConfigSupported:function(e){var t={supported:!1,smooth:!1,powerEfficient:!1};if(!e||"undefined"==typeof navigator)return Promise.resolve(t);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(e);var n=e.video||{},r=e.audio||{};try{var i=MediaSource.isTypeSupported(n.contentType),s=MediaSource.isTypeSupported(r.contentType);return Promise.resolve({supported:i&&s,smooth:!1,powerEfficient:!1})}catch(e){return Promise.resolve(t)}}},Z="3.0.21",ee={1:"media",2:"media",3:"media",4:"media",5:"media",6:"media"},te={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106},ne=M((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};w(this,e);var r=t&&t.i18n?t.i18n.ERROR_TYPES:null;if(t.media){var i=n.mediaError?n.mediaError:t.media.error||{},s=t.duration,a=t.currentTime,o=t.ended,l=t.src,u=t.currentSrc,c=t.media,h=c.readyState,d=c.networkState,f=n.errorCode||i.code;te[f]&&(f=te[f]);var p={playerVersion:Z,currentTime:a,duration:s,ended:o,readyState:h,networkState:d,src:l||u,errorType:n.errorType,errorCode:f,message:n.errorMessage||i.message,mediaError:i,originError:n.originError?n.originError.stack:"",host:K.getHostFromUrl(l||u)};return n.ext&&Object.keys(n.ext).map((function(e){p[e]=n.ext[e]})),p}if(arguments.length>1){for(var g={playerVersion:Z,domain:document.domain},m=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],v=0;v<arguments.length;v++)g[m[v]]=arguments[v];return g.ex=r?(r[arguments[0]]||{}).msg:"",g}}));function re(e,t){this&&this.emit&&("error"===e?this.errorHandler(e,t.error):this.emit(e,t))}var ie=function(e){function t(e){var n;w(this,t),(n=P(this,t,[e]))._hasStart=!1,n._currentTime=0,n._duration=0,n._internalOp={},n._lastMuted=!1,n.vtype="MP4",n._rate=-1,n.mediaConfig=Object.assign({},{controls:!1,autoplay:e.autoplay,playsinline:e.playsinline,"x5-playsinline":e.playsinline,"webkit-playsinline":e.playsinline,"x5-video-player-fullscreen":e["x5-video-player-fullscreen"]||e.x5VideoPlayerFullscreen,"x5-video-orientation":e["x5-video-orientation"]||e.x5VideoOrientation,airplay:e.airplay,"webkit-airplay":e.airplay,tabindex:0|e.tabindex,mediaType:e.mediaType||"video","data-index":-1},e.videoConfig,e.videoAttributes);var r=e["x5-video-player-type"]||e.x5VideoPlayerType;return J.isWeixin&&J.os.isAndroid&&r&&(n.mediaConfig["x5-video-player-type"]=r,delete n.mediaConfig.playsinline,delete n.mediaConfig["webkit-playsinline"],delete n.mediaConfig["x5-playsinline"]),e.loop&&(n.mediaConfig.loop="loop"),e.autoplayMuted&&!Object.prototype.hasOwnProperty.call(n.mediaConfig,"muted")&&(n.mediaConfig.muted=!0),n.media=K.createDom(n.mediaConfig.mediaType,"",n.mediaConfig,""),e.defaultPlaybackRate&&(n.media.defaultPlaybackRate=n.media.playbackRate=e.defaultPlaybackRate),"Number"===K.typeOf(e.volume)&&(n.volume=e.volume),e.autoplayMuted&&(n.media.muted=!0,n._lastMuted=!0),e.autoplay&&(n.media.autoplay=!0),n._interval={},n.mediaEventMiddleware={},n.attachVideoEvents(),n}return D(t,e),M(t,[{key:"setEventsMiddleware",value:function(e){var t=this;Object.keys(e).map((function(n){t.mediaEventMiddleware[n]=e[n]}))}},{key:"removeEventsMiddleware",value:function(e){var t=this;Object.keys(e).map((function(e){delete t.mediaEventMiddleware[e]}))}},{key:"attachVideoEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.media;this._evHandlers||(this._evHandlers=b.map((function(t){var n="on".concat(t.charAt(0).toUpperCase()).concat(t.slice(1));return"function"==typeof e[n]&&e.on(t,e[n]),E({},t,function(e,t){return function(n,r){var i={player:t,eventName:e,originalEvent:n,detail:n.detail||{},timeStamp:n.timeStamp,currentTime:t.currentTime,duration:t.duration,paused:t.paused,ended:t.ended,isInternalOp:!!t._internalOp[n.type],muted:t.muted,volume:t.volume,host:K.getHostFromUrl(t.currentSrc),vtype:t.vtype};if(t.removeInnerOP(n.type),"timeupdate"===e&&(t._currentTime=t.media&&t.media.currentTime),"ratechange"===e){var s=t.media?t.media.playbackRate:0;if(s&&t._rate===s)return;t._rate=t.media&&t.media.playbackRate}if("durationchange"===e&&(t._duration=t.media.duration),"volumechange"===e&&(i.isMutedChange=t._lastMuted!==t.muted,t._lastMuted=t.muted),"error"===e&&(i.error=r||t.video.error),t.mediaEventMiddleware[e]){var a=re.bind(t,e,i);try{t.mediaEventMiddleware[e].call(t,i,a)}catch(n){throw re.call(t,e,i),n}}else re.call(t,e,i)}}(t,e))}))),this._evHandlers.forEach((function(e){var n=Object.keys(e)[0];t.addEventListener(n,e[n],!1)}))}},{key:"detachVideoEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.media;this._evHandlers.forEach((function(e){var n=Object.keys(e)[0];t.removeEventListener(n,e[n],!1)})),this._evHandlers.forEach((function(t){var n=Object.keys(t)[0],r="on".concat(n.charAt(0).toUpperCase()).concat(n.slice(1));"function"==typeof e[r]&&e.off(n,e[r])})),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(e,t){var n=this;e.removeAttribute("src"),e.load(),t.forEach((function(e,t){n.media.appendChild(K.createDom("source","",{src:"".concat(e.src),type:"".concat(e.type||""),"data-index":t+1}))}));var r=e.children;if(r){this._videoSourceCount=r.length,this._videoSourceIndex=r.length,this._vLoadeddata=function(e){n.emit("source_success",{src:e.target.currentSrc,host:K.getHostFromUrl(e.target.currentSrc)})};for(var i=null,s=0;s<this._evHandlers.length;s++)if("error"===Object.keys(this._evHandlers[s])[0]){i=this._evHandlers[s];break}!this._sourceError&&(this._sourceError=function(e){var t=parseInt(e.target.getAttribute("data-index"),10);if(n._videoSourceIndex--,0===n._videoSourceIndex||t>=n._videoSourceCount){var r={code:4,message:"sources_load_error"};i?i.error(e,r):n.errorHandler("error",r)}var s=ee[4];n.emit("source_error",new ne(n,{errorType:s,errorCode:4,errorMessage:"sources_load_error",mediaError:{code:4,message:"sources_load_error"},src:e.target.src}))});for(var a=0;a<r.length;a++)r[a].addEventListener("error",this._sourceError);e.addEventListener("loadeddata",this._vLoadeddata)}}},{key:"_detachSourceEvents",value:function(e){var t=e.children;if(t&&0!==t.length&&this._sourceError){for(var n=0;n<t.length;n++)t[n].removeEventListener("error",this._sourceError);for(;t.length>0;)e.removeChild(t[0]);this._vLoadeddata&&e.removeEventListener("loadeddata",this._vLoadeddata)}}},{key:"errorHandler",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.media&&(this.media.error||t)){var n=this.media.error||t,r=n.code?ee[n.code]:"other";n.message,this.media.currentSrc||(n={code:6,message:"empty_src"}),this.emit(e,new ne(this,{errorType:r,errorCode:n.code,errorMessage:n.message||"",mediaError:n}))}}},{key:"destroy",value:function(){for(var e in this.media&&(this.media.pause&&(this.media.pause(),this.media.muted=!0),this.media.removeAttribute("src"),this.media.load()),this._currentTime=0,this._duration=0,this.mediaConfig=null,this._interval)Object.prototype.hasOwnProperty.call(this._interval,e)&&(clearInterval(this._interval[e]),this._interval[e]=null);this.detachVideoEvents(),this.media=null,this.mediaEventMiddleware={},this.removeAllListeners()}},{key:"video",get:function(){return this.media},set:function(e){this.media=e}},{key:"play",value:function(){return this.media?this.media.play():null}},{key:"pause",value:function(){this.media&&this.media.pause()}},{key:"load",value:function(){this.media&&this.media.load()}},{key:"canPlayType",value:function(e){return!!this.media&&this.media.canPlayType(e)}},{key:"getBufferedRange",value:function(e){var t=[0,0];if(!this.media)return t;e||(e=this.media.buffered);var n=this.media.currentTime;if(e)for(var r=0,i=e.length;r<i&&(t[0]=e.start(r),t[1]=e.end(r),!(t[0]<=n&&n<=t[1]));r++);return t[0]-n<=0&&n-t[1]<=0?t:[0,0]}},{key:"autoplay",get:function(){return!!this.media&&this.media.autoplay},set:function(e){this.media&&(this.media.autoplay=e)}},{key:"buffered",get:function(){return this.media?this.media.buffered:null}},{key:"buffered2",get:function(){return this.media&&this.media.buffered?K.getBuffered2(this.media.buffered):null}},{key:"bufferedPoint",get:function(){var e={start:0,end:0};if(!this.media)return e;var t=this.media.buffered;if(!t||0===t.length)return e;for(var n=0;n<t.length;n++)if((t.start(n)<=this.currentTime||t.start(n)<.1)&&t.end(n)>=this.currentTime)return{start:t.start(n),end:t.end(n)};return e}},{key:"crossOrigin",get:function(){return this.media?this.media.crossOrigin:""},set:function(e){this.media&&(this.media.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.media?this.media.currentSrc:""},set:function(e){this.media&&(this.media.currentSrc=e)}},{key:"currentTime",get:function(){return this.media?void 0!==this.media.currentTime?this.media.currentTime:this._currentTime:0},set:function(e){this.media&&(this.media.currentTime=e)}},{key:"defaultMuted",get:function(){return!!this.media&&this.media.defaultMuted},set:function(e){this.media&&(this.media.defaultMuted=e)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return!!this.media&&this.media.ended}},{key:"error",get:function(){return this.media.error}},{key:"errorNote",get:function(){return this.media.error?["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"][this.media.error.code-1]:""}},{key:"loop",get:function(){return!!this.media&&this.media.loop},set:function(e){this.media&&(this.media.loop=e)}},{key:"muted",get:function(){return!!this.media&&this.media.muted},set:function(e){this.media&&this.media.muted!==e&&(this._lastMuted=this.media.muted,this.media.muted=e)}},{key:"networkState",get:function(){return this.media.networkState}},{key:"paused",get:function(){return!this.media||this.media.paused}},{key:"playbackRate",get:function(){return this.media?this.media.playbackRate:0},set:function(e){this.media&&e!==1/0&&(this.media.defaultPlaybackRate=e,this.media.playbackRate=e)}},{key:"played",get:function(){return this.media?this.media.played:null}},{key:"preload",get:function(){return!!this.media&&this.media.preload},set:function(e){this.media&&(this.media.preload=e)}},{key:"readyState",get:function(){return this.media.readyState}},{key:"seekable",get:function(){return!!this.media&&this.media.seekable}},{key:"seeking",get:function(){return!!this.media&&this.media.seeking}},{key:"src",get:function(){return this.media?this.media.src:""},set:function(e){this.media&&(this.emit("urlchange",e),this.emit("waiting"),this._currentTime=0,this._duration=0,K.isMSE(this.media)?this.onWaiting():(this._detachSourceEvents(this.media),"Array"===K.typeOf(e)?this._attachSourceEvents(this.media,e):e?this.media.src=e:this.media.removeAttribute("src"),this.load()))}},{key:"volume",get:function(){return this.media?this.media.volume:0},set:function(e){e!==1/0&&this.media&&(this.media.volume=e)}},{key:"aspectRatio",get:function(){return this.media?this.media.videoWidth/this.media.videoHeight:0}},{key:"addInnerOP",value:function(e){this._internalOp[e]=!0}},{key:"removeInnerOP",value:function(e){delete this._internalOp[e]}},{key:"emit",value:function(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];G(t,"emit",this,3)([e,n].concat(i))}},{key:"on",value:function(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];G(t,"on",this,3)([e,n].concat(i))}},{key:"once",value:function(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];G(t,"once",this,3)([e,n].concat(i))}},{key:"off",value:function(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];G(t,"off",this,3)([e,n].concat(i))}},{key:"offAll",value:function(){G(t,"removeAllListeners",this,3)([])}}])}(F()),se=function(){return M((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};w(this,e),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=t}),[{key:"openDB",value:function(e){var t=this,n=this,r=this.myDB.version||1,i=n.indexedDB.open(n.myDB.name,r);i.onerror=function(e){},i.onsuccess=function(r){t.myDB.db=r.target.result,e.call(n)},i.onupgradeneeded=function(e){var t=e.target.result;e.target.transaction,t.objectStoreNames.contains(n.myDB.ojstore.name)||t.createObjectStore(n.myDB.ojstore.name,{keyPath:n.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){this.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(e,t){for(var n,r=this.myDB.db.transaction(e,"readwrite").objectStore(e),i=0;i<t.length;i++)(n=r.add(t[i])).onerror=function(){},n.onsuccess=function(){}}},{key:"putData",value:function(e,t){for(var n,r=this.myDB.db.transaction(e,"readwrite").objectStore(e),i=0;i<t.length;i++)(n=r.put(t[i])).onerror=function(){},n.onsuccess=function(){}}},{key:"getDataByKey",value:function(e,t,n){var r=this,i=this.myDB.db.transaction(e,"readwrite").objectStore(e).get(t);i.onerror=function(){n.call(r,null)},i.onsuccess=function(e){var t=e.target.result;n.call(r,t)}}},{key:"deleteData",value:function(e,t){this.myDB.db.transaction(e,"readwrite").objectStore(e).delete(t)}},{key:"clearData",value:function(e){this.myDB.db.transaction(e,"readwrite").objectStore(e).clear()}}])}(),ae=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],oe=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],le=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],ue="data-xgplayerid";function ce(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];var a=t.call.apply(t,[e].concat(i));n&&"function"==typeof n&&(a&&a.then?a.then((function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];n.call.apply(n,[e].concat(r))})):n.call.apply(n,[e].concat(i)))}function he(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[e]&&(this.__hooks[e]=null),function(){var r=arguments,i=this;if(n.pre)try{var s;(s=n.pre).call.apply(s,[this].concat(Array.prototype.slice.call(arguments)))}catch(t){throw t.message="[pluginName: ".concat(this.pluginName,":").concat(e,":pre error] >> ").concat(t.message),t}if(this.__hooks&&this.__hooks[e])try{var a,o=(a=this.__hooks[e]).call.apply(a,[this,this].concat(Array.prototype.slice.call(arguments)));o?o.then?o.then((function(e){!1!==e&&ce.apply(void 0,[i,t,n.next].concat(B(r)))})).catch((function(e){throw e})):ce.apply(void 0,[this,t,n.next].concat(Array.prototype.slice.call(arguments))):void 0===o&&ce.apply(void 0,[this,t,n.next].concat(Array.prototype.slice.call(arguments)))}catch(t){throw t.message="[pluginName: ".concat(this.pluginName,":").concat(e,"] >> ").concat(t.message),t}else ce.apply(void 0,[this,t,n.next].concat(Array.prototype.slice.call(arguments)))}.bind(this)}function de(e,t){var n=this.__hooks;if(n)return n.hasOwnProperty(e)?(n&&(n[e]=t),!0):(console.warn("has no supported hook which name [".concat(e,"]")),!1)}function fe(e,t){var n=this.__hooks;n&&delete n[e]}function pe(e){if(this.plugins&&this.plugins[e.toLowerCase()]){for(var t=this.plugins[e.toLowerCase()],n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.useHooks&&t.useHooks.apply(t,r)}}function ge(e){if(this.plugins&&this.plugins[e.toLowerCase()]){var t=this.plugins[e.toLowerCase()];if(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.removeHooks&&t.removeHooks.apply(t,r)}}}function me(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.__hooks={},t&&t.map((function(t){e.__hooks[t]=null})),Object.defineProperty(e,"hooks",{get:function(){return e.__hooks&&Object.keys(e.__hooks).map((function(t){if(e.__hooks[t])return t}))}})}function ve(e){e.__hooks=null}function ye(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];if(!e.__hooks||!e.__hooks[t])return n.call.apply(n,[e,e].concat(i));var a,o=(a=e.__hooks[t]).call.apply(a,[e,e].concat(i));if(o&&o.then)o.then((function(t){return!1===t?null:n.call.apply(n,[e,e].concat(i))})).catch((function(e){console.warn("[runHooks]".concat(t," reject"),e.message)}));else if(!1!==o)return n.call.apply(n,[e,e].concat(i))}function _e(e,t){z.logError("[".concat(e,"] event or callback cant be undefined or null when call ").concat(t))}var Te=function(){return M((function e(t){w(this,e),K.checkIsFunction(this.beforeCreate)&&this.beforeCreate(t),me(this),this.__args=t,this.__events={},this.__onceEvents={},this.config=t.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(t)}),[{key:"beforeCreate",value:function(e){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(e){this.player=e.player,this.playerConfig=e.player&&e.player.config,this.pluginName=e.pluginName?e.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=e.player&&e.player.logger}},{key:"updateLang",value:function(e){e||(e=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var e=K.checkTouchSupport()?"touch":"mouse";return!this.playerConfig||"touch"!==this.playerConfig.domEventType&&"mouse"!==this.playerConfig.domEventType||(e=this.playerConfig.domEventType),e}},{key:"on",value:function(e,t){var n=this;e&&t&&this.player?"string"==typeof e?(this.__events[e]=t,this.player.on(e,t)):Array.isArray(e)&&e.forEach((function(e){n.__events[e]=t,n.player.on(e,t)})):_e(this.pluginName,"plugin.on(event, callback)")}},{key:"once",value:function(e,t){var n=this;e&&t&&this.player?"string"==typeof e?(this.__onceEvents[e]=t,this.player.once(e,t)):Array.isArray(e)&&e.forEach((function(r){n.__onceEvents[r]=t,n.player.once(e,t)})):_e(this.pluginName,"plugin.once(event, callback)")}},{key:"off",value:function(e,t){var n=this;e&&t&&this.player?"string"==typeof e?(delete this.__events[e],this.player.off(e,t)):Array.isArray(e)&&e.forEach((function(r){delete n.__events[e],n.player.off(r,t)})):_e(this.pluginName,"plugin.off(event, callback)")}},{key:"offAll",value:function(){var e=this;["__events","__onceEvents"].forEach((function(t){Object.keys(e[t]).forEach((function(n){e[t][n]&&e.off(n,e[t][n]),n&&delete e[t][n]}))})),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(e){var t;if(this.player){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.player).emit.apply(t,[e].concat(r))}}},{key:"emitUserAction",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.player){var r=L(L({},n),{},{pluginName:this.pluginName});this.player.emitUserAction(e,t,r)}}},{key:"hook",value:function(e,t){return he.call.apply(he,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return de.call.apply(de,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return fe.call.apply(fe,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.player)return n&&(t.pluginName=n),this.player.registerPlugin({plugin:e,options:t})}},{key:"getPlugin",value:function(e){return this.player?this.player.getPlugin(e):null}},{key:"__destroy",value:function(){var e=this,t=this.player,n=this.pluginName;this.offAll(),K.clearAllTimers(this),K.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map((function(t){e[t]=null})),t.unRegisterPlugin(n),ve(this)}}],[{key:"defineGetterOrSetter",value:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&Object.defineProperty(e,n,t[n])}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}])}(),be=n(36922),Se=n.n(be),Pe={CONTROLS:"controls",ROOT:"root"},we={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"},ke="xg-icon-disable";function Me(e){return!!e&&e.indexOf&&/^(?:http|data:|\/)/.test(e)}function Ee(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=null;if(e instanceof window.Element)return K.addClass(e,n),Object.keys(r).map((function(t){e.setAttribute(t,r[t])})),e;if(Me(e)||Me(e.url))return r.src=Me(e)?e:e.url||"",s=K.createDom(e.tag||"img","",r,"xg-img ".concat(n));if("function"==typeof e)try{return(s=e())instanceof window.Element?(K.addClass(s,n),Object.keys(r).map((function(e){s.setAttribute(e,r[e])})),s):(z.logWarn("warn>>icons.".concat(t," in config of plugin named [").concat(i,"] is a function mast return an Element Object")),null)}catch(e){return z.logError("Plugin named [".concat(i,"]:createIcon"),e),null}return"string"==typeof e?K.createDomFromHtml(e,r,n):(z.logWarn("warn>>icons.".concat(t," in config of plugin named [").concat(i,"] is invalid")),null)}var Re=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return w(this,t),(e=P(this,t,[n])).__delegates=[],e}return D(t,e),M(t,[{key:"__init",value:function(e){G(t,"__init",this,3)([e]);var n=e.root,r=null;if(this.icons={},this.root=null,this.parent=null,e.root){(function(e,t){var n=t.config.icons||t.playerConfig.icons;Object.keys(e).map((function(r){var i=e[r],s=i&&i.class?i.class:"",a=i&&i.attr?i.attr:{},o=null;n&&n[r]&&(s=function(e,t){return"object"===$(e)&&e.class&&"string"==typeof e.class?"".concat(t," ").concat(e.class):t}(n[r],s),a=function(e,t){return"object"===$(e)&&e.attr&&"object"===$(e.attr)&&Object.keys(e.attr).map((function(n){t[n]=e.attr[n]})),t}(n[r],a),o=Ee(n[r],r,s,a,t.pluginName)),!o&&i&&(o=Ee(i.icon?i.icon:i,a,s,{},t.pluginName)),t.icons[r]=o}))})(this.registerIcons()||{},this),this.langText={};var i,s,a=this.registerLanguageTexts()||{};i=a,s=this,Object.keys(i).map((function(e){Object.defineProperty(s.langText,e,{get:function(){var t=s.lang,n=s.i18n;return n[e]?n[e]:i[e]&&i[e][t]||""}})}));var o="";try{o=this.render()}catch(e){throw z.logError("Plugin:".concat(this.pluginName,":render"),e),new Error("Plugin:".concat(this.pluginName,":render:").concat(e.message))}if(o)(r=t.insert(o,n,e.index)).setAttribute("data-index",e.index);else{if(!e.tag)return;(r=K.createDom(e.tag,"",e.attr,e.name)).setAttribute("data-index",e.index),n.appendChild(r)}this.root=r,this.parent=n;var l=this.config.attr||{},u=this.config.style||{};this.setAttr(l),this.setStyle(u),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var e=this;if(this.root){this._children=[];var t=this.children();t&&"object"===$(t)&&Object.keys(t).length>0&&Object.keys(t).map((function(n){var r,i,s=n,a=t[s],o={root:e.root};"function"==typeof a?(r=e.config[s]||{},i=a):"object"===$(a)&&"function"==typeof a.plugin&&(r=a.options?K.deepCopy(e.config[s]||{},a.options):e.config[s]||{},i=a.plugin),o.config=r,void 0!==r.index&&(o.index=r.index),r.root&&(o.root=r.root),e.registerPlugin(i,o,s)}))}}},{key:"updateLang",value:function(e){e||(e=this.lang);var t=this.root,n=this.i18n,r=this.langText;t&&function e(t,n){for(var r=0;r<t.children.length;r++)t.children[r].children.length>0?e(t.children[r],n):n(t.children[r])}(t,(function(t){var i=t.getAttribute&&t.getAttribute("lang-key");if(i){var s=n[i.toUpperCase()]||r[i];s&&(t.innerHTML="function"==typeof s?s(e):s)}}))}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.i18n||{},r=this.langText;e.setAttribute&&e.setAttribute("lang-key",t);var i=n[t]||r[t]||"";i&&(e.innerHTML=i)}},{key:"plugins",value:function(){return this._children}},{key:"disable",value:function(){this.config.disable=!0,K.addClass(this.find(".xgplayer-icon"),ke)}},{key:"enable",value:function(){this.config.disable=!1,K.removeClass(this.find(".xgplayer-icon"),ke)}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";n.root=n.root||this.root;var i=G(t,"registerPlugin",this,3)([e,n,r]);return this._children.push(i),i}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(e){if(this.root)return this.root.querySelector(e)}},{key:"bind",value:function(e,n,r){var i=this;if(arguments.length<3&&"function"==typeof n)Array.isArray(e)?e.forEach((function(e){i.bindEL(e,n)})):this.bindEL(e,n);else{var s=t.delegate.call(this,this.root,e,n,r);this.__delegates=this.__delegates.concat(s)}}},{key:"unbind",value:function(e,t){var n=this;if(arguments.length<3&&"function"==typeof t)Array.isArray(e)?e.forEach((function(e){n.unbindEL(e,t)})):this.unbindEL(e,t);else for(var r="".concat(e,"_").concat(t),i=0;i<this.__delegates.length;i++)if(this.__delegates[i].key===r){this.__delegates[i].destroy(),this.__delegates.splice(i,1);break}}},{key:"setStyle",value:function(e,t){var n=this;if(this.root)return"String"===K.typeOf(e)?this.root.style[e]=t:void("Object"===K.typeOf(e)&&Object.keys(e).map((function(t){n.root.style[t]=e[t]})))}},{key:"setAttr",value:function(e,t){var n=this;if(this.root)return"String"===K.typeOf(e)?this.root.setAttribute(e,t):void("Object"===K.typeOf(e)&&Object.keys(e).map((function(t){n.root.setAttribute(t,e[t])})))}},{key:"setHtml",value:function(e,t){this.root&&(this.root.innerHTML=e,"function"==typeof t&&t())}},{key:"bindEL",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"==typeof t&&this.root.addEventListener(e,t,n)}},{key:"unbindEL",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"==typeof t&&this.root.removeEventListener(e,t,n)}},{key:"show",value:function(e){if(this.root)return this.root.style.display=void 0!==e?e:"block","none"===window.getComputedStyle(this.root,null).getPropertyValue("display")?this.root.style.display="block":void 0}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(e,t){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!(t&&t instanceof window.Element))return null;try{return"string"==typeof e?this.find(e).appendChild(t):e.appendChild(t)}catch(e){return z.logError("Plugin:appendChild",e),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var e=this,n=this.player;this.__delegates.map((function(e){e.destroy()})),this.__delegates=[],this._children instanceof Array&&(this._children.map((function(e){n.unRegisterPlugin(e.pluginName)})),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),G(t,"__destroy",this,3)([]),this.icons={},["root","parent"].map((function(t){e[t]=null}))}}],[{key:"insert",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=t.children.length,i=Number(n),s=e instanceof window.Node;if(r){for(var a=0,o=null,l="";a<r;a++){o=t.children[a];var u=Number(o.getAttribute("data-index"));if(u>=i){l="beforebegin";break}u<i&&(l="afterend")}return s?"afterend"===l?t.appendChild(e):t.insertBefore(e,o):o.insertAdjacentHTML(l,e),"afterend"===l?t.children[t.children.length-1]:t.children[a]}return s?t.appendChild(e):t.insertAdjacentHTML("beforeend",e),t.children[t.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=[];if(e instanceof window.Node&&"function"==typeof r)if(Array.isArray(n))n.forEach((function(n){var a=Se()(e,t,n,r,i);a.key="".concat(t,"_").concat(n),s.push(a)}));else{var a=Se()(e,t,n,r,i);a.key="".concat(t,"_").concat(n),s.push(a)}return s}},{key:"ROOT_TYPES",get:function(){return Pe}},{key:"POSITIONS",get:function(){return we}}])}(Te),xe=function(){return M((function e(){var t=this;if(w(this,e),E(this,"__trigger",(function(e){var n=(new Date).getTime();t.timeStamp=n;for(var r=0;r<e.length;r++)t.__runHandler(e[r].target)})),this.__handlers=[],this.timeStamp=0,this.observer=null,window.ResizeObserver)try{this.observer=new window.ResizeObserver(function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return W(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),function(e,t,n){var r,i,s,a,o,l,u=0,c=!1,h=!1,d=!0,f=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,s=i;return r=i=void 0,u=t,a=e.apply(s,n)}function g(e,t){return f?(window.cancelAnimationFrame(o),window.requestAnimationFrame(e)):setTimeout(e,t)}function m(e){var n=e-l;return void 0===l||n>=t||n<0||h&&e-u>=s}function v(){var e=Date.now();if(m(e))return y(e);o=g(v,function(e){var n=e-u,r=t-(e-l);return h?Math.min(r,s-n):r}(e))}function y(e){return o=void 0,d&&r?p(e):(r=i=void 0,a)}function _(){for(var e=Date.now(),n=m(e),s=arguments.length,d=new Array(s),f=0;f<s;f++)d[f]=arguments[f];if(r=d,i=this,l=e,n){if(void 0===o)return function(e){return u=e,o=g(v,t),c?p(e):a}(l);if(h)return o=g(v,t),p(l)}return void 0===o&&(o=g(v,t)),a}return t=+t||0,W(n)&&(c=!!n.leading,s=(h="maxWait"in n)?Math.max(+n.maxWait||0,t):s,d="trailing"in n?!!n.trailing:d),_.cancel=function(){void 0!==o&&function(e){if(f)return window.cancelAnimationFrame(e);clearTimeout(e)}(o),u=0,r=l=i=o=void 0},_.flush=function(){return void 0===o?a:y(Date.now())},_.pending=function(){return void 0!==o},_}(e,100,{leading:r,trailing:i,maxWait:100})}(this.__trigger,0,{trailing:!0})),this.timeStamp=(new Date).getTime()}catch(e){console.error(e)}}),[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var n=e.getAttribute(ue),r=this.__handlers,i=-1,s=0;s<r.length;s++)r[s]&&e===r[s].target&&(i=s);i>-1?this.__handlers[i].handler=t:this.__handlers.push({target:e,handler:t,playerId:n})}}},{key:"unObserver",value:function(e){var t=-1;this.__handlers.map((function(n,r){e===n.target&&(t=r)}));try{this.observer&&this.observer.unobserve(e)}catch(e){}this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e){for(var t=this.__handlers,n=0;n<t.length;n++)if(t[n]&&e===t[n].target){try{t[n].handler(e)}catch(e){console.error(e)}return!0}return!1}}])}(),De=null,Ie={pluginGroup:{},init:function(e){var t,n,r=e._pluginInfoId;r||(r=K.generateSessionId(),e._pluginInfoId=r),!e.config.closeResizeObserver&&e.root&&(t=e.root,n=function(){e.resize()},De||(De=new xe),De.addObserver(t,n)),this.pluginGroup[r]={_originalOptions:e.config||{},_plugins:{}}},formatPluginInfo:function(e,t){var n=null,r=null;return e.plugin&&"function"==typeof e.plugin?(n=e.plugin,r=e.options):(n=e,r={}),t&&(r.config=t||{}),{PLUFGIN:n,options:r}},checkPluginIfExits:function(e,t){for(var n=0;n<t.length;n++)if(e.toLowerCase()===t[n].pluginName.toLowerCase())return!0;return!1},getRootByConfig:function(e,t){for(var n=Object.keys(t),r=null,i=0;i<n.length;i++)if(e.toLowerCase()===n[i].toLowerCase()){r=t[n[i]];break}return"Object"===K.typeOf(r)?{root:r.root,position:r.position}:{}},lazyRegister:function(e,t){var n=this,r=t.timeout||1500;return Promise.race([t.loader().then((function(t){var r;r=t&&t.__esModule?t.default:t,n.register(e,r,t.options)})),new Promise((function(e,t){setTimeout((function(){t(new Error("timeout"))}),r)}))])},register:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&t&&"function"==typeof t&&void 0!==t.prototype){var r=e._pluginInfoId;if(r&&this.pluginGroup[r]){this.pluginGroup[r]._plugins||(this.pluginGroup[r]._plugins={});var i=this.pluginGroup[r]._plugins,s=this.pluginGroup[r]._originalOptions;n.player=e;var a=n.pluginName||t.pluginName;if(!a)throw new Error("The property pluginName is necessary");if(!t.isSupported||t.isSupported(e.config.mediaType,e.config.codecType)){n.config||(n.config={});for(var o=Object.keys(s),l=0;l<o.length;l++)if(a.toLowerCase()===o[l].toLowerCase()){var u=s[o[l]];"Object"===K.typeOf(u)?n.config=Object.assign({},n.config,s[o[l]]):"Boolean"===K.typeOf(u)&&(n.config.disable=!u);break}t.defaultConfig&&Object.keys(t.defaultConfig).forEach((function(e){void 0===n.config[e]&&(n.config[e]=t.defaultConfig[e])})),n.root?"string"==typeof n.root&&(n.root=e[n.root]):n.root=e.root,n.index=n.config.index||0;try{i[a.toLowerCase()]&&(this.unRegister(r,a.toLowerCase()),console.warn("the is one plugin with same pluginName [".concat(a,"] exist, destroy the old instance")));var c=new t(n);return i[a.toLowerCase()]=c,i[a.toLowerCase()].func=t,c&&"function"==typeof c.afterCreate&&c.afterCreate(),c}catch(e){throw console.error(e),e}}else console.warn("not supported plugin [".concat(a,"]"))}}},unRegister:function(e,t){e._pluginInfoId&&(e=e._pluginInfoId),t=t.toLowerCase();try{var n=this.pluginGroup[e]._plugins[t];n&&(n.pluginName&&n.__destroy(),delete this.pluginGroup[e]._plugins[t])}catch(n){console.error("[unRegister:".concat(t,"] cgid:[").concat(e,"] error"),n)}},deletePlugin:function(e,t){var n=e._pluginInfoId;n&&this.pluginGroup[n]&&this.pluginGroup[n]._plugins&&delete this.pluginGroup[n]._plugins[t]},getPlugins:function(e){var t=e._pluginInfoId;return t&&this.pluginGroup[t]?this.pluginGroup[t]._plugins:{}},findPlugin:function(e,t){var n=e._pluginInfoId;if(!n||!this.pluginGroup[n])return null;var r=t.toLowerCase();return this.pluginGroup[n]._plugins[r]},beforeInit:function(e){var t=this;function n(e){return e&&e.then?e:new Promise((function(e){e()}))}return new Promise((function(r){if(t.pluginGroup)return(e._loadingPlugins&&e._loadingPlugins.length?Promise.all(e._loadingPlugins):Promise.resolve()).then((function(){var i=e._pluginInfoId;if(t.pluginGroup[i]){var s=t.pluginGroup[i]._plugins,a=[];Object.keys(s).forEach((function(e){if(s[e]&&s[e].beforePlayerInit)try{var t=s[e].beforePlayerInit();a.push(n(t))}catch(e){throw a.push(n(null)),e}})),Promise.all([].concat(a)).then((function(){r()})).catch((function(e){console.error(e),r()}))}else r()}))}))},afterInit:function(e){var t=e._pluginInfoId;if(t&&this.pluginGroup[t]){var n=this.pluginGroup[t]._plugins;Object.keys(n).forEach((function(e){n[e]&&n[e].afterPlayerInit&&n[e].afterPlayerInit()}))}},setLang:function(e,t){var n=t._pluginInfoId;if(n&&this.pluginGroup[n]){var r=this.pluginGroup[n]._plugins;Object.keys(r).forEach((function(t){if(r[t].updateLang)r[t].updateLang(e);else try{r[t].lang=e}catch(e){console.warn("".concat(t," setLang"))}}))}},reRender:function(e){var t=this,n=e._pluginInfoId;if(n&&this.pluginGroup[n]){var r=[],i=this.pluginGroup[n]._plugins;Object.keys(i).forEach((function(e){"controls"!==e&&i[e]&&(r.push({plugin:i[e].func,options:i[e].__args}),t.unRegister(n,e))})),r.forEach((function(n){t.register(e,n.plugin,n.options)}))}},onPluginsReady:function(e){var t=e._pluginInfoId;if(t&&this.pluginGroup[t]){var n=this.pluginGroup[t]._plugins||{};Object.keys(n).forEach((function(e){n[e].onPluginsReady&&"function"==typeof n[e].onPluginsReady&&n[e].onPluginsReady()}))}},destroy:function(e){var t=e._pluginInfoId;if(this.pluginGroup[t]){var n;e.root&&(n=e.root,De.unObserver(n,undefined));for(var r=this.pluginGroup[t]._plugins,i=0,s=Object.keys(r);i<s.length;i++){var a=s[i];this.unRegister(t,a)}delete this.pluginGroup[t],delete e._pluginInfoId}}},Ce="xgplayer-is-enter",Le="xgplayer-pause",Oe="xgplayer-playing",Ae="xgplayer-ended",Ge="xgplayer-isloading",Be="xgplayer-is-error",Ne="xgplayer-replay",$e="xgplayer-nostart",Ue="xgplayer-inactive",Fe="xgplayer-is-fullscreen",He="xgplayer-is-cssfullscreen",Ve="xgplayer-rotate-fullscreen",je="xgplayer-rotate-parent",ze="xgplayer-fullscreen-parent",Xe="xgplayer-fullscreen-inner",Ke="controls-autohide",We="not-allow-autoplay",Qe="seeking",qe="xgplayer-built-in";function Ye(){return{id:"",el:null,isNoRoot:!1,isCustomRoot:!0,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!0,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},preProcessUrl:null,ignores:[],whitelist:[],inactive:3e3,lang:(e=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase(),"zh-cn"===e&&(e="zh"),e),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],tabindex:0,thumbnail:null,videoConfig:{},isHideTips:!1,minWaitDelay:200,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}};var e}var Je=function(e){function t(){var e;w(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return E(e=P(this,t,[].concat(r)),"onMouseEnter",(function(t){var n=e,r=n.player;n.playerConfig.closeControlsBlur&&r.focus({autoHide:!1})})),E(e,"onMouseLeave",(function(t){e.player.focus()})),e}return D(t,e),M(t,[{key:"beforeCreate",value:function(e){e.config.mode||"mobile"!==J.device||(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}},{key:"afterCreate",value:function(){var e=this,t=this.config,n=t.disable,r=t.height,i=t.mode;if(!n){"flex"===i&&this.player.addClass("flex-controls");var s={height:"".concat(r,"px")};Object.keys(s).map((function(t){e.root.style[t]=s[t]})),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on("mini_state_change",(function(t){t?K.addClass(e.root,"mini-controls"):K.removeClass(e.root,"mini-controls")}));var a=this.playerConfig.isMobileSimulateMode;"mobile"!==J.device&&"mobile"!==a&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&K.addClass(this.root,Ke)}},{key:"pauseAutoHide",value:function(){K.removeClass(this.root,Ke)}},{key:"show",value:function(e){this.root.style.display="",this.player.focus()}},{key:"hide",value:function(){this.root.style.display="none"}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;if(this.root){var i=e.defaultConfig||{};if(!n.root){switch(n.position?n.position:n.config&&n.config.position?n.config.position:i.position){case we.CONTROLS_LEFT:n.root=this.left;break;case we.CONTROLS_RIGHT:n.root=this.right;break;case we.CONTROLS_CENTER:n.root=this.center;break;case we.CONTROLS:n.root=this.root;break;default:n.root=this.left}return G(t,"registerPlugin",this,3)([e,n,r])}}}},{key:"destroy",value:function(){"mobile"!==J.device&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave))}},{key:"render",value:function(){var e=this.config,t=e.mode,n=e.autoHide,r=e.initShow;if(!e.disable){var i=K.classNames({"xgplayer-controls":!0},{"flex-controls":"flex"===t},{"bottom-controls":"bottom"===t},E({},Ke,n),{"xgplayer-controls-initshow":r||!n});return'<xg-controls class="'.concat(i,'" unselectable="on">\n    <xg-inner-controls class="xg-inner-controls xg-pos">\n      <xg-left-grid class="xg-left-grid">\n      </xg-left-grid>\n      <xg-center-grid class="xg-center-grid"></xg-center-grid>\n      <xg-right-grid class="xg-right-grid">\n      </xg-right-grid>\n    </xg-inner-controls>\n    </xg-controls>')}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}])}(Re),Ze={lang:{},langKeys:[],textKeys:[]};function et(e,t){return Object.keys(t).forEach((function(n){var r,i=K.typeOf(t[n]),s=K.typeOf(e[n]);"Array"===i?("Array"!==s&&(e[n]=[]),(r=e[n]).push.apply(r,B(t[n]))):"Object"===i?("Object"!==s&&(e[n]={}),et(e[n],t[n])):e[n]=t[n]})),e}function tt(){Object.keys(Ze.lang.en).map((function(e){Ze.textKeys[e]=e}))}function nt(e,t){var n=e.LANG;if(t||(t=Ze),t.lang){var r=e.TEXT||{};"zh"===n&&(n="zh-cn"),t.lang[n]?et(t.lang[n],r):(t.langKeys.push(n),t.lang[n]=r),tt()}}nt({LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}});var rt={get textKeys(){return Ze.textKeys},get langKeys(){return Ze.langKeys},get lang(){var e={};return Ze.langKeys.map((function(t){e[t]=Ze.lang[t]})),Ze.lang["zh-cn"]&&(e.zh=Ze.lang["zh-cn"]||{}),e},extend:function(e,t){var n=[];if(t||(t=Ze),t.lang){n="Array"!==K.typeOf(e)?Object.keys(e).map((function(t){return{LANG:"zh"===t?"zh-cn":t,TEXT:e[t]}})):e;var r=t.lang;n.map((function(e){"zh"===e.LANG&&(e.LANG="zh-cn"),r[e.LANG]?et(r[e.LANG]||{},e.TEXT||{}):nt(e,t)})),tt()}},use:nt,init:function(e){var t,n={lang:{},langKeys:[],textKeys:{},pId:e};return et(n.lang,Ze.lang),(t=n.langKeys).push.apply(t,B(Ze.langKeys)),et(n.textKeys,Ze.textKeys),n}},it=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"],st={},at=null,ot=function(e){function t(){return w(this,t),P(this,t,arguments)}return D(t,e),M(t,[{key:"add",value:function(e){e&&(st[e.playerId]=e,1===Object.keys(st).length&&this.setActive(e.playerId,!0))}},{key:"remove",value:function(e){e&&(e.isUserActive,delete st[e.playerId])}},{key:"_iterate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var n in st)if(Object.prototype.hasOwnProperty.call(st,n)){var r=st[n];if(t){if(e(r))break}else e(r)}}},{key:"forEach",value:function(e){this._iterate(e)}},{key:"find",value:function(e){var t=null;return this._iterate((function(n){var r=e(n);return r&&(t=n),r}),!0),t}},{key:"findAll",value:function(e){var t=[];return this._iterate((function(n){e(n)&&t.push(n)})),t}},{key:"setActive",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(st[e])return t?this.forEach((function(t){e===t.playerId?(t.isUserActive=!0,t.isInstNext=!1):t.isUserActive=!1})):st[e].isUserActive=t,e}},{key:"getActiveId",value:function(){for(var e=Object.keys(st),t=0;t<e.length;t++){var n=st[e[t]];if(n&&n.isUserActive)return e[t]}return null}},{key:"setNext",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(st[e])return t?this.forEach((function(t){e===t.playerId?(t.isUserActive=!1,t.isInstNext=!0):t.isInstNext=!1})):st[e].isInstNext=t,e}}],[{key:"getInstance",value:function(){return at||(at=new t),at}}])}(U.EventEmitter),lt=["play","pause","replay","retry"],ut=0,ct=0,ht=null,dt=function(e){function t(e){var n;w(this,t);var r,i=K.deepMerge(Ye(),e);E(n=P(this,t,[i]),"canPlayFunc",(function(){if(n.config){var e=n.config,t=e.autoplay,r=e.defaultPlaybackRate;z.logInfo("player","canPlayFunc, startTime",n.__startTime),n._seekToStartTime(),n.playbackRate=r,(t||n._useAutoplay)&&n.mediaPlay(),n.off(o,n.canPlayFunc),n.removeClass(Ce)}})),E(n,"onFullscreenChange",(function(e,t){var r=function(){K.setTimeout(n,(function(){n.resize()}),100)},i=K.getFullScreenEl();n._fullActionFrom?n._fullActionFrom="":n.emit(T,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:n.currentTime,duration:n.duration,props:[{prop:"fullscreen",from:!0,to:!1}]});var s=function(e,t,n){if(e){var r=e.getAttribute(n);return!(!r||r!==t||"VIDEO"!==e.tagName&&"AUDIO"!==e.tagName)}}(i,n.playerId,ue);if(t||i&&(i===n._fullscreenEl||s))r(),!n.config.closeFocusVideoFocus&&n.media.focus(),n.fullscreen=!0,n.changeFullStyle(n.root,i,Fe),n.emit(v,!0,n._fullScreenOffset),n.cssfullscreen&&n.exitCssFullscreen();else if(n.fullscreen){r();var a=n,o=a._fullScreenOffset;if(a.config.needFullscreenScroll?(window.scrollTo(o.left,o.top),K.setTimeout(n,(function(){n.fullscreen=!1,n._fullScreenOffset=null}),100)):(!n.config.closeFocusVideoFocus&&n.media.focus(),n.fullscreen=!1,n._fullScreenOffset=null),n.cssfullscreen)n.removeClass(Fe);else{var l=n._fullscreenEl;l||!n.root.contains(e.target)&&e.target!==n.root||(l=e.target),n.recoverFullStyle(n.root,l,Fe)}n._fullscreenEl=null,n.emit(v,!1)}})),E(n,"_onWebkitbeginfullscreen",(function(e){n._fullscreenEl=n.media,n.onFullscreenChange(e,!0)})),E(n,"_onWebkitendfullscreen",(function(e){n.onFullscreenChange(e,!1)})),me(n,lt),n.config=i,n._pluginInfoId=K.generateSessionId(),(r=n).logInfo=z.logInfo.bind(r),r.logWarn=z.logWarn.bind(r),r.logError=z.logError.bind(r);var s=n.constructor.defaultPreset,a=n.config.presets;if(a.length){var l=a.indexOf("default");l>=0&&s&&(a[l]=s)}else s&&a.push(s);n.userTimer=null,n.waitTimer=null,n.handleSource=!0,n._state=1,n.isError=!1,n._hasStart=!1,n.isSeeking=!1,n.isCanplay=!1,n._useAutoplay=!1,n.__startTime=-1,n.rotateDeg=0,n.isActive=!1,n.fullscreen=!1,n.cssfullscreen=!1,n.isRotateFullscreen=!1,n._fullscreenEl=null,n.timeSegments=[],n._cssfullscreenEl=null,n.curDefinition=null,n._orgCss="",n._fullScreenOffset=null,n._videoHeight=0,n._videoWidth=0,n.videoPos={pi:1,scale:0,rotate:-1,x:0,y:0,h:-1,w:-1,vy:0,vx:0},n.sizeInfo={width:0,height:0,left:0,top:0},n._accPlayed={t:0,acc:0,loopAcc:0},n._offsetInfo={currentTime:-1,duration:0},n.innerContainer=null,n.controls=null,n.topBar=null,n.root=null,n.__i18n=rt.init(n._pluginInfoId),J.os.isAndroid&&J.osVersion>0&&J.osVersion<6&&(n.config.autoplay=!1),n.database=new se,n.isUserActive=!1,n._onceSeekCanplay=null,n._isPauseBeforeSeek=0,n.innerStates={isActiveLocked:!1},n.instManager=ht,n._initMedia();var u=n.config.isNoRoot,c=!u&&n._initDOM();if(!u&&!c)return console.error(new Error("can't find the dom which id is ".concat(n.config.id," or this.config.el does not exist"))),O(n);Ie.init(n);var h=n.config,d=h.definition,f=void 0===d?{}:d;if(!h.url&&f.list&&f.list.length>0){var p=f.list.find((function(e){return e.definition&&e.definition===f.defaultDefinition}));p||(f.defaultDefinition=f.list[0].definition,p=f.list[0]),n.config.url=p.url,n.curDefinition=p}return n._bindEvents(),n._registerPresets(),n._registerPlugins(),Ie.onPluginsReady(n),n.getInitDefinition(),n.setState(2),K.setTimeout(n,(function(){n.emit("ready")}),0),n.onReady&&n.onReady(),(n.config.videoInit||n.config.autoplay)&&(!n.hasStart||n.state<4)&&n.start(),n}return D(t,e),M(t,[{key:"_initMedia",value:function(){var e=this.constructor.XgVideoProxy;if(e&&this.mediaConfig.mediaType===e.mediaType){var t=this.innerContainer||this.root;this.detachVideoEvents(this.media);var n=new e(t,this.config,this.mediaConfig);this.attachVideoEvents(n),this.media=n}this.media.setAttribute(ue,this.playerId)}},{key:"_initDOM",value:function(){var e,t=this,n=this.config,r=n.id,i=n.el,s=n.isCustomRoot,a=n.controls,o=n.autoplay,l=n.isMobileSimulateMode;if(this.root=r?document.getElementById(r):null,!this.root)if(i&&1===i.nodeType)this.root=i;else{if(s)return this.emit("error",new ne("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1;this.root=K.createDom("div","",{id:r,class:qe})}var u=function(e){for(var t=Object.keys(st),n=0;n<t.length;n++){var r=st[t[n]];if(r.root===e)return r}return null}(this.root);u&&(z.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),u.destroy()),this.root.setAttribute(ue,this.playerId),null===(e=ht)||void 0===e||e.add(this),Ie.init(this),this._initBaseDoms();var c=this.constructor.XgVideoProxy;if(c&&this.mediaConfig.mediaType===c.mediaType){var h=this.innerContainer||this.root;this.detachVideoEvents(this.media);var d=new c(h,this.config,this.mediaConfig);this.attachVideoEvents(d),this.media=d}if(this.media.setAttribute(ue,this.playerId),a){var f=a.root||null,p=Ie.register(this,Je,{root:f});this.controls=p}var g="mobile"===l?"mobile":J.device;if(this.addClass("".concat("xgplayer"," ").concat(Ue," xgplayer-").concat(g," ").concat(a?"":"no-controls")),o?this.addClass(Ce):this.addClass($e),this.config.fluid){var m=this.config,v=m.width,y=m.height;"number"==typeof v&&"number"==typeof y||(v=600,y=337.5);var _={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(100*y/v,"%")};Object.keys(_).forEach((function(e){t.root.style[e]=_[e]}))}else["width","height"].forEach((function(e){t.config[e]&&("number"!=typeof t.config[e]?t.root.style[e]=t.config[e]:t.root.style[e]="".concat(t.config[e],"px"))}));var T=this.root.getBoundingClientRect(),b=T.width,S=T.height,P=T.left,w=T.top;return this.sizeInfo.width=b,this.sizeInfo.height=S,this.sizeInfo.left=P,this.sizeInfo.top=w,!0}},{key:"_initBaseDoms",value:function(){this.topBar=null,this.leftBar=null,this.rightBar=null,this.config.marginControls&&(this.innerContainer=K.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer))}},{key:"_bindEvents",value:function(){var e=this;["focus","blur"].forEach((function(t){e.on(t,e["on"+t.charAt(0).toUpperCase()+t.slice(1)])})),ae.forEach((function(t){document&&document.addEventListener(t,e.onFullscreenChange)})),J.os.isIos&&(this.media.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(u,this.resize),this.playFunc=function(){e.config.closeFocusVideoFocus||e.media.focus()},this.once(i,this.playFunc)}},{key:"_unbindEvents",value:function(){var e=this;this.root&&this.root.removeEventListener("mousemove",this.mousemoveFunc),ae.forEach((function(t){document.removeEventListener(t,e.onFullscreenChange)})),this.playFunc&&this.off(i,this.playFunc),this.off(o,this.canPlayFunc),this.media.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}},{key:"_clearUserTimer",value:function(){this.userTimer&&(K.clearTimeout(this,this.userTimer),this.userTimer=null)}},{key:"_startInit",value:function(e){var t=this;if(this.media&&(e&&""!==e&&("Array"!==K.typeOf(e)||0!==e.length)||(e="",this.emit("urlNull"),z.logWarn("config.url is null, please get url and run player._startInit(url)"),!this.config.nullUrlStart))){this.handleSource&&(this._detachSourceEvents(this.media),"Array"===K.typeOf(e)&&e.length>0?this._attachSourceEvents(this.media,e):this.media.src&&this.media.src===e?e||this.media.removeAttribute("src"):this.media.src=e),"Number"===K.typeOf(this.config.volume)&&(this.volume=this.config.volume);var n=this.innerContainer?this.innerContainer:this.root;n&&this.media instanceof window.Element&&!n.contains(this.media)&&n.insertBefore(this.media,n.firstChild);var r=this.media.readyState;z.logInfo("_startInit readyState",r),this.config.autoplay&&(!K.isMSE(this.media)&&this.load(),(J.os.isIpad||J.os.isPhone)&&this.mediaPlay());var i=this.config.startTime;this.__startTime=i>0?i:-1,this.config.startTime=0,r>=2&&this.duration>0?this.canPlayFunc():this.on(o,this.canPlayFunc),(!this.hasStart||this.state<4)&&Ie.afterInit(this),this.hasStart=!0,this.setState(4),K.setTimeout(this,(function(){t.emit("complete")}),0)}}},{key:"_registerPlugins",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._loadingPlugins=[];var n=this.config.ignores||[],r=this.config.plugins||[],i=this.config.i18n||[];t&&rt.extend(i,this.__i18n);var s=n.join("||").toLowerCase().split("||"),a=this.plugins;r.forEach((function(n){try{var r=n.plugin?n.plugin.pluginName:n.pluginName;if(r&&s.indexOf(r.toLowerCase())>-1)return null;if(!t&&a[r.toLowerCase()])return;if(n.lazy&&n.loader){var i=Ie.lazyRegister(e,n);return void(n.forceBeforeInit&&(i.then((function(){e._loadingPlugins.splice(e._loadingPlugins.indexOf(i),1)})).catch((function(t){z.logError("_registerPlugins:loadingPlugin",t),e._loadingPlugins.splice(e._loadingPlugins.indexOf(i),1)})),e._loadingPlugins.push(i)))}return e.registerPlugin(n)}catch(e){z.logError("_registerPlugins:",e)}}))}},{key:"_registerPresets",value:function(){var e=this;this.config.presets.forEach((function(t){!function(e,t){var n,r,i=t.preset&&t.options?new t.preset(t.options,e.config):new t({},e.config),s=i.plugins,a=void 0===s?[]:s,o=i.ignores,l=void 0===o?[]:o,u=i.icons,c=void 0===u?{}:u,h=i.i18n,d=void 0===h?[]:h;e.config.plugins||(e.config.plugins=[]),e.config.ignores||(e.config.ignores=[]),(n=e.config.plugins).push.apply(n,B(a)),(r=e.config.ignores).push.apply(r,B(l)),Object.keys(c).map((function(t){e.config.icons[t]||(e.config.icons[t]=c[t])}));var f=e.config.i18n||[];d.push.apply(d,B(f)),e.config.i18n=d}(e,t)}))}},{key:"_getRootByPosition",value:function(e){var t=null;switch(e){case we.ROOT_RIGHT:this.rightBar||(this.rightBar=K.createPositionBar("xg-right-bar",this.root)),t=this.rightBar;break;case we.ROOT_LEFT:this.leftBar||(this.leftBar=K.createPositionBar("xg-left-bar",this.root)),t=this.leftBar;break;case we.ROOT_TOP:this.topBar||(this.topBar=K.createPositionBar("xg-top-bar",this.root),this.config.topBarAutoHide&&K.addClass(this.topBar,"top-bar-autohide")),t=this.topBar;break;default:t=this.innerContainer||this.root}return t}},{key:"registerPlugin",value:function(e,t){var n=Ie.formatPluginInfo(e,t),r=n.PLUFGIN,i=n.options,s=this.config.plugins;!Ie.checkPluginIfExits(r.pluginName,s)&&s.push(r);var a=Ie.getRootByConfig(r.pluginName,this.config);a.root&&(i.root=a.root),a.position&&(i.position=a.position);var o=i.position?i.position:i.config&&i.config.position||r.defaultConfig&&r.defaultConfig.position;return!i.root&&"string"==typeof o&&o.indexOf("controls")>-1?this.controls&&this.controls.registerPlugin(r,i,r.pluginName):(i.root||(i.root="controls"===r.pluginName?this.root:this._getRootByPosition(o)),Ie.register(this,r,i))}},{key:"deregister",value:function(e){"string"==typeof e?Ie.unRegister(this,e):e instanceof Te&&Ie.unRegister(this,e.pluginName)}},{key:"unRegisterPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.deregister(e),t&&this.removePluginFromConfig(e)}},{key:"removePluginFromConfig",value:function(e){var t;if("string"==typeof e?t=e:e instanceof Te&&(t=e.pluginName),t)for(var n=this.config.plugins.length-1;n>-1;n--)if(this.config.plugins[n].pluginName.toLowerCase()===t.toLowerCase()){this.config.plugins.splice(n,1);break}}},{key:"plugins",get:function(){return Ie.getPlugins(this)}},{key:"getPlugin",value:function(e){var t=Ie.findPlugin(this,e);return t&&t.pluginName?t:null}},{key:"addClass",value:function(e){this.root&&(K.hasClass(this.root,e)||K.addClass(this.root,e))}},{key:"removeClass",value:function(e){this.root&&K.removeClass(this.root,e)}},{key:"hasClass",value:function(e){if(this.root)return K.hasClass(this.root,e)}},{key:"setAttribute",value:function(e,t){this.root&&this.root.setAttribute(e,t)}},{key:"removeAttribute",value:function(e,t){this.root&&this.root.removeAttribute(e,t)}},{key:"start",value:function(e){var t=this;if(!(this.state>3))return e||this.config.url||this.getInitDefinition(),this.hasStart=!0,this.setState(3),this._registerPlugins(!1),Ie.beforeInit(this).then((function(){if(t.config){e||(e=t.url||t.config.url);var n=t._preProcessUrl(e);return t._startInit(n.url)}})).catch((function(e){throw e.fileName="player",e.lineNumber="236",z.logError("start:beforeInit:",e),e}))}},{key:"switchURL",value:function(e,t){var n=this,r=e;"Object"===K.typeOf(e)&&(r=e.url),r=this._preProcessUrl(r).url;var i=this.currentTime;this.__startTime=i;var s=this.paused&&!this.isError;return this.src=r,new Promise((function(e,t){var i=function(e){n.off("timeupdate",a),n.off("canplay",a),t(e)},a=function(){n._seekToStartTime(),s&&n.pause(),n.off("error",i),e(!0)};n.once("error",i),r?(J.os.isAndroid?n.once("timeupdate",a):n.once("canplay",a),n.play()):n.errorHandler("error",{code:6,message:"empty_src"})}))}},{key:"videoPlay",value:function(){this.mediaPlay()}},{key:"mediaPlay",value:function(){var e=this;if(!this.hasStart&&this.state<4)return this.removeClass($e),this.addClass(Ce),this.start(),void(this._useAutoplay=!0);this.state<6&&(this.removeClass($e),!this.isCanplay&&this.addClass(Ce));var n=G(t,"play",this,3)([]);return void 0!==n&&n&&n.then?n.then((function(){e.removeClass(We),e.addClass(Oe),e.state<6&&(z.logInfo(">>>>playPromise.then"),e.setState(6),e.emit(g))})).catch((function(t){if(z.logWarn(">>>>playPromise.catch",t.name),e.media&&e.media.error)return e.onError(),void e.removeClass(Ce);"NotAllowedError"===t.name&&(e._errorTimer=K.setTimeout(e,(function(){e._errorTimer=null,e.emit(m),e.addClass(We),e.removeClass(Ce),e.pause(),e.setState(5)}),0))})):(z.logWarn("video.play not return promise"),this.state<6&&(this.setState(6),this.removeClass(We),this.removeClass($e),this.removeClass(Ce),this.addClass(Oe),this.emit(g))),n}},{key:"mediaPause",value:function(){G(t,"pause",this,3)([])}},{key:"videoPause",value:function(){G(t,"pause",this,3)([])}},{key:"play",value:function(){var e=this;return this.removeClass(Le),ye(this,"play",(function(){return e.mediaPlay()}))}},{key:"pause",value:function(){var e=this;ye(this,"pause",(function(){G(t,"pause",e,3)([])}))}},{key:"seek",value:function(e,t){var n=this;if(this.media&&!Number.isNaN(Number(e))&&this.hasStart){var r=this.config,i=r.isSeekedPlay,a=r.seekedStatus,o=t||(i?"play":a);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,!this._isPauseBeforeSeek&&(this._isPauseBeforeSeek=this.paused?2:1),this._onceSeekCanplay&&this.off(s,this._onceSeekCanplay),this._onceSeekCanplay=function(){switch(n.removeClass(Ce),n.isSeeking=!1,o){case"play":n.play();break;case"pause":n.pause();break;default:n._isPauseBeforeSeek>1||n.paused?n.pause():n.play()}n._isPauseBeforeSeek=0,n._onceSeekCanplay=null},this.once(s,this._onceSeekCanplay),this.state<6?(this.removeClass($e),this.currentTime=e,this.play()):this.currentTime=e}}},{key:"getInitDefinition",value:function(){var e=this,t=this.config,n=t.definition;!t.url&&n&&n.list&&n.list.length>0&&n.defaultDefinition&&n.list.map((function(t){t.definition===n.defaultDefinition&&(e.config.url=t.url,e.curDefinition=t)}))}},{key:"changeDefinition",value:function(e,t){var n=this,r=this.config.definition;if(Array.isArray(null==r?void 0:r.list)&&r.list.forEach((function(t){(null==e?void 0:e.definition)===t.definition&&(n.curDefinition=t)})),null!=e&&e.bitrate&&"number"!=typeof e.bitrate&&(e.bitrate=parseInt(e.bitrate,10)||0),this.emit("definition_change",{from:t,to:e}),this.hasStart){var i=this.switchURL(e.url,L({seamless:!1!==r.seamless&&"undefined"!=typeof MediaSource&&"function"==typeof MediaSource.isTypeSupported},e));i&&i.then?i.then((function(){n.emit(_,{from:t,to:e})})):this.emit(_,{from:t,to:e})}else this.config.url=e.url}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(u,this.reloadFunc)}},{key:"resetState",value:function(){var e=this,t=[We,Oe,$e,Le,Ne,Ce,Ae,Be,Ge];this.hasStart=!1,this.isError=!1,this._useAutoplay=!1,this.mediaPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,t.forEach((function(t){e.removeClass(t)})),this.addClass($e),this.emit("reset")}},{key:"reset",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;if(this.resetState(),this.plugins&&(t.map((function(t){e.deregister(t)})),n)){var r=Ye();Object.keys(this.config).keys((function(t){"undefined"===e.config[t]||"plugins"!==t&&"presets"!==t&&"el"!==t&&"id"!==t||(e.config[t]=r[t])}))}}},{key:"destroy",value:function(){var e,n=this,r=this.innerContainer,i=this.root,s=this.media;if(s){if(this.hasStart=!1,this._useAutoplay=!1,i&&i.removeAttribute(ue),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.media),K.clearAllTimers(this),this.emit("destroy"),null===(e=ht)||void 0===e||e.remove(this),Ie.destroy(this),ve(this),G(t,"destroy",this,3)([]),this.fullscreen&&this._fullscreenEl===i&&this.exitFullscreen(),r)for(var a=r.children,o=0;o<a.length;o++)r.removeChild(a[o]);i&&!r&&s instanceof window.Node&&i.contains(s)&&i.removeChild(s),["topBar","leftBar","rightBar","innerContainer"].map((function(e){n[e]&&i.removeChild(n[e]),n[e]=null}));var l=i?i.className.split(" "):[],u=i&&K.hasClass(i,qe);l.length>0?i.className=l.filter((function(e){return e.indexOf("xgplayer")<0})).join(" "):i&&(i.className=""),this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach((function(e){n[e]=!1})),u&&this.root.parentNode&&this.root.parentNode.removeChild(this.root)}}},{key:"replay",value:function(){var e=this;this.removeClass(Ae),this.currentTime=0,this.isSeeking=!1,ye(this,"replay",(function(){e.once(s,(function(){var t=e.mediaPlay();t&&t.catch&&t.catch((function(e){console.log(e)}))})),e.emit("replay"),e.onPlay()}))}},{key:"retry",value:function(){var e=this;this.removeClass(Be),this.addClass(Ge),ye(this,"retry",(function(){var t=e.currentTime,n=e.config.url,r=K.isMSE(e.media)?{url:n}:e._preProcessUrl(n);e.src=r.url,!e.config.isLive&&(e.currentTime=t),e.once(o,(function(){e.mediaPlay()}))}))}},{key:"changeFullStyle",value:function(e,t,n,r){e&&(r||(r=ze),this._orgCss||(this._orgCss=K.filterStyleFromText(e)),K.addClass(e,n),t&&t!==e&&!this._orgPCss&&(this._orgPCss=K.filterStyleFromText(t),K.addClass(t,r),t.setAttribute(ue,this.playerId)))}},{key:"recoverFullStyle",value:function(e,t,n,r){r||(r=ze),this._orgCss&&(K.setStyleFromCsstext(e,this._orgCss),this._orgCss=""),K.removeClass(e,n),t&&t!==e&&this._orgPCss&&(K.setStyleFromCsstext(t,this._orgPCss),this._orgPCss="",K.removeClass(t,r),t.removeAttribute(ue))}},{key:"getFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget,t=this.root,n=this.media;if("video"!==e&&"media"!==e||(e=this[e]),e||(e=t),this._fullScreenOffset={top:K.scrollTop(),left:K.scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get",K.getFullScreenEl()===this._fullscreenEl)return this.onFullscreenChange(),Promise.resolve();try{for(var r=0;r<oe.length;r++){var i=oe[r];if(e[i]){var s="webkitRequestFullscreen"===i?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[i]();return s&&s.then?s:Promise.resolve()}}return n.fullscreenEnabled||n.webkitSupportsFullscreen?(n.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch(e){return Promise.reject(new Error("call getFullscreen fail"))}}},{key:"exitFullscreen",value:function(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),this._fullscreenEl||K.getFullScreenEl()){this.root;var t=this.media;this._fullActionFrom="exit";try{for(var n=0;n<le.length;n++){var r=le[n];if(document[r]){var i=document[r]();return i&&i.then?i:Promise.resolve()}}return t&&t.webkitSupportsFullscreen?(t.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch(e){return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var t=e?"".concat(Xe," ").concat(He):He;this.changeFullStyle(this.root,e,t);var n=this.config.fullscreen,r=void 0===n?{}:n;(!0===r.useCssFullscreen||"function"==typeof r.useCssFullscreen&&r.useCssFullscreen())&&(this.fullscreen=!0,this.emit(v,!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(y,!0)}},{key:"exitCssFullscreen",value:function(){var e=this._cssfullscreenEl?"".concat(Xe," ").concat(He):He;if(this.fullscreen){var t=this.config.fullscreen,n=void 0===t?{}:t;!0===n.useCssFullscreen||"function"==typeof n.useCssFullscreen&&n.useCssFullscreen()?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(v,!1)):this.removeClass(e)}else this.recoverFullStyle(this.root,this._cssfullscreenEl,e);this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(y,!1)}},{key:"getRotateFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget;this.cssfullscreen&&this.exitCssFullscreen(e);var t=e?"".concat(Xe," ").concat(Ve):Ve;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,t,je),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this._rootStyle=this.root.getAttribute("style"),this.root.style.width="".concat(window.innerHeight,"px"),this.emit(v,!0)}},{key:"exitRotateFullscreen",value:function(e){var t=this._fullscreenEl!==this.root?"".concat(Xe," ").concat(Ve):Ve;this.recoverFullStyle(this.root,this._fullscreenEl,t,je),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(v,!1),this._rootStyle&&(this.root.style.style=this._rootStyle,this._rootStyle=!1)}},{key:"setRotateDeg",value:function(e){90===window.orientation||-90===window.orientation?this.rotateDeg=0:this.rotateDeg=e}},{key:"focus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autoHide:!this.config.closeDelayBlur,delay:this.config.inactive};this.isActive?this.onFocus(e):this.emit(f,L({paused:this.paused,ended:this.ended},e))}},{key:"blur",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{ignorePaused:!1};this.isActive?(this._clearUserTimer(),this.emit(p,L({paused:this.paused,ended:this.ended},e))):this.onBlur(e)}},{key:"onFocus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autoHide:!0,delay:3e3},n=this.innerStates;if(this.isActive=!0,this.removeClass(Ue),this._clearUserTimer(),void 0!==t.isLock&&(n.isActiveLocked=t.isLock),!1===t.autoHide||!0===t.isLock||n.isActiveLocked)this._clearUserTimer();else{var r=t&&t.delay?t.delay:this.config.inactive;this.userTimer=K.setTimeout(this,(function(){e.userTimer=null,e.blur()}),r)}}},{key:"onBlur",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).ignorePaused,t=void 0!==e&&e;if(!this.innerStates.isActiveLocked){var n=this.config.closePauseVideoFocus;this.isActive=!1,(t||n||!this.paused&&!this.ended)&&this.addClass(Ue)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.removeClass(Ce),this.removeClass(Be),this.removeClass(Ge),this.isCanplay=!0,this.waitTimer&&K.clearTimeout(this,this.waitTimer)}},{key:"onLoadeddata",value:function(){var e=this;this.isError=!1,this.isSeeking=!1,this.__startTime>0&&(this.duration>0?this._seekToStartTime():this.once("durationchange",(function(){e._seekToStartTime()})))}},{key:"onLoadstart",value:function(){this.removeClass(Be),this.isCanplay=!1}},{key:"onPlay",value:function(){7===this.state&&this.setState(6),this.removeClass(Le),this.ended&&this.removeClass(Ae),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(Le),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this._clearUserTimer(),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(Ae),this.setState(7)}},{key:"onError",value:function(){this.isError=!0,this.updateAcc("error"),this.removeClass(We),this.removeClass($e),this.removeClass(Ce),this.removeClass(Ge),this.addClass(Be)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(Qe)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&K.clearTimeout(this,this.waitTimer),this.removeClass(Ge),this.removeClass(Qe)}},{key:"onWaiting",value:function(){var e=this;this.waitTimer&&K.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=K.setTimeout(this,(function(){e.addClass(Ge),e.emit("loading"),K.clearTimeout(e,e.waitTimer),e.waitTimer=null}),this.config.minWaitDelay)}},{key:"onPlaying",value:function(){var e=this;this.isError=!1,[$e,Le,Ae,Be,Ne,Ge].forEach((function(t){e.removeClass(t)})),this._accPlayed.t||this.paused||this.ended||(this._accPlayed.t=(new Date).getTime())}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.media.videoHeight&&this.resize(),(this.waitTimer||this.hasClass(Ge))&&this.media.readyState>2&&(this.removeClass(Ge),K.clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&5===this.state&&this.duration&&(this.setState(6),this.emit(g)),this._accPlayed.t||this.paused||this.ended||(this._accPlayed.t=(new Date).getTime())}},{key:"onVolumechange",value:function(){"Number"===K.typeOf(this.config.volume)&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(e,t,n){if(this.media&&t&&e){var r="String"===K.typeOf(e)?e:e.type||"";n.props&&"Array"!==K.typeOf(n.props)&&(n.props=[n.props]),this.emit(T,L({eventType:r,action:t,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e},n))}}},{key:"updateAcc",value:function(e){if(this._accPlayed.t){var t=(new Date).getTime()-this._accPlayed.t;this._accPlayed.acc+=t,this._accPlayed.t=0,("ended"===e||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{startDiff:0,endDiff:0})||{},n=t.startDiff,r=void 0===n?0:n,i=t.endDiff,s=void 0===i?0:i,a=this.media.buffered;if(!a||0===a.length||!this.duration)return!0;for(var o=e||this.media.currentTime||.2,l=a.length,u=0;u<l;u++)if(a.start(u)+r<=o&&a.end(u)-s>o)return!0;return!1}},{key:"resizePosition",value:function(){var e=this.videoPos,t=e.vy,n=e.vx,r=e.h,i=e.w,s=this.videoPos.rotate;if(!(s<0&&r<0&&i<0)){var a=this.videoPos._pi;if(!a&&this.media.videoHeight&&(a=this.media.videoWidth/this.media.videoHeight*100),a){this.videoPos.pi=a;var o={rotate:s=s<0?0:s},l=0,u=0,c=1,h=Math.abs(s/90),d=this.root,f=this.innerContainer,p=d.offsetWidth,g=f?f.offsetHeight:d.offsetHeight,m=g,v=p;if(h%2==0)c=r>0?100/r:i>0?100/i:1,o.scale=c,l=t>0?(100-r)/2-t:0,o.y=2===h?0-l:l,u=n>0?(100-i)/2-n:0,o.x=2===h?0-u:u,this.media.style.width="".concat(v,"px"),this.media.style.height="".concat(m,"px");else if(h%2==1){m=p;var y=g-p;u=-y/2/(v=g)*100,o.x=3===h?u+t/2:u-t/2,l=y/2/m*100,o.y=3===h?l+n/2:l-n/2,o.scale=c,this.media.style.width="".concat(v,"px"),this.media.style.height="".concat(m,"px")}var _=K.getTransformStyle(o,this.media.style.transform||this.media.style.webkitTransform);this.media.style.transform=_,this.media.style.webkitTransform=_}}}},{key:"position",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{h:0,y:0,x:0,w:0};if(this.media&&e&&e.h){var t=this.videoPos;t.h=100*e.h||0,t.w=100*e.w||0,t.vx=100*e.x||0,t.vy=100*e.y||0,this.resizePosition()}}},{key:"setConfig",value:function(e){var t=this;e&&Object.keys(e).map((function(n){if("plugins"!==n){t.config[n]=e[n];var r=t.plugins[n.toLowerCase()];r&&"Function"===K.typeOf(r.setConfig)&&r.setConfig(e[n])}}))}},{key:"playNext",value:function(e){var t=this;this.resetState(),this.setConfig(e),this._currentTime=0,this._duration=0,ye(this,"playnext",(function(){t.start(),t.emit("playnext",e)}))}},{key:"resize",value:function(){var e=this;if(this.media&&this.root){var t=this.root.getBoundingClientRect();this.sizeInfo.width=t.width,this.sizeInfo.height=t.height,this.sizeInfo.left=t.left,this.sizeInfo.top=t.top;var n=this.media,r=n.videoWidth,i=n.videoHeight,s=this.config,a=s.fitVideoSize,o=s.videoFillMode;if("fill"!==o&&"cover"!==o&&"contain"!==o||this.setAttribute("data-xgfill",o),i&&r){this._videoHeight=i,this._videoWidth=r;var l=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,u=t.width,c=t.height-l,h=parseInt(r/i*1e3,10),d=parseInt(u/c*1e3,10),f=u,p=c,g={};"auto"===a&&d>h||"fixWidth"===a?(p=u/h*1e3,this.config.fluid?g.paddingTop="".concat(100*p/f,"%"):g.height="".concat(p+l,"px")):("auto"===a&&d<h||"fixHeight"===a)&&(f=h*c/1e3,g.width="".concat(f,"px")),this.fullscreen||this.cssfullscreen||Object.keys(g).forEach((function(t){e.root.style[t]=g[t]})),("fillHeight"===o&&d<h||"fillWidth"===o&&d>h)&&this.setAttribute("data-xgfill","cover");var m={videoScale:h,vWidth:f,vHeight:p,cWidth:f,cHeight:p+l};this.resizePosition(),this.emit("video_resize",m)}}}},{key:"updateObjectPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.media.updateObjectPosition?this.media.updateObjectPosition(e,t):this.media.style.objectPosition="".concat(100*e,"% ").concat(100*t,"%")}},{key:"setState",value:function(e){z.logInfo("setState","state from:".concat(it[this.state]," to:").concat(it[e])),this._state=e}},{key:"_preProcessUrl",value:function(e,t){var n=this.config,r=n.preProcessUrl,i=n.preProcessUrlOptions,s=Object.assign({},i,t);return K.isBlob(e)||"function"!=typeof r?{url:e}:r(e,s)}},{key:"_seekToStartTime",value:function(){this.__startTime>0&&this.duration>0&&(this.currentTime=this.__startTime>this.duration?this.duration:this.__startTime,this.__startTime=-1)}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){"boolean"==typeof e&&(this._hasStart=e,!1===e&&this.setState(2),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return 6===this._state||7===this._state},set:function(e){e?this.setState(6):this._state>=6&&this.setState(4)}},{key:"definitionList",get:function(){return this.config&&this.config.definition&&this.config.definition.list||[]},set:function(e){var t=this,n=this.config.definition,r=null,i=null;n.list=e,this.emit("resourceReady",e),e.forEach((function(e){var s;(null===(s=t.curDefinition)||void 0===s?void 0:s.definition)===e.definition&&(r=e),n.defaultDefinition===e.definition&&(i=e)})),!i&&e.length>0&&(i=e[0]),r?this.changeDefinition(r):i&&this.changeDefinition(i)}},{key:"videoFrameInfo",get:function(){var e={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.media||!this.media.getVideoPlaybackQuality)return e;var t=this.media.getVideoPlaybackQuality();return e.dropped=t.droppedVideoFrames||0,e.total=t.totalVideoFrames||0,e.corrupted=t.corruptedVideoFrames||0,e.total>0&&(e.droppedRate=e.dropped/e.total*100,e.droppedDuration=parseInt(this.cumulateTime/e.total*e.dropped,0)),e}},{key:"lang",get:function(){return this.config.lang},set:function(e){0!==rt.langKeys.filter((function(t){return t===e})).length||"zh"===e?(this.config.lang=e,Ie.setLang(e,this)):console.error("Sorry, set lang fail, because the language [".concat(e,"] is not supported now, list of all supported languages is [").concat(rt.langKeys.join(),"] "))}},{key:"i18n",get:function(){var e=this.config.lang;return"zh"===e&&(e="zh-cn"),this.__i18n.lang[e]||this.__i18n.lang.en}},{key:"i18nKeys",get:function(){return this.__i18n.textKeys||{}}},{key:"version",get:function(){return Z}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(e){this.__url=e}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(e){this.plugins.poster&&this.plugins.poster.update(e)}},{key:"readyState",get:function(){return G(t,"readyState",this,1)}},{key:"error",get:function(){var e=G(t,"error",this,1);return this.i18n[e]||e}},{key:"networkState",get:function(){return G(t,"networkState",this,1)}},{key:"fullscreenChanging",get:function(){return!(null===this._fullScreenOffset)}},{key:"cumulateTime",get:function(){var e=this._accPlayed,t=e.acc,n=e.t;return n?(new Date).getTime()-n+t:t}},{key:"zoom",get:function(){return this.config.zoom},set:function(e){this.config.zoom=e}},{key:"videoRotateDeg",get:function(){return this.videoPos.rotate},set:function(e){(e=K.convertDeg(e))%90==0&&e!==this.videoPos.rotate&&(this.videoPos.rotate=e,this.resizePosition())}},{key:"avgSpeed",get:function(){return ct},set:function(e){ct=e}},{key:"realTimeSpeed",get:function(){return ut},set:function(e){ut=e}},{key:"offsetCurrentTime",get:function(){return this._offsetInfo.currentTime||0},set:function(e){this._offsetInfo.currentTime=e}},{key:"offsetDuration",get:function(){return this._offsetInfo.duration||0},set:function(e){this._offsetInfo.duration=e||0}},{key:"hook",value:function(e,t){return he.call.apply(he,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){return de.call.apply(de,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,t){return fe.call.apply(fe,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];return pe.call.apply(pe,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removePluginHooks",value:function(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];return ge.call.apply(ge,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(e,t){var n;"boolean"==typeof t&&t!==this.muted&&(this.addInnerOP("volumechange"),K.typeOf(t)===Boolean&&(this.muted=t)),null===(n=ht)||void 0===n||n.setActive(this.playerId,e)}}],[{key:"version",get:function(){return Z}},{key:"debugger",get:function(){return z.config.debug},set:function(e){z.config.debug=e}},{key:"instManager",get:function(){return ht},set:function(e){ht=e}},{key:"getCurrentUserActivePlayerId",value:function(){var e;return null===(e=ht)||void 0===e?void 0:e.getActiveId()}},{key:"setCurrentUserActive",value:function(e,t){var n;null===(n=ht)||void 0===n||n.setActive(e,t)}},{key:"isHevcSupported",value:function(){return J.isHevcSupported()}},{key:"probeConfigSupported",value:function(e){return J.probeConfigSupported(e)}},{key:"install",value:function(e,n){t.plugins||(t.plugins={}),t.plugins[e]||(t.plugins[e]=n)}},{key:"use",value:function(e,n){t.plugins||(t.plugins={}),t.plugins[e]=n}}])}(ie);E(dt,"defaultPreset",null),E(dt,"XgVideoProxy",null),dt.instManager=ot.getInstance();var ft=Object.defineProperty,pt=(e,t,n)=>((e,t,n)=>t in e?ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class gt{constructor(){this.__handlers=[],window.ResizeObserver&&(this.observer=new window.ResizeObserver((e=>{this.__trigger(e)})))}addObserver(e,t){if(!this.observer)return;this.observer&&this.observer.observe(e);const{__handlers:n}=this;let r=-1;for(let t=0;t<n.length;t++)n[t]&&e===n[t].target&&(r=t);r>-1?this.__handlers[r].handler.push(t):this.__handlers.push({target:e,handler:[t]})}unObserver(e){let t=-1;this.__handlers.map(((n,r)=>{e===n.target&&(t=r)})),this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}destroyObserver(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=[]}__runHandler(e,t){const{__handlers:n}=this;for(let r=0;r<n.length;r++)if(n[r]&&e===n[r].target){n[r].handler&&n[r].handler.forEach((n=>{try{n(e,t)}catch(e){console.error(e)}}));break}}__trigger(e){e.map((e=>{const t=e.contentRect;this.__runHandler(e.target,t)}))}}let mt=null;const vt="change",yt="update",_t="error",Tt=[{code:0,msg:"SUCCESS"},{code:1,msg:"LOAD_ERROR",type:"LOAD_ERROR"},{code:2,msg:"PARSER_ERROR",type:"PARSER_ERROR"},{code:3,msg:"FORMAT_NOT_SUPPORTED",type:"FORMAT_NOT_SUPPORTED"},{code:4,msg:"ID_OR_LANGUAGE_NOT_EXIST",type:"ID_OR_LANGUAGE_NOT_EXIST"},{code:5,msg:"PARAMETERS_ERROR",type:"PARAMETERS_ERROR"},{code:6,msg:"ABORT",type:"ABORT"},{code:7,msg:"UNKNOWN",type:"UNKNOWN"},{code:8,msg:"DATA_ERROR:subtitle.url is null",type:"DATA_ERROR"},{code:9,msg:"DATA_ERROR:subtitle.url length is 0",type:"DATA_ERROR"}];class bt extends Error{constructor(e,t,n,r){e||(e=Tt[t||7].msg),super(e),this.message="",this.code=t||7,this.message=e,this.type=Tt[t||7].msg,this.orgError=n||null,this.data=r||null}}function St(e,t={},n){const r={code:Tt[e].code,message:Tt[e].msg,id:"",language:""};return Object.keys(t).map((e=>{r[e]=t[e]})),r}class Pt{constructor(){let e,t;const n=new Promise(((n,r)=>{e=n,t=r}));return n.resolve=function(t){e(t),n.state="fulfilled"},n.reject=function(e){t(e),n.state="rejected",n.isBreak="DESTROYED"===e},n.state="pending",n}resolve(e){}reject(e){}}function wt(e,t){if(!e)return!1;if(e.classList)return Array.prototype.some.call(e.classList,(e=>e===t));{const n=e.className&&"object"==typeof e.className?e.getAttribute("class"):e.className;return n&&!!n.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}}function kt(e,t){e&&(e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((t=>{t&&e.classList.add(t)})):wt(e,t)||(e.className&&"object"==typeof e.className?e.setAttribute("class",e.getAttribute("class")+" "+t):e.className+=" "+t))}function Mt(e){const t=Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g);return t?t[0]:""}function Et(e="div",t="",n={},r=""){const i=document.createElement(e);return i.className=r,i.innerHTML=t,Object.keys(n).forEach((t=>{const r=t,s=n[t];"video"===e||"audio"===e||"live-video"===e?s&&i.setAttribute(r,s):i.setAttribute(r,s)})),i}function Rt(e){return e&&e instanceof window.HTMLMediaElement}function xt(e){const t=[];if(e&&"String"===Mt(e))t.push({url:[e],index:0,start:-1,end:-1});else if("Array"===Mt(e)){const n=e;if(0===n.length)return t;"String"===Mt(n[0])?t.push({url:e,index:0,start:-1,end:-1}):n.forEach(((e,n)=>{const r=e;t.push({url:r.url||r.src||"",index:n,start:r.start||-1,end:r.end||-1})}))}return t}function Dt(e,t,n){const r=t.length;if(r<1)return-1;if(t[n=n<0?0:n>=r?r-1:n].start<=e&&e<t[n].end)return n;{let i=t[n].end<=e?n+1:0;for(;i<r;i++){if(t[i].start<=e&&e<t[i].end)return i;if(e>t[i].end&&i+1<r&&e<t[i+1].start)return-1;if(e>t[i].end&&i+1>=r)return-1}return-1}}function It(e,t,n){const r=t.length;if(r<1)return[];const i=[];if((n=n<0?0:n>=r?r-1:n)<r){let s=t[n].end<=e?n:0;for(;s<r&&(t[s].start<=e&&e<t[s].end&&i.push(s),!(e<t[s].start));s++);}return i}function Ct(e,t){return!!(e.id&&t.id&&e.id===t.id||e.language&&t.language&&e.language===t.language)}function Lt(e){return null!==e&&""!==e.trim()&&/^[a-zA-Z]+$/.test(e)}function Ot(e){return!!/[\x21-\x2f\x3a-\x40\x5b-\x60\x7B-\x7F]/.test(e)}function At(e){return!!/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/.test(e)}const Gt=/^WEBVTT/,Bt=/^STYLE+$/,Nt=/^\:\:cue/,$t=/^}+$/,Ut=/^\[Script Info\].*/,Ft=[/[0-9]{1,3}:[0-9]{2}:[0-9]{2}\.[0-9]{1,3}-->[0-9]{1,3}:[0-9]{2}:[0-9]{2}\.[0-9]{1,3}/,/[0-9]{1,3}:[0-9]{2}\.[0-9]{1,3}-->[0-9]{1,3}:[0-9]{2}\.[0-9]{1,3}/,/[0-9]{1,2}\.[0-9]{1,3}-->[0-9]{1,2}\.[0-9]{1,3}/],Ht=/^Format:\s/,Vt=/^Style:\s/,jt=/^Dialogue:\s/;function zt(e){const t=e.length;return 3===t?(60*(60*Number(e[0])+Number(e[1]))*1e3+1e3*Number(e[2]))/1e3:2===t?(60*Number(e[0])*1e3+1e3*Number(e[1]))/1e3:Number(e[0])}function Xt(e,t){return e>=0&&e<t.length?t[e]:""}class Kt{static parseJson(e){const t=[];let n=0;for(let r=0;r<e.length;r++){if(n>=50&&(n=0),0===n){const n={start:e[r].start,list:[e[r]],end:e[r].end};t.push(n)}else t[t.length-1].list.push(e[r]),t[t.length-1].end=e[r].end;n++}return t}static parse(e,t){const n=Kt.checkFormat(e);if(n)try{let r={list:[],styles:[]};"ass"===n?r=Kt.parseASS(e):"vtt"===n&&(r=Kt.parseVTT(e)),t({format:n,list:r.list,styles:r.styles})}catch(e){console.error(e),t({format:n},new bt(`parse_error_${e.message}`,2,e))}else t({format:"unknown"},new bt("unknown_format",3))}static parseASSItem(e="",t=[]){const n=e.split(","),r={};let i="";try{const e=n.length-t.length;return i=e>0?n.splice(t.length-1,e+1).join(",")+"":n[n.length-1]+"",i=i.replace(/\\n+/g,""),n[t.length-1]=i,t.map(((e,t)=>{"end"===e||"start"===e?r[e]=zt(n[t].split(":")):"text"===e?r[e]=[n[t]]:"layer"===e?(r[e]=[n[t]],r.textTag=[n[t]]):r[e]="style"===e?[n[t]]:Number(n[t])?Number(n[t]):n[t]})),r}catch(e){return console.error(e),{}}}static parseASS(e){const t=e.split("\n"),n=[];let r=0,i=0;const s=[];let a=[],o=null;for(;r<t.length;){if(Ht.test(t[r]))a=t[r].replace(Ht,"").replace(/\s+/g,"").split(","),a=a.map((e=>e.toLocaleLowerCase()));else if(Vt.test(t[r]))s.push(t[r].replace(Vt,"").replace(/\s+/g,""));else if(jt.test(t[r])){const e=Kt.parseASSItem(t[r].replace(jt,""),a);if(o&&e.start===o.start&&e.end===o.end)try{const{text:t=[],textTag:n=[],style:r}=o;e.text.length>0&&t.push(e.text[0]),e.textTag.length>0&&n.push(e.textTag[0]),r&&r.push(e.style[0])}catch(e){console.error(e)}else{o=e;let t=null;i%50==0?(t={start:o.start,end:o.end,list:[]},t.list.push(o),n.push(t)):(t=n[n.length-1],t.end=o.end,t.list.push(o)),i++}}r++}return{list:n,styles:[]}}static parseVTTStyle(e,t){const n=e.split(":");if(n.length>1){const e=n[0].trim().split("-");let r="";e.length>1?e.map(((e,t)=>{r+=0===t?e:e.charAt(0).toUpperCase()+e.slice(1)})):r=e[0],t[r]=n[1].trim().replace(/;$/,"")}return t}static parseVTT(e){const t=(e=e.replace(Gt,"")).split("\n"),n=[];let r=0,i=0,s=null,a=!1,o=!1,l=null,u=null;const c=[];for(;r<t.length;){const e=Xt(r,t).trim();if(!e||a&&/^(\-|\+)?\d+(\.\d+)?$/.test(e))a=!e;else if(Nt.test(e)&&Bt.test(Xt(r-1,t).trim())){o=!0;const t=/\((.+?)\)/g.exec(e);u=t?t[1]:"",l=""}else if(o)$t.test(e)?(c.push({key:u||"",style:l||""}),l=null,u=null,o=!1):l+=e;else if(e){a=!1;const e=this.checkIsTime(t[r]);if(e){const t=this.parseVttTime(e);if(!s||t.start!==s.start||t.end!==s.end){s={...t,text:[],textTag:[]},s.text=[],s.textTag=[];let e=null;i%50==0?(e={start:s.start,end:s.end,list:[]},e.list.push(s),n.push(e)):(e=n[n.length-1],e.end=s.end,e.list.push(s)),i++}}else if(s){const{text:e,textTag:n}=s,i=this.parseVttText(t[r]);e.push(i.text),n.push(i.tag)}a=!1}r++}return{list:n,styles:c}}static checkIsTime(e){e=e.replace(/\s+/g,"");let t=0,n=null;for(;t<Ft.length&&(n=Ft[t].exec(e),!n);)t++;return n?n[0]:null}static parseVttText(e){const t=/^(<?.+?>)/g.exec(e);let n="",r="default";if(t){r=t[0].replace(/\<|\>|\&/g,"");const i=RegExp(`^<${r}>(([\\s\\S])*?)</${r}>$`).exec(e);i?n=i[1]:(n=e,r="")}else n=e;const i=/<(\w+).(\w+)>/g;let s=i.exec(n);for(;s&&s.length>2;)n=n.replace(s[0],`<${s[1]} class="${s[2]}">`),s=i.exec(n);return{tag:r,text:n.replace(/\\n+/g,"<br/>")}}static parseVttTime(e){const t=e.split("--\x3e");let n=0,r=0;if(2===t.length){const e=t[0].split(":"),i=t[1].split(":");n=zt(e),r=zt(i)}return{start:n,end:r,time:e}}static isVTT(e){return Gt.test(e)}static isASS(e){return Ut.test(e)}static checkFormat(e){return e?Gt.test(e)?"vtt":Ut.test(e)?"ass":"":""}}function Wt(e,t){const{status:n="",statusText:r=""}=e;return`${t}_${n}_${r}`}function Qt(e,t,n){const{url:r="",method:i="GET",type:s="arraybuffer",timeout:a=1e4,data:o={}}=e,l=new window.XMLHttpRequest,u=i.toUpperCase(),c=[];if(s&&(l.responseType=s),a&&(l.timeout=a),Object.keys(o).forEach((e=>{c.push(`k=${o[e]}`)})),l.onload=()=>{200===l.status||206===l.status?n({context:t,res:l,type:"success"}):n({context:t,res:l,type:"error",error:new bt(Wt(l,"response_error"),1)})},l.onerror=e=>{n({context:t,res:l,type:"error",error:new bt("loaderror",1)})},l.ontimeout=e=>{n({context:t,res:l,type:"error",error:new bt("timeout",1)})},l.onabort=()=>{n({context:t,res:l,type:"error",error:new bt("abort",1)})},"GET"===u)l.open(u,`${r}`),l.send();else{if("post"!==u)throw n({context:t,res:l,type:"error",error:new bt(`xhr ${u} is not supported`,1)}),new bt(`xhr ${u} is not supported`,1);l.open(u,r),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.send(c.join("&"))}}function qt(e,t,n){"json"===t?n({styles:[],list:Kt.parseJson(e),format:"json"}):"string"===t&&Kt.parse(e,n)}function Yt(e,t,n){let r=[];n||(n=new Pt),r="String"===Mt(e)?[e]:[...e];const i=r.shift()||"",s=e=>{const{res:i,error:a}=e;if(a)r.length>0?Qt({url:r.shift()||"",type:"text"},t,s):n.reject(a);else if(i){const{response:e}=i;qt(e,"string",((e,t)=>{t?n.reject(t):n.resolve(e)}))}};return Qt({url:i,type:"text"},t,s),n}let Jt=!1;class Zt extends U{constructor(e){super(),pt(this,"_onPause",(()=>{this.stopRender()})),pt(this,"_onPlay",(()=>{this._curRenderTask.length>0&&this.startRender(-1)})),pt(this,"_onTimeupdate",(()=>{if(!this._isOpen)return;if(this.config.domRender){const e=this.player.video?this.player.video:this.player,{videoWidth:t,videoHeight:n}=e;!this._videoMeta.scale&&t&&n&&this._onResize(this.player.root)}const e=this._getPlayerCurrentTime();Math.round(Math.abs(1e3*e-this._ctime))<200||(this._ctime=1e3*e,this.currentText&&this.currentText.list&&("live"===this.config.updateMode?this._liveUpdate(e):this._update(e)))})),pt(this,"_onResize",(e=>{const{_videoMeta:t,config:n}=this;if(n.domRender){if((!e||!(e instanceof window.Element))&&(e=this.player.root),this._iId&&(window.clearTimeout(this._iId),this._iId=null),!t.scale){if(!this.player.video)return;const{videoWidth:e,videoHeight:n}=this.player.video;if(!e||!n)return;t.videoWidth=e,t.videoHeight=n,t.scale=parseInt(n/e*100,10)}this.__startResize(e)}})),pt(this,"_onCoreEvents",(e=>{try{switch(e.eventName){case"core.subtitlesegments":this._onSubtitleSegment(e.list||[]);break;case"core.subtitleplaylist":this._onSubtitlePlaylist(e.list||[]);break;case"core.seipayloadtime":this._onCoreSeiintime(e)}}catch(e){console.error(e)}})),pt(this,"startRender",(e=>{if(e>0&&this._renderIntervalId&&(window.cancelAnimationFrame(this._renderIntervalId),this._renderIntervalId=-1),!this.textTrack)return;const{_curRenderTask:t}=this;this._lastTimeStamp=(new Date).getTime();const n=[];t.forEach(((t,r)=>{const{lastTime:i,wordList:s,interval:a,dom:o,ids:l}=t;if(e<0||this._lastTimeStamp<0||this._lastTimeStamp-i>=a){const e=s.shift();e&&o.appendData(e),t.lastTime=this._lastTimeStamp}s.length<1&&n.push({index:r,ids:l})})),this._log(">>>>_renderByWords emptyArr",n.length,t.length),n.forEach((e=>{t.splice(e.index,1),this._log(">>>_renderByWords remove emptyArr",e.index,t.length)})),t.length>0&&(this._renderIntervalId=window.requestAnimationFrame(this.startRender))})),pt(this,"destroy",(()=>{this.detachPlayer(),this.removeAllListeners(),this.player=null,this.textTrack=null,this._curRenderTask=[],this.stopRender()})),Jt=function(){const e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),n=/(?:SymbianOS)/.test(e)||t,r=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),s=/(?:iPad|PlayBook)/.test(e)||r&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e);return/(?:iPhone)/.test(e)&&!s||r||n||s}(),this.currentText=null,this.currentExtText=null,this.textTrack=[],this._cid=-1,this._gid=-1,this._cids=[],this._iId=null,this._iC=0,this.player=null,this.root=null,this.config={line:"double",bottom:0,mode:"stroke",defaultOpen:!1,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,fitVideo:!0,offsetBottom:2,fontColor:"#fff",domRender:!1,updateMode:"vod",renderMode:"",debugger:!1},this._ctime=0,this._loadingTrack={},this.seiTime=0,this.lastSeiTime=0,this._curTexts=[],this._curRenderTask=[],this._renderIntervalId=-1,this._lastTimeStamp=-1,Object.keys(this.config).map((t=>{void 0!==e[t]&&null!==e[t]&&(this.config[t]=e[t])})),this._isOpen=this.config.defaultOpen||!1,this._videoMeta={scale:0,videoHeight:0,videoWidth:0,lwidth:0,lheight:0,vWidth:0,vHeight:0,vBottom:0,vLeft:0,marginBottom:0},e.subTitles&&"Array"===Mt(e.subTitles)&&(e.player&&this.attachPlayer(e.player),this.setSubTitles(e.subTitles,this.config.defaultOpen))}get version(){return"0.2.17"}setSubTitles(e=[],t=!1,n=!0){const r=this._isOpen||t;n&&this.innerRoot&&this.switchOff(),!e||e.length<1?this.switchOff():(this.currentText=null,this.textTrack=[],e.forEach((e=>{const t={};Object.keys(e).map((n=>{t[n]=e[n]})),t.url=xt(t.url),t.isDefault&&(this.currentText=t),this.textTrack.push(t)})),this._log("setSubTitles",r,this.textTrack),r&&(this.currentText||(this.currentText=this.textTrack[0]),this.switch().catch((e=>{this.emitError(e),this._log("[switch]",e)}))),this._log(">>>this.currentText",r,this.currentText),this.currentText&&this._loadTrack(this.currentText).then((e=>{this.addStyles(e)})).catch((e=>{this.emitError(e),this._log("[_loadTrack] errorsss",e)})),this.emit("reset",{type:"reset",list:this.textTrack,isOpen:r}))}updateSubTitle(e){let t=-1;for(let n=0;n<this.textTrack.length;n++)if(Ct(e,this.textTrack[n])){t=n;break}if(this._log("updateSubTitle",t,e),t>-1){const n=Ct(this.currentText,this.textTrack[t]);if(this._log("updateSubTitle","_isCurrent",n,"this.isOpen",this.isOpen,this.currentText),!n)return;const r=xt(e.url);this.isOpen?(r.forEach((e=>{this.textTrack[t].url.push(e)})),this._log("updateSubTitle _loadTrackUrls",this.textTrack[t]),this._loadTrackUrls(this.currentText,2)):this.textTrack[t].url=r}}addStyles(e){const{styles:t,format:n}=e;t&&"vtt"===n&&(t.map((e=>{e.key||(e.key="xg-text-track-span")})),function(e,t=""){let n="";e.map((e=>{n+=` ${t} ${e.key} {${e.style}}`}));const r=document.createElement("style"),i=document.head||document.getElementsByTagName("head")[0];if(r.type="text/css",r.id="ssss",r.styleSheet){const e=function(){try{r.styleSheet.cssText=n}catch{}};r.styleSheet.disabled?setTimeout(e,10):e()}else{const e=document.createTextNode(n);r.appendChild(e)}i.appendChild(r)}(t,"xg-text-track"))}attachPlayer(e){if(this._log("attachPlayer"),!e||e===this.player)return;this.player&&this.detachPlayer();const{fontColor:t,mode:n,fitVideo:r,domRender:i}=this.config;var s,a;this.player=e,i&&(this.root=document.createElement("xg-text-track"),this.root.className="xg-text-track",!this._isOpen&&kt(this.root,"text-track-hide"),!r&&kt(this.root,"text-track-no-fitvideo"),n&&kt(this.root,`text-track-${n}`),this.innerRoot=document.createElement("xg-text-track-inner"),this.root.appendChild(this.innerRoot),t&&(this.root.style.color=t),this.currentText&&["language","id","label"].map((e=>{this.root.setAttribute(`data-${e}`,this.currentText[e]||"")})),this.player.root.appendChild(this.root),s=e.root,a=this._onResize,mt||(mt=new gt),mt.addObserver(s,a)),Rt(e)?(e.addEventListener("timeupdate",this._onTimeupdate),e.addEventListener("pause",this._onPause),e.addEventListener("play",this._onPlay)):(this.player.on("destroy",this.destroy),this.player.on("timeupdate",this._onTimeupdate),this.player.on("pause",this._onPause),this.player.on("play",this._onPlay),this.player.on("core_event",this._onCoreEvents)),this._isOpen&&this.switch().catch((e=>{this._log("[switch]",e)}))}detachPlayer(){const{player:e,config:t}=this;var n;e&&(Rt(e)?(e.removeEventListener("timeupdate",this._onTimeupdate),e.removeEventListener("pause",this._onPause),e.removeEventListener("play",this._onPlay)):(this.player.off("destroy",this.destroy),this.player.off("timeupdate",this._onTimeupdate),this.player.off("pause",this._onPause),this.player.off("play",this._onPlay),this.player.off("core_event",this._onCoreEvents)),t.domRender&&(e.root&&(n=e.root,this._onResize,mt&&mt.unObserver(n),e.root.removeChild(this.root)),this.innerRoot=null,this.root=null),this.player=null)}switch(e={id:"",language:""}){return this._log("switch",e),this._loadingTrack=e,new Promise(((t,n)=>{if(!e.id&&!e.language){if(this.currentText)return this._loadingTrack={},this._updateCurrent(this.currentText),this.switchOn(),void t({message:"switch default subtitle success",code:0});{const e=new bt("no default subtitle",5);return this.emitError(e),void n(e)}}if(this.currentText&&Ct(e,this.currentText))this._loadingTrack={},this._updateCurrent(this.currentText),this.switchOn(),t(St(0));else{let r=null;this.__removeByTime(this._curTexts,0);for(let t=0;t<this.textTrack.length;t++)if(Ct(e,this.textTrack[t])){r=this.textTrack[t];break}if(this._log("nextSubtitle",r),r)this._emitPlayerSwitch(this.currentText,r),r.list?(this._loadingTrack={},this._updateCurrent(r),this.switchOn(),t(St(0))):(this._log("this._loadTrack",r),this._updateCurrent(r),this._loadTrack(r).then((i=>{if(this.addStyles(i),this._loadingTrack.id===r.id||this._loadingTrack.language===i.language)this._loadingTrack={},this._updateCurrent(i),this.switchOn(),t(St(0));else{const t=new bt(`check _loadingTrack fail id: ${this._loadingTrack.id}  nextSubtitle:${i.id}`,6,null,e);this.emitError(t),n(t)}})).catch((e=>{this.emitError(e),n(e)})));else{const t=new bt(`The is no subtitle with id:[{${e.id}}] or language:[${e.language}]`,4,null,e);this.emitError(t),n(t)}}}))}switchExt(e={id:"",language:""}){return new Promise(((t,n)=>{if(e.id||e.language){let n=null;for(let t=0;t<this.textTrack.length;t++)if(Ct(e,this.textTrack[t])){n=this.textTrack[t];break}n&&!Ct(n,this.currentText)&&this._loadTrack(n).then((e=>{this.currentExtText=e,t(St(0))})).catch((e=>{this.emitError(e)}))}else this.currentExtText=null,t(St(0))}))}emitError(e){this.emit(_t,{type:_t,error:e})}switchOn(){this._log("switchOn"),this._isOpen=!0,this.show();const{id:e,language:t}=this.currentText;this.emit(vt,{type:vt,isOpen:!0,id:e,language:t,texts:[]})}switchOff(){if(this._isOpen=!1,this.hide(),!this.currentText)return;const{id:e,language:t}=this.currentText;this.emit("off",{type:"off",id:e,language:t,texts:[],isOpen:!1})}get isOpen(){return this._isOpen}_log(...e){this.config.debugger&&console.log("[xgSubtitle]",...e)}_loadTrack(e){this._log("_loadTrack",e.language,e);const t=new Pt;let n="",r="";if(e.json?(n="json",r=e.json):e.stringContent&&(!e.url||0===e.url.length)&&(n="string",r=e.stringContent),r)return qt(r,n,((n,r)=>{r?(this.emitError(r),t.reject(r)):(e.format=n.format,e.styles=n.styles,e.list=n.list,t.resolve(e))})),t;const i=[...e.url];return 0===i.length?(t.resolve(e),t):(Yt(i.splice(0,1)[0].url,e).then((n=>{e.format=n.format,e.styles=n.styles,e.list||(e.list=[]),this._pushList(e.list,n.list),i.length>1&&this._loadTrackUrls(e,2),t.resolve(e)})).catch((e=>{t.reject(e)})),t)}_emitPlayerSwitch(e,t){e&&"live"===this.config.updateMode&&(e.list=[],e.url=[]);const n={lang:t.language,...t};this._log("emit subtile_switch ",t,n),this.emit(vt,{type:vt,error:null})}_loadTrackUrls(e,t,n){const r=e.url.length,i=r>t?e.url.splice(0,t):e.url.splice(0,r);let s=i.length;this._log("_loadTrackUrls",e.language,r,i.length,s),i.forEach(((t,r)=>{Yt({...t}.url,t).then((t=>{e.format=t.format,e.styles=t.format,e.list||(e.list=[]),this._pushList(e.list,t.list),s--})).catch((e=>{s--})).finally((t=>{0===s&&(n&&n.resolve(e),this._loadTrackUrls(e,2))}))}))}_freshUrl(e,t={url:""}){let n=-1;e.url.forEach(((e,r)=>{e.url===t.url&&(n=r)})),n>-1&&e.url.splice(n,1)}_pushList(e,t){const n=t[0].start,r=t[t.length-1].end;if(0===e.length||n>=e[e.length-1].end)t.forEach((t=>{e.push(t)}));else{let n=-1;for(let t=0;t<e.length;t++)if(e[t].start>r){n=t;break}n>-1&&t.forEach(((t,r)=>{e.splice(n+r,0,t)}))}return e}_updateCurrent(e){this.currentText=e,this.config.domRender&&this.root&&(["language","id","label"].map((e=>{this.root.setAttribute(`data-${e}`,this.currentText[e]||"")})),this.__remove(this._cids)),this._cids=[],this._gid=-1,this._cid=-1,this._curTexts=[];const t=this._getPlayerCurrentTime();t&&("live"===this.config.updateMode?this._liveUpdate(t):this._update(t))}__loadAll(){this.textTrack.forEach((e=>{this._loadTrack(e)}))}getDelCid(e,t){const n=[];for(let r=0;r<e.length;r++)t.includes(e[r])||n.push(e[r]);return n}getNewCid(e,t){const n=[];for(let r=0;r<t.length;r++)e.includes(t[r])||n.push(t[r]);return n}_liveUpdate(e){if(!this.currentText||!this.currentText.list||!this.currentText.list.length)return;let t=[];const n=Dt(e,this.currentText.list,this._gid);if(n>-1&&(t=It(e,this.currentText.list[n].list,this._cid)),this.__removeByTime(this._curTexts,e),this._log("_liveUpdate",e,n,t,this.currentText.list[0].list[0].start,this.currentText.list[0].list[0].end),t.length>0){const e=function(e,t,n){if(0===e.length||t<0||t>e.length-1)return[];const r=e[t].list;if(0===n.length)return[];const i=r.splice(n[0],n.length);return t>0&&e.splice(0,t),0===r.length&&e.splice(0,1),i}(this.currentText.list,n,t),r=this._curTexts.length,i=r>0?this._curTexts[r-1].index:0;e.forEach(((e,t)=>{e.index=t+i,this._curTexts.push(e)})),this.__render(e)}this.emit(yt,this.getUpdateData(this._curTexts,0,this.currentText))}_update(e){if(!this.currentText||!this.currentText.list||!this.currentText.list.length)return;const t=Dt(e,this.currentText.list,this._gid);let n=[];if(t>-1&&(n=It(e,this.currentText.list[t].list,this._cid)),this._log("update1",`currentTime:${e}`,t,this._gid,n,this._cids,this._cids.join(",")===n.join(","),t===this._gid),n.length<1)return this._cids.length>0&&this.config.domRender&&this.__remove(this._cids),this._cids=[],this._curTexts.length>0&&this.emit(yt,this.getUpdateData([],e,this.currentText)),void(this._curTexts=[]);if(this._cids.join("")===n.join("")&&t===this._gid)return;this._gid=t,this._cid=n[0];const r=this.getDelCid(this._cids,n),i=this.getNewCid(this._cids,n);this._cids=n,this.config.domRender&&this.__remove(r);const s=[];i.map((e=>{const n=this.currentText.list[t].list[e];n.index=e,s.push(n)})),this.currentExtText&&i.map((e=>{const n=this.currentText.list[t].list[e];n.index=e,s.push(n)})),this._log("update",`currentTime:${e}`,s.length>0?`start:${s[0].start} end:${s[0].end}`:"",`delCids:${r.length} newCids:${i.length}`),this._curTexts=s,this.emit(yt,this.getUpdateData(s,e,this.currentText)),this.__render(s,e)}getUpdateData(e,t,n){const{id:r,language:i}=n;return{type:yt,currentTime:0|t,id:r,language:i,texts:e,isOpen:this._isOpen}}_getPlayerCurrentTime(){if(!this.player)return 0;const{currentTime:e}=this.player;return parseInt(1e3*e+1e3*this.seiTime-1e3*this.lastSeiTime,10)/1e3}_onSubtitlePlaylist(e){this._log("_onSubtitlePlaylist",e);const t=e.map((e=>({label:e.name,language:e.lang,id:e.id,isDefault:e.default,url:[],mUrl:e.url})));this.setSubTitles(t)}_onSubtitleSegment(e){if(this._log("_onSubtitleSegment",e.length,e[0].lang,e[0].sn,e[e.length-1].sn,e[0].start,e[e.length-1].end),!e||0===e.length)return;const t=e[0].lang,n=e.map((e=>({id:e.sn,url:e.url,duration:e.duration,start:e.start,end:e.end}))),r={language:t,url:n};Ct(r,this.currentText)&&this.updateSubTitle(r)}_onCoreSeiintime(e){try{const t=e.time/1e3;this._log("_onCoreSeiintime sei",t,this.seiTime,this.lastSeiTime),this.seiTime=t,this.lastSeiTime=this.player?this.player.currentTime:0}catch{}}resize(e,t){const{baseSizeX:n,baseSizeY:r,minMobileSize:i,minSize:s,fitVideo:a,offsetBottom:o}=this.config,{scale:l}=this._videoMeta;this._videoMeta.lwidth=e,this._videoMeta.lheight=t;let u,c=0;t/e*100>=l?(c=parseInt(l*e,10)/100,u=e):(c=t,u=parseInt(t/l*100,10)),this._videoMeta.vWidth=u,this._videoMeta.vHeight=c;let h=0,d=0;l>120?(h=r,d=parseInt(h*c/1080,10)):(h=n,d=parseInt(h*u/1920,10));const f=Jt?i:s;d=d<f?f:d>h?h:d;const p={fontSize:d},g=parseInt((t-c)/2,10),m=parseInt((e-u)/2,10),v=parseInt(c*o,10)/100;this._videoMeta.vBottom=g,this._videoMeta.vLeft=m,this._videoMeta.marginBottom=v,a&&(p.bottom=g+v,p.left=p.right=m),Object.keys(p).map((e=>{this.root.style[e]=`${p[e]}px`})),this.emit("resize",{vLeft:m,vBottom:g,marginBottom:v,vWidth:u,vHeight:c,fontSize:d,scale:l})}__startResize(e){const t=e.getBoundingClientRect(),{_videoMeta:n}=this,{width:r,height:i}=t;if(this._iId&&(clearTimeout(this._iId),this._iId=null),r>0&&i>0&&(r!==n.lwidth||i!==n.lheight))this._iC=0,this.resize(r,i);else{if(this._iC>=5)return void(this._iC=0);this._iC++,this._iId=setTimeout((()=>{this.__startResize(e)}),50)}}__removeByTime(e,t){const n=[];for(let r=0;r<e.length;r++)(!t||e[r].end<t)&&n.push(r);0!==n.length&&(e.splice(n[0],n.length),this.config.domRender&&this.__remove(n))}__remove(e){if(!e||e.length<1)return;this._log(">>>>_renderByWords__remove",e);const t=this.innerRoot.children,n=[];for(let r=0;r<t.length;r++){const i=Number(t[r].getAttribute("data-index"));e.includes(i)&&n.push(t[r])}n.map((e=>{this.innerRoot.removeChild(e)}))}__render(e=[]){const{renderMode:t,domRender:n}=this.config;e.length>0&&n&&e.forEach((e=>{let n=`text-track-${this.config.line}`;e.text.forEach(((r,i)=>{i>0&&(n+=" text-track-deputy");const s={"data-start":e.start,"data-end":e.end,"data-index":e.index},a=Et("xg-text-track-span","",s,n);if(this.innerRoot.appendChild(a),"step"===t){const t=Et("xg-text-track-span","",s,`${n} text-track-space`);this.innerRoot.appendChild(t),t.innerHTML=r,window.setTimeout((()=>{this._renderByWords(a,i,e.start,e.end,r)}),600)}else a.innerHTML=r}))}))}_renderByWords(e,t,n,r,i){const s=document.createTextNode("");e.appendChild(s);const a=function(e){const t=e.split(""),n=[];let r=!1;for(let e=0;e<t.length;e++){const i=t[e];if(Lt(i))if(r){const e=n.length-1;n[e]=`${n[e]}${i}`}else n.push(i),r=!0;else if(i.match(/^[ ]*$/)||Ot(i)||At(i)){r=!1;const e=n.length-1;n[e]=`${n[e]}${i}`}else r=!1,n.push(i)}return n}(i);let o=this._getPlayerCurrentTime(),l=parseInt(1e3*(r-o),10);if(o>=r)return;n>=o&&(o=n),l>300&&(l-=50);const u={dom:s,ids:t,wordList:a,interval:l/a.length,start:o,end:r,duration:l,lastTime:0};this._log(">>>>_renderByWords",l,u);const{_curRenderTask:c}=this;let h=-1;for(let e=0;e<c.length;e++)if(c[e].ids===t){h=e;break}h>-1&&c.slice(h,1),c.push(u),this.startRender(-1)}stopRender(){this._renderIntervalId&&window.cancelAnimationFrame(this._renderIntervalId)}show(){var e,t;this.config.domRender&&(t="text-track-hide",(e=this.root)&&(e.classList?t.split(/\s+/g).forEach((t=>{e.classList.remove(t)})):wt(e,t)&&t.split(/\s+/g).forEach((t=>{const n=new RegExp("(\\s|^)"+t+"(\\s|$)");if(e.className&&"object"==typeof e.className){const t=e.getAttribute("class")||"";e.setAttribute("class",t.replace(n," "))}else e.className=e.className.replace(n," ")}))))}hide(){this.config.domRender&&(kt(this.root,"text-track-hide"),this.innerRoot.innerHTML="")}emit(e,t,...n){super.emit(e,t,...n)}on(e,t,...n){super.on(e,t,...n)}once(e,t,...n){super.once(e,t,...n)}off(e,t,...n){super.off(e,t,...n)}offAll(){super.removeAllListeners()}get marginBottom(){const{bottom:e,marginBottom:t}=this._videoMeta;return this.config.fitVideo?e+t:t}}var en=function(e){function t(){var e;w(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return E(e=P(this,t,[].concat(r)),"_onOff",(function(){e.switchOffSubtitle()})),E(e,"_onChange",(function(t){var n=e.getSubTitleIndex(e.config.list,t);n<0||e.updateCurItem(n,t)})),E(e,"_onUpdate",(function(t){if(t&&!(t.length<1)){var n=t.map((function(e){return{startTime:e.start,endTime:e.end,text:e.text.length>0?e.text[0]:"",textTag:e.textTag}}));e._updateCallback&&e._updateCallback(n[0]),e.emit("subtitle_update",n[0])}})),E(e,"_onListReset",(function(t){e.updateList(t)})),e}return D(t,e),M(t,[{key:"afterCreate",value:function(){this._initExtSubTitle(),this._updateCallback=null}},{key:"_initExtSubTitle",value:function(e){var t=this.config,n=t.list,r=t.style,i=t.isDefaultOpen,s=t.updateMode,a=t.renderMode;i&&e<0&&n.length>0&&(e=0,n[0].isDefault=!0);var o={subTitles:n,defaultOpen:i,updateMode:s,renderMode:a,debugger:this.config.debugger,domRender:!1};Object.keys(r).map((function(e){o[e]=r[e]}));var l=this.player.controls;!this.playerConfig.marginControls&&l&&l.root&&(this.on(f,this.onPlayerFocus),this.on(p,this.onPlayerBlur));var u=this.player;u._subTitles?u._subTitles._isOpen&&(e=this.getSubTitleIndex(this.config.list,u._subTitles.currentText)):(u._subTitles=new Zt(o),u._subTitles.attachPlayer(this.player)),this.subTitles=u._subTitles,this.subTitles.on("off",this._onOff),this.subTitles.on("change",this._onChange),this.subTitles.on("update",this._onUpdate),this.subTitles.on("reset",this._onListReset),r.follow&&this.subTitles.root&&K.addClass(this.subTitles.root,"follow-control")}},{key:"show",value:function(e){!this.config.list||this.config.list.length<1||K.addClass(this.root,"show")}},{key:"getSubTitleIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{id:"",language:""},n=-1;return t&&(t.id||t.language)?(e.forEach((function(e,r){var i,s,a,o;i=e,s=t,a=K.isNotNull(i.id)&&K.isNotNull(s.id)&&i.id===s.id,o=K.isNotNull(i.language)&&K.isNotNull(s.language)&&i.language===s.language,(a||o)&&(n=r)})),n):n}},{key:"updateSubtitles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&("String"===K.typeOf(e)&&(e=[{id:parseInt(100*Math.random()),isDefault:!0,url:e}]),t&&(this._updateCallback=t),this.updateList({list:e}),this.subTitles&&this.subTitles.setSubTitles(this.config.list,this.curIndex>-1,n))}},{key:"updateList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.list){var t=[];e.list.forEach((function(e){t.push(e)}));var n=function(e){var t=-1;return e.forEach((function(e,n){e.id||e.language||(e.id=n),e.id=String(e.id),!e.url&&(e.url=e.src),!e.text&&(e.text=e.label),!e.language&&(e.language=e.srclang),void 0===e.isDefault&&(e.isDefault=e.default||!1),(e.isDefault||e.default)&&(t<0?t=n:e.isDefault=e.default=!1)})),t}(t);e.isOpen?(this.curIndex=n,this.curItem=n>-1?t[n]:null):(this.curIndex=-1,this.curItem=null),this.config.list=t,0===t.length&&this.switchOffSubtitle()}}},{key:"switchSubTitle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:"",language:""};this.getSubTitleIndex(this.config.list,e)<0||this.subTitles.switch(e).catch((function(e){}))}},{key:"switchOffSubtitle",value:function(e){this.emit("subtitle_change",{off:!0,isListUpdate:!1,list:[]}),this.lastIndex=this.curIndex,this.curIndex=-1,this.curItem=null,this.switchIconState(!1)}},{key:"switchOnSubtitle",value:function(){var e=this.config.list[this.lastIndex>-1?this.lastIndex:0];this.switchIconState(!0),this.switchSubTitle(e)}},{key:"destroy",value:function(){this.subTitles&&(this.subTitles.destroy(),this.subTitles=null),G(t,"destroy",this,3)([])}}],[{key:"pluginName",get:function(){return"texttrack"}},{key:"defaultConfig",get:function(){return{index:6,list:[],isDefaultOpen:!0,style:{follow:!0,mode:"stroke",followBottom:50,fitVideo:!0,offsetBottom:2,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,line:"double",fontColor:"#fff"},closeText:{text:"不开启",iconText:"字幕"},needCloseText:!0,className:"xgplayer-texttrack",hidePortrait:!1,isShowIcon:!0,renderMode:"normal",mode:"external",debugger:!1}}}])}(Re),tn=n(23232),nn=Object.defineProperty,rn=(e,t,n)=>((e,t,n)=>t in e?nn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class sn{static getDefaultConfig(){return{rangeMaxDuration:15,rangeMinDuration:5,rangeMinSize:409600,safeFactor:.1,cacheSafeFactor:3,minDangerThreshold:5,estPlayTime:12,minBandwidth:1e6,estPTcontrol:!1,minTargetCacheDur:30,maxTargetCacheDur:60,targetCacheControl:!1,rangeControl:!1}}constructor(e,t,n,r){this.config=sn.getDefaultConfig(),Object.keys(r).map((e=>{void 0!==r[e]&&null!==r[e]&&(this.config[e]=r[e])})),this.duration=n,this.player=e,this.updateBitrate(t)}updateBitrate(e){this.bitrate=e,this.bitrate||(this.bitrate=this.config.minBandwidth)}getAdaptLoadDuration(){const{player:e,config:t}=this;if(!t.rangeControl)return-1;const n=(null==e?void 0:e.bufferedPoint)||null,r=n&&n.end?n.end-e.currentTime:0;return Math.max(t.rangeMaxDuration-r,t.rangeMinDuration)}getAdaptCacheBuffer(){const{player:e,config:t,bitrate:n}=this;if(!t.targetCacheControl)return-1;const{estPlayTime:r}=t;let i=r;t.estPTcontrol&&(i=Math.min(r,this.duration-((null==e?void 0:e.currentTime)||0)));const s=1024*(null==e?void 0:e.avgSpeed)||0;let a=Math.max(t.safeFactor*s,t.minBandwidth);e&&e.avgSpeed&&(a=t.safeFactor*s);let o=n>0?Math.floor((1-a/n)*i):0;return o=t.minDangerThreshold+Math.max(o,0),Math.min(Math.max(t.cacheSafeFactor*o,t.minTargetCacheDur),t.maxTargetCacheDur)}}class an{static getDefaultConfig(){return{rangeControl:!1,rangeMaxDuration:20,rangeMinDuration:5,rangeMinSize:409600,rangeFloatSize:10240,safeFactor:.1,cacheSafeFactor:3,minDangerThreshold:5,estPlayTime:12,minBandwidth:1e6,estPTcontrol:!1,minTargetCacheDur:30,maxTargetCacheDur:60,targetCacheControl:!1}}constructor(e,t,n,r){this.config=an.getDefaultConfig(),Object.keys(r).map((e=>{void 0!==r[e]&&null!==r[e]&&(this.config[e]=r[e])})),this.duration=n,this.player=e,this.updateBitrate(t)}updateBitrate(e){this.bitrate=e,this.bitrate||(this.bitrate=this.config.minBandwidth)}getBuffer(){const{player:e}=this,t=(null==e?void 0:e.bufferedPoint)||null;return t&&t.end?t.end-e.currentTime:0}getAdaptLoadDuration(){const{config:e,duration:t}=this;if(!e.rangeControl)return-1;const n=this.getBuffer(),r=t-n,i=Math.min(r,e.rangeMaxDuration-n);return Math.max(i,e.rangeMinDuration)}getAdaptRangeSize(e){const{config:t,bitrate:n,duration:r}=this;if(!t.rangeControl)return-1;e||(e=this.getAdaptLoadDuration());const i=r-this.getBuffer();let s=Math.max(t.rangeMinSize,e*n/8);const a=i*n/8;return s+t.rangeFloatSize>=a&&(s=a),Math.ceil(s)}getAdaptCacheBuffer(){const{player:e,config:t,bitrate:n}=this;if(!t.targetCacheControl)return-1;const{estPlayTime:r}=t;let i=r;t.estPTcontrol&&(i=Math.min(r,this.duration-((null==e?void 0:e.currentTime)||0)));const s=1024*(null==e?void 0:e.avgSpeed)||0;let a=Math.max(t.safeFactor*s,t.minBandwidth);e&&e.avgSpeed&&(a=t.safeFactor*s);let o=n>0?Math.floor((1-a/n)*i):0;o=t.minDangerThreshold+Math.max(o,0);const l=Math.max(t.cacheSafeFactor*o,t.minTargetCacheDur);return Math.min(l,t.maxTargetCacheDur)}}var on=(e=>(e.CHANGE_FLYING_PLUGIN_CONFIG="CHANGE_FLYING_PLUGIN_CONFIG",e))(on||{});function ln(e,t,n){return t=cn(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,hn()?Reflect.construct(t,n||[],cn(e).constructor):t.apply(e,n))}function un(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,fn(r.key),r)}}function cn(e){return(cn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(hn=function(){return!!e})()}function dn(e,t){return(dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function fn(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}function pn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var gn={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,r,s,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new i(r,s||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=new Array(s);i<s;i++)a[i]=r[i].fn;return a},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,i,s,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,s),!0;case 6:return c.fn.call(c.context,t,r,i,s,a),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!i||o.once)&&(!r||o.context===r)&&a(this,s);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||i&&!o[l].once||r&&o[l].context!==r)&&u.push(o[l]);u.length?this._events[s]=1===u.length?u[0]:u:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o}(gn);var mn=gn.exports;const vn=pn(mn);var yn={},_n=null,Tn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ln(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dn(e,t)}(t,e),function(e,t,n){return t&&un(e.prototype,t),n&&un(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"add",value:function(e){e&&(yn[e.playerId]=e,1===Object.keys(yn).length&&this.setActive(e.playerId,!0))}},{key:"remove",value:function(e){e&&(e.isUserActive,delete yn[e.playerId])}},{key:"_iterate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var n in yn)if(Object.prototype.hasOwnProperty.call(yn,n)){var r=yn[n];if(t){if(e(r))break}else e(r)}}},{key:"forEach",value:function(e){this._iterate(e)}},{key:"find",value:function(e){var t=null;return this._iterate((function(n){var r=e(n);return r&&(t=n),r}),!0),t}},{key:"findAll",value:function(e){var t=[];return this._iterate((function(n){e(n)&&t.push(n)})),t}},{key:"setActive",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(yn[e])return t?this.forEach((function(t){e===t.playerId?(t.isUserActive=!0,t.isInstNext=!1):t.isUserActive=!1})):yn[e].isUserActive=t,e}},{key:"getActiveId",value:function(){for(var e=Object.keys(yn),t=0;t<e.length;t++){var n=yn[e[t]];if(n&&n.isUserActive)return e[t]}return null}},{key:"setNext",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(yn[e])return t?this.forEach((function(t){e===t.playerId?(t.isUserActive=!1,t.isInstNext=!0):t.isInstNext=!1})):yn[e].isInstNext=t,e}}],[{key:"getInstance",value:function(){return _n||(_n=new t),_n}}])}(mn.EventEmitter);function bn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bn(Object(n),!0).forEach((function(t){Dn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pn(){Pn=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch{l=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var s=t&&t.prototype instanceof d?t:d,a=Object.create(s.prototype),o=new k(i||[]);return r(a,"_invoke",{value:b(e,n,o)}),a}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var h={};function d(){}function f(){}function p(){}var g={};l(g,s,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(M([])));v&&v!==t&&n.call(v,s)&&(g=v);var y=p.prototype=d.prototype=Object.create(g);function _(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function i(r,s,a,o){var l=c(e[r],e,s);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==typeof h&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){i("next",e,a,o)}),(function(e){i("throw",e,a,o)})):t.resolve(h).then((function(e){u.value=e,a(u)}),(function(e){return i("throw",e,a,o)}))}o(l.arg)}var s;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return s=s?s.then(r,r):r()}})}function b(e,t,n){var r="suspendedStart";return function(i,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw s;return{value:void 0,done:!0}}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var o=S(a,n);if(o){if(o===h)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=c(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}function S(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=c(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function M(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=p,r(y,"constructor",{value:p,configurable:!0}),r(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},_(T.prototype),l(T.prototype,a,(function(){return this})),e.AsyncIterator=T,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var a=new T(u(t,n,r,i),s);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},_(y),l(y,o,"Generator"),l(y,s,(function(){return this})),l(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=M,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var o=n.call(s,"catchLoc"),l=n.call(s,"finallyLoc");if(o&&l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;w(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function wn(e){return(wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kn(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function Mn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){kn(s,r,i,a,o,"next",e)}function o(e){kn(s,r,i,a,o,"throw",e)}a(void 0)}))}}function En(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Rn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Fn(r.key),r)}}function xn(e,t,n){return t&&Rn(e.prototype,t),n&&Rn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Dn(e,t,n){return(t=Fn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function In(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ln(e,t)}function Cn(e){return(Cn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ln(e,t){return Ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ln(e,t)}function On(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}}function An(e,t,n){return An=On()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Ln(i,n.prototype),i},An.apply(null,arguments)}function Gn(e){var t="function"==typeof Map?new Map:void 0;return Gn=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return An(e,arguments,Cn(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Ln(n,e)},Gn(e)}function Bn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nn(e){var t=On();return function(){var n,r=Cn(e);if(t){var i=Cn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Bn(e)}(this,n)}}function $n(){return $n=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Cn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},$n.apply(this,arguments)}function Un(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fn(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function Hn(){var e,t,n=new Promise((function(n,r){e=n,t=r}));return n.used=!1,n.resolve=function(){return n.used=!0,e.apply(void 0,arguments)},n.reject=function(){return n.used=!0,t.apply(void 0,arguments)},n}Tn||Object.prototype.constructor;var Vn={DEBUG:1,LOG:2,WARN:3,ERROR:4},jn=["Boolean","Number","String","Undefined","Null","Date","Object"],zn=function(){function e(t,n){En(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(null==n?void 0:n.logCacheLevel)||3,this.logMaxSize=(null==n?void 0:n.logMaxSize)||204800,this.logSize=0,this.logTextArray=[]}return xn(e,[{key:"debug",value:function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];this.logCache.apply(this,[Vn.DEBUG].concat(r)),!e.disabled&&(t=console).debug.apply(t,[this._prefix,Xn()].concat(r))}},{key:"log",value:function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];this.logCache.apply(this,[Vn.LOG].concat(r)),!e.disabled&&(t=console).log.apply(t,[this._prefix,Xn()].concat(r))}},{key:"warn",value:function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];this.logCache.apply(this,[Vn.WARN].concat(r)),!e.disabled&&(t=console).warn.apply(t,[this._prefix,Xn()].concat(r))}},{key:"error",value:function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];this.logCache.apply(this,[Vn.ERROR].concat(r)),!e.disabled&&(t=console).error.apply(t,[this._prefix,Xn()].concat(r))}},{key:"logCache",value:function(e){if(!(e<this.logCacheLevel)){var t="";try{for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var s=r.map((function(e){return Wn(e)}));t=this._prefix+Xn()+JSON.stringify(s)}catch{return}if(e>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var a=this.logTextArray.shift();this.logSize-=a.length}}}},{key:"getLogCache",value:function(){var e=this.logTextArray.join("\n");return this.reset(),e}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(e){this.logCacheLevel=e}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();function Xn(){return(new Date).toLocaleString()}function Kn(e){if("object"!==wn(e))return e;var t=Object.prototype.toString.call(e).slice(8,-1);switch(t){case"Array":case"Uint8Array":case"ArrayBuffer":return t+"["+e.length+"]";case"Object":return"{}";default:return t}}function Wn(e,t,n){n||(n=1),t||(t=2);var r={};if(!e||"object"!==wn(e))return e;var i=Object.prototype.toString.call(e).slice(8,-1);if(!jn.includes(i))return i;if(!(n>t)){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n===t?r[s]=Kn(e[s]):"object"===wn(e[s])?r[s]=Wn(e[s],t,n+1):r[s]=e[s]);return r}}Dn(zn,"disabled",!0);var Qn="fetch",qn="arraybuffer",Yn="text",Jn="json",Zn=function(e){In(n,e);var t=Nn(n);function n(e,r,i,s){var a;return En(this,n),Dn(Bn(a=t.call(this,s)),"retryCount",0),Dn(Bn(a),"isTimeout",!1),Dn(Bn(a),"loaderType",Qn),Dn(Bn(a),"startTime",0),Dn(Bn(a),"endTime",0),Dn(Bn(a),"options",{}),a.url=e,a.request=r,a.response=i,a}return xn(n)}(Gn(Error)),er=Object.prototype.toString;function tr(e){if("[object Object]"!==er.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function nr(e){if(e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function rr(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ir(e,t){if(e){if(!t)return e;var n,r=Object.keys(t).map((function(e){if(null!=(n=t[e]))return Array.isArray(n)?e+="[]":n=[n],n.map((function(t){return function(e){return"[object Date]"===er.call(e)}(t)?t=t.toISOString():function(e){return null!==e&&"object"===wn(e)}(t)&&(t=JSON.stringify(t)),"".concat(rr(e),"=").concat(rr(t))})).join("&")})).filter(Boolean).join("&");if(r){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}}function sr(e,t,n,r,i,s,a,o,l,u,c){return i=null!=i?parseFloat(i):null,r=parseInt(r||"0",10),Number.isNaN(r)&&(r=0),{data:e,done:t,options:{range:l,vid:u,index:o,contentLength:r,age:i,startTime:s,firstByteTime:a,endTime:Date.now(),priOptions:c},response:n}}function ar(e,t){return Math.round(8*e*1e3/t/1024)}var or="real_time_speed",lr=2097152,ur=function(e){In(r,e);var t,n=Nn(r);function r(){var e;return En(this,r),Dn(Bn(e=n.call(this)),"_abortController",null),Dn(Bn(e),"_timeoutTimer",null),Dn(Bn(e),"_reader",null),Dn(Bn(e),"_response",null),Dn(Bn(e),"_aborted",!1),Dn(Bn(e),"_index",-1),Dn(Bn(e),"_range",null),Dn(Bn(e),"_receivedLength",0),Dn(Bn(e),"_running",!1),Dn(Bn(e),"_logger",null),Dn(Bn(e),"_vid",""),Dn(Bn(e),"_onProcessMinLen",0),Dn(Bn(e),"_onCancel",null),Dn(Bn(e),"_priOptions",null),e}return xn(r,[{key:"load",value:function(e){var t,n=this,r=e.url,i=e.vid,s=e.timeout,a=e.responseType,o=e.onProgress,l=e.index,u=e.onTimeout,c=e.onCancel,h=e.range,d=e.transformResponse,f=e.request,p=e.params,g=e.logger,m=e.method,v=e.headers,y=e.body,_=e.mode,T=e.credentials,b=e.cache,S=e.redirect,P=e.referrer,w=e.referrerPolicy,k=e.onProcessMinLen,M=e.priOptions;this._logger=g,this._aborted=!1,this._onProcessMinLen=k,this._onCancel=c,this._abortController=typeof AbortController<"u"&&new AbortController,this._running=!0,this._index=l,this._range=h||[0,0],this._vid=i||r,this._priOptions=M||{};var E={method:m,headers:v,body:y,mode:_,credentials:T,cache:b,redirect:S,referrer:P,referrerPolicy:w,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},R=!1;clearTimeout(this._timeoutTimer),r=ir(r,p);var x=nr(h);x&&(v=f?f.headers:E.headers=E.headers||(Headers?new Headers:{}),Headers&&v instanceof Headers?v.append("Range",x):v.Range=x),s&&(this._timeoutTimer=setTimeout((function(){if(R=!0,n.cancel(),u){var e=new Zn(r,E,null,"timeout");e.isTimeout=!0,u(e,{index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions})}}),s));var D=Date.now();return this._logger.debug("[fetch load start], index,",l,",range,",h),new Promise((function(e,t){fetch(f||r,f?void 0:E).then(function(){var i=Mn(Pn().mark((function i(s){var u,c,f,p;return Pn().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(clearTimeout(n._timeoutTimer),n._response=s,!n._aborted&&n._running){i.next=4;break}return i.abrupt("return");case 4:if(d&&(s=d(s,r)||s),s.ok){i.next=7;break}throw new Zn(r,E,s,"bad network response");case 7:if(u=Date.now(),a!==Yn){i.next=15;break}return i.next=11,s.text();case 11:c=i.sent,n._running=!1,i.next=37;break;case 15:if(a!==Jn){i.next=22;break}return i.next=18,s.json();case 18:c=i.sent,n._running=!1,i.next=37;break;case 22:if(!o){i.next=29;break}return n.resolve=e,n.reject=t,n._loadChunk(s,o,D,u),i.abrupt("return");case 29:return i.next=31,s.arrayBuffer();case 31:c=i.sent,c=new Uint8Array(c),n._running=!1,f=Date.now()-D,p=ar(c.byteLength,f),n.emit(or,{speed:p,len:c.byteLength,time:f,vid:n._vid,index:n._index,range:n._range,priOptions:n._priOptions});case 37:n._logger.debug("[fetch load end], index,",l,",range,",h),e(sr(c,!0,s,s.headers.get("Content-Length"),s.headers.get("age"),D,u,l,h,n._vid,n._priOptions));case 39:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()).catch((function(e){var i;clearTimeout(n._timeoutTimer),n._running=!1,(!n._aborted||R)&&((e=e instanceof Zn?e:new Zn(r,E,null,null===(i=e)||void 0===i?void 0:i.message)).startTime=D,e.endTime=Date.now(),e.isTimeout=R,e.options={index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions},t(e))}))}))}},{key:"cancel",value:(t=Mn(Pn().mark((function e(){return Pn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch{}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,n,r){var i=this;if(!e.body||!e.body.getReader){this._running=!1;var s=new Zn(e.url,"",e,"onProgress of bad response.body.getReader");return s.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},void this.reject(s)}this._onProcessMinLen>0&&(this._cache=new Uint8Array(lr),this._writeIdx=0);var a,o,l,u=this._reader=e.body.getReader(),c=function(){var s=Mn(Pn().mark((function s(){var h,d,f,p,g,m,v,y;return Pn().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o=Date.now(),s.prev=1,s.next=4,u.read();case 4:a=s.sent,l=Date.now(),s.next=13;break;case 8:return s.prev=8,s.t0=s.catch(1),l=Date.now(),i._aborted||(i._running=!1,s.t0.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i.reject(s.t0)),s.abrupt("return");case 13:if(d=(null===(h=i._range)||void 0===h?void 0:h.length)>0?i._range[0]:0,f=d+i._receivedLength,!i._aborted){s.next=19;break}return i._running=!1,t(void 0,!1,{range:[f,f],vid:i._vid,index:i._index,startTime:o,endTime:l,st:n,firstByteTime:r,priOptions:i._priOptions},e),s.abrupt("return");case 19:p=a.value?a.value.byteLength:0,i._receivedLength+=p,i._logger.debug("【fetchLoader,onProgress call】,task,",i._range,", start,",f,", end,",d+i._receivedLength,", done,",a.done),i._onProcessMinLen>0?i._writeIdx+p>=i._onProcessMinLen||a.done?((g=new Uint8Array(i._writeIdx+p)).set(i._cache.slice(0,i._writeIdx),0),p>0&&g.set(a.value,i._writeIdx),i._writeIdx=0,i._logger.debug("【fetchLoader,onProgress enough】,done,",a.done,",len,",g.byteLength,", writeIdx,",i._writeIdx)):p>0&&i._writeIdx+p<lr?(i._cache.set(a.value,i._writeIdx),i._writeIdx+=p,i._logger.debug("【fetchLoader,onProgress cache】,len,",p,", writeIdx,",i._writeIdx)):p>0&&(m=new Uint8Array(i._writeIdx+p+2048),i._logger.debug("【fetchLoader,onProgress extra start】,size,",i._writeIdx+p+2048,", datalen,",p,", writeIdx,",i._writeIdx),m.set(i._cache.slice(0,i._writeIdx),0),p>0&&m.set(a.value,i._writeIdx),i._writeIdx+=p,delete i._cache,i._cache=m,i._logger.debug("【fetchLoader,onProgress extra end】,len,",p,", writeIdx,",i._writeIdx)):g=a.value,(g&&g.byteLength>0||a.done)&&t(g,a.done,{range:[i._range[0]+i._receivedLength-(g?g.byteLength:0),i._range[0]+i._receivedLength],vid:i._vid,index:i._index,startTime:o,endTime:l,st:n,firstByteTime:r,priOptions:i._priOptions},e),a.done?(v=Date.now()-n,y=ar(i._receivedLength,v),i.emit(or,{speed:y,len:i._receivedLength,time:v,vid:i._vid,index:i._index,range:i._range,priOptions:i._priOptions}),i._running=!1,i._logger.debug("[fetchLoader onProgress end],task,",i._range,",done,",a.done),i.resolve(sr(a,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),n,r,i._index,i._range,i._vid,i._priOptions))):c();case 25:case"end":return s.stop()}}),s,null,[[1,8]])})));return function(){return s.apply(this,arguments)}}();c()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return typeof fetch<"u"}}]),r}(vn),cr=function(e){In(n,e);var t=Nn(n);function n(){var e;return En(this,n),Dn(Bn(e=t.call(this)),"_xhr",null),Dn(Bn(e),"_aborted",!1),Dn(Bn(e),"_timeoutTimer",null),Dn(Bn(e),"_range",null),Dn(Bn(e),"_receivedLength",0),Dn(Bn(e),"_url",null),Dn(Bn(e),"_onProgress",null),Dn(Bn(e),"_index",-1),Dn(Bn(e),"_headers",null),Dn(Bn(e),"_currentChunkSizeKB",384),Dn(Bn(e),"_timeout",null),Dn(Bn(e),"_xhr",null),Dn(Bn(e),"_withCredentials",null),Dn(Bn(e),"_startTime",-1),Dn(Bn(e),"_loadCompleteResolve",null),Dn(Bn(e),"_loadCompleteReject",null),Dn(Bn(e),"_runing",!1),Dn(Bn(e),"_logger",!1),Dn(Bn(e),"_vid",""),Dn(Bn(e),"_responseType",void 0),Dn(Bn(e),"_credentials",void 0),Dn(Bn(e),"_method",void 0),Dn(Bn(e),"_transformResponse",void 0),Dn(Bn(e),"_firstRtt",void 0),Dn(Bn(e),"_onCancel",null),Dn(Bn(e),"_priOptions",null),e}return xn(n,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=ir(e.url,e.params);var n=Date.now();return new Promise((function(e,n){t._loadCompleteResolve=e,t._loadCompleteReject=n,t._startLoad()})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted)throw(e=e instanceof Zn?e:new Zn(t._url,t._request)).startTime=n,e.endTime=Date.now(),e.options={index:t._index,vid:t._vid,priOptions:t._priOptions},e}))}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===qn&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var t=1024*this._currentChunkSizeKB,n=this._range[0]+this._receivedLength,r=this._range[1];t<this._range[1]-n&&(r=n+t),e=[n,r],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var t=this;try{this._startTime=Date.now();var n=this._xhr=new XMLHttpRequest;n.open(this._method||"GET",this._url,!0),n.responseType=this._responseType,this._timeout&&(n.timeout=this._timeout),n.withCredentials=this._withCredentials,n.onload=this._onLoad.bind(this),n.onreadystatechange=this._onReadyStatechange.bind(this),n.onerror=function(e){var n,r,i;t._running=!1;var s=new Zn(t._url,t._request,null==e||null===(n=e.currentTarget)||void 0===n?void 0:n.response,"xhr.onerror.status:"+(null==e||null===(r=e.currentTarget)||void 0===r?void 0:r.status)+",statusText,"+(null==e||null===(i=e.currentTarget)||void 0===i?void 0:i.statusText));s.options={index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions},t._loadCompleteReject(s)},n.ontimeout=function(e){t.cancel();var n=new Zn(t._url,t._request,{status:408},"timeout");t._onTimeout&&(n.isTimeout=!0,t._onTimeout(n,{index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions})),n.options={index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions},t._loadCompleteReject(n)};var r=this._headers||{},i=nr(e);i&&(r.Range=i),r&&Object.keys(r).forEach((function(e){n.setRequestHeader(e,r[e])})),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),n.send(this._body)}catch(t){t.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(t)}}},{key:"_onReadyStatechange",value:function(e){2===e.target.readyState&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t,n=e.target.status;if(n<200||n>299){var r=new Zn(this._url,null,Sn(Sn({},e.target.response),{},{status:n}),"bad response,status:"+n);return r.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(r)}var i,s=null,a=!1,o=(null===(t=this._range)||void 0===t?void 0:t.length)>0?this._range[0]:0;if(this._responseType===qn){var l,u=new Uint8Array(e.target.response);if(i=o+this._receivedLength,u&&u.byteLength>0){this._receivedLength+=u.byteLength;var c=Date.now()-this._startTime,h=ar(this._receivedLength,c);this.emit(or,{speed:h,len:this._receivedLength,time:c,vid:this._vid,index:this._index,range:[i,o+this._receivedLength],priOptions:this._priOptions})}s=u,a=!((null===(l=this._range)||void 0===l?void 0:l.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._logger.debug("[xhr load done->], tast :",this._range,", start",i,"end ",o+this._receivedLength,",dataLen,",u?u.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",a)}else a=!0,s=e.target.response;var d={ok:n>=200&&n<300,status:n,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(d=this._transformResponse(d,this._url)||d),this._onProgress&&this._onProgress(s,a,{index:this._index,vid:this._vid,range:[i,o+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},d),a?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(sr(this._onProgress?null:s,a,d,d.headers["content-length"],d.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted&&(this._aborted=!0,this._runing=!1,$n(Cn(n.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr))return this._xhr.abort()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,n={},r=function(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Un(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Un(e,t)}}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{!a&&null!=n.return&&n.return()}finally{if(o)throw s}}}}(e.getAllResponseHeaders().trim().split("\r\n"));try{for(r.s();!(t=r.n()).done;){var i=t.value.split(": ");n[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(e){r.e(e)}finally{r.f()}return n}}],[{key:"isSupported",value:function(){return typeof XMLHttpRequest<"u"}}]),n}(vn),hr=["retry","retryDelay","onRetryError","transformError"],dr=function(){function e(t,n){En(this,e),this.promise=Hn(),this.alive=!!n.onProgress,!n.logger&&(n.logger=new zn("Loader")),this._loaderType=t,this._loader=t===Qn&&window.fetch?new ur:new cr,this._config=n,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=n.retryCheckFunc,this._logger=n.logger}return xn(e,[{key:"exec",value:function(){var e=this,t=this._config,n=t.retry,r=t.retryDelay,i=t.onRetryError,s=t.transformError,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(t,hr),o=function(){var t=Mn(Pn().mark((function t(){var l,u,c;return Pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(a);case 3:l=t.sent,e.promise.resolve(l),t.next=27;break;case 7:if(t.prev=7,t.t0=t.catch(0),e._loader.running=!1,e._logger.debug("[task request catch err]",t.t0),!e._canceled){t.next=13;break}return t.abrupt("return");case 13:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,u=t.t0,s&&(u=s(u)||u),i&&e._retryCount>0&&i(u,e._retryCount,{index:a.index,vid:a.vid,range:a.range,priOptions:a.priOptions}),e._retryCount++,c=!0,e._retryCheckFunc&&(c=e._retryCheckFunc(t.t0)),!(c&&e._retryCount<=n)){t.next=26;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",a.range),e._retryTimer=setTimeout(o,r),t.abrupt("return");case 26:e.promise.reject(u);case 27:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return o(),this.promise}},{key:"cancel",value:(t=Mn(Pn().mark((function e(){return Pn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),e;var t}();function fr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var pr=function(e){In(r,e);var t,n=Nn(r);function r(e){var t;return En(this,r),Dn(Bn(t=n.call(this,e)),"type",Qn),Dn(Bn(t),"_queue",[]),Dn(Bn(t),"_alive",[]),Dn(Bn(t),"_currentTask",null),Dn(Bn(t),"_config",void 0),t._config=function(e){return Sn({loaderType:Qn,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:Yn,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},e)}(e),("xhr"===t._config.loaderType||!ur.isSupported())&&(t.type="xhr"),t.log=e.logger,t}return xn(r,[{key:"isFetch",value:function(){return this.type===Qn}},{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?n=e:n.url=e||n.url||this._config.url,(n=Object.assign({},this._config,n)).params&&(n.params=Object.assign({},n.params)),n.headers&&tr(n.headers)&&(n.headers=Object.assign({},n.headers)),n.body&&tr(n.body)&&(n.body=Object.assign({},n.body)),n.transformRequest&&(n=n.transformRequest(n)||n),n.logger=this.log;var r=new dr(this.type,n);return r.loader.on(or,(function(e){t.emit(or,e)})),this._queue.push(r),1===this._queue.length&&(!this._currentTask||!this._currentTask.running)&&this._processTask(),r.promise}},{key:"cancel",value:(t=Mn(Pn().mark((function e(){var t;return Pn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,fr();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var t=this._currentTask.exec().catch((function(e){}));t&&"function"==typeof t.finally&&t.finally((function(){var t,n;null!==(t=e._currentTask)&&void 0!==t&&t.alive&&(null===(n=e._alive)||void 0===n?void 0:n.length)>0&&(e._alive=e._alive.filter((function(t){return t&&t!==e._currentTask}))),e._processTask()}))}}}],[{key:"isFetchSupport",value:function(){return ur.isSupported()}}]),r}(vn);class gr{static getDefaultConfig(){return{PCDNBufferControl:!1,PCDNCntControl:!1,estPTcontrol:!1,minPCDNInBuffer:8,maxPCDNInBuffer:12,minPCDNOutBuffer:3,maxPCDNOutBuffer:6,safePCDNInFactor:.1,safePCDNOutFactor:.4,alpha:.5,estPlayTime:12,minBandwidth:1e6}}constructor(e,t,n,r){this.config=gr.getDefaultConfig(),Object.keys(r).map((e=>{void 0!==r[e]&&null!==r[e]&&(this.config[e]=r[e])})),this.duration=n,this.player=e,this.updateBitrate(t),this.curPCDNInBuffer=this.config.maxPCDNInBuffer,this.curPCDNOutBuffer=this.config.maxPCDNOutBuffer,this.PCDNChangeCnt=0}updateBitrate(e){this.bitrate=e,this.bitrate||(this.bitrate=this.config.minBandwidth)}getPCDNInBuffer(){const{config:e,player:t,bitrate:n}=this;if(!e.PCDNBufferControl)return null;const{estPlayTime:r}=e;let i=r;e.estPTcontrol&&(i=Math.min(r,Math.max(0,this.duration-((null==t?void 0:t.currentTime)||0))));const{safePCDNInFactor:s,minBandwidth:a,maxPCDNInBuffer:o,minPCDNInBuffer:l}=e,u=s*Math.max(1024*(null==t?void 0:t.avgSpeedPCDN)||0,a),c=n>0?(1-u/n)*i:0;return this.curPCDNInBuffer=Math.min(o,Math.max(l,c)),this.curPCDNInBuffer}getPCDNOutBuffer(){const{config:e,player:t,bitrate:n}=this;if(!e.PCDNBufferControl)return null;const{estPlayTime:r}=e;let i=r;e.estPTcontrol&&(i=Math.min(r,Math.max(0,this.duration-((null==t?void 0:t.currentTime)||0))));const{safePCDNOutFactor:s,minBandwidth:a,maxPCDNOutBuffer:o,minPCDNOutBuffer:l}=e,u=s*Math.max(1024*(null==t?void 0:t.avgSpeedPCDN)||0,a),c=n>0?(1-u/n)*i:0;return this.curPCDNOutBuffer=Math.min(o,Math.max(l,c)),this.curPCDNOutBuffer}getPCDNChangeCnt(){const{PCDNCntControl:e,alpha:t}=this.config,{curPCDNInBuffer:n,player:r}=this,i=(null==r?void 0:r.bufferedPoint)||null,s=i&&i.end?i.end-r.currentTime:0;return e?s>n+(this.PCDNChangeCnt-1)*t&&this.PCDNChangeCnt++:s>=n&&this.PCDNChangeCnt<2&&this.PCDNChangeCnt++,this.PCDNChangeCnt}}const mr=new Map,vr=class e{static get pluginName(){return"PCDN"}static get pcdnReqCnt(){const{pcdn_tracker_request_cnt:t,pcdn_tracker_success_cnt:n}=e;return e.pcdn_tracker_request_cnt=0,e.pcdn_tracker_success_cnt=0,{pcdn_tracker_request_cnt:t,pcdn_tracker_failed_cnt:t-n}}static getDefaultConfig(){return{trackerUrl:"",loaderType:Qn,responseType:Jn,mode:"cors",method:"POST",retry:0,retryDelay:3e3,timeout:5e3,node_num:5,client_info:null,maxCnt:30,withReferer:0,NULLNodeTimeStep:6e4,ErrorTimeStep:15e3}}constructor(t,n,r,i){var s,a;this.options=e.getDefaultConfig(),Object.keys(t).map((e=>{void 0!==t[e]&&null!==t[e]&&(this.options[e]=t[e])})),(!this.options.productConfig||!this.options.productConfig.app_id)&&console.error("productConfig must has"),this.loader=new pr(this.options),this.resetTrackeArgs(),this._lastFileInfo=null,this.lastfetchNodeTime=-1,this._lastRetFileKey=null,this._minUpdateNodeStep=this.options.ErrorTimeStep,null!=(a=null==(s=this.options)?void 0:s.adaptPCDNConfig)&&a.PCDNBufferControl&&(this.pcdnAdapt=new gr(n,r,i,this.options.adaptPCDNConfig))}get isOpenAdaptPCDN(){return!!this.pcdnAdapt}get curPCDNInBuffer(){return this.pcdnAdapt.curPCDNInBuffer}getPCDNInBuffer(){var e;return null==(e=this.pcdnAdapt)?void 0:e.getPCDNInBuffer()}get curPCDNOutBuffer(){return this.pcdnAdapt.curPCDNOutBuffer}getPCDNOutBuffer(){var e;return null==(e=this.pcdnAdapt)?void 0:e.getPCDNOutBuffer()}get curPCDNChangeCnt(){return this.pcdnAdapt.PCDNChangeCnt}getPCDNChangeCnt(){var e;return null==(e=this.pcdnAdapt)?void 0:e.getPCDNChangeCnt()}resetTrackeArgs(e){this.trackeArgs={fid:null,trace_id:null,req_times:(null==e?void 0:e.req_times)||0,resp_times:(null==e?void 0:e.resp_times)||0,token:null,node_num:this.options.node_num,client_info:this.options.client_info}}static async gainPCDNNode(t,n,r,i){var s,a,o;const l=e.getDefaultConfig();Object.keys(n).map((e=>{void 0!==n[e]&&null!==n[e]&&(l[e]=n[e])})),(!i||!i.app_id)&&console.error("productConfig must has");const u=new Hn;r?(r.byterate=_r(r.bitrate),delete r.bitrate):u.reject("video fileInfo need set");const c=Object.assign(i,{file_info:r},{node_num:(null==n?void 0:n.node_num)||3}),h=JSON.stringify(c),d=new pr(l);try{e.pcdn_tracker_request_cnt++;const n=await d.load(t,{body:h});n.done&&(null==(o=null==(a=null==(s=n.data)?void 0:s.Result)?void 0:a.nodes)?void 0:o.length)>0&&e.pcdn_tracker_success_cnt++,u.resolve(n)}catch(e){u.reject((null==e?void 0:e.message)||"get pcdnNode error")}return u}getPCDNNode(e,t,n){var r;const i=_r(t),s=mr.get(yr(e,i)),a=new Hn;return null==s||!s.nodes||(null==(r=null==s?void 0:s.nodes)?void 0:r.length)<1?this.fetchPCDNNode(null,null,n).then((e=>{a.resolve(e)})).catch((e=>{a.reject(e)})):(s.fromCache=!0,a.resolve(s)),a}removePCDNNode(e,t,n){const r=_r(t),i=mr.get(yr(e,r)),s=null==i?void 0:i.nodes;s&&(n?i.nodes=s.filter((e=>e&&n.indexOf(e.url)<0)):s.shift(),mr.set(yr(e,r),i)),(!s||!s.length)&&this.fetchPCDNNode().then().catch((()=>{}))}async fetchPCDNNode(t,n,r){var i,s;const a=new Hn;if(n){n.byterate=_r(n.bitrate);const e=mr.get(yr(n.vid,n.byterate));if((null==(i=null==e?void 0:e.nodes)?void 0:i.length)>0)return e.fromCache=!0,a.resolve(e),a;delete n.bitrate,this._lastFileInfo=n}else n=this._lastFileInfo;if(!n)return a.resolve(null),a;let o=!1;const l=yr(n.vid,n.byterate);if(this._lastRetFileKey!==l&&(this.resetTrackeArgs(),o=!0),Date.now()-this.lastfetchNodeTime<this._minUpdateNodeStep&&!o)return a.resolve(null),a;this.lastfetchNodeTime=Date.now(),this._lastRetFileKey=l,n.sfid?n.version=1:n.vid&&(n.version=2),this.options.withReferer&&(n.with_referer=this.options.withReferer);const u=Object.assign(this.options.productConfig,{file_info:n},this.trackeArgs,{req_id:r}),c=JSON.stringify(u);if(this.trackeArgs.req_times>=this.options.maxCnt)return a.resolve(null),a;this.loader||(this.loader=new pr(this.options)),this.trackeArgs.req_times+=1;try{e.pcdn_tracker_request_cnt++;const r=await this.loader.load(t||this.options.trackerUrl,{body:c});let i=null;if(r){this.trackeArgs.resp_times+=1;const t=8*n.byterate;if(r.done&&null!=(s=r.data)&&s.Result){const s=r.data.Result;i=s.nodes,i&&i.length>0?e.pcdn_tracker_success_cnt++:this._minUpdateNodeStep=this.options.NULLNodeTimeStep,i.map((e=>{e.vid=n.vid,e.bitrate=t}));const{fid:o,trace_id:l,req_id:u}=s,c={nodes:i,fid:o,vid:n.vid,trace_id:l,req_id:u,bitrate:t},h=yr(n.vid,n.byterate);mr.set(h,c),this.trackeArgs.fid=s.fid,this.trackeArgs.trace_id=s.trace_id,this.trackeArgs.token=s.token,a.resolve(c)}else this._minUpdateNodeStep=this.options.ErrorTimeStep,a.reject(r)}}catch(e){this._minUpdateNodeStep=this.options.ErrorTimeStep,console.warn("tracker catch ERR,",e),a.reject(e)}return a}};function yr(e,t){return`${e}-${t}`}function _r(e){return Math.floor(e/8)}function Tr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function br(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function Sr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){br(s,r,i,a,o,"next",e)}function o(e){br(s,r,i,a,o,"throw",e)}a(void 0)}))}}function Pr(e,t,n){return t=xr(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ir()?Reflect.construct(t,n||[],xr(e).constructor):t.apply(e,n))}function wr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Gr(r.key),r)}}function Mr(e,t,n){return t&&kr(e.prototype,t),n&&kr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Er(e,t,n){return(t=Gr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rr(){return Rr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=xr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Rr.apply(null,arguments)}function xr(e){return(xr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ar(e,t)}function Ir(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ir=function(){return!!e})()}function Cr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cr(Object(n),!0).forEach((function(t){Er(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Or(){Or=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var s=t&&t.prototype instanceof v?t:v,a=Object.create(s.prototype),o=new D(r||[]);return i(a,"_invoke",{value:M(e,n,o)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var d="suspendedStart",f="suspendedYield",p="executing",g="completed",m={};function v(){}function y(){}function _(){}var T={};u(T,a,(function(){return this}));var b=Object.getPrototypeOf,S=b&&b(b(I([])));S&&S!==n&&r.call(S,a)&&(T=S);var P=_.prototype=v.prototype=Object.create(T);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(i,s,a,o){var l=h(e[i],e,s);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)})):t.resolve(c).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,o)}))}o(l.arg)}var s;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return s=s?s.then(i,i):i()}})}function M(t,n,r){var i=d;return function(s,a){if(i===p)throw Error("Generator is already running");if(i===g){if("throw"===s)throw a;return{value:e,done:!0}}for(r.method=s,r.arg=a;;){var o=r.delegate;if(o){var l=E(o,r);if(l){if(l===m)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?g:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=g,r.method="throw",r.arg=u.arg)}}}function E(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var s=h(i,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,m;var a=s.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function I(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(typeof t+" is not iterable")}return y.prototype=_,i(P,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:y,configurable:!0}),y.displayName=u(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,u(e,l,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},w(k.prototype),u(k.prototype,o,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var a=new k(c(e,n,r,i),s);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(P),u(P,l,"Generator"),u(P,a,(function(){return this})),u(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=I,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return o.type="throw",o.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:I(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function Ar(e,t){return(Ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Gr(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}function Br(e){return(Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nr(e){var t="function"==typeof Map?new Map:void 0;return Nr=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(Ir())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&Ar(i,n.prototype),i}(e,arguments,xr(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Ar(n,e)},Nr(e)}rn(vr,"pcdn_tracker_request_cnt",0),rn(vr,"pcdn_tracker_success_cnt",0);var $r={DEBUG:1,LOG:2,WARN:3,ERROR:4},Ur=["Boolean","Number","String","Undefined","Null","Date","Object"],Fr=function(){function e(t,n){wr(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(null==n?void 0:n.logCacheLevel)||3,this.logMaxSize=(null==n?void 0:n.logMaxSize)||204800,this.logSize=0,this.logTextArray=[]}return Mr(e,[{key:"debug",value:function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];this.logCache.apply(this,[$r.DEBUG].concat(r)),e.disabled||(t=console).debug.apply(t,[this._prefix,Hr()].concat(r))}},{key:"log",value:function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];this.logCache.apply(this,[$r.LOG].concat(r)),e.disabled||(t=console).log.apply(t,[this._prefix,Hr()].concat(r))}},{key:"warn",value:function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];this.logCache.apply(this,[$r.WARN].concat(r)),e.disabled||(t=console).warn.apply(t,[this._prefix,Hr()].concat(r))}},{key:"error",value:function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];this.logCache.apply(this,[$r.ERROR].concat(r)),e.disabled||(t=console).error.apply(t,[this._prefix,Hr()].concat(r))}},{key:"logCache",value:function(e){if(!(e<this.logCacheLevel)){var t="";try{for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var s=r.map((function(e){return jr(e)}));t=this._prefix+Hr()+JSON.stringify(s)}catch(e){return}if(e>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var a=this.logTextArray.shift();this.logSize-=a.length}}}},{key:"getLogCache",value:function(){var e=this.logTextArray.join("\n");return this.reset(),e}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(e){this.logCacheLevel=e}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}])}();function Hr(){return(new Date).toLocaleString()}function Vr(e){if("object"!==Br(e))return e;var t=Object.prototype.toString.call(e).slice(8,-1);switch(t){case"Array":case"Uint8Array":case"ArrayBuffer":return t+"["+e.length+"]";case"Object":return"{}";default:return t}}function jr(e,t,n){n||(n=1),t||(t=2);var r={};if(!e||"object"!==Br(e))return e;var i=Object.prototype.toString.call(e).slice(8,-1);if(!Ur.includes(i))return i;if(!(n>t)){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n===t?r[s]=Vr(e[s]):"object"===Br(e[s])?r[s]=jr(e[s],t,n+1):r[s]=e[s]);return r}}Er(Fr,"disabled",!0);var zr,Xr=function(){function e(){wr(this,e)}return Mr(e,null,[{key:"start",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6||1===e.length&&e.start(0)<0?0:e.start(0):0}},{key:"end",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1):0}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(e){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var n=[],r=0,i=e.length;r<i;r++){var s=n.length;if(s&&t){var a=n[s-1],o=a[1];if(e.start(r)-o<=t){var l=e.end(r);l>o&&(a[1]=l)}else n.push([e.start(r),e.end(r)])}else n.push([e.start(r),e.end(r)])}return n}},{key:"totalLength",value:function(e){return e&&e.length?e.reduce((function(e,t){return e+(t[1]-t[0])}),0):0}},{key:"info",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var i=0,s=0,a=0,o=0,l=0,u=0,c=0,h=e.buffers(t,r),d=0,f=h.length;d<f;d++){var p=h[d];if(n+r>=p[0]&&n<=p[1])i=p[0],s=p[1],a=d;else{if(n+r<p[0]){o=p[0],l=p[1];break}n+r>p[1]&&(u=p[0],c=p[1])}}return{start:i,end:s,index:a,buffers:h,nextStart:o,nextEnd:l,prevStart:u,prevEnd:c,currentTime:n,behind:n-i,remaining:s?s-n:0,length:e.totalLength&&e.totalLength(h)}}},{key:"isBuffered",value:function(t,n){if(t){var r=e.get(t);if(null!=r&&r.length)for(var i=0;i<r.length;i++)if(n>=r.start(i)&&n<=r.end(i))return!0}return!1}}])}(),Kr="undefined"!=typeof window,Wr={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWORK_NOTFOUND:"network_notfound",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",MSE_CHANGE_TYPE:"MSE_CHANGE_TYPE",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",WAITING_TIMEOUT_ERROR:"WAITING_TIMEOUT_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},Qr=(Er(Er(Er(Er(Er(Er(Er(Er(Er(Er(zr={},Wr.MANIFEST,{HLS:1100,DASH:1200}),Wr.NETWORK,2100),Wr.NETWORK_TIMEOUT,2101),Wr.NETWORK_FORBIDDEN,2103),Wr.NETWORK_NOTFOUND,2104),Wr.NETWROK_RANGE_NOT_SATISFIABLE,2116),Wr.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),Wr.REMUX,{FMP4:4100,MP4:4200}),Wr.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,MSE_CHANGE_TYPE:5205,EME_HIJACK:5301}),Wr.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),Er(Er(zr,Wr.OTHER,8e3),Wr.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003})),qr=function(e){function t(e,n,r,i,s){var a;return wr(this,t),(a=Pr(this,t,[s||(null==r?void 0:r.message)])).errorType=e===Wr.NETWORK_TIMEOUT?Wr.NETWORK:e,a.originError=r,a.ext=i,a.errorCode=Qr[e][n]||Qr[e],a.errorMessage=a.message,a.errorCode||(a.errorType=Wr.OTHER,a.errorCode=Qr[a.errorType]),a}return Dr(t,e),Mr(t,null,[{key:"create",value:function(e,n,r,i,s){return e instanceof t?e:(e instanceof Error&&(r=e,e=""),e||(e=Wr.OTHER),new t(e,n,r,i,s))}},{key:"network",value:function(e){var n;return new t(null!=e&&e.isTimeout?Wr.NETWORK_TIMEOUT:Wr.NETWORK,null,e instanceof Error?e:null,{url:null==e?void 0:e.url,response:null==e?void 0:e.response,httpCode:null==e||null===(n=e.response)||void 0===n?void 0:n.status})}}])}(Nr(Error));function Yr(){var e,t,n=new Promise((function(n,r){e=n,t=r}));return n.used=!1,n.resolve=function(){return n.used=!0,e.apply(void 0,arguments)},n.reject=function(){return n.used=!0,t.apply(void 0,arguments)},n}function Jr(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}}function Zr(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{return Kr?e&&"undefined"!=typeof ManagedMediaSource?ManagedMediaSource:window.MediaSource:null}catch(e){}}function ei(e){return/ManagedMediaSource/gi.test(Object.prototype.toString.call(e))}var ti="updateDuration",ni=function(){function e(t,n){var r=this;wr(this,e),Er(this,"media",null),Er(this,"mediaSource",null),Er(this,"_openPromise",Yr()),Er(this,"_queue",Object.create(null)),Er(this,"_sourceBuffer",Object.create(null)),Er(this,"_mseFullFlag",{}),Er(this,"_st",0),Er(this,"_opst",0),Er(this,"_logger",null),Er(this,"_config",null),Er(this,"_url",null),Er(this,"_onStartStreaming",(function(){r._logger.debug("startstreaming")})),Er(this,"_onEndStreaming",(function(){r._logger.debug("endstreaming")})),Er(this,"_onSBUpdateEnd",(function(e){var t=r._queue[e];if(t){var n=t[0];if((null==n?void 0:n.opName)!==ti&&t.shift(),n){var i,s,a=Jr()-r._opst;r._logger.debug("UpdateEnd(".concat(e,"/").concat(n.opName,")"),function(e){try{return JSON.stringify(e)}catch(e){return""}}(function(e){var t=[];if(e instanceof TimeRanges)for(var n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}(null===(i=r._sourceBuffer[e])||void 0===i?void 0:i.buffered)),a,n.context),n.promise.resolve({name:n.opName,context:n.context,costtime:a});var o=null===(s=n.context)||void 0===s?void 0:s.callback;o&&"function"==typeof o&&o(n.context),r._startQueue(e)}}})),Er(this,"_onSBUpdateError",(function(e,t){var n=r._queue[e];if(n){var i=n[0];i&&(r._logger.error("UpdateError",e,i.opName,i.context),i.promise.reject(new qr(Wr.MEDIA,Wr.SUB_TYPES.MSE_APPEND_BUFFER,t)))}})),this._config=Object.assign(e.getDefaultConfig(),n),t&&this.bindMedia(t),this._logger=new Fr("MSE"),this._config.openLog&&Fr.enable()}return Mr(e,[{key:"isOpened",get:function(){var e;return"open"===(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)}},{key:"hasOpTasks",get:function(){var e=this,t=!1;return Object.keys(this._queue).forEach((function(n){var r=e._queue[n];Array.isArray(r)&&(t||(t=r.length>0))})),t}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return!!this.mediaSource&&"ended"===this.mediaSource.readyState}},{key:"streaming",get:function(){return!ei(this.mediaSource)||this.mediaSource.streaming}},{key:"isFull",value:function(t){return t?this._mseFullFlag[t]:this._mseFullFlag[e.VIDEO]}},{key:"updateDuration",value:function(e){var t=this,n=this.mediaSource&&this.mediaSource.duration>e;if(this.mediaSource&&this.mediaSource.duration>e){var r=0;if(Object.keys(this._sourceBuffer).forEach((function(e){try{r=Math.max(t.bufferEnd(e)||0,r)}catch(e){}})),e<r)return Promise.resolve()}return this._enqueueBlockingOp((function(){t.isEnded?t._logger.debug("setDuration but ended"):t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("setDuration",e))}),ti,{isReduceDuration:n})}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource,n=function(){var r=Jr()-e._st;e._logger.debug("sourceopen",r),t.removeEventListener("sourceopen",n),e._openPromise.resolve({costtime:r})};t.addEventListener("sourceopen",n),this._openPromise=Yr()}return this._openPromise}},{key:"bindMedia",value:(r=Sr(Or().mark((function e(t){var n,r,i,s,a=this;return Or().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mediaSource&&!this.media){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(n=Zr(this._config.preferMMS),t&&n){e.next=6;break}throw new Error("Param media or MediaSource does not exist");case 6:return this.media=t,r=this.mediaSource=new n,i=ei(r),this._st=Jr(),s=function(){var e=Jr()-a._st;a._logger.debug("sourceopen"),r.removeEventListener("sourceopen",s),URL.revokeObjectURL(t.src),a._openPromise.resolve({costtime:e})},r.addEventListener("sourceopen",s),i&&(r.addEventListener("startstreaming",this._onStartStreaming),r.addEventListener("endstreaming",this._onEndStreaming)),this._url=URL.createObjectURL(r),t.src=this._url,t.disableRemotePlayback=i,e.abrupt("return",this._openPromise);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"unbindMedia",value:(n=Sr(Or().mark((function e(){var t,n,r,i=this;return Or().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),t=this.mediaSource){if(Object.keys(this._queue).forEach((function(e){var t=i._queue[e];t&&t.forEach((function(e){var t,n;return null===(t=e.promise)||void 0===t||null===(n=t.resolve)||void 0===n?void 0:n.call(t)}))})),n=!!this.media&&this.media.readyState>=1,r="open"===t.readyState,n&&r)try{t.endOfStream()}catch(e){}Object.keys(this._sourceBuffer).forEach((function(e){try{t.removeSourceBuffer(i._sourceBuffer[e])}catch(e){}})),ei(t)&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming))}if(this.media){this.media.disableRemotePlayback=!1,this.media.removeAttribute("src");try{this.media.load()}catch(e){}this.media=null}this.mediaSource=null,this._openPromise=Yr(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"createSource",value:function(e,t){if(!this._sourceBuffer[e]&&this.mediaSource){var n;try{n=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(e){throw new qr(Wr.MEDIA,Wr.SUB_TYPES.MSE_ADD_SB,e)}n.mimeType=t,n.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),n.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var n=this,r=this._sourceBuffer[e];return this.mediaSource&&r&&r.mimeType!==t?"function"!=typeof r.changeType?Promise.reject(new qr(Wr.MEDIA,Wr.SUB_TYPES.MSE_CHANGE_TYPE,new Error("changeType is not a function"))):this._enqueueOp(e,(function(){try{r.changeType(t)}catch(e){throw new qr(Wr.MEDIA,Wr.SUB_TYPES.MSE_CHANGE_TYPE,e)}r.mimeType=t,n._onSBUpdateEnd(e)}),"changeType",{mimeType:t}):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t,n){var r=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,(function(){var i;r.mediaSource&&!r.media.error&&(r._logger.debug("MSE APPEND START",n),r._opst=Jr(),null===(i=r._sourceBuffer[e])||void 0===i||i.appendBuffer(t))}),"appendBuffer",n):Promise.resolve()}},{key:"remove",value:function(e,t,n,r){var i=this,s=!1;return this._mseFullFlag[e]&&(s=!0),this._enqueueOp(e,(function(){if(i.mediaSource&&!i.media.error){var s=i._sourceBuffer[e];t>=n||!s?i._onSBUpdateEnd(e):(i._opst=Jr(),i._logger.debug("MSE REMOVE START",e,t,n,r),s.remove(t,n))}}),"removeBuffer",r,s)}},{key:"clearBuffer",value:function(e,t){var n,r=this;return Object.keys(this._sourceBuffer).forEach((function(i){n=r.remove(i,e,t)})),n||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach((function(n){var r=t._sourceBuffer[n];e=t.remove(n,0,Xr.end(Xr.get(r)))})),e}},{key:"clearOpQueues",value:function(e,t){var n;this._logger.debug("MSE clearOpQueue START");var r=this._queue[e];if(t&&r)this._queue[e]=[];else if(r&&r[e]&&!(r.length<5)){var i=[];r.forEach((function(e){e.context&&e.context.isinit&&i.push(e)})),this._queue[e]=r.slice(0,2),i.length>0&&(n=this._queue[e]).push.apply(n,i)}}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp((function(){var n=t.mediaSource;n&&"open"===n.readyState&&(t._logger.debug("MSE endOfStream START"),e?n.endOfStream(e):n.endOfStream())}),"endOfStream"):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var n=this.mediaSource;e<0||t<e||null==n||!n.setLiveSeekableRange||"open"!==n.readyState||n.setLiveSeekableRange(e,t)}},{key:"getSourceBuffer",value:function(e){return this._sourceBuffer[e]}},{key:"buffered",value:function(e){return Xr.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return Xr.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return Xr.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,n,r,i){var s=this;if(!this.mediaSource)return Promise.resolve();var a=this._queue[e]=this._queue[e]||[],o={exec:t,promise:Yr(),opName:n,context:r};return i?(a.splice(0,0,o),this._mseFullFlag[e]=!1,this._startQueue(e)):a.push(o),this.isOpened||this.isEnded?1===a.length&&this._startQueue(e):this._openPromise.then((function(){1===a.length&&s._startQueue(e)})),o.promise}},{key:"_enqueueBlockingOp",value:(t=Sr(Or().mark((function e(t,n,r){var i,s,a=this;return Or().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if((i=Object.keys(this._sourceBuffer)).length){e.next=5;break}return e.abrupt("return",t());case 5:return s=[],i.forEach((function(e){var t=a._queue[e],i=Yr();s.push(i),t.push({exec:function(){i.resolve()},promise:i,opName:n,context:r}),1===t.length&&a._startQueue(e)})),e.abrupt("return",Promise.all(s).then((function(){try{return t()}finally{i.forEach((function(e){var t=a._queue[e],n=a._sourceBuffer[e];null==t||t.shift(),n&&n.updating||a._startQueue(e)}))}})));case 8:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var n=t[0];if(n&&!this._mseFullFlag[e])try{n.exec()}catch(r){r&&r.message&&r.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[e]=!0,n.context&&"object"===Br(n.context)&&(n.context.isFull=!0),this._logger.error("[MSE error],  context,",n.context," ,name,",n.opName,",err,SourceBuffer is full"),n.promise.reject(new qr(Wr.MEDIA,Wr.SUB_TYPES.MSE_FULL,r))):(this._logger.error(r),n.promise.reject(r.constructor===qr?r:new qr(Wr.MEDIA,Wr.SUB_TYPES.MSE_OTHER,r)),t.shift(),this._startQueue(e))}}}},{key:"setTimeoffset",value:function(e,t,n){var r=this;return this._enqueueOp(e,(function(){t<0&&(t+=.001),r._sourceBuffer[e].timestampOffset=t,r._onSBUpdateEnd(e)}),"setTimeoffset",n)}},{key:"abort",value:function(e,t){var n=this;return this.isOpened?this._enqueueOp(e,(function(){n._sourceBuffer[e].abort(),n._onSBUpdateEnd(e)}),"abort",t):Promise.resolve()}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',t=Zr();if(!t)return!1;try{return t.isTypeSupported(e)}catch(t){return this._logger.error(e,t),!1}}},{key:"isMMSOnly",value:function(){return"undefined"!=typeof ManagedMediaSource&&"undefined"==typeof MediaSource}},{key:"getDefaultConfig",value:function(){return{openLog:!1,preferMMS:!1}}}]);var t,n,r}();Er(ni,"VIDEO","video"),Er(ni,"AUDIO","audio");const ri=function(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}&&!function(){const e="_localstorage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}();ri&&localStorage.length;class ii{constructor(){let e,t;const n=new Promise(((n,r)=>{e=n,t=r}));return n.resolve=e,n.reject=t,n}resolve(e){}reject(e){}}const si="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NvbnN0IHQ9e30se2hhc093blByb3BlcnR5OmN9PU9iamVjdC5wcm90b3R5cGU7cG9zdE1lc3NhZ2Uoe2V2ZW50OiJyZWFkeSJ9KTtmdW5jdGlvbiBvKHMsYSl7dFtzXT1zZXRUaW1lb3V0KCgpPT57cG9zdE1lc3NhZ2Uoe2RhdGE6e2Zha2VJZDpzfX0pLG8ocyxhKX0sYSl9YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsZnVuY3Rpb24ocyl7dHJ5e2NvbnN0e2RhdGE6YT17fX09cyx7YWN0aW9uOm4sZmFrZUlkOmUsdGltZTpyfT1hO3N3aXRjaChuKXtjYXNlInNldEludGVydmFsIjpvKGUscik7YnJlYWs7Y2FzZSJjbGVhckludGVydmFsIjpjLmNhbGwodCxlKSYmKGNsZWFyVGltZW91dCh0W2VdKSxkZWxldGUgdFtlXSk7YnJlYWs7Y2FzZSJzZXRUaW1lb3V0Ijp0W2VdPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtwb3N0TWVzc2FnZSh7ZGF0YTp7ZmFrZUlkOmV9fSksYy5jYWxsKHQsZSkmJmRlbGV0ZSB0W2VdfSxyKTticmVhaztjYXNlImNsZWFyVGltZW91dCI6Yy5jYWxsKHQsZSkmJihjbGVhclRpbWVvdXQodFtlXSksZGVsZXRlIHRbZV0pO2JyZWFrO2RlZmF1bHQ6YnJlYWt9fWNhdGNoKGEpe3Bvc3RNZXNzYWdlKHtldmVudDoiZXJyb3IiLGRhdGE6e2Vycm9yOmF9fSl9fSl9KSgpOwo=",ai=typeof self<"u"&&self.Blob&&new Blob([(e=>Uint8Array.from(atob(e),(e=>e.charCodeAt(0))))(si)],{type:"text/javascript;charset=utf-8"});function oi(e){let t;try{if(t=ai&&(self.URL||self.webkitURL).createObjectURL(ai),!t)throw"";const n=new Worker(t,{name:null==e?void 0:e.name});return n.addEventListener("error",(()=>{(self.URL||self.webkitURL).revokeObjectURL(t)})),n}catch{return new Worker("data:text/javascript;base64,"+si,{name:null==e?void 0:e.name})}finally{t&&(self.URL||self.webkitURL).revokeObjectURL(t)}}let li,ui,ci,hi,di,fi={},pi=0;function gi(){do{2147483647===pi?pi=0:pi++}while(pi in fi);return pi}if(typeof Worker<"u"){let e,t=!1,n=!1;const r=()=>{if(!e){const{promise:r,resolve:i,reject:s}=Promise.withResolvers();e=r;try{li=new oi,li.addEventListener("message",(e=>{const{event:r,data:a}=e.data;switch(r){case"error":n=!0,s(a.error);break;case"ready":t=!0,i();break;default:{const{fakeId:e}=a;if(e in fi){const{cb:t,param:n,keepAlive:r,type:i}=fi[e]||{};if("setInterval"!==i&&delete fi[e],!r&&document.hidden)return;if("function"==typeof t)try{t.apply(window,n)}catch(e){console.error("Error when parse callback function, code %s",e)}}}}})),li.addEventListener("error",(function(e){console.error(e),n=!0,s(e)}))}catch(e){n=!0,s(e)}}return e},i=(e,i)=>{n?i&&i():t?e():r().then(e,i)};ui=function(e,t,n=!1,...r){if("function"!=typeof e)throw new Error("cb must be a function");const s=gi();return fi[s]={cb:e,param:r,keepAlive:!!n,type:"setInterval"},i((()=>{li.postMessage({action:"setInterval",fakeId:s,time:t})}),(()=>{s in fi&&(fi[s].degradeId=setInterval(e,t))})),s},hi=function(e){if("number"==typeof e&&e in fi){const{degradeId:t}=fi[e];delete fi[e],i((()=>{li.postMessage({action:"clearInterval",fakeId:e})}),(()=>{t&&clearInterval(t)}))}},ci=function(e,t,n=!0,...r){if("function"!=typeof e)throw new Error("cb must be a function");const s=gi();return fi[s]={cb:e,param:r,keepAlive:!!n,type:"setTimeout"},i((()=>{li.postMessage({action:"setTimeout",fakeId:s,time:t})}),(()=>{s in fi&&(fi[s].degradeId=setTimeout(e,t))})),s},di=function(e){if("number"==typeof e&&e in fi){const{degradeId:t}=fi[e];delete fi[e],i((()=>{li.postMessage({action:"clearTimeout",fakeId:e})}),(()=>{t&&clearTimeout(t)}))}}}else ui=setInterval,ci=setTimeout,hi=clearInterval,di=clearTimeout,console.error("the browser not support web worker, fallback to unWarp function!");Promise.withResolvers||(Promise.withResolvers=function(){const e={};return e.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n})),e});const mi="PRELOAD_NEXT",vi="PRELOAD_SEG_DONE",yi={PREPARE:"PREPARE",IDLE:"IDLE",PRELOADING:"PRELOADING",FINISH:"FINISH"},_i="ONE_STEP_DONE",Ti={INDEXDB:0,MEMORY:1},bi={FAIL:-1,SUCCESS:0,DOWNLOADING:1},Si={MP4:"MP4",DASH:"DASH",HLS:"HLS"},Pi=Object.freeze(Object.defineProperty({__proto__:null,CACHE_TYPES:Ti,DOWN_STATES:bi,MEDIA_FORMAT:{DASH:0,MP4:1},MEDIA_TYPES:{VIDEO:0,AUDIO:1,MIXED:2},ONE_STEP_DONE:_i,PRELOAD_NEXT:mi,PRELOAD_SEG_DONE:vi,PRELOAD_TYPES:{DURATION:0,SIZE:1},STATES:yi,VTYPES:Si},Symbol.toStringTag,{value:"Module"}));class wi extends U{constructor(e,t,n,r,i){super(),this.state=yi.PREPARE,this.options=e||{},this.logger=e.logger||function(){},this._preloadManager=t,this.player=t.player;const{handlers:s,predictInst:a,readyPromise:o}=n;this._predictInst=a,this._handlers=s,this._predictInstReadyPromise=o,this._toLoadList=[],this.retryCount=0,this._cachedHandler=r,this._cachedDataHandler=i,this.cnt=0}start(){const e=new ii;return this._handlers.start(this.options).then((t=>{t.onObtain().then((n=>{this._predictInstReadyPromise.then((()=>{this._predictInst.updateMediaInfos(n);const r=this._predictInst.preloadPredict(this.options),{cachedData:i}=this._predictInst;this._cachedDataHandler(Object.assign({vid:this.options.vid},{data:i}));const s=Object.assign(r,this.options);t.onTransform(s).then((t=>{this._toLoadList=t,e.resolve(t)}))}))}))})).catch((()=>{e.reject(new Error("preload unit start error"))})),e}preloadSeg(){if(0===this._toLoadList.length)return this.state=yi.FINISH,void this.emit(vi,!0);this.state="PRELOADING";const e=this._toLoadList.shift();this._handlers.onRequest(e,(t=>{const n=Object.assign({},e.extData,t);this._cachedHandler(n)})).then((()=>{this.state=yi.IDLE,this.emit(vi)})).catch((()=>{this.requestError(),this.emit(vi,!1)}))}requestError(){this.retryCount++,this.state=yi.IDLE,this.retryCount>=10&&(this.state=yi.FINISH),this.emit(_i),this.logger("preload request error")}cancelLoading(){this._toLoadList=[]}destroy(){this.removeAllListeners()}}const ki=function(){try{if(typeof indexedDB<"u")return indexedDB}catch{}}();function Mi(e,t){t||(t=()=>{}),t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function Ei(e){return"string"!=typeof e&&(console.warn(`${e} used as a key, but it is not a string.`),e=String(e)),e}const Ri={},xi="readonly",Di="readwrite";function Ii(e){const t=Ri[e.name],n={};n.promise=new Promise((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function Ci(e,t){return new Promise((function(n,r){if(Ri[e.name]=Ri[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);Ii(e),e.db.close()}const i=[e.name];t&&i.push(e.version);const s=null==ki?void 0:ki.open.apply(ki,i);t&&(s.onupgradeneeded=function(t){const n=s.result;try{n.createObjectStore(e.storeName)}catch(t){const n=t;if("ConstraintError"!==n.name)throw t;{const{oldVersion:t,newVersion:r}=n;console.warn(`The database "${e.name}" has been upgraded from version ${t} to\n            version ${r}, but the storage "${e.storeName}" already exists.`)}}}),s.onerror=function(e){e.preventDefault(),r(s.error)},s.onsuccess=function(){n(s.result),function(e){const t=Ri[e.name].deferredOperations.pop();t&&(t.resolve(),t.promise)}(e)}}))}function Li(e){return Ci(e,!1)}function Oi(e){return Ci(e,!0)}function Ai(e,t){if(!e.db)return!0;const n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn(`The database "${e.name}" can't be downgraded from version ${e.db.version} to\n      version ${e.version}.`),e.version=e.db.version),i||n){if(n){const t=e.db.version+1;t>e.version&&(e.version=t)}return!0}return!1}function Gi(e,t,n,r){var i;void 0===r&&(r=1);try{const r=null==(i=e.db)?void 0:i.transaction(e.storeName,t);n(null,r)}catch(i){const s=i;if(r>0&&(!e.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return Promise.resolve().then((()=>{if(!e.db||"NotFoundError"===s.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),Oi(e)})).then((()=>function(e){Ii(e);const t=Ri[e.name],{forages:n}=t;for(let e=0;e<n.length;e++){const t=n[e];t._dbInfo.db&&(t._dbInfo.db.close(),t._dbInfo.db=null)}return e.db=null,Li(e).then((t=>(e.db=t,Ai(e)?Oi(e):t))).then((r=>{e.db=t.db=r;for(let e=0;e<n.length;e++)n[e]._dbInfo.db=r})).catch((t=>{throw function(e,t){const n=Ri[e.name].deferredOperations.pop();n&&(n.reject(t),n.promise)}(e,t),t}))}(e).then((()=>{Gi(e,t,n,r-1)})))).catch(n);n(s)}}class Bi{ready(){return this._ready}_initStorage(e){const t=this;t._defaultConfig=e;const n={db:null,name:"",version:"",storeName:""};if(e)for(const t in e)n[t]=e[t];let r=Ri[n.name];r||(r={forages:[],db:null,dbReady:null,deferredOperations:[]},Ri[n.name]=r),r.forages.push(t),t._initReady||(t._initReady=t.ready,t._ready=t._fullyReady);const i=[];function s(){return Promise.resolve()}for(let e=0;e<r.forages.length;e++){const n=r.forages[e];n!==t&&i.push(n._initReady().catch(s))}const a=r.forages.slice(0);return t._ready=Promise.all(i).then((function(){return n.db=r.db,Li(n)})).then((function(e){return n.db=e,Ai(n,t._defaultConfig.version)?Oi(n):e})).then((function(e){n.db=r.db=e,t._dbInfo=n;for(let e=0;e<a.length;e++){const r=a[e];r!==t&&(r._dbInfo.db=n.db,r._dbInfo.version=n.version)}})),t._ready}get probeSupport(){return function(){try{if(null==ki||!ki.open)return!1;const e=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}()}getItem(e,t){const n=this;e=Ei(e);const r=new Promise((function(t,r){n.ready().then((function(){Gi(n._dbInfo,xi,(function(i,s){if(i)return r(i);const a=s;try{const i=a.objectStore(n._dbInfo.storeName).get(e);i.onsuccess=function(){let e=i.result;void 0===e&&(e=null),t(e)},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return Mi(r,t),r}setItem(e,t,n){const r=this;e=Ei(e);const i=new Promise((function(n,i){r.ready().then((function(){return r._dbInfo,t})).then((function(t){Gi(r._dbInfo,Di,(function(s,a){if(s)return i(s);const o=a;try{const s=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);const a=s.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e;const t=a.error?a.error:null==(e=a.transaction)?void 0:e.error;i(t)}}catch(e){i(e)}}))})).catch(i)}));return Mi(i,n),i}removeItem(e,t){const n=this;e=Ei(e);const r=new Promise((function(t,r){n.ready().then((function(){Gi(n._dbInfo,Di,(function(i,s){if(i)return r(i);const a=s;try{const i=a.objectStore(n._dbInfo.storeName).delete(e);a.oncomplete=function(){t()},a.onerror=function(){r(i.error)},a.onabort=function(){var e;const t=i.error?i.error:null==(e=i.transaction)?void 0:e.error;r(t)}}catch(e){r(e)}}))})).catch(r)}));return Mi(r,t),r}clear(e){const t=this,n=new Promise((function(e,n){t.ready().then((function(){Gi(t._dbInfo,Di,(function(r,i){if(r)return n(r);const s=i;try{const r=s.objectStore(t._dbInfo.storeName).clear();s.oncomplete=function(){e()},s.onabort=s.onerror=function(){var e;const t=r.error?r.error:null==(e=r.transaction)?void 0:e.error;n(t)}}catch(e){n(e)}}))})).catch(n)}));return Mi(n,e),n}length(e){const t=this,n=new Promise((function(e,n){t.ready().then((function(){Gi(t._dbInfo,xi,(function(r,i){if(r)return n(r);const s=i;try{const r=s.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return Mi(n,e),n}all(e){const t=this,n=new Promise((function(e,n){t.ready().then((function(){Gi(t._dbInfo,xi,(function(r,i){if(r)return n(r);const s=i;try{const r=s.objectStore(t._dbInfo.storeName).openCursor(),i=[];r.onsuccess=function(){const t=r.result;t?(i.push({key:t.key,value:t.value}),t.continue()):e(i)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return Mi(n,e),n}_fullyReady(e){const t=this,n=t._initReady().then((function(){const e=Ri[t._dbInfo.name];if(null!=e&&e.dbReady)return e.dbReady}));return function(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}(n,e,e),n}}class Ni{constructor(){this.key="",this.store={}}_initStorage(e){const{name:t}=e,{storeName:n}=e,r=`${t}_${n}`;return this.key=r,(!window[r]||"object"!=typeof window[r])&&(window[r]={}),this.store=window[r],Promise.resolve()}getItem(e,t){let n=this.store[e];return void 0===n&&(n=null),this._internalPromise(t,n)}setItem(e,t,n){return this.store[e]=t,this._internalPromise(n)}removeItem(e,t){return delete this.store[e],this._internalPromise(t)}clear(e){return this.store={},window[this.key]={},this._internalPromise(e)}length(e){const t=Object.keys(this.store).length;return this._internalPromise(e,t)}_internalPromise(e,t){const n=t?Promise.resolve(t):Promise.resolve();return Mi(n,e),n}all(e){const t=[],n=Object.keys(this.store);for(let e=0;e<n.length;e++){const r=n[e];t.push({key:r,value:this.store[r]})}return this._internalPromise(e,t)}probeSupport(){return!0}}const $i={description:"",name:"__PRE_CACHE__",storeName:"keyvaluepairs",version:1},Ui="__PRE_CACHE__KEYS";class Fi{constructor(e,t){const n=t===Ti.MEMORY?Ni:Bi;this._driver=new n,this._driver._initStorage($i).catch((()=>{})),this._hasIdbForbidden=!1,this._maxCache=!e||e<=0?200:e,this.setMaxCache(this._maxCache),this._allCachedKeys={},this._allCachedTimeKeys={},this.getCachedKeysFromLocal(),this._readyPromise=new ii,this.init()}getCachedKeysFromLocal(){const e=(e=>{try{return localStorage.getItem(e)}catch{return null}})(Ui);if(e){const t=e.split("|");for(let e=0;e<t.length;e++){const n=t[e],{time:r,cachedKey:i}=this._getCacheKeyInfos(n);this._allCachedKeys[i]=1,this._allCachedTimeKeys[i]=r}}}_getCacheKeyInfos(e){const t=e.split("$");let n;return 2===t.length&&(n=t[0],e=t[1]),{time:n,cachedKey:e}}writeCachedKeysToLocal(e){const t=[];this._allCachedKeys={},this._allCachedTimeKeys={};for(let n=0;n<e.length;n++){const r=e[n].key,{time:i,cachedKey:s}=this._getCacheKeyInfos(r);this._allCachedKeys[s]=1,this._allCachedTimeKeys[s]=i,t.push(r)}const n=t.join("|");((e,t)=>{try{localStorage.setItem(e,t)}catch{}})(Ui,n)}init(){this._driver.setItem("test","test").then((()=>{})).catch((()=>{this._hasIdbForbidden=!0})).finally((()=>{this._driver.removeItem("test").catch((()=>{})),this._hasIdbForbidden&&(this._driver=new Ni,this._driver._initStorage($i)),this._getAll(),this._readyPromise.resolve()}))}_getAll(){this._driver.all().then((e=>{const t=e.length-this._maxCache;let n=e;if(t>0){const r=e.slice(0,t);n=e.slice(t);for(let e=0;e<r.length;e++)this.removeItem(r[e].key).then((()=>{}))}this.writeCachedKeysToLocal(n)})).catch((()=>{}))}getItem(e,t){if(!this.hasItem(e))return Promise.resolve(!1);const{timeKey:n}=this._getTimeKey(e);return this._driver.getItem(n,t)}setItem(e,t,n){const{timeKey:r}=this._getTimeKey(e);r&&this.removeItem(e);const i=(new Date).getTime();this._allCachedKeys[e]=1,this._allCachedTimeKeys[e]=i;const s=this._genTimeKey(e,i);return n=n?()=>{this._getAll(),n()}:()=>{this._getAll()},this._driver.setItem(s,t,n)}_getTimeKey(e){const t=this._allCachedTimeKeys[e];let n=e;return t&&(n=this._genTimeKey(e,t)),{timeKey:n,time:t}}_genTimeKey(e,t){return`${t}$${e}`}removeItem(e,t){const{timeKey:n}=this._getTimeKey(e),r=this._driver.removeItem(n,t);return delete this._allCachedKeys[e],delete this._allCachedTimeKeys[e],r}hasItem(e){return!!this._allCachedKeys[e]}clear(e){return this._driver.clear(e)}length(e){return this._driver.length(e)}setMaxCache(e){"number"==typeof e&&e>0&&(this._maxCache=e)}}const Hi=class e extends U{constructor(e,t,n=null){super(),this._preloadDataList=[],this._currentPreloadInst=null,this.autoPreload=e.autoPreload||!1,this._autoCheck=e.autoCheck||{enable:!1,interval:1e3},this._onPreloadNext=this.onPreloadNextReady.bind(this),this.on(mi,this._onPreloadNext),this._preloaderConfigs={},this.update(e,t,n),this._cacheInst=new Fi(e.preloadMaxCacheCount,e.preloadCacheType||0),this._preloadCacheProgress={},this._ptag_=!0,this._cachedDatas={},this._taskIntervalId=null}setMaxCache(e){var t;null==(t=this._cacheInst)||t.setMaxCache(e)}startCheckTask(){const{_autoCheck:e,_preloadDataList:t}=this;this._taskIntervalId&&(window.clearTimeout(this._taskIntervalId),this._taskIntervalId=null),0!==t.length&&(this._checkIfCanPreload()&&this.onPreloadNext(),this._taskIntervalId=window.setTimeout((()=>{this.startCheckTask()}),e.interval||1e3))}stopCheckTask(){this._taskIntervalId&&(window.clearTimeout(this._taskIntervalId),this._taskIntervalId=null)}_checkIfCanPreload(){if(null==this._currentPreloadInst&&this._preloadDataList.length>0){const e=this._preloadDataList[0].data;if(e.payload){const t=this._getPreloaderKey(e),n=this._preloaderConfigs[t];if(null!=n&&n.handlers){const{checkIfCanPreload:t}=n.handlers;return t?t(e):(this.stopCheckTask(),!1)}return console.warn("need to set vtype, no preloader",e),this.stopCheckTask(),!1}}return!1}_getPreloaderKey(e){return e.vtype?e.vtype:"DEFAULT"}update(e,t,n){if(!n)throw new Error("PreloaderManager predictInst is null");const r=this._getPreloaderKey(e);this._preloaderConfigs[r]={predictInst:n,readyPromise:n.init(e),handlers:t}}get cachedDatas(){return this._cachedDatas}onCacheSegment(e){const{vid:t,format:n,cacheKey:r,total:i,loaded:s,isInitSegment:a,mediaType:o}=e,l=this.getProgressCacheKey(t,n,o);let u=this._preloadCacheProgress[l];u||(u=this._preloadCacheProgress[l]={}),u[r]={total:i,loaded:s,isInitSegment:a}}onCachePredict(e){const{vid:t,data:n}=e;t&&n&&(this._cachedDatas[t]=n)}getProgressCacheKey(e,t,n){return`${e}-${t}-${n}`}onPreloadNextReady(){this.onPreloadNext()}onPreloadSegDone(){this.autoPreload&&this.emit(mi)}onPreloadNext(){if(null==this._currentPreloadInst&&this._preloadDataList.length>0){if(this._preloadDataList.length>0){const e=this._preloadDataList.shift(),t=null==e?void 0:e.data;if(null!=t&&t.payload){const e=this._getPreloaderKey(t),n=this._preloaderConfigs[e];if(!n)return void console.warn("need to set vtype, no preloader",t);this._currentPreloadInst=new wi(t,this,n,(e=>{this.onCacheSegment(e)}),(e=>{this.onCachePredict(e)})),this._currentPreloadInst.on(vi,this.onPreloadSegDone.bind(this)),this._currentPreloadInst.start().then((()=>{this._currentPreloadInst.preloadSeg()})).catch((()=>{this._currentPreloadInst=null}))}}}else null!=this._currentPreloadInst&&(this._currentPreloadInst.state===yi.IDLE?this._currentPreloadInst.preloadSeg():this._currentPreloadInst.state===yi.FINISH?(this._currentPreloadInst.destroy(),this._currentPreloadInst=null):this._currentPreloadInst.state===yi.PREPARE&&(this._currentPreloadInst.cnt++,this._currentPreloadInst.cnt>2&&(this._currentPreloadInst.destroy(),this._currentPreloadInst=null)))}addDashPreloader(e){e.data&&(this._preloadDataList.push(e),this.sort(this._preloadDataList),this.autoPreload&&this.emit(mi),this._autoCheck.enable&&!this._taskIntervalId&&this.startCheckTask())}_addDashPreloader(e){e.data&&this._preloadDataList.push(e)}addDashPreloaderList(e=[]){this.sort(e);for(let t=0;t<e.length;t++)this._addDashPreloader(e[t]);this._autoCheck.enable&&!this._taskIntervalId&&this.startCheckTask()}sort(e){e.sort(((e,t)=>void 0===e.order&&void 0===e.order||"number"==typeof e.order&&"number"==typeof t.order&&e.order<t.order?-1:1))}destroy(){this.off(mi,this._onPreloadNext)}cancelLoading(){this._currentPreloadInst&&(this._currentPreloadInst.cancelLoading(),this._currentPreloadInst=null),this._preloadDataList=[]}static getInstance(t,n,r=null){const i=e.GLOBAL_KEY+(t.globalKey?t.globalKey:""),s=window[i];if(null!=s&&s._ptag_)return s.update(t,n,r),s;const a=new e(t,n,r);return window[i]=a,a}preloadCacheProgress(e){const{vid:t,format:n,mediaType:r,prelaodType:i,bitrate:s,set_duration:a,set_size:o,media_type:l,start_time:u}=e,c=this.getProgressCacheKey(t,n,r),h=this._preloadCacheProgress[c];if(h){const e=Object.values(h);let t=0,n=0,r=0,c=0,d=0;for(let i=0;i<e.length;i++){const s=e[i];s.isInitSegment&&(t=s.total,r=s.loaded,c=s.loaded===s.total?bi.SUCCESS:bi.DOWNLOADING),n+=s.total,d+=s.loaded}return{media_type:l,preload_type:i,stream_bitrate:s,header_size:t,content_total_size:n,start_time:u||-1,state_info:{set_duration:a,set_size:o,current_header_download_size:r,current_content_download_size:d,header_download_state:c,content_download_state:d===n?bi.SUCCESS:bi.DOWNLOADING}}}return null}getPreloadTaskInfos(){}getItem(e,t){return this._cacheInst.getItem(e,t)}setItem(e,t,n){return this._cacheInst.setItem(e,t,n)}removeItem(e,t){return this._cacheInst.removeItem(e,t)}};Hi.GLOBAL_KEY="__preloadcontext__";let Vi=Hi;class ji extends U{constructor(e){super(),this.options=e,this.promisePolyfill(),this.before(),this.check(),this._preloadManager=Vi.getInstance(e,this.handlers,this.predictInst),this.loadingTasks=[]}promisePolyfill(){Promise.prototype.finally||(Promise.prototype.finally={finally(e){const t=t=>Promise.resolve(e()).then(t);return this.then((e=>t((()=>e))),(e=>t((()=>Promise.reject(e)))))}}.finally)}before(){throw new Error("need")}check(){if(!this.handlers)throw new Error("handlers null");if(!this.handlers.start||!this.handlers.onRequest)throw new Error("handlers callback null");if(!this.predictInst)throw new Error("predictInst null");if(!this.predictInst.__p__)throw new Error("predictInst need extends predictbase")}preloadNext(){this._preloadManager.emit(mi)}get preloadManager(){return this._preloadManager}start(){throw new Error("start need implment, return Promise")}cancelLoading(){for(let e=0;e<this.loadingTasks.length;e++)try{const t=this.loadingTasks[e];"function"==typeof t.cancel&&t.cancel()}catch{}this.loadingTasks=[],this._preloadManager.cancelLoading()}addTasker(e){this.loadingTasks.push(e)}removeTasker(e){setTimeout((()=>{for(let t=this.loadingTasks.length-1;t>-1;t--)if(this.loadingTasks[t]===e){this.loadingTasks.splice(t,1);break}}))}addDashPreloader(e){this._preloadManager.addDashPreloader(e)}addDashPreloaderList(e=[]){this._preloadManager.addDashPreloaderList(e)}}class zi{constructor(){this.bandwidth2item={},this._mediaInfos=void 0,this.__p__=!0}init(){throw new Error("init func not implement, return promise")}preloadPredict(e){throw new Error(`preloadPredict error: ${e}`)}updateMediaInfos(e){if(this._mediaInfos=e,this.bandwidth2item={},this.dynamic_video=e.dynamic_video_list,this.dynamic_video.length>0)for(let e=0;e<this.dynamic_video.length;e++){const t=this.dynamic_video[e],n=(null==t?void 0:t.bitrate)||(null==t?void 0:t.bandwidth);this.bandwidth2item[n]=t}}getIdx(e,t){let n=0;return e.forEach(((e,r)=>{e.definition===t&&(n=r)})),n}get cachedData(){return null}}const Xi=Si;var Ki=n(23722);function Wi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Qi(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function qi(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){Qi(s,r,i,a,o,"next",e)}function o(e){Qi(s,r,i,a,o,"throw",e)}a(void 0)}))}}function Yi(e,t,n){return t=ns(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,rs()?Reflect.construct(t,n||[],ns(e).constructor):t.apply(e,n))}function Ji(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Zi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,cs(r.key),r)}}function es(e,t,n){return t&&Zi(e.prototype,t),n&&Zi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ts(e,t,n){return(t=cs(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ns(e){return(ns=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rs(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(rs=function(){return!!e})()}function is(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ss(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?is(Object(n),!0).forEach((function(t){ts(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):is(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function as(e){throw new TypeError('"'+e+'" is read-only')}function os(){os=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var s=t&&t.prototype instanceof v?t:v,a=Object.create(s.prototype),o=new D(r||[]);return i(a,"_invoke",{value:M(e,n,o)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var d="suspendedStart",f="suspendedYield",p="executing",g="completed",m={};function v(){}function y(){}function _(){}var T={};u(T,a,(function(){return this}));var b=Object.getPrototypeOf,S=b&&b(b(I([])));S&&S!==n&&r.call(S,a)&&(T=S);var P=_.prototype=v.prototype=Object.create(T);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(i,s,a,o){var l=h(e[i],e,s);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)})):t.resolve(c).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,o)}))}o(l.arg)}var s;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return s=s?s.then(i,i):i()}})}function M(t,n,r){var i=d;return function(s,a){if(i===p)throw Error("Generator is already running");if(i===g){if("throw"===s)throw a;return{value:e,done:!0}}for(r.method=s,r.arg=a;;){var o=r.delegate;if(o){var l=E(o,r);if(l){if(l===m)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?g:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=g,r.method="throw",r.arg=u.arg)}}}function E(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var s=h(i,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,m;var a=s.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function I(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(typeof t+" is not iterable")}return y.prototype=_,i(P,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:y,configurable:!0}),y.displayName=u(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,u(e,l,"GeneratorFunction")),e.prototype=Object.create(P),e},t.awrap=function(e){return{__await:e}},w(k.prototype),u(k.prototype,o,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var a=new k(c(e,n,r,i),s);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(P),u(P,l,"Generator"),u(P,a,(function(){return this})),u(P,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=I,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return o.type="throw",o.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:I(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function ls(e,t){return(ls=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function us(e){return function(e){if(Array.isArray(e))return Wi(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||hs(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cs(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}function hs(e,t){if(e){if("string"==typeof e)return Wi(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wi(e,t):void 0}}var ds="fetch",fs="arraybuffer",ps="text",gs=function(e){function t(e,n,r,i){var s;return wr(this,t),Er(s=Pr(this,t,[i]),"retryCount",0),Er(s,"isTimeout",!1),Er(s,"loaderType",ds),Er(s,"startTime",0),Er(s,"endTime",0),Er(s,"options",{}),s.url=e,s.request=n,s.response=r,s}return Dr(t,e),Mr(t)}(Nr(Error)),ms=Object.prototype.toString;function vs(e){if("[object Object]"!==ms.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function ys(e){if(e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function _s(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ts(e,t){if(e){if(!t)return e;var n,r=Object.keys(t).map((function(e){if(null!=(n=t[e]))return Array.isArray(n)?e+="[]":n=[n],n.map((function(t){var n;return n=t,"[object Date]"===ms.call(n)?t=t.toISOString():function(e){return null!==e&&"object"===Br(e)}(t)&&(t=JSON.stringify(t)),"".concat(_s(e),"=").concat(_s(t))})).join("&")})).filter(Boolean).join("&");if(r){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}}function bs(e,t,n,r,i,s,a,o,l,u,c){return i=null!=i?parseFloat(i):null,r=parseInt(r||"0",10),Number.isNaN(r)&&(r=0),{data:e,done:t,options:{range:l,vid:u,index:o,contentLength:r,age:i,startTime:s,firstByteTime:a,endTime:Date.now(),priOptions:c},response:n}}function Ss(e,t){return Math.round(8*e*1e3/t/1024)}var Ps="real_time_speed",ws=2097152,ks=function(e){function t(){var e;return wr(this,t),Er(e=Pr(this,t),"_abortController",null),Er(e,"_timeoutTimer",null),Er(e,"_reader",null),Er(e,"_response",null),Er(e,"_aborted",!1),Er(e,"_index",-1),Er(e,"_range",null),Er(e,"_receivedLength",0),Er(e,"_running",!1),Er(e,"_logger",null),Er(e,"_vid",""),Er(e,"_onProcessMinLen",0),Er(e,"_onCancel",null),Er(e,"_priOptions",null),Er(e,"_processMaxGapTime",1/0),e}return Dr(t,e),Mr(t,[{key:"load",value:function(e){var t,n=this,r=e.url,i=e.vid,s=e.timeout,a=e.responseType,o=e.onProgress,l=e.index,u=e.onTimeout,c=e.onCancel,h=e.range,d=e.transformResponse,f=e.request,p=e.params,g=e.logger,m=e.method,v=e.headers,y=e.body,_=e.mode,T=e.credentials,b=e.cache,S=e.redirect,P=e.referrer,w=e.referrerPolicy,k=e.onProcessMinLen,M=e.processMaxGapTime,E=e.priOptions;this._logger=g,this._aborted=!1,this._onProcessMinLen=k,this._onCancel=c,this._abortController="undefined"!=typeof AbortController&&new AbortController,this._running=!0,this._receivedLength=0,this._index=l,this._range=h||[0,0],this._vid=i||r,this._priOptions=E||{},this._processMaxGapTime=M;var R={method:m,headers:v,body:y,mode:_,credentials:T,cache:b,redirect:S,referrer:P,referrerPolicy:w,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},x=!1;clearTimeout(this._timeoutTimer),r=Ts(r,p);var D=ys(h);D&&(v=f?f.headers:R.headers=R.headers||(Headers?new Headers:{}),Headers&&v instanceof Headers?v.append("Range",D):v.Range=D),s&&(this._timeoutTimer=setTimeout(Sr(Or().mark((function e(){var t;return Or().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x=!0,e.next=3,n.cancel();case 3:u&&((t=new gs(r,R,null,"timeout")).isTimeout=!0,u(t,{index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions}));case 4:case"end":return e.stop()}}),e)}))),s));var I=Date.now();return this._logger.debug("[fetch load start], index,",l,",range,",h),new Promise((function(e,t){fetch(f||r,f?void 0:R).then(function(){var i=Sr(Or().mark((function i(s){var u,c,f,p;return Or().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(clearTimeout(n._timeoutTimer),n._response=s,!n._aborted&&n._running){i.next=4;break}return i.abrupt("return");case 4:if(d&&(s=d(s,r)||s),s.ok){i.next=7;break}throw new gs(r,R,s,"bad network response");case 7:if(u=Date.now(),a!==ps){i.next=15;break}return i.next=11,s.text();case 11:c=i.sent,n._running=!1,i.next=37;break;case 15:if("json"!==a){i.next=22;break}return i.next=18,s.json();case 18:c=i.sent,n._running=!1,i.next=37;break;case 22:if(!o){i.next=29;break}return n.resolve=e,n.reject=t,n._loadChunk(s,o,I,u),i.abrupt("return");case 29:return i.next=31,s.arrayBuffer();case 31:c=i.sent,c=new Uint8Array(c),n._running=!1,f=Date.now()-I,p=Ss(c.byteLength,f),n.emit(Ps,{speed:p,len:c.byteLength,time:f,vid:n._vid,index:n._index,range:n._range,priOptions:n._priOptions});case 37:n._logger.debug("[fetch load end], index,",l,",range,",h),e(bs(c,!0,s,s.headers.get("Content-Length"),s.headers.get("age"),I,u,l,h,n._vid,n._priOptions));case 39:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()).catch((function(e){var i;clearTimeout(n._timeoutTimer),n._running=!1,n._aborted&&!x||((e=e instanceof gs?e:new gs(r,R,null,null===(i=e)||void 0===i?void 0:i.message)).startTime=I,e.endTime=Date.now(),e.isTimeout=x,e.options={index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions},t(e))}))}))}},{key:"cancel",value:(n=Sr(Or().mark((function e(){return Or().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(e){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return n.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,n,r){var i=this;if(!e.body||!e.body.getReader){this._running=!1;var s=new gs(e.url,"",e,"onProgress of bad response.body.getReader");return s.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},void this.reject(s)}this._onProcessMinLen>0&&(this._cache=new Uint8Array(ws),this._writeIdx=0);var a,o,l,u=this._reader=e.body.getReader(),c=Date.now(),h=function(){var s=Sr(Or().mark((function s(){var d,f,p,g,m,v,y,_,T;return Or().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o=Date.now(),s.prev=1,s.next=4,u.read();case 4:a=s.sent,l=Date.now(),s.next=13;break;case 8:return s.prev=8,s.t0=s.catch(1),l=Date.now(),i._aborted||(i._running=!1,s.t0.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i.reject(s.t0)),s.abrupt("return");case 13:if(f=(null===(d=i._range)||void 0===d?void 0:d.length)>0?i._range[0]:0,p=f+i._receivedLength,!i._aborted){s.next=19;break}return i._running=!1,t(void 0,!1,{range:[p,p],vid:i._vid,index:i._index,startTime:o,endTime:l,st:n,firstByteTime:r,priOptions:i._priOptions},e),s.abrupt("return");case 19:if(g=a.value?a.value.byteLength:0,i._receivedLength+=g,i._onProcessMinLen>0?i._writeIdx+g>=i._onProcessMinLen||a.done?((m=new Uint8Array(i._writeIdx+g)).set(i._cache.subarray(0,i._writeIdx),0),g>0&&m.set(a.value,i._writeIdx),i._writeIdx=0,i._logger.debug("【fetchLoader,onProgress enough】,done,",a.done,",len,",m.byteLength,", writeIdx,",i._writeIdx)):g>0&&i._writeIdx+g<ws?(i._cache.set(a.value,i._writeIdx),i._writeIdx+=g,i._logger.debug("【fetchLoader,onProgress cache】,len,",g,", writeIdx,",i._writeIdx)):g>0&&(v=new Uint8Array(i._writeIdx+g+2048),i._logger.debug("【fetchLoader,onProgress extra start】,size,",i._writeIdx+g+2048,", datalen,",g,", writeIdx,",i._writeIdx),v.set(i._cache.subarray(0,i._writeIdx),0),g>0&&v.set(a.value,i._writeIdx),i._writeIdx+=g,delete i._cache,i._cache=v,i._logger.debug("【fetchLoader,onProgress extra end】,len,",g,", writeIdx,",i._writeIdx)):m=a.value,!(m&&m.byteLength>0||a.done)){s.next=28;break}i._logger.debug("【fetchLoader,onProgress call】,task,",i._range,", start,",p,", end,",f+i._receivedLength,", done,",a.done,n),t(m,a.done,{range:[i._range[0]+i._receivedLength-(m?m.byteLength:0),i._range[0]+i._receivedLength],vid:i._vid,index:i._index,startTime:o,endTime:l,st:n,firstByteTime:r,priOptions:i._priOptions},e),c=Date.now(),s.next=37;break;case 28:if(!(Date.now()-c>=i._processMaxGapTime)){s.next=37;break}return i._logger.debug("[onProgress timeout],task: ".concat(JSON.stringify(i._range)," done: ").concat(a.done," processMaxGapTime: ").concat(i._processMaxGapTime)),(y=new gs(e.url,null,e,"process timeout")).options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i.running=!1,s.next=35,i.cancel();case 35:return i.reject(y),s.abrupt("return");case 37:a.done?(_=Date.now()-n,T=Ss(i._receivedLength,_),i.emit(Ps,{speed:T,len:i._receivedLength,time:_,vid:i._vid,index:i._index,range:i._range,priOptions:i._priOptions}),i._running=!1,i._logger.debug("[fetchLoader onProgress end],task,",i._range,",done,",a.done),i.resolve(bs(a,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),n,r,i._index,i._range,i._vid,i._priOptions))):h();case 38:case"end":return s.stop()}}),s,null,[[1,8]])})));return function(){return s.apply(this,arguments)}}();h()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return!("undefined"==typeof fetch)}}]);var n}(F()),Ms=function(e){function t(){var e;return wr(this,t),Er(e=Pr(this,t),"_xhr",null),Er(e,"_aborted",!1),Er(e,"_timeoutTimer",null),Er(e,"_range",null),Er(e,"_receivedLength",0),Er(e,"_url",null),Er(e,"_onProgress",null),Er(e,"_index",-1),Er(e,"_headers",null),Er(e,"_currentChunkSizeKB",384),Er(e,"_timeout",null),Er(e,"_xhr",null),Er(e,"_withCredentials",null),Er(e,"_startTime",-1),Er(e,"_loadCompleteResolve",null),Er(e,"_loadCompleteReject",null),Er(e,"_runing",!1),Er(e,"_logger",!1),Er(e,"_vid",""),Er(e,"_responseType",void 0),Er(e,"_credentials",void 0),Er(e,"_method",void 0),Er(e,"_transformResponse",void 0),Er(e,"_firstRtt",void 0),Er(e,"_onCancel",null),Er(e,"_priOptions",null),e}return Dr(t,e),Mr(t,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=Ts(e.url,e.params);var n=Date.now();return new Promise((function(e,n){t._loadCompleteResolve=e,t._loadCompleteReject=n,t._startLoad()})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted)throw(e=e instanceof gs?e:new gs(t._url,t._request)).startTime=n,e.endTime=Date.now(),e.options={index:t._index,vid:t._vid,priOptions:t._priOptions},e}))}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===fs&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var t=1024*this._currentChunkSizeKB,n=this._range[0]+this._receivedLength,r=this._range[1];t<this._range[1]-n&&(r=n+t),e=[n,r],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var t=this;try{this._startTime=Date.now();var n=this._xhr=new XMLHttpRequest;n.open(this._method||"GET",this._url,!0),n.responseType=this._responseType,this._timeout&&(n.timeout=this._timeout),n.withCredentials=this._withCredentials,n.onload=this._onLoad.bind(this),n.onreadystatechange=this._onReadyStatechange.bind(this),n.onerror=function(e){var n,r,i;t._running=!1;var s=new gs(t._url,t._request,null==e||null===(n=e.currentTarget)||void 0===n?void 0:n.response,"xhr.onerror.status:"+(null==e||null===(r=e.currentTarget)||void 0===r?void 0:r.status)+",statusText,"+(null==e||null===(i=e.currentTarget)||void 0===i?void 0:i.statusText));s.options={index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions},t._loadCompleteReject(s)},n.ontimeout=function(e){t.cancel();var n=new gs(t._url,t._request,{status:408},"timeout");t._onTimeout&&(n.isTimeout=!0,t._onTimeout(n,{index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions})),n.options={index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions},t._loadCompleteReject(n)};var r=this._headers||{},i=ys(e);i&&(r.Range=i),r&&Object.keys(r).forEach((function(e){n.setRequestHeader(e,r[e])})),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),n.send(this._body)}catch(t){t.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(t)}}},{key:"_onReadyStatechange",value:function(e){2===e.target.readyState&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t,n=e.target.status;if(n<200||n>299){var r=new gs(this._url,null,Lr(Lr({},e.target.response),{},{status:n}),"bad response,status:"+n);return r.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(r)}var i,s=null,a=!1,o=(null===(t=this._range)||void 0===t?void 0:t.length)>0?this._range[0]:0;if(this._responseType===fs){var l,u=new Uint8Array(e.target.response);if(i=o+this._receivedLength,u&&u.byteLength>0){this._receivedLength+=u.byteLength;var c=Date.now()-this._startTime,h=Ss(this._receivedLength,c);this.emit(Ps,{speed:h,len:this._receivedLength,time:c,vid:this._vid,index:this._index,range:[i,o+this._receivedLength],priOptions:this._priOptions})}s=u,a=!((null===(l=this._range)||void 0===l?void 0:l.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._logger.debug("[xhr load done->], tast :",this._range,", start",i,"end ",o+this._receivedLength,",dataLen,",u?u.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",a)}else a=!0,s=e.target.response;var d={ok:n>=200&&n<300,status:n,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(d=this._transformResponse(d,this._url)||d),this._onProgress&&this._onProgress(s,a,{index:this._index,vid:this._vid,range:[i,o+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},d),a?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(bs(this._onProgress?null:s,a,d,d.headers["content-length"],d.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._runing=!1,(e=this,"function"==typeof(n=Rr(xr(t.prototype),"removeAllListeners",e))?function(t){return n.apply(e,t)}:n)([]),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr?this._xhr.abort():void 0;var e,n}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,n={},r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Tr(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}(e.getAllResponseHeaders().trim().split("\r\n"));try{for(r.s();!(t=r.n()).done;){var i=t.value.split(": ");n[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(e){r.e(e)}finally{r.f()}return n}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}])}(F()),Es=["retry","retryDelay","onRetryError","transformError"],Rs=function(){return Mr((function e(t,n){wr(this,e),this.promise=Yr(),this.alive=!!n.onProgress,!n.logger&&(n.logger=new Fr("Loader")),this._loaderType=t,this._loader=t===ds&&"undefined"!=typeof fetch?new ks:new Ms,this._config=n,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=n.retryCheckFunc,this._logger=n.logger}),[{key:"exec",value:function(){var e=this,t=this._config,n=t.retry,r=t.retryDelay,i=t.onRetryError,s=t.transformError,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(t,Es),o=function(){var t=Sr(Or().mark((function t(){var l,u,c;return Or().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(a);case 3:l=t.sent,e.promise.resolve(l),t.next=27;break;case 7:if(t.prev=7,t.t0=t.catch(0),e._loader.running=!1,e._logger.debug("[task request catch err]",t.t0),!e._canceled){t.next=13;break}return t.abrupt("return");case 13:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,u=t.t0,s&&(u=s(u)||u),i&&e._retryCount>0&&i(u,e._retryCount,{index:a.index,vid:a.vid,range:a.range,priOptions:a.priOptions}),e._retryCount++,c=!0,e._retryCheckFunc&&(c=e._retryCheckFunc(t.t0)),!(c&&e._retryCount<=n)){t.next=26;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",a.range),e._retryTimer=setTimeout(o,r),t.abrupt("return");case 26:e.promise.reject(u);case 27:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return o(),this.promise}},{key:"cancel",value:(e=Sr(Or().mark((function e(){return Or().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]);var e}(),xs=10;function Ds(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if((t=t.filter(Boolean)).length<2)return t[0];var r=t.reduce((function(e,t){return e+t.byteLength}),0),i=Is(r),s=0;return t.forEach((function(e){i.set(e,s),s+=e.byteLength})),i}function Is(e){for(var t,n=0;n<xs;)try{if((t=new Uint8Array(e))&&t.byteLength>0)break;n++}catch(e){if(!(n<xs))throw new Error("new array failed final,".concat(null==e?void 0:e.message));n++}return t}function Cs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var Ls=function(e){function t(e){var n;return wr(this,t),Er(n=Pr(this,t,[e]),"type",ds),Er(n,"_queue",[]),Er(n,"_alive",[]),Er(n,"_currentTask",null),Er(n,"_finnalUrl",""),Er(n,"_config",void 0),n._config=function(e){return Lr({loaderType:ds,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ps,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0,processMaxGapTime:1/0},e)}(e),"xhr"!==n._config.loaderType&&ks.isSupported()||(n.type="xhr"),n.log=e.logger,n}return Dr(t,e),Mr(t,[{key:"isFetch",value:function(){return this.type===ds}},{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?n=e:n.url=e||n.url||this._config.url,(n=Object.assign({},this._config,n)).params&&(n.params=Object.assign({},n.params)),n.headers&&vs(n.headers)&&(n.headers=Object.assign({},n.headers)),n.body&&vs(n.body)&&(n.body=Object.assign({},n.body)),n.transformRequest&&(n=n.transformRequest(n)||n),n.logger=this.log;var r=new Rs(this.type,n);return r.loader.on(Ps,(function(e){t.emit(Ps,e)})),this._queue.push(r),1!==this._queue.length||this._currentTask&&this._currentTask.running||this._processTask(),r.promise}},{key:"cancel",value:(n=Sr(Or().mark((function e(){var t;return Or().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,Cs();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var t=this._currentTask.exec().catch((function(e){}));t&&"function"==typeof t.finally&&t.finally((function(){var t,n;null!==(t=e._currentTask)&&void 0!==t&&t.alive&&(null===(n=e._alive)||void 0===n?void 0:n.length)>0&&(e._alive=e._alive.filter((function(t){return t&&t!==e._currentTask}))),e._processTask()}))}}}],[{key:"isFetchSupport",value:function(){return ks.isSupported()}}]);var n}(F());function Os(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function As(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gs(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Us(r.key),r)}}function Bs(e,t,n){return t&&Gs(e.prototype,t),n&&Gs(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ns(e,t,n){return(t=Us(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $s(e){return function(e){if(Array.isArray(e))return Os(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Fs(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Us(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}function Fs(e,t){if(e){if("string"==typeof e)return Os(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Os(e,t):void 0}}function Hs(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t=t.filter(Boolean);var r=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){r.set(e,i),i+=e.byteLength})),r}var Vs=Math.pow(2,32);function js(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<8)+(e[t+1]||0)}function zs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function Xs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new DataView(e.buffer,e.byteOffset,e.byteLength).getInt32(t)}function Ks(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return zs(e,t)*Vs+zs(e,t+4)}function Ws(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getUint32(t)<<32|n.getUint32(t+4)}function Qs(e){if(!Array.isArray(e)){for(var t=[],n="",r=0;r<e.length;r++)r%2&&(n=e[r-1]+e[r],t.push(parseInt(n,16)),n="");return t}return e.map((function(e){return parseInt(e,16)}))}function qs(e,t){return Number(e+"."+t)}var Ys="undefined"!=typeof window,Js=Ys&&navigator.userAgent.toLocaleLowerCase(),Zs=(Ys&&/^((?!chrome|android).)*safari/.test(Js),Ys&&Js.includes("firefox")),ea=Ys&&Js.includes("android"),ta=function(){function e(){As(this,e)}return Bs(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,n){for(var r=t.length,i=0;i+2<r&&(255!==t[i]||240!=(246&t[i+1]));)i++;if(!(i>=r)){var s=i,a=[],o=(60&t[i+2])>>>2,l=e.FREQ[o];if(!l)throw new Error("Invalid sampling index: ".concat(o));for(var u,c,h=1+((192&t[i+2])>>>6),d=(1&t[i+2])<<2|(192&t[i+3])>>>6,f=e._getConfig(o,d,h),p=f.config,g=f.codec,m=0,v=e.getFrameDuration(l);i+7<r;)if(255===t[i]&&240==(246&t[i+1])){if(!(c=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>5)||r-i<c)break;u=2*(1&~t[i+1]),a.push({pts:n+m*v,data:t.subarray(i+7+u,i+c)}),m++,i+=c}else i++;return{skip:s,remaining:i>=r?void 0:t.subarray(i),frames:a,samplingFrequencyIndex:o,sampleRate:l,objectType:h,channelCount:d,codec:g,config:p,originCodec:"mp4a.40.".concat(h)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var n=t[0]>>>3,r=(7&t[0])<<1|t[1]>>>7,i=(120&t[1])>>>3,s=e.FREQ[r];if(s){var a=e._getConfig(r,i,n),o=a.config,l=a.codec;return t.length>=4&&695==(t[2]<<3|(224&t[3])>>5)&&(128&t[4])>>7&&(n=31&t[3]),{samplingFrequencyIndex:r,sampleRate:s,objectType:n,channelCount:i,config:o,codec:l,originCodec:"mp4a.40.".concat(n)}}}}},{key:"getFrameDuration",value:function(e){return 1024*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4)/e}},{key:"_getConfig",value:function(e,t,n){var r,i,s=[];return Zs?e>=6?(r=5,i=e-3):(r=2,i=e):ea?(r=2,i=e):(r=2===n||5===n?n:5,i=e,e>=6?i=e-3:1===t&&(r=2,i=e)),s[0]=r<<3,s[0]|=(14&e)>>1,s[1]=(1&e)<<7,s[1]|=t<<3,5===r&&(s[1]|=(14&i)>>1,s[2]=(1&i)<<7,s[2]|=8,s[3]=0),{config:s,codec:"mp4a.40.".concat(r)}}},{key:"getSilentFrame",value:function(e,t,n){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if("mp4a.40.5"===e&&2===t&&22050===n)return new Uint8Array([33,17,69,0,20,80,1,70,173,200,65,117,0,0,0,28,96,24,13,230,66,20,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,188]);if("mp40.40.5"===e&&2===t&&24e3===n)return new Uint8Array([33,17,69,0,20,80,1,70,173,200,65,117,0,0,0,28,96,24,13,229,98,20,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,188]);if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}])}();Ns(ta,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var na=function(){return Bs((function e(t){if(As(this,e),Ns(this,"_bytesAvailable",void 0),Ns(this,"_bitsAvailable",0),Ns(this,"_word",0),!t)throw new Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}),[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var n=new Uint8Array(4);n.set(this._data.subarray(e,e+t)),this._word=new DataView(n.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"bitsPos",value:function(){return 8*this._bytesAvailable-this._bitsAvailable}},{key:"bitsLeft",value:function(){return 8*this._data.length-this.bitsPos()}},{key:"byteAligned",value:function(){return 0===this.bitsPos()||this.bitsPos()%8==0}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),n=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),(t=e-t)>0&&this._bitsAvailable?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(this._word&2147483648>>>e)return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,n=8,r=0;r<e;r++)0!==n&&(n=(t+this.readEG()+256)%256),t=0===n?t:n}}])}(),ra=function(){return Bs((function e(t){As(this,e),this._buffer=t,this._offset=0,this._heldBits=0,this._numHeldBits=0}),[{key:"readUint8",value:function(){return this._buffer[this._offset++]}},{key:"readUint16",value:function(){return this._buffer[this._offset++]<<8|this._buffer[this._offset++]}},{key:"readUint32",value:function(){return this._buffer[this._offset++]<<24|this._buffer[this._offset++]<<16|this._buffer[this._offset++]<<8|this._buffer[this._offset++]}},{key:"readUint8Array",value:function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t}},{key:"streamRead1Bytes",value:function(){this._heldBits=this.readUint8(),this._numHeldBits=8}},{key:"streamRead2Bytes",value:function(){this._heldBits=this.readUint16(),this._numHeldBits=16}},{key:"extractBits",value:function(e){var t=this._heldBits>>this._numHeldBits-e&(1<<e)-1;return this._numHeldBits-=e,t}}])}(),ia=function(){function e(){As(this,e)}return Bs(e,null,[{key:"parseVVCDecoderConfigurationRecord",value:function(t){var n=new ra(t),r=n.readUint8();n.streamRead1Bytes(),n.extractBits(5);var i,s,a,o,l,u,c,h,d=n.extractBits(2)+1,f=n.extractBits(1),p={};f&&(n.streamRead2Bytes(),o=n.extractBits(2),l=n.extractBits(3),s=n.extractBits(3),a=n.extractBits(2),n.extractBits(6),p=e.parseVVCPTLRecord(n,s),i=n.readUint16(),u=n.readUint16(),c=n.readUint16(),h=n.readUint16());for(var g=n.readUint8(),m=[],v=[],y=[],_=null,T=0;T<g;T++){n.streamRead1Bytes(),n.extractBits(1),n.extractBits(2);var b=n.extractBits(5),S=1;13!==b&&12!==b&&(S=n.readUint16());for(var P=0;P<S;P++){var w=n.readUint16();switch(b){case 14:m.push(n.readUint8Array(w));break;case 15:var k=n.readUint8Array(w);_||(_=e.parseSPS(e.removeEPB(k))),v.push(k);break;case 16:y.push(n.readUint8Array(w))}}}return{data:t,configurationVersion:r,codec:"bvc2.1.6.L93.B0",nalUnitSize:d,ptlPresentFlag:f,olsIdx:i,numSublayers:s,constantFrameRate:a,chromaFormatIdc:o,bitDepthLumaMinus8:l,ptlRecord:p,width:u,height:c,sampleRate:h,numOfArrays:g,vps:m,sps:v,pps:y,spsParsed:_}}},{key:"parseVVCPTLRecord",value:function(e,t){e.streamRead2Bytes(),e.extractBits(2);var n=e.extractBits(6),r=e.extractBits(7),i=e.extractBits(1),s=e.readUint8();e.streamRead1Bytes();var a=e.extractBits(1),o=e.extractBits(1),l=new Uint8Array(n);if(n){for(var u=0;u<n-1;u++){var c=e.extractBits(6);e.streamRead1Bytes();var h=e.extractBits(2);l[u]=c<<2|h}l[n-1]=e.extractBits(6)}else e.extractBits(6);var d=[];if(t>1){e.streamRead1Bytes();for(var f=0,p=t-2;p>=0;--p)f|=e.extractBits(1)<<p;for(var g=t;g<=8&&t>1;++g)e.extractBits(1);for(var m=t-2;m>=0;--m)f&1<<m&&(d[m]=e.readUint8())}var v=e.readUint8(),y=[];if(v)for(var _=0;_<v;_++)y.push(e.readUint32());return{generalProfileIdc:r,generalTierFlag:i,generalLevelIdc:s,ptlFrameOnlyConstraintFlag:a,ptlMultilayerEnabledFlag:o,generalConstraintInfo:l,subLayerLevelIdc:d,generalSubProfileIdc:y,ptlNumSubProfiles:v,numBytesConstraintInfo:n}}},{key:"getAvccNals",value:function(e){for(var t=[];e.position<e.length-4;){var n=e.dataview.getInt32(e.dataview.position);if(!(e.length-e.position>=n))break;var r=e.buffer.slice(e.position,e.position+4);e.skip(4);var i=new Uint8Array(e.buffer.slice(e.position,e.position+n));e.skip(n),t.push({header:r,body:i})}return t}},{key:"analyseNal",value:function(e){var t=(248&e.body[1])>>3;switch(e.type=t,t){case 23:case 24:break;case 7:case 8:e.key=!0;break;case 14:e.vps=!0;break;case 15:e.sps=!0;break;case 16:e.pps=!0;break;case 17:e.aps=!0}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,n=[],r=1;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(!n.length)return e;var i=t-n.length,s=new Uint8Array(i),a=0;for(r=0;r<i;a++,r++)a===n[0]&&(a++,n.shift()),s[r]=e[a];return s}},{key:"parseVps",value:function(){}},{key:"parseSPS",value:function(t){var n=new na(t);n.readUByte(),n.readUByte(),n.skipBits(4);var r=n.readBits(4),i=n.readBits(3),s=n.readBits(2),a=420;s<=3&&(a=[0,420,422,444][s]),n.readBits(2),n.readBits(1);var o=e._parseProfileTierLevel(n,1,i);return n.readBits(1),n.readBits(1)&&n.readBits(1),{width:n.readUEG(),height:n.readUEG(),spsMaxSubLayerMinus1:i,spsVideoParameterSetId:r,chromaFormatIdc:s,chromaFormat:a,ptlInfo:o}}},{key:"_parseProfileTierLevel",value:function(t,n,r){var i,s=t.readBits(7),a=t.readBits(1),o=t.readBits(8),l=t.readBits(1),u=t.readBits(1);n&&(i=e._parseGeneralConstraintsInfo(t));for(var c=r-1,h=[],d=[],f=[],p=c;p>=0;--p)h[p]=t.readBits(1);for(;!t.byteAligned();)t.readBits(1);for(var g=c;g>=0;--g)h[g]&&(d[g]=t.readUByte());if(n)for(var m=t.readUByte(),v=0;v<m;v++)f[v]=t.readBits(32);return{generalProfileIdc:s,generalTierFlag:a,generalLevelIdc:o,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:u,ptlSublayerLevelPresentFlags:h,ptlSublayerLevelIdcs:d,ptlSubProfileIdcs:f,gciInfo:i}}},{key:"_parseGeneralConstraintsInfo",value:function(e){var t=e.readBits(1);if(t){e.skipBits(71);var n=e.readBits(8);n&&e.skipBits(n)}var r=8-e.bitsPos()%8;return e.skipBits(r),{gciPresentFlag:t}}}])}(),sa="video",aa="hevc",oa="vvcC",la=function(){function e(t,n,r){As(this,e),this.dv=new DataView(t),this.start=this.offset=n||this.dv.byteOffset,this.end=r?this.start+r:this.start+this.dv.byteLength}return Bs(e,[{key:"buffer",get:function(){return this.dv.buffer}},{key:"unreadLength",get:function(){return Math.max(this.end-this.offset,0)}},{key:"size",get:function(){return this.end-this.start}},{key:"readFloat",value:function(e){var t=0;switch(e){case 4:t=this.dv.getFloat32(this.offset);break;case 8:t=this.dv.getFloat64(this.offset);break;default:throw new Error("read ".concat(e,"-byte float is not supported"))}return this.offset+=e,t}},{key:"back",value:function(e){this.offset-=e}},{key:"skip",value:function(e){this.offset+=e}},{key:"readInt",value:function(e){var t=this.offset;switch(this.offset+=e,e){case 1:return this.dv.getInt8(t);case 2:return this.dv.getInt16(t);case 4:return this.dv.getInt32(t);default:throw new Error("read ".concat(e,"-byte integers is not supported"))}}},{key:"read",value:function(e){var t=this.offset;switch(this.offset+=e,e){case 1:return this.dv.getUint8(t);case 2:return this.dv.getUint16(t);case 3:return(this.dv.getUint16(t)<<8)+this.dv.getUint8(t+2);case 4:return this.dv.getUint32(t);default:return this.back(e-4),this.read(e-4)+this.dv.getUint32(t)*Math.pow(256,e-4)}}},{key:"write",value:function(e,t){var n=this.offset;switch(this.offset+=e,e){case 1:return this.dv.setUint8(n,t);case 2:return this.dv.setUint16(n,t);case 3:return this.dv.setUint8(n,t>>>16),this.dv.setUint16(n+1,65535&t);case 4:return this.dv.setUint32(n,t);default:throw new Error("write ".concat(e,"-byte integers is not supported"))}}},{key:"readToBuffer",value:function(e){var t;return t=this.offset||e?this.dv.buffer.slice(this.offset,e?this.offset+e:this.end):this.dv.buffer,this.offset+=t.byteLength,t}},{key:"readToUint8",value:function(e){var t=new Uint8Array(this.dv.buffer,this.offset,e||this.unreadLength);return this.offset+=t.byteLength,t}},{key:"readString",value:function(e){for(var t=0,n="";t<e;t++)n+=String.fromCharCode(this.dv.getUint8(this.offset)),this.offset++;return n}}],[{key:"fromUint8",value:function(t){return new e(t.buffer,t.byteOffset,t.byteLength)}},{key:"concatUint8s",value:function(e){var t=new Uint8Array(e.reduce((function(e,t){return e+t.byteLength}),0)),n=0;return e.forEach((function(e){t.set(e,n),n+=e.byteLength})),t}},{key:"concatUint8",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.concatUint8s(t)}}])}(),ua=function(){function e(t,n){As(this,e),this.offset=0,this.val=t,this.size=n}return Bs(e,[{key:"skip",value:function(e){this.offset+=e}},{key:"read",value:function(e){var t=this.size-this.offset-e;if(t>=0){var n=0,r=0;if(this.offset+=e,this.size>31){for(;r<e;r++)n+=Math.pow(2,r);return this.val/Math.pow(2,t)&n}for(;r<e;r++)n+=1<<r;return this.val>>>t&n}throw new Error("the number of the read operation exceeds the total length limit of bits")}}],[{key:"fromByte",value:function(t,n){return new e(t.read(n),n<<3)}}])}(),ca=function(){function e(){As(this,e)}return Bs(e,null,[{key:"findBox",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[];if(!t)return i;for(var s=0,a="",o=0;t.length>7;){if(s=zs(t),a=String.fromCharCode.apply(null,t.subarray(4,8)),o=8,1===s?(s=Ks(t,8),o+=8):s||(s=t.length),!n[0]||a===n[0]){var l=t.subarray(0,s);if(!(n.length<2))return e.findBox(l.subarray(o),n.slice(1),r+o);i.push({start:r,size:s,headerSize:o,type:a,data:l})}r+=s,t=t.subarray(s)}return i}},{key:"tfhd",value:function(e){return pa(e,!0,(function(e,t){e.trackId=zs(t);var n=4,r=1&e.flags,i=2&e.flags,s=8&e.flags,a=16&e.flags,o=32&e.flags;r&&(n+=4,e.baseDataOffset=zs(t,n),n+=4),i&&(e.sampleDescriptionIndex=zs(t,n),n+=4),s&&(e.defaultSampleDuration=zs(t,n),n+=4),a&&(e.defaultSampleSize=zs(t,n),n+=4),o&&(e.defaultSampleFlags=zs(t,n))}))}},{key:"sidx",value:function(e){return pa(e,!0,(function(e,t){var n=0;e.reference_ID=zs(t,n),n+=4,e.timescale=zs(t,n),n+=4,0===e.version?(e.earliest_presentation_time=zs(t,n),n+=4,e.first_offset=zs(t,n),n+=4):(e.earliest_presentation_time=Ks(t,n),n+=8,e.first_offset=Ks(t,n),n+=8),n+=2,e.references=[];var r=js(t,n);n+=2;for(var i=0;i<r;i++){var s={};e.references.push(s);var a=zs(t,n);n+=4,s.reference_type=a>>31&1,s.referenced_size=2147483647&a,s.subsegment_duration=zs(t,n),a=zs(t,n+=4),n+=4,s.starts_with_SAP=a>>31&1,s.SAP_type=a>>28&7,s.SAP_delta_time=268435455&a}}))}},{key:"moov",value:function(t){return pa(t,!1,(function(t,n,r){t.mvhd=e.mvhd(e.findBox(n,["mvhd"],r)[0]),t.trak=e.findBox(n,["trak"],r).map((function(t){return e.trak(t)})),t.pssh=e.pssh(e.findBox(n,["pssh"],r)[0])}))}},{key:"mvhd",value:function(e){return pa(e,!0,(function(e,t){var n=0;1===e.version?(e.timescale=zs(t,16),e.duration=Ks(t,20),n+=28):(e.timescale=zs(t,8),e.duration=zs(t,12),n+=16),e.nextTrackId=zs(t,n+76)}))}},{key:"trak",value:function(t){return pa(t,!1,(function(t,n,r){t.tkhd=e.tkhd(e.findBox(n,["tkhd"],r)[0]),t.mdia=e.mdia(e.findBox(n,["mdia"],r)[0]),t.edts=e.edts(e.findBox(n,["edts"],r)[0])}))}},{key:"tkhd",value:function(e){return pa(e,!0,(function(e,t){var n=la.fromUint8(t);1===e.version?(n.read(8),n.read(8),e.trackId=n.read(4),n.read(4),e.duration=n.read(8)):(n.read(4),n.read(4),e.trackId=n.read(4),n.read(4),e.duration=n.read(4)),n.skip(16),e.matrix=[];for(var r=0;r<36;r++)e.matrix.push(n.read(1));n.back(36);for(var i,s=[],a=0;a<3;a++)s.push(qs(n.readInt(2),n.readInt(2))),s.push(qs(n.readInt(2),n.readInt(2))),i=n.readInt(4),s.push(qs(i>>30,1073741823&i));e.rotation=function(e){if(e.length<5)return 0;var t=Math.hypot(e[0],e[3]),n=Math.hypot(e[1],e[4]);return 0===t||0===n?0:180*Math.atan2(e[1]/n,e[0]/t)/Math.PI}(s),e.width=n.read(4),e.height=n.read(4)}))}},{key:"mdia",value:function(t){return pa(t,!1,(function(t,n,r){t.mdhd=e.mdhd(e.findBox(n,["mdhd"],r)[0]),t.hdlr=e.hdlr(e.findBox(n,["hdlr"],r)[0]),t.minf=e.minf(e.findBox(n,["minf"],r)[0])}))}},{key:"edts",value:function(t){return pa(t,!1,(function(t,n,r){t.elst=e.elst(e.findBox(n,["elst"],r)[0])}))}},{key:"elst",value:function(e){return pa(e,!0,(function(e,t,n){e.entries=[],e.entriesData=t;var r=0,i=zs(t,r);r+=4;for(var s=0;s<i;s++){var a={};e.entries.push(a),1===e.version?(a.segment_duration=Ks(t,r),r+=8,a.media_time=Ws(t,r),r+=8):(a.segment_duration=zs(t,r),r+=4,a.media_time=Xs(t,r),r+=4),a.media_rate_integer=js(t,r),r+=2,a.media_rate_fraction=js(t,n),r+=2}}))}},{key:"mdhd",value:function(e){return pa(e,!0,(function(e,t){var n=0;1===e.version?(e.timescale=zs(t,16),e.duration=Ks(t,20),n+=28):(e.timescale=zs(t,8),e.duration=zs(t,12),n+=16);var r=js(t,n);e.language=String.fromCharCode(96+(r>>10&31),96+(r>>5&31),96+(31&r))}))}},{key:"hdlr",value:function(e){return pa(e,!0,(function(e,t){0===e.version&&(e.handlerType=String.fromCharCode.apply(null,t.subarray(4,8)))}))}},{key:"minf",value:function(t){return pa(t,!1,(function(t,n,r){t.vmhd=e.vmhd(e.findBox(n,["vmhd"],r)[0]),t.smhd=e.smhd(e.findBox(n,["smhd"],r)[0]),t.stbl=e.stbl(e.findBox(n,["stbl"],r)[0])}))}},{key:"vmhd",value:function(e){return pa(e,!0,(function(e,t){e.graphicsmode=js(t),e.opcolor=[js(t,2),js(t,4),js(t,6)]}))}},{key:"smhd",value:function(e){return pa(e,!0,(function(e,t){e.balance=js(t)}))}},{key:"stbl",value:function(t){return pa(t,!1,(function(t,n,r){var i,s,a;t.stsd=e.stsd(e.findBox(n,["stsd"],r)[0]),t.stts=e.stts(e.findBox(n,["stts"],r)[0]),t.ctts=e.ctts(e.findBox(n,["ctts"],r)[0]),t.stsc=e.stsc(e.findBox(n,["stsc"],r)[0]),t.stsz=e.stsz(e.findBox(n,["stsz"],r)[0]),t.stco=e.stco(e.findBox(n,["stco"],r)[0]),t.stco||(t.co64=e.co64(e.findBox(n,["co64"],r)[0]),t.stco=t.co64);var o=null===(i=t.stsd.entries[0])||void 0===i||null===(s=i.sinf)||void 0===s||null===(a=s.schi)||void 0===a?void 0:a.tenc.default_IV_size;t.stss=e.stss(e.findBox(n,["stss"],r)[0]),t.senc=e.senc(e.findBox(n,["senc"],r)[0],o)}))}},{key:"senc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return pa(e,!0,(function(e,n){var r=0,i=zs(n,r);r+=4,e.samples=[];for(var s=0;s<i;s++){for(var a={InitializationVector:[]},o=0;o<t;o++)a.InitializationVector[o]=n[r+o];if(r+=t,2&e.flags){a.subsamples=[];var l=js(n,r);r+=2;for(var u=0;u<l;u++){var c={};c.BytesOfClearData=js(n,r),r+=2,c.BytesOfProtectedData=zs(n,r),r+=4,a.subsamples.push(c)}}e.samples.push(a)}}))}},{key:"pssh",value:function(e){return pa(e,!0,(function(e,t){for(var n=[],r=[],i=0,s=0;s<16;s++)r.push(ga(t[i+s]));if(i+=16,e.version>0){var a=zs(t,i);i+=4;for(var o=0;o<(""+a).length;o++)for(var l=0;l<16;l++){var u=t[i];i+=1,n.push(ga(u))}}var c=zs(t,i);e.data_size=c,i+=4,e.kid=n,e.system_id=r,e.buffer=t}))}},{key:"bvc2",value:function(t){return pa(t,!1,(function(t,n,r){var i=da(t,n),s=n.subarray(i);r+=i,t.vvcC=e.bv2C(e.findBox(s,["bv2C"],r)[0]),t.pasp=e.pasp(e.findBox(s,["pasp"],r)[0])}))}},{key:"bv2C",value:function(e){return pa(e,!1,(function(e,t,n){var r=ia.parseVVCDecoderConfigurationRecord(t);for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}))}},{key:"stsd",value:function(t){return pa(t,!0,(function(t,n,r){t.entryCount=zs(n),t.entries=e.findBox(n.subarray(4),[],r+4).map((function(t){switch(t.type){case"av01":return e.av01(t);case"avc1":case"avc2":case"avc3":case"avc4":return e.avc1(t);case"hvc1":case"hev1":return e.hvc1(t);case"bvc2":return e.bvc2(t);case"mp4a":return e.mp4a(t);case"alaw":case"ulaw":return e.alaw(t);case"enca":return pa(t,!1,(function(t,n,r){t.channelCount=js(n,16),t.samplesize=js(n,18),t.sampleRate=zs(n,24)/65536,n=n.subarray(28),t.sinf=e.sinf(e.findBox(n,["sinf"],r)[0]),t.esds=e.esds(e.findBox(n,["esds"],r)[0])}));case"encv":return pa(t,!1,(function(t,n,r){t.width=js(n,24),t.height=js(n,26),t.horizresolution=zs(n,28),t.vertresolution=zs(n,32),n=n.subarray(78),t.sinf=e.sinf(e.findBox(n,["sinf"],r)[0]),t.avcC=e.avcC(e.findBox(n,["avcC"],r)[0]),t.hvcC=e.hvcC(e.findBox(n,["hvcC"],r)[0]),t.pasp=e.pasp(e.findBox(n,["pasp"],r)[0])}))}})).filter(Boolean)}))}},{key:"tenc",value:function(e){return pa(e,!1,(function(e,t){var n=6;e.default_IsEncrypted=t[n],n+=1,e.default_IV_size=t[n],n+=1,e.default_KID=[];for(var r=0;r<16;r++)e.default_KID.push(ga(t[n])),n+=1}))}},{key:"schi",value:function(t){return pa(t,!1,(function(t,n,r){t.tenc=e.tenc(e.findBox(n,["tenc"],r)[0])}))}},{key:"sinf",value:function(t){return pa(t,!1,(function(t,n,r){t.schi=e.schi(e.findBox(n,["schi"],r)[0]),t.frma=e.frma(e.findBox(n,["frma"],r)[0])}))}},{key:"frma",value:function(e){return pa(e,!1,(function(e,t){e.data_format="";for(var n=0;n<4;n++)e.data_format+=String.fromCharCode(t[n])}))}},{key:"colr",value:function(e){return pa(e,!1,(function(t,n){var r=la.fromUint8(n);t.data=e.data,t.colorType=r.readString(4),"nclx"===t.colorType?(t.colorPrimaries=r.read(2),t.transferCharacteristics=r.read(2),t.matrixCoefficients=r.read(2),t.fullRangeFlag=r.read(1)>>7):"rICC"!==t.colorType&&"prof"!==t.colorType||(t.iccProfile=n.readToUint8())}))}},{key:"av01",value:function(t){return pa(t,!1,(function(t,n,r){var i=da(t,n),s=n.subarray(i);r+=i,t.av1C=e.av1C(e.findBox(s,["av1C"],r)[0]),t.colr=e.colr(e.findBox(s,["colr"],r)[0])}))}},{key:"av1C",value:function(e){return pa(e,!1,(function(t,n){t.data=e.data;var r,i=la.fromUint8(n),s=ua.fromByte(i,4);t.marker=s.read(1),t.version=s.read(7),t.seqProfile=s.read(3),t.seqLevelIdx0=s.read(5),t.seqTier0=s.read(1),t.highBitdepth=s.read(1),t.twelveBit=s.read(1),t.monochrome=s.read(1),t.chromaSubsamplingX=s.read(1),t.chromaSubsamplingY=s.read(1),t.chromaSamplePosition=s.read(2),t.reserved=s.read(3),t.initialPresentationDelayPresent=s.read(1),t.initialPresentationDelayPresent?t.initialPresentationDelayMinusOne=s.read(4):t.initialPresentationDelayMinusOne=0,t.configOBUs=i.readToUint8(),2===t.seqLevelIdx0&&1===t.highBitdepth?r=1===t.twelveBit?"12":"10":t.seqProfile<=2&&(r=1===t.highBitdepth?"10":"08"),t.codec=["av01",t.seqProfile,(t.seqLevelIdx0<10?"0"+t.seqLevelIdx0:t.seqLevelIdx0)+(t.seqTier0?"H":"M"),r].join(".")}))}},{key:"avc1",value:function(t){return pa(t,!1,(function(t,n,r){var i=da(t,n),s=n.subarray(i);r+=i,t.avcC=e.avcC(e.findBox(s,["avcC"],r)[0]),t.pasp=e.pasp(e.findBox(s,["pasp"],r)[0])}))}},{key:"avcC",value:function(e){return pa(e,!1,(function(t,n){t.data=e.data,t.configurationVersion=n[0],t.AVCProfileIndication=n[1],t.profileCompatibility=n[2],t.AVCLevelIndication=n[3],t.codec=function(e){for(var t,n="avc1.",r=0;r<3;r++)(t=e[r].toString(16)).length<2&&(t="0".concat(t)),n+=t;return n}([n[1],n[2],n[3]]),t.lengthSizeMinusOne=3&n[4],t.spsLength=31&n[5],t.sps=[];for(var r=6,i=0;i<t.spsLength;i++){var s=js(n,r);r+=2,t.sps.push(n.subarray(r,r+s)),r+=s}t.ppsLength=n[r],r+=1,t.pps=[];for(var a=0;a<t.ppsLength;a++){var o=js(n,r);r+=2,t.pps.push(n.subarray(r,r+=o)),r+=o}}))}},{key:"hvc1",value:function(t){return pa(t,!1,(function(t,n,r){var i=da(t,n),s=n.subarray(i);r+=i,t.hvcC=e.hvcC(e.findBox(s,["hvcC"],r)[0]),t.pasp=e.pasp(e.findBox(s,["pasp"],r)[0])}))}},{key:"hvcC",value:function(e){return pa(e,!1,(function(t,n){t.data=e.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=n[0];var r=n[1];t.generalProfileSpace=r>>6,t.generalTierFlag=(32&r)>>5,t.generalProfileIdc=31&r,t.generalProfileCompatibility=zs(n,2),t.generalConstraintIndicatorFlags=n.subarray(6,12),t.generalLevelIdc=n[12],t.avgFrameRate=js(n,19),t.numOfArrays=n[22],t.vps=[],t.sps=[],t.pps=[];for(var i=23,s=0,a=0,o=0,l=0;l<t.numOfArrays;l++){s=63&n[i],a=js(n,i+1),i+=3;for(var u,c=[],h=0;h<a;h++)o=js(n,i),i+=2,c.push(n.subarray(i,i+o)),i+=o;if(32===s)(u=t.vps).push.apply(u,c);else if(33===s){var d;(d=t.sps).push.apply(d,c)}else if(34===s){var f;(f=t.pps).push.apply(f,c)}}}))}},{key:"pasp",value:function(e){return pa(e,!1,(function(e,t){e.hSpacing=zs(t),e.vSpacing=zs(t,4)}))}},{key:"mp4a",value:function(t){return pa(t,!1,(function(t,n,r){var i=fa(t,n);t.esds=e.esds(e.findBox(n.subarray(i),["esds"],r+i)[0])}))}},{key:"esds",value:function(e){return pa(e,!0,(function(e,t){e.codec="mp4a.";for(var n=0,r=0,i=0,s=0;t.length;){for(s=t[n=0],r=t[n+1],n+=2;128&r;)i=(127&r)<<7,r=t[n],n+=1;if(i+=127&r,3===s)t=t.subarray(n+3);else{if(4!==s){if(5===s){var a=e.config=t.subarray(n,n+i),o=(248&a[0])>>3;return 31===o&&a.length>=2&&(o=32+((7&a[0])<<3)+((224&a[1])>>5)),e.objectType=o,e.codec+=o.toString(16),void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}return void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}e.codec+=(t[n].toString(16)+".").padStart(3,"0"),t=t.subarray(n+13)}}}))}},{key:"alaw",value:function(e){return pa(e,!1,(function(e,t){fa(e,t)}))}},{key:"stts",value:function(e){return pa(e,!0,(function(e,t){for(var n=zs(t),r=[],i=4,s=0;s<n;s++)r.push({count:zs(t,i),delta:zs(t,i+4)}),i+=8;e.entryCount=n,e.entries=r}))}},{key:"ctts",value:function(e){return pa(e,!0,(function(e,t){var n=zs(t),r=[],i=4;if(1===e.version)for(var s=0;s<n;s++)r.push({count:zs(t,i),offset:zs(t,i+4)}),i+=8;else for(var a=0;a<n;a++)r.push({count:zs(t,i),offset:-(1+~zs(t,i+4))}),i+=8;e.entryCount=n,e.entries=r}))}},{key:"stsc",value:function(e){return pa(e,!0,(function(e,t){for(var n=zs(t),r=new Array(n),i=4,s=0;s<n;s++)r[s]={firstChunk:zs(t,i),samplesPerChunk:zs(t,i+4),sampleDescriptionIndex:zs(t,i+8)},i+=12;e.entryCount=n,e.entries=r}))}},{key:"stsz",value:function(e){return pa(e,!0,(function(e,t){var n=zs(t),r=zs(t,4),i=new Array(r);if(!n)for(var s=8,a=0;a<r;a++)i[a]=zs(t,s),s+=4;e.sampleSize=n,e.sampleCount=r,e.entrySizes=i}))}},{key:"stco",value:function(e){return pa(e,!0,(function(e,t){for(var n=zs(t),r=new Array(n),i=4,s=0;s<n;s++)r[s]=zs(t,i),i+=4;e.entryCount=n,e.entries=r}))}},{key:"co64",value:function(e){return pa(e,!0,(function(e,t){for(var n=zs(t),r=new Array(n),i=4,s=0;s<n;s++)r[s]=Ks(t,i),i+=8;e.entryCount=n,e.entries=r}))}},{key:"stss",value:function(e){return pa(e,!0,(function(e,t){for(var n=zs(t),r=new Array(n),i=4,s=0;s<n;s++)r[s]=zs(t,i),i+=4;e.entryCount=n,e.entries=r}))}},{key:"moof",value:function(t){return pa(t,!1,(function(t,n,r){t.mfhd=e.mfhd(e.findBox(n,["mfhd"],r)[0]),t.traf=e.findBox(n,["traf"],r).map((function(t){return e.traf(t)}))}))}},{key:"mfhd",value:function(e){return pa(e,!0,(function(e,t){e.sequenceNumber=zs(t)}))}},{key:"traf",value:function(t){return pa(t,!1,(function(t,n,r){t.tfhd=e.tfhd(e.findBox(n,["tfhd"],r)[0]),t.tfdt=e.tfdt(e.findBox(n,["tfdt"],r)[0]),t.trun=e.trun(e.findBox(n,["trun"],r)[0])}))}},{key:"trun",value:function(e){return pa(e,!0,(function(e,t){var n=e.version,r=e.flags,i=t.length,s=e.sampleCount=zs(t),a=4;if(i>a&&1&r&&(e.dataOffset=-(1+~zs(t,a)),a+=4),i>a&&4&r&&(e.firstSampleFlags=zs(t,a),a+=4),i>a){var o;e.samples=new Array(s);for(var l=0;l<s;l++)o={},256&r&&(o.duration=zs(t,a),a+=4),512&r&&(o.size=zs(t,a),a+=4),1024&r&&(o.flags=zs(t,a),a+=4),2048&r&&(o.cts=n?-(1+~zs(t,a+4)):zs(t,a),a+=4),e.samples[l]=o}}))}},{key:"tfdt",value:function(e){return pa(e,!0,(function(e,t){1===e.version?e.baseMediaDecodeTime=Ks(t):e.baseMediaDecodeTime=zs(t)}))}},{key:"probe",value:function(t){return!!e.findBox(t,["ftyp"])}},{key:"parseSampleFlags",value:function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}}},{key:"moovToTrack",value:function(e,t,n){var r,i,s=e.trak;if(s&&s.length){var a=s.find((function(e){var t,n;return"vide"===(null===(t=e.mdia)||void 0===t||null===(n=t.hdlr)||void 0===n?void 0:n.handlerType)})),o=s.find((function(e){var t,n;return"soun"===(null===(t=e.mdia)||void 0===t||null===(n=t.hdlr)||void 0===n?void 0:n.handlerType)}));if(a&&t){var l,u,c,h,d,f,p,g,m=t;null!=(null===(l=a.tkhd)||void 0===l?void 0:l.trackId)&&(m.id=a.tkhd.trackId),m.tkhdDuration=a.tkhd.duration,m.mvhdDurtion=e.mvhd.duration,m.mvhdTimecale=e.mvhd.timescale,m.timescale=m.formatTimescale=a.mdia.mdhd.timescale,m.duration=a.mdia.mdhd.duration||m.mvhdDurtion/m.mvhdTimecale*m.timescale,m.rotation=a.tkhd.rotation,m.matrix=a.tkhd.matrix,null!==(u=a.edts)&&void 0!==u&&u.elst&&(m.editList=a.edts.elst,m.editListApplied=a.editListApplied);var v,y,_,T,b,S,P,w,k=a.mdia.minf.stbl.stsd.entries[0];if(m.width=k.width,m.height=k.height,k.pasp&&(m.sarRatio=[k.pasp.hSpacing,k.pasp.vSpacing]),k.av1C)m.codecType="av1",m.codec=k.av1C.codec,m.av1C=k.av1C.data,m.colr=k.colr.data;else if(k.hvcC)m.codecType=aa,m.codec=k.hvcC.codec,m.vps=k.hvcC.vps,m.sps=k.hvcC.sps,m.pps=k.hvcC.pps,m.hvcC=k.hvcC.data;else if(k.avcC)m.codec=k.avcC.codec,m.sps=k.avcC.sps,m.pps=k.avcC.pps;else{if(!k.vvcC)throw new Error("unknown video stsd entry");m.codecType=oa,m.codec=k.vvcC.codec,m.sps=k.vvcC.sps,m.pps=k.vvcC.pps,m.vps=k.vvcC.vps,m.vvcC=k.vvcC.data}m.present=!0,m.ext={},m.ext.stss=null===(c=a.mdia)||void 0===c||null===(h=c.minf)||void 0===h||null===(d=h.stbl)||void 0===d?void 0:d.stss,m.ext.ctts=null===(f=a.mdia)||void 0===f||null===(p=f.minf)||void 0===p||null===(g=p.stbl)||void 0===g?void 0:g.ctts,k&&"encv"===k.type&&(m.isVideoEncryption=!0,k.default_KID=null===(v=k.sinf)||void 0===v||null===(y=v.schi)||void 0===y?void 0:y.tenc.default_KID,k.default_IsEncrypted=null===(_=k.sinf)||void 0===_||null===(T=_.schi)||void 0===T?void 0:T.tenc.default_IsEncrypted,k.default_IV_size=null===(b=k.sinf)||void 0===b||null===(S=b.schi)||void 0===S?void 0:S.tenc.default_IV_size,m.videoSenc=a.mdia.minf.stbl.senc&&a.mdia.minf.stbl.senc.samples,k.data_format=null===(P=k.sinf)||void 0===P||null===(w=P.frma)||void 0===w?void 0:w.data_format,m.useEME=e.useEME,m.kidValue=e.kidValue,m.pssh=e.pssh,m.encv=k)}if(o&&n){var M,E,R,x,D,I,C,L,O,A,G=n;null!=(null===(M=o.tkhd)||void 0===M?void 0:M.trackId)&&(G.id=o.tkhd.trackId),G.tkhdDuration=o.tkhd.duration,G.mvhdDurtion=e.mvhd.duration,G.mvhdTimecale=e.mvhd.timescale,G.timescale=G.formatTimescale=o.mdia.mdhd.timescale,G.duration=o.mdia.mdhd.duration||G.mvhdDurtion/G.mvhdTimecale*G.timescale,null!==(E=o.edts)&&void 0!==E&&E.elst&&(G.editList=o.edts.elst,G.editListApplied=o.editListApplied);var B,N,$,U,F,H,V,j,z=o.mdia.minf.stbl.stsd.entries[0];switch(G.sampleSize=z.sampleSize,G.sampleRate=z.sampleRate,G.channelCount=z.channelCount,G.present=!0,z.type){case"alaw":G.codecType=G.codec="g7110a",G.sampleRate=8e3;break;case"ulaw":G.codecType=G.codec="g7110m",G.sampleRate=8e3;break;default:G.sampleDuration=ta.getFrameDuration(G.sampleRate,G.timescale),G.sampleRateIndex=ta.getRateIndexByRate(G.sampleRate),G.objectType=(null===(r=z.esds)||void 0===r?void 0:r.objectType)||2,z.esds&&(G.config=Array.from(z.esds.config)),G.codec=(null===(i=z.esds)||void 0===i?void 0:i.codec)||"mp4a.40.2"}G.sampleDuration=ta.getFrameDuration(G.sampleRate,G.timescale),G.objectType=(null===(R=z.esds)||void 0===R?void 0:R.objectType)||2,z.esds&&(z.esds.config?G.config=Array.from(z.esds.config):console.warn("esds config is null")),G.codec=(null===(x=z.esds)||void 0===x?void 0:x.codec)||"mp4a.40.2",G.sampleRateIndex=ta.getRateIndexByRate(G.sampleRate),G.ext={},G.ext.stss=null===(D=o.mdia)||void 0===D||null===(I=D.minf)||void 0===I||null===(C=I.stbl)||void 0===C?void 0:C.stss,G.ext.ctts=null===(L=o.mdia)||void 0===L||null===(O=L.minf)||void 0===O||null===(A=O.stbl)||void 0===A?void 0:A.ctts,G.present=!0,z&&"enca"===z.type&&(G.isAudioEncryption=!0,z.data_format=null===(B=z.sinf)||void 0===B||null===(N=B.frma)||void 0===N?void 0:N.data_format,z.default_KID=null===($=z.sinf)||void 0===$||null===(U=$.schi)||void 0===U?void 0:U.tenc.default_KID,z.default_IsEncrypted=null===(F=z.sinf)||void 0===F||null===(H=F.schi)||void 0===H?void 0:H.tenc.default_IsEncrypted,z.default_IV_size=null===(V=z.sinf)||void 0===V||null===(j=V.schi)||void 0===j?void 0:j.tenc.default_IV_size,G.audioSenc=o.mdia.minf.stbl.senc&&o.mdia.minf.stbl.senc.samples,G.useEME=e.useEME,G.kidValue=e.kidValue,G.enca=z)}if(n&&(n.isVideoEncryption=!!t&&t.isVideoEncryption),t&&(t.isAudioEncryption=!!n&&n.isAudioEncryption),null!=t&&t.encv||null!=n&&n.enca){var X,K,W=null==t||null===(X=t.encv)||void 0===X?void 0:X.default_KID,Q=null==n||null===(K=n.enca)||void 0===K?void 0:K.default_KID,q=W||Q?(W||Q).join(""):null;t&&(t.kid=q),n&&(n.kid=q)}return t&&(t.flags=3841),n&&(n.flags=1793),{videoTrack:t,audioTrack:n}}}},{key:"evaluateDefaultDuration",value:function(e,t,n){var r,i=null==t||null===(r=t.samples)||void 0===r?void 0:r.length;return i?1024*i/t.timescale*e.timescale/n:1024}},{key:"moofToSamples",value:function(t,n,r){var i={};return t.mfhd&&(n&&(n.sequenceNumber=t.mfhd.sequenceNumber),r&&(r.sequenceNumber=t.mfhd.sequenceNumber)),t.traf.forEach((function(t){var s=t.tfhd,a=t.tfdt,o=t.trun;if(s&&o){a&&(n&&n.id===s.trackId&&(n.baseMediaDecodeTime=a.baseMediaDecodeTime),r&&r.id===s.trackId&&(r.baseMediaDecodeTime=a.baseMediaDecodeTime));var l=s.defaultSampleSize||0,u=s.defaultSampleDuration||e.evaluateDefaultDuration(n,r,o.samples.length||o.sampleCount),c=o.dataOffset||0,h=0,d=-1;if(!o.samples.length&&o.sampleCount){i[s.trackId]=new Array(o.sampleCount);for(var f=0;f<o.sampleCount;f++)i[s.trackId][f]={offset:c,dts:h,duration:u,size:l},h+=u,c+=l}else i[s.trackId]=o.samples.map((function(e,t){return(e={offset:c,dts:h,pts:h+(e.cts||0),duration:e.duration||u,size:e.size||l,gopId:d,keyframe:0===t||null!==e.flags&&void 0!==e.flags&&(65536&e.flags)>>>0!=65536}).keyframe&&(d++,e.gopId=d),h+=e.duration,c+=e.size,e}))}})),i}},{key:"moovToSamples",value:function(e){var t=e.trak;if(t&&t.length){var n=t.find((function(e){var t,n;return"vide"===(null===(t=e.mdia)||void 0===t||null===(n=t.hdlr)||void 0===n?void 0:n.handlerType)})),r=t.find((function(e){var t,n;return"soun"===(null===(t=e.mdia)||void 0===t||null===(n=t.hdlr)||void 0===n?void 0:n.handlerType)}));if(n||r){var i,s;if(n){var a,o,l=null===(a=n.mdia)||void 0===a||null===(o=a.minf)||void 0===o?void 0:o.stbl;if(!l)return;var u=l.stts,c=l.stsc,h=l.stsz,d=l.stco,f=l.stss,p=l.ctts;if(!(u&&c&&h&&d&&f))return;i=ha(u,c,h,d,p,f)}if(r){var g,m,v,y=null===(g=r.mdia)||void 0===g||null===(m=g.minf)||void 0===m?void 0:m.stbl;if(!y)return;var _=null===(v=r.mdia.mdhd)||void 0===v?void 0:v.timescale,T=y.stts,b=y.stsc,S=y.stsz,P=y.stco;if(!(_&&T&&b&&S&&P))return;s=ha(T,b,S,P)}return{videoSamples:i,audioSamples:s}}}}}])}();function ha(e,t,n,r,i,s){var a,o,l,u=[],c=null==i?void 0:i.entries,h=t.entries,d=r.entries,f=n.entrySizes,p=null==s?void 0:s.entries;p&&(a={},p.forEach((function(e){a[e-1]=!0}))),c&&(o=[],c.forEach((function(e){for(var t=e.count,n=e.offset,r=0;r<t;r++)o.push(n)})));var g=-1,m=0,v=0,y=0,_=0,T=0,b=h[0].samplesPerChunk,S=h[1]?h[1].firstChunk-1:1/0;return e.entries.forEach((function(e){for(var t=e.count,r=e.delta,i=0;i<t;i++)l={dts:m,duration:r,size:f[v]||n.sampleSize,offset:d[y]+T,index:v},p&&(l.keyframe=a[v],l.keyframe&&g++,l.gopId=g),o&&v<o.length&&(l.pts=l.dts+o[v]),u.push(l),m+=r,++v<b?T+=l.size:(y++,T=0,y>=S&&(_++,S=h[_+1]?h[_+1].firstChunk-1:1/0),b+=h[_].samplesPerChunk)})),u}function da(e,t){return e.dataReferenceIndex=js(t,6),e.width=js(t,24),e.height=js(t,26),e.horizresolution=zs(t,28),e.vertresolution=zs(t,32),e.frameCount=js(t,40),e.depth=js(t,74),78}function fa(e,t){return e.dataReferenceIndex=js(t,6),e.channelCount=js(t,16),e.sampleSize=js(t,18),e.sampleRate=zs(t,24)/65536,28}function pa(e,t,n){if(e){if(e.size!==e.data.length)throw new Error("box ".concat(e.type," size !== data.length"));var r={start:e.start,size:e.size,headerSize:e.headerSize,type:e.type};return t&&(r.version=e.data[e.headerSize],r.flags=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<16)+(e[t+1]<<8)+(e[t+2]||0)}(e.data,e.headerSize+1),r.headerSize+=4),n(r,e.data.subarray(r.headerSize),r.start+r.headerSize),r}}var ga=function(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){e.push(function(e){for(var t=String(0),n=Math.ceil(2/t.length),r=[],i=String(e);n--;)r.push(t);return r.join("").substring(0,2-i.length)+i}(Number(t).toString(16)))})),e[0]},ma=es((function e(t,n){Ji(this,e),this.type="file",this.message=t,this.data=n})),va=function(){return es((function e(){Ji(this,e),ts(this,"_data",Object.create(null))}),[{key:"set",value:function(e,t){this._data[e]=t}},{key:"get",value:function(e){return this._data[e]}},{key:"clear",value:function(){this._data=Object.create(null)}}])}(),ya=function(){return es((function e(){Ji(this,e),this.frames=[],this.dur=0,this.minPts=Number.MAX_VALUE,this.maxPts=0}),[{key:"appendFrame",value:function(e){this.frames.push(e),this.dur+=e.duration}},{key:"calMinMaxPts",value:function(e){e.pts<this.minPts&&(this.minPts=e.pts);var t=e.pts+e.duration;t>this.maxPts&&(this.maxPts=t)}}])}();function _a(e,t){var n=e.trak;if(n&&n.length){var r=n.find((function(e){var t,n;return"vide"===(null===(t=e.mdia)||void 0===t||null===(n=t.hdlr)||void 0===n?void 0:n.handlerType)})),i=n.find((function(e){var t,n;return"soun"===(null===(t=e.mdia)||void 0===t||null===(n=t.hdlr)||void 0===n?void 0:n.handlerType)}));if(r||i){var s=[],a=[];if(t){var o=[],l=0,u=t.start+t.size;t.references.forEach((function(e,n){o.push({index:n,startTime:l,endTime:l+e.subsegment_duration/t.timescale,duration:e.subsegment_duration/t.timescale,range:[u,u+e.referenced_size],frames:[]}),l+=e.subsegment_duration/t.timescale,u+=e.referenced_size})),s=o,a=o}else{var c,h,d=function(t){return t?[{index:0,startTime:0,endTime:t.duration/t.timescale,duration:t.duration/t.timescale,range:[e.start+e.size,""],frames:[]}]:[]};a=d(e.mvhd.duration?e.mvhd:null===(c=r.mdia)||void 0===c?void 0:c.mdhd),s=d(e.mvhd.duration?e.mvhd:null===(h=i.mdia)||void 0===h?void 0:h.mdhd)}return{videoSegments:a,audioSegments:s}}}}function Ta(e,t){var n=t.segmentDuration,r=e.trak;if(r&&r.length){var i=r.find((function(e){var t,n;return"vide"===(null===(t=e.mdia)||void 0===t||null===(n=t.hdlr)||void 0===n?void 0:n.handlerType)})),s=r.find((function(e){var t,n;return"soun"===(null===(t=e.mdia)||void 0===t||null===(n=t.hdlr)||void 0===n?void 0:n.handlerType)}));if(i||s){var a,o=[],l=[];return i&&(a=(o=ba("video",i,n,t)).map((function(e){return e.duration}))),s&&(l=ba("audio",s,n,t,a,o)),{videoSegments:o,audioSegments:l}}}}function ba(e,t,n,r){var i,s,a,o,l,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5?arguments[5]:void 0,h=r.fixEditListOffset,d=r.fixEditListOffsetThreshold,f=r.audioGroupingStrategy,p=r.memoryOpt,g=null===(i=t.mdia)||void 0===i||null===(s=i.minf)||void 0===s?void 0:s.stbl;if(!g)return[];var m=null===(a=t.mdia.mdhd)||void 0===a?void 0:a.timescale,v=g.stts,y=g.stsc,_=g.stsz,T=g.stco,b=g.stss,S=g.ctts;if(!(m&&v&&y&&_&&T)||"video"===e&&!b)return[];var P=0,w=null===(o=t.edts)||void 0===o||null===(l=o.elst)||void 0===l?void 0:l.entries;if(h&&function(){var e=!0,t=navigator.userAgent||"";if(/Chrome/gi.test(t)&&!/Edge\//gi.test(t)){var n=t.match(/Chrome\/(\d+)/i),r=n?parseInt(n[1],10):0;e=!!r&&r>=75}return e}()&&Array.isArray(w)&&w.length>0){var k=w[0].media_time;k>0&&k<(d?d*m:5*m)&&(P=k)}var M,E,R=[],x=[],D=[],I=[],C=[],L=y.entries,O=T.entries,A=_.entrySizes,G=null==b?void 0:b.entries,B=null==S?void 0:S.entries,N=[],$={};p||(B&&B.forEach((function(e){for(var t=e.count,n=e.offset,r=0;r<t;r++)N.push(n)})),G&&G.forEach((function(e){$[e-1]=!0})));var U,F=0,H=0,V=0,j=0,z=L.length>0?L[0].samplesPerChunk:0,X=L.length>1&&L[1]?L[1].firstChunk-1:1/0,K=0,W=-1,Q=!1,q={};(null==B?void 0:B.length)>0&&P>0&&(K-=P,Q=!0),t.editListApplied=Q,p&&(U=null==G?void 0:G.shift()),v.entries.forEach((function(e){var t=e.count,n=e.delta;E=n;for(var r=0;r<t;r++){if(M={dts:K,duration:E,size:A[F]||_.sampleSize,offset:O[H]+j,index:F},B&&(p?(Sa(B,F,q),M.pts=K+((null==q?void 0:q.offset)||0)):N&&F<N.length&&(M.pts=K+N[F])),0===P&&0===F&&(M.pts=0),void 0===M.pts&&(M.pts=M.dts),G){if(p?F+1===U&&(M.keyframe=!0,U=G.shift()):M.keyframe=$[F],M.keyframe)if(W++,p){var i=new ya;i.appendFrame(M),x.push(i)}else x.push([M]),D.push(M.duration);else p?x[x.length-1].appendFrame(M):(x[x.length-1].push(M),D[x.length-1]+=M.duration);M.gopId=W,p&&x[x.length-1].calMinMaxPts(M)}if(!p)if(M.keyframe?I[I.length]=M.pts:M.pts<I[x.length-1]&&(I[x.length-1]=M.pts),M.keyframe)C[C.length]=M.index;else if(x.length>0&&void 0!==C[x.length-1]){var s,a=null===(s=R[C[x.length-1]])||void 0===s?void 0:s.pts;void 0!==a&&M.pts>a&&(C[x.length-1]=M.index)}R[R.length]=M,K+=n,++F<z?j+=M.size:(H++,j=0,H>=X&&(V++,X=L[V+1]?L[V+1].firstChunk-1:1/0),z+=L[V].samplesPerChunk)}}));var Y=R.length;if(!Y||b&&!R[0].keyframe)return[];var J,Z,ee=[],te=[],ne=0,re=0,ie=0,se=0,ae=function(e,t,n){J=te[te.length-1],p?(ie=(null==x?void 0:x.length)>0?x[t].minPts:te[0].pts,se=(null==x?void 0:x.length)>0?x[n].maxPts:J.pts+J.duration):(ie=I[t],Z=R[C[n]],se=Z.pts+Z.duration),0===ee.length&&(e=(se-ie)/m),ee.push({index:ee.length,startTime:ie/m,endTime:se/m,duration:e,range:[te[0].offset,J.offset+J.size-1],frames:te}),1!==f&&(ne=0),te=[]},oe=0;if(b)for(var le=n*m,ue=0,ce=x.length;ue<ce;ue++){var he,de;p?(ne+=x[ue].dur,(he=te).push.apply(he,us(x[ue].frames))):(ne+=D[ue],(de=te).push.apply(de,us(x[ue]))),ue+1<ce?(0===ue||ne>le)&&(ae(ne/m,oe,ue),ne=0,oe=ue+1):(ae(ne/m,oe,ue),ne=0,oe=ue+1)}else{p||(I=[],C=[]);var fe=u[0]||n;if(1===f)for(var pe,ge=0;ge<Y;ge++){var me=R[ge],ve=R[ge+1],ye=ge===Y-1;te.push(me),ne+=me.duration;var _e=pe||ne/m;pe=(ve?ne+ve.duration:0)/m,(ye||(c[ee.length]?pe>c[ee.length].endTime:pe-te[0].pts/m>=fe))&&(p||(I.push(te[0].pts),C.push(te[te.length-1].index)),ae(_e,ee.length,ee.length),fe=u[ee.length]||n)}else for(var Te,be=0;be<Y;be++){var Se=R[be],Pe=R[be+1],we=be===Y-1;te.push(Se),ne+=Se.duration;var ke=Te||ne/m;Te=(Pe?ne+Pe.duration:0)/m,(we||Te+re>=fe)&&(re+=2===f?ne/m-fe:Te-fe,p||(I.push(te[0].pts),C.push(te[te.length-1].index)),ae(ke,ee.length,ee.length),fe=u[ee.length]||n)}}return ee}function Sa(e,t,n){n.offset=0;var r=(null==n?void 0:n.beforeFrameNum)||0,i=(null==n?void 0:n.usedCttsIdx)||0;if(!e||(null==e?void 0:e.length)<=0||(null==n?void 0:n.usedCttsIdx)>=e.length)n.offset=0,n.usedCttsIdx=i,n.beforeFrameNum=r;else{var s=e[i];if(t<r+((null==s?void 0:s.count)||1))n.offset=(null==s?void 0:s.offset)||0;else{var a=e[++i];a?(n.offset=a.offset||0,n.beforeFrameNum=r+s.count):(n.offset=0,n.beforeFrameNum=r+1),n.usedCttsIdx=i}}}function Pa(e,t){var n="",r="",i=0,s=0,a=0,o=0,l=0,u=0,c=0;e.mvhd&&(l=e.mvhd.duration/e.mvhd.timescale);var h=e.trak;if(h){var d,f,p,g,m,v,y,_,T,b,S,P,w,k,M,E,R,x=h.find((function(e){var t,n;return"vide"===(null===(t=e.mdia)||void 0===t||null===(n=t.hdlr)||void 0===n?void 0:n.handlerType)})),D=h.find((function(e){var t,n;return"soun"===(null===(t=e.mdia)||void 0===t||null===(n=t.hdlr)||void 0===n?void 0:n.handlerType)})),I=null;return x&&(I=null===(f=x.mdia)||void 0===f||null===(p=f.minf)||void 0===p||null===(g=p.stbl)||void 0===g?void 0:g.stsd.entries[0])&&(i=I.width,s=I.height,u=null===(m=x.mdia)||void 0===m||null===(v=m.mdhd)||void 0===v?void 0:v.timescale,n=null===(y=I.avcC||I.hvcC||I.av1C||I.vvcC)||void 0===y?void 0:y.codec,"encv"===I.type&&(d=null===(_=I.sinf)||void 0===_||null===(T=_.schi)||void 0===T?void 0:T.tenc.default_KID)),D&&(I=null===(b=D.mdia)||void 0===b||null===(S=b.minf)||void 0===S||null===(P=S.stbl)||void 0===P?void 0:P.stsd.entries[0])&&(a=I.channelCount,o=I.sampleRate,r=null===(w=I.esds)||void 0===w?void 0:w.codec,c=null===(k=D.mdia)||void 0===k||null===(M=k.mdhd)||void 0===M?void 0:M.timescale,"enca"===I.type&&(d=d||(null===(E=I.sinf)||void 0===E||null===(R=E.schi)||void 0===R?void 0:R.tenc.default_KID))),{kid:d?d.join(""):null,videoCodec:n,audioCodec:r,width:i,height:s,videoTimescale:u,audioChannelCount:a,audioSampleRate:o,duration:l,audioTimescale:c,moov:e,isFragmentMP4:t}}}function wa(e){return"number"==typeof e&&!Number.isNaN(e)}function ka(e){if(!e)return!1;var t=e.audioSegments,n=e.videoSegments,r=!n||0===n.length,i=!t||0===t.length;return!r||!i}var Ma=["vid","cache"],Ea=function(e){function t(e){var n,r;Ji(this,t),ts(n=Yi(this,t),"vid",""),ts(n,"url",""),ts(n,"meta",{}),ts(n,"downloadInfo",[]),ts(n,"videoSegments",[]),ts(n,"audioSegments",[]),ts(n,"cache",null),ts(n,"_currentSegmentIndex",-1),ts(n,"_currentLoadingSegmentIndex",-1),ts(n,"buffer",void 0),ts(n,"bufferDataLen",0),ts(n,"_error",void 0),ts(n,"_transformError",(function(e){return e})),n._config=("boolean"!=typeof(r=e).fixEditListOffset&&delete r.fixEditListOffset,ss({vid:"",moovEnd:8e4,segmentDuration:2,maxDownloadInfoSize:30,responseType:"arraybuffer",fixEditListOffset:!0,cache:null},r));var i=n._config,s=i.vid,a=i.cache,o=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(i,Ma);return n.cache=a||new va,n.vid=s||o.url,n.url=o.url,o.transformError=n._transformError,n.logger=new Fr("MP4Loader_"+n.vid),e.openLog&&Fr.enable(),o.logger=n.logger,n._loader=new Ls(o),n._loader.on(Ps,(function(e){n.emit(Ps,e)})),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ls(e,t)}(t,e),es(t,[{key:"isMetaLoaded",get:function(){return this.videoSegments.length||this.audioSegments.length}},{key:"setCurrentSegment",value:function(e){wa(e)&&(this._currentSegmentIndex=e)}},{key:"isLastSegment",value:function(e){var t,n;return!!wa(e)&&e>=((null===(t=this.videoSegments[this.videoSegments.length-1])||void 0===t?void 0:t.index)||(null===(n=this.audioSegments[this.audioSegments.length-1])||void 0===n?void 0:n.index)||0)}},{key:"isSegmentLoading",value:function(e){return e===this._currentLoadingSegmentIndex}},{key:"changeUrl",value:(d=qi(os().mark((function e(t){var n,r,i,s=arguments;return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:t,r=s.length>2?s[2]:void 0,i=s.length>3?s[3]:void 0,e.next=5,this.reset(i);case 5:t&&(this.url=t),n&&(this.vid=n),r&&(this._config.moovEnd=r);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getOrLoadMeta",value:(h=qi(os().mark((function e(t){return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(t);case 3:return e.abrupt("return",this.meta);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"newBufferArray",value:function(e,t){var n;if(this.buffer){if(t||(null===(n=this.buffer)||void 0===n?void 0:n.byteLength)<e){var r,i=this.buffer.subarray(0,this.bufferDataLen),s=Is(((null===(r=this.buffer)||void 0===r?void 0:r.byteLength)||0)+e);s.set(i,0),delete this.buffer,this.buffer=s}}else this.buffer=Is(e),this.bufferDataLen=0}},{key:"loadMetaProcess",value:(c=qi(os().mark((function e(t,n,r){var i,s,a,o,l,u,c=this,h=arguments;return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=2,s=function(e){if(Array.isArray(e))return e}(d=n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}(d,f)||hs(d,f)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),a=s[0],o=s[1],l=h.length>3&&void 0!==h[3]?h[3]:{},this._error=!1,this.logger.debug("[loadMetaProcess start], range,",[a,o]),null!==(i=this._config)&&void 0!==i&&i.memoryOpt&&(!this.buffer||null!=l&&l.isExp))try{this.newBufferArray(o-a+1,null==l?void 0:l.isExp)}catch(f){r(null,!0,{},new ma(null==f?void 0:f.message),{})}return u=function(){var e=qi(os().mark((function e(n,i,s,u){var h,d,f,p,g,m,v,y,_,T,b,S,P,w,k,M;return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.meta&&null!=s&&s.range&&s.range.length>0&&s.range[1]>=o&&(i=!0,c.logger.debug("[loadMetaProcess],data done,setstate true,[",a,o,"]")),i&&null!=s&&s.range&&s.range.length>0&&s.range[1]<o&&(i=!1,c.logger.debug("[loadMetaProcess],data not done,setstate false,[",a,o,"]")),c.logger.debug("[loadMetaProcess],task,[",a,o,"], range,",s.range,",dataLen,",n?n.byteLength:void 0,", state,",i,",err,",c._error),!c._error&&n&&n.byteLength>0&&r(n,i,s,null,u),!c.meta.moov&&!c._error){e.next=6;break}return e.abrupt("return");case 6:if(!(n&&n.byteLength>0)){e.next=59;break}e.prev=7,null!==(d=c._config)&&void 0!==d&&d.memoryOpt?(c.buffer.set(n,c.bufferDataLen),c.bufferDataLen+=(null==n?void 0:n.byteLength)||0,h=c.buffer.subarray(0,c.bufferDataLen)):(c.buffer=Ds(c.buffer,n),h=c.buffer),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(7),r(null,i,s,new ma(null===e.t0||void 0===e.t0?void 0:e.t0.message),u),e.abrupt("return");case 15:if(f=ca.findBox(h,["moov"])[0]){e.next=30;break}if(p=ca.findBox(h,["mdat"])[0],!i){e.next=30;break}if(p){e.next=25;break}return c._error=!0,r(null,i,s,new ma("cannot find moov or mdat box"),u),e.abrupt("return");case 25:return g=p.start+p.size,e.next=28,c.loadData([g,""],t,l);case 28:(m=e.sent)&&(f=ca.findBox(m.data,["moov"])[0]);case 30:if(!(f&&i&&f.size>f.data.length)){e.next=34;break}return c.logger.debug("[loadMetaProcess],moov not all, range,",s.range[1],",dataLen,",c.bufferDataLen,", state,",i),e.next=34,c.loadMetaProcess(t,[s.range[1],f.start+f.size-1],r,{isExp:!0});case 34:if(!(f&&f.size<=f.data.length)||c.meta.moov){e.next=59;break}if(y=ca.moov(f)){e.next=40;break}return c._error=!0,r(null,i,s,new ma("cannot parse moov box"),u),e.abrupt("return");case 40:if(_=Ta(y,c._config),T=function(){var e=qi(os().mark((function e(n){var r,i;return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=ca.findBox(c.buffer,[n])[0])){e.next=11;break}if(!(r.size>r.data.length)){e.next=10;break}return e.next=5,c.loadData([r.start,r.start+r.size-1],t,l);case 5:if(!(i=e.sent)){e.next=8;break}return e.abrupt("return",ca.findBox(i.data,[n])[0]);case 8:e.next=11;break;case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=!1,_&&_.videoSegments.length&&_.audioSegments.length){e.next=48;break}return e.next=46,T("sidx");case 46:(S=e.sent)&&(P=ca.sidx(S))&&(_a(y,P),as("segments"),b=!0);case 48:if(ka(_)){e.next=52;break}return c._error=!0,r(null,i,s,new ma("cannot parse segments"),u),e.abrupt("return");case 52:c.meta=Pa(y,b),k=(w=_).videoSegments,M=w.audioSegments,c.videoSegments=k,c.audioSegments=M,null!==(v=c._config)&&void 0!==v&&v.memoryOpt&&(delete c.buffer,c.bufferDataLen=0),c.logger.debug("[loadMetaProcess] moov ok"),r(void 0,i,{meta:{meta:c.meta,videoSegments:k,audioSegments:M}},null,u);case 59:case"end":return e.stop()}}),e,null,[[7,11]])})));return function(t,n,r,i){return e.apply(this,arguments)}}(),e.next=8,this.loadData([a,o||this._config.moovEnd],t,ss({onProgress:u},l));case 8:case"end":return e.stop()}var d,f}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"loadMeta",value:(u=qi(os().mark((function e(t,n){var r,i,s,a,o,l,u,c,h,d,f,p,g,m,v,y=arguments;return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.length>2&&void 0!==y[2]?y[2]:{},i=[],this.logger.debug("[loadMeta start]"),e.next=5,this.loadData([0,n||this._config.moovEnd],t,r);case 5:if(s=e.sent){e.next=8;break}return e.abrupt("return");case 8:if(i.push(s),a=ca.findBox(s.data,["moov"])[0]){e.next=24;break}if(o=ca.findBox(s.data,["mdat"])[0]){e.next=14;break}throw new ma("cannot find moov or mdat box",s.data);case 14:return l=o.start+o.size,e.next=17,this.loadData([l],t,r);case 17:if(s=e.sent){e.next=20;break}return e.abrupt("return");case 20:if(i.push(s),a=ca.findBox(s.data,["moov"],l)[0]){e.next=24;break}throw new ma("cannot find moov box",s.data);case 24:if(!(a.size>a.data.length)){e.next=32;break}return e.next=27,this.loadData([s.data.length,a.start+a.size-1],t,r);case 27:if(s=e.sent){e.next=30;break}return e.abrupt("return");case 30:i.push(s),a.data=Ds(a.data,s.data);case 32:if(u=ca.moov(a)){e.next=35;break}throw new ma("cannot parse moov box",a.data);case 35:if(ka(c=Ta(u,this._config))){e.next=38;break}throw new ma("cannot parse segments",a.data);case 38:return c.videoSegments.length&&c.audioSegments.length||(d=ca.findBox(this.buffer,["moof"])[0],f=ca.findBox(this.buffer,["sidx"])[0],d&&d.size<=d.data.length&&f&&(p=ca.moof(d),h=ca.sidx(f),p&&h&&(_a(u,h),as("segments")))),this.meta=Pa(u,h),m=(g=c).videoSegments,v=g.audioSegments,this.videoSegments=m,this.audioSegments=v,delete this.buffer,this.bufferDataLen=0,this.logger.debug("[load moov end!!!!!]"),e.abrupt("return",{meta:this.meta,videoSegments:m,audioSegments:v,responses:i});case 47:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"loadCacheMeta",value:function(e,t){var n=Ta(e.moov,this._config),r=n.videoSegments,i=n.audioSegments;this.videoSegments=r,this.audioSegments=i,this._currentSegmentIndex=t,this.meta=e}},{key:"getSegmentByTime",value:function(e){var t,n;return this.videoSegments.length?(t=this.videoSegments.find((function(t){return t.startTime<=e&&t.endTime>e})),t&&(n=this.audioSegments[t.index])):n=this.audioSegments.find((function(t){return t.startTime<=e&&t.endTime>e})),{video:t,audio:n}}},{key:"loadSegmentByTime",value:(l=qi(os().mark((function e(t,n){var r,i,s,a,o,l=arguments;return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(l.length>2&&void 0!==l[2])||l[2],i=l.length>3&&void 0!==l[3]?l[3]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta(n);case 5:return s=this.getSegmentByTime(t),a=s.video,o=s.audio,e.abrupt("return",this._loadSegment(a,o,n,r,i));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"loadNextSegment",value:(o=qi(os().mark((function e(t){var n,r,i,s,a=arguments;return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(a.length>1&&void 0!==a[1])||a[1],r=a.length>2&&void 0!==a[2]?a[2]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta();case 5:return i=this.videoSegments[this._currentSegmentIndex+1],s=this.audioSegments[this._currentSegmentIndex+1],e.abrupt("return",this._loadSegment(i,s,t,n,r));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"preload",value:(a=qi(os().mark((function e(t){var n,r,i,s,a,o,l,u=this;return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(!0);case 3:if(t&&!(t<0)){e.next=5;break}return e.abrupt("return");case 5:if(n=this.getSegmentByTime(t),r=n.video,i=n.audio,s=Math.max((null==r?void 0:r.index)||0,(null==i?void 0:i.index)||0)){e.next=9;break}return e.abrupt("return");case 9:return a=this.videoSegments.slice(0,s),o=this.audioSegments.slice(0,s),l=function(){var e=qi(os().mark((function e(t){return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>s)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,u._loadSegment(a[t],o[t],!0,!1);case 4:return e.next=6,l(t+1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=14,l(0);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"cancel",value:function(){return this._loader.cancel()}},{key:"reset",value:(s=qi(os().mark((function e(){var t,n=arguments;return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.length>0&&void 0!==n[0]&&n[0]){e.next=5;break}return this.logger.debug("[MP4loader reset func call loader.cancel]"),e.next=5,this._loader.cancel();case 5:this.vid=this.url="",this.meta={},this.downloadInfo=[],this.videoSegments=[],this.audioSegments=[],this._currentSegmentIndex=-1,this._currentLoadingSegmentIndex=-1,null!==(t=this._config)&&void 0!==t&&t.memoryOpt&&(delete this.buffer,this.bufferDataLen=0);case 13:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"destroy",value:(i=qi(os().mark((function e(){return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reset();case 2:this.cache.clear();case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_loadSegment",value:(r=qi(os().mark((function e(t,n,r,i,s){var a,o;return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||n){e.next=2;break}return e.abrupt("return");case 2:return a=(null==t?void 0:t.index)||(null==n?void 0:n.index)||0,this._currentLoadingSegmentIndex=a,e.prev=4,e.next=7,this.loadData([Math.min((null==t?void 0:t.range[0])||1/0,(null==n?void 0:n.range[0])||1/0),Math.max((null==t?void 0:t.range[1])||0,(null==n?void 0:n.range[1])||0)],r,s);case 7:o=e.sent;case 8:return e.prev=8,this._currentLoadingSegmentIndex=-1,e.finish(8);case 11:if(o){e.next=13;break}return e.abrupt("return");case 13:return i&&(this._currentSegmentIndex=a),o.video=t,o.audio=n,e.abrupt("return",o);case 17:case"end":return e.stop()}}),e,this,[[4,,8,11]])}))),function(e,t,n,i,s){return r.apply(this,arguments)})},{key:"loadData",value:(n=qi(os().mark((function e(t,n){var r,i,s,a,o,l=arguments;return os().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]?l[2]:{},i=this._getCacheKey(t),e.next=4,this.cache.get(i);case 4:if(s=e.sent){e.next=12;break}return o=null!=r&&r.url?r.url:this.url,e.next=9,this._loader.load(o,ss({range:t,vid:this.vid},r));case 9:a=e.sent,e.next=13;break;case 12:a={data:s,state:!0,options:{fromCache:!0,range:t,vid:this.vid}};case 13:if(a){e.next=15;break}return e.abrupt("return");case 15:return s||(a.data&&this.downloadInfo.push({startTime:a.startTime,endTime:a.endTime,size:a.data.byteLength,range:t}),this.downloadInfo&&this.downloadInfo.length>this._config.maxDownloadInfoSize&&(this.downloadInfo=this.downloadInfo.slice(-this._config.maxDownloadInfoSize))),e.abrupt("return",a);case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_getCacheKey",value:function(e){return(this.vid||this.url)+":"+e}}]);var n,r,i,s,a,o,l,u,c,h,d}(F()),Ra=function(){return Bs((function e(){As(this,e),Ns(this,"id",1),Ns(this,"type",sa),Ns(this,"codecType","avc"),Ns(this,"pid",-1),Ns(this,"hvcC",void 0),Ns(this,"codec",""),Ns(this,"timescale",0),Ns(this,"formatTimescale",0),Ns(this,"sequenceNumber",0),Ns(this,"baseMediaDecodeTime",0),Ns(this,"baseDts",0),Ns(this,"duration",0),Ns(this,"warnings",[]),Ns(this,"samples",[]),Ns(this,"pps",[]),Ns(this,"sps",[]),Ns(this,"vps",[]),Ns(this,"fpsNum",0),Ns(this,"fpsDen",0),Ns(this,"sarRatio",[]),Ns(this,"width",0),Ns(this,"height",0),Ns(this,"nalUnitSize",4),Ns(this,"present",!1),Ns(this,"isVideoEncryption",!1),Ns(this,"isAudioEncryption",!1),Ns(this,"isVideo",!0),Ns(this,"kid",null),Ns(this,"pssh",null),Ns(this,"ext",void 0)}),[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var e=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-e.dts+t.duration}return 0}},{key:"exist",value:function(){return!!/av01/.test(this.codec)||!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}])}(),xa=function(){return Bs((function e(){As(this,e),Ns(this,"id",2),Ns(this,"type","audio"),Ns(this,"codecType","aac"),Ns(this,"pid",-1),Ns(this,"codec",""),Ns(this,"sequenceNumber",0),Ns(this,"sampleDuration",0),Ns(this,"timescale",0),Ns(this,"formatTimescale",0),Ns(this,"baseMediaDecodeTime",0),Ns(this,"duration",0),Ns(this,"warnings",[]),Ns(this,"samples",[]),Ns(this,"baseDts",0),Ns(this,"sampleSize",16),Ns(this,"sampleRate",0),Ns(this,"channelCount",0),Ns(this,"objectType",0),Ns(this,"sampleRateIndex",0),Ns(this,"config",[]),Ns(this,"present",!1),Ns(this,"isVideoEncryption",!1),Ns(this,"isAudioEncryption",!1),Ns(this,"kid",null),Ns(this,"isHeAACExt",!1),Ns(this,"ext",void 0)}),[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.isHeAACExt=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&"aac"===this.codecType)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var e=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-e.dts+t.duration}return 0}}])}(),Da=function(){return Bs((function e(t,n,r){As(this,e),Ns(this,"flag",{}),Ns(this,"keyframe",!1),Ns(this,"gopId",0),Ns(this,"duration",0),Ns(this,"size",0),Ns(this,"units",[]),Ns(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=n,r&&(this.units=r)}),[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}])}(),Ia=Bs((function e(t,n,r,i){As(this,e),Ns(this,"duration",1024),Ns(this,"flag",{dependsOn:2,isNonSyncSample:0}),Ns(this,"keyframe",!0),this.originPts=this.pts=this.dts=t,this.data=n,this.size=n.byteLength,this.sampleOffset=i,r&&(this.duration=r)})),Ca=function(){return Bs((function e(){As(this,e),Ns(this,"id",3),Ns(this,"type","metadata"),Ns(this,"timescale",0),Ns(this,"flvScriptSamples",[]),Ns(this,"seiSamples",[])}),[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}])}(),La=function(){function e(t,n){As(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),e.disabled=n}return Bs(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(r))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(r))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(r))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(r))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}])}();Ns(La,"disabled",!0);var Oa,Aa=null,Ga=["stts","stsc","stsz","stco","co64","stss","ctts"],Ba=function(){function e(t,n,r,i){var s,a,o=this;if(As(this,e),Ns(this,"_videoSamples",[]),Ns(this,"_audioSamples",[]),Ns(this,"_lastRemainBuffer",[]),Ns(this,"_lastRemainBufferStartPos",0),Ns(this,"videoMaxFrameIdx",-1),Ns(this,"audioMaxFrameIdx",-1),this.videoTrack=new Ra,this.audioTrack=new xa,this.metadataTrack=r||new Ca,this.videoSegmnents=t,this.audioSegmnents=n,this.log=new La("MP4Demuxer",!i||!i.openLog||!i.openLog),this.memoryOpt=null==i?void 0:i.memoryOpt,this.memoryOpt||(t&&t.forEach((function(e){var t;(t=o._videoSamples).push.apply(t,$s(e.frames))})),n&&n.forEach((function(e){var t;(t=o._audioSamples).push.apply(t,$s(e.frames))}))),(null===(s=this.videoSegmnents)||void 0===s?void 0:s.length)>0){var l=this.videoSegmnents[this.videoSegmnents.length-1].frames;this.videoMaxFrameIdx=l[l.length-1].index}if((null===(a=this.audioSegmnents)||void 0===a?void 0:a.length)>0){var u=this.audioSegmnents[this.audioSegmnents.length-1].frames;this.audioMaxFrameIdx=u[u.length-1].index}}return Bs(e,[{key:"parseSamples",value:function(e){if(!e)throw new Error("moov is required");this.videoTrack.codec||this.audioTrack.codec||(ca.moovToTrack(e,this.videoTrack,this.audioTrack),this.videoSenc=this.videoTrack.videoSenc,this.audioSenc=this.audioTrack.audioSenc,this.memoryOpt&&this.clearBoxEntries(e))}},{key:"demux",value:function(e,t,n,r,i){this.parseSamples(i);var s,a,o,l=this.videoTrack,u=this.audioTrack;l.samples=[],u.samples=[];var c={};if(n){var h,d=0;if(this.memoryOpt&&this.videoSegmnents&&!(c=this.getFramePosByIdx("video",n[0])))throw new Error("cannot found video frame #".concat(n[0]));for(var f=c,p=f.frameIdx,g=f.segmentIdx,m=n[0],v=n[1];m<=v;m++){if(!this._videoSamples.length&&this.videoSegmnents){var y=this.getFrameInfo("video",g,p);s=y.sample,g=y.segmentIdx,p=y.frameIdx}else s=this._videoSamples[m];if(!s)throw new Error("cannot found video frame #".concat(m));o=s.offset-t,a=e.subarray(o,o+s.size),(h=new Da("number"==typeof s.pts?s.pts:s.dts,s.dts)).duration=s.duration,h.gopId=s.gopId,s.keyframe&&h.setToKeyframe();for(var _=0,T=a.length-1;_<T;)d=zs(a,_),_+=4,h.units.push(a.subarray(_,_+d)),_+=d;l.samples.push(h)}l.baseMediaDecodeTime=l.samples[0].dts}if(c={},r){if(this.memoryOpt&&this.audioSegmnents&&!(c=this.getFramePosByIdx("audio",r[0])))throw new Error("cannot found video frame #".concat(r[0]));for(var b=c,S=b.frameIdx,P=b.segmentIdx,w=r[0],k=r[1];w<=k;w++){if(!this._audioSamples.length&&this.audioSegmnents){var M=this.getFrameInfo("audio",P,S);s=M.sample,P=M.segmentIdx,S=M.frameIdx}else s=this._audioSamples[w];if(!s)throw new Error("cannot found video frame #".concat(w));o=s.offset-t,a=e.subarray(o,o+s.size),u.samples.push(new Ia(s.dts,a,s.duration))}u.baseMediaDecodeTime=u.samples[0].dts}return{videoTrack:l,audioTrack:u,metadataTrack:this.metadataTrack}}},{key:"demuxPart",value:function(e,t,n,r,i,s,a,o){if(this.parseSamples(i),this.videoTrack.useEME=s,this.audioTrack.useEME=s,this._lastRemainBuffer&&this._lastRemainBuffer.byteLength>0&&t>this._lastRemainBufferStartPos&&t<=this._lastRemainBufferStartPos+this._lastRemainBuffer.byteLength)for(var l=0;l<20;)try{var u=this._lastRemainBuffer.subarray(0,t-this._lastRemainBufferStartPos),c=new Uint8Array(e.byteLength+u.byteLength);c.set(u,0),c.set(new Uint8Array(e),u.byteLength),e=c,t-=u.byteLength,this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0;break}catch(e){if(!(l<20))throw new Error("new Uint8Array error:,"+e.errorMessage);l++}var h,d,f,p=this.videoTrack,g=this.audioTrack;p.samples=[],g.samples=[],p.videoSenc=null,g.audioSenc=null,(null==n?void 0:n[1])>this.videoMaxFrameIdx&&this.videoMaxFrameIdx>0&&(n[1]=this.videoMaxFrameIdx),(null==r?void 0:r[1])>this.audioMaxFrameIdx&&this.audioMaxFrameIdx>0&&(r[1]=this.audioMaxFrameIdx);var m=0,v=0,y={},_=e.byteLength+t;if(n.length>0){var T;if(this.memoryOpt&&this.videoSegmnents&&!(y=this.getFramePosByIdx("video",n[0])))throw new Error("cannot found video frame #".concat(n[0]));for(var b=y,S=b.frameIdx,P=b.segmentIdx,w=n[0];w<=n[1];w++){if(!this._videoSamples.length&&this.videoSegmnents){var k=this.getFrameInfo("video",P,S);h=k.sample,P=k.segmentIdx,S=k.frameIdx}else h=this._videoSamples[w];if(!h)throw new Error("cannot found video frame #".concat(w));if(this.memoryOpt&&h.offset+h.size>_)break;h.offset>=t&&h.offset+h.size<=_&&(m=(f=h.offset-t)+h.size,d=e.subarray(f,m),(T=new Da("number"==typeof h.pts?h.pts:h.dts,h.dts)).duration=h.duration,T.gopId=h.gopId,T.sampleOffset=h.index,h.keyframe&&T.setToKeyframe(),T.data=d,T.size=h.size,p.samples.push(T))}p.samples.length>0&&(p.gopId=p.samples[0].gopId,p.baseMediaDecodeTime=p.samples[0].dts,p.startPts=p.samples[0].pts/p.timescale,p.endPts=p.samples[p.samples.length-1].pts/p.timescale,p.startDts=p.samples[0].dts/p.timescale,p.endDts=p.samples[p.samples.length-1].dts/p.timescale,this.videoSenc&&(p.videoSenc=this.videoSenc.slice(p.samples[0].sampleOffset,p.samples[0].sampleOffset+p.samples.length),p.kidValue=a))}if(r.length>0){if(this.memoryOpt&&this.audioSegmnents&&!(y=this.getFramePosByIdx("audio",r[0])))throw new Error("cannot found video frame #".concat(r[0]));for(var M=y,E=M.frameIdx,R=M.segmentIdx,x=r[0];x<=r[1];x++){if(!this._audioSamples.length&&this.audioSegmnents){var D=this.getFrameInfo("audio",R,E);h=D.sample,R=D.segmentIdx,E=D.frameIdx}else h=this._audioSamples[x];if(!h)throw new Error("cannot found video frame #".concat(x));if(this.memoryOpt&&h.offset+h.size>_)break;h.offset>=t&&h.offset+h.size<=_&&(v=(f=h.offset-t)+h.size,d=e.subarray(f,v),g.samples.push(new Ia(h.dts,d,h.duration,h.index)))}g.samples.length>0&&(g.gopId=g.samples[0].gopId||p.gopId,g.baseMediaDecodeTime=g.samples[0].dts,g.startPts=g.samples[0].pts/g.timescale,g.endPts=g.samples[g.samples.length-1].pts/g.timescale,this.audioSenc&&(g.audioSenc=this.audioSenc.slice(g.samples[0].sampleOffset,g.samples[0].sampleOffset+g.samples.length),g.kidValue=a))}this.decoderData(p,g,o);for(var I=0,C=0;C<p.samples.length;C++)for(var L=0,O=p.samples[C].data,A=O.length-1;L<A;)I=zs(O,L),L+=4,p.samples[C].units.push(O.subarray(L,L+I)),L+=I;var G=Math.max(m,v);return this._lastRemainBuffer=e.subarray(G),this._lastRemainBuffer.byteLength>0?this._lastRemainBufferStartPos=t+e.byteLength-this._lastRemainBuffer.byteLength:this._lastRemainBufferStartPos=0,{videoTrack:p,audioTrack:g,metadataTrack:this.metadataTrack,lastRemainBufferInfo:{data:this._lastRemainBuffer,pos:this._lastRemainBufferStartPos}}}},{key:"setLastRemainBufferInfo",value:function(e,t){this._lastRemainBuffer=e,this._lastRemainBufferStartPos=t}},{key:"reset",value:function(){this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0,this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}},{key:"decoderData",value:function(t,n,r){if(!t.useEME&&!n.useEME&&(null!=t&&t.videoSenc||null!=n&&n.audioSenc)){if(!e.Crypto)throw new Error("Crypto is not defined");e.Crypto.decoderAESCTRData(t,n,r)}}},{key:"getFramePosByIdx",value:function(e,t){var n="video"===e?this.videoSegmnents:this.audioSegmnents;if(!n||null==n||!n.length)return null;for(var r,i=0,s=0;s<n.length;s++){var a,o;if(r=n[s].frames,t<=(null===(a=n[s].frames)||void 0===a?void 0:a[(null===(o=r)||void 0===o?void 0:o.length)-1].index)){i=s;break}}return{frameIdx:r.findIndex((function(e){return e.index===t})),segmentIdx:i}}},{key:"getFrameInfo",value:function(e,t,n){var r,i,s,a,o="video"===e?this.videoSegmnents:this.audioSegmnents;return o?n<(null===(r=o[t])||void 0===r||null===(i=r.frames)||void 0===i?void 0:i.length)?{sample:null===(s=o[t])||void 0===s?void 0:s.frames[n],segmentIdx:t,frameIdx:n+1}:{sample:null===(a=o[t+1])||void 0===a?void 0:a.frames[0],segmentIdx:t+1,frameIdx:1}:{}}},{key:"clearBoxEntries",value:function(e){this.memoryOpt&&e.trak.forEach((function(e){Ga.forEach((function(t){var n=e.mdia.minf.stbl[t];n&&(n.entries&&(n.entries=null),n.entrySizes&&(n.entrySizes=null))}))}))}}],[{key:"Crypto",get:function(){return Aa},set:function(e){Aa=e}},{key:"probe",value:function(e){return ca.probe(e)}}])}(),Na=function(){return Bs((function e(){As(this,e),this.buffer=new Uint8Array(0)}),[{key:"write",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){t?e.buffer=function(e){for(var t=0,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];r.forEach((function(e){t+=e.length}));var s=new e(t),a=0;return r.forEach((function(e){s.set(e,a),a+=e.length})),s}(Uint8Array,e.buffer,t):window.console.warn(t)}))}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}])}(),$a=Math.pow(2,32)-1,Ua=function(){function e(){As(this,e)}return Bs(e,null,[{key:"box",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=8+(n=n.filter(Boolean)).reduce((function(e,t){return e+t.byteLength}),0),s=new Uint8Array(i);s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=255&i,s.set(e,4);var a=8;return n.forEach((function(e){s.set(e,a),a+=e.byteLength})),s}},{key:"FullBox",value:function(t,n,r){for(var i=arguments.length,s=new Array(i>3?i-3:0),a=3;a<i;a++)s[a-3]=arguments[a];return e.box.apply(e,[t,new Uint8Array([n,r>>16&255,r>>8&255,255&r])].concat(s))}},{key:"ftyp",value:function(t){return t.find((function(e){return e.type===sa&&e.codecType===aa}))?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return Hs(e.ftyp(t),e.moov(t))}},{key:"pssh",value:function(t){var n=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],Qs(t.kid),[0,0,0,0]));return e.box(e.types.pssh,n)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var n=this.pssh(t[0].pssh);return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale),e.mvex(t)].concat($s(t.map((function(t){return e.trak(t)}))),[n]))}return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale)].concat($s(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.tkhdDuration||0,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))}},{key:"edts",value:function(t){return e.box(e.types.edts,e.elst(t))}},{key:"elst",value:function(t){t.entries;var n=t.entriesData,r=t.version;return e.FullBox(e.types.elst,r,0,n)}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]))}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===sa?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){return t&&t.ext,e.box(e.types.stbl,e.stsd(t),e.STTS,[][0],e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){var n;return n="audio"===t.type?t.useEME&&t.enca?e.enca(t):e.mp4a(t):t.useEME&&t.encv?e.encv(t):t.av1C?e.av01(t):e.avc1hev1vvc1(t),e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),n)}},{key:"enca",value:function(t){var n=t.enca.channelCount,r=t.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,r>>8&255,255&r,0,0]),s=e.esds(t.config),a=e.sinf(t.enca);return e.box(e.types.enca,i,s,a)}},{key:"encv",value:function(t){var n,r,i=t.sps.length>0?t.sps[0]:[],s=t.pps.length>0?t.pps[0]:[],a=t.width,o=t.height,l=t.sarRatio[0],u=t.sarRatio[1],c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a>>8&255,255&a,o>>8&255,255&o,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h=new Uint8Array((n=(r=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,255&i.length]).concat.apply(r,$s(i)).concat([1,s.length>>>8&255,255&s.length])).concat.apply(n,$s(s))),d=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),f=e.sinf(t.encv),p=new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,u>>24,u>>16&255,u>>8&255,255&u]);return e.box(e.types.encv,c,e.box(e.types.avcC,h),e.box(e.types.btrt,d),f,e.box(e.types.pasp,p))}},{key:"schi",value:function(t){var n=new Uint8Array([]),r=e.tenc(t);return e.box(e.types.schi,n,r)}},{key:"tenc",value:function(t){var n=new Uint8Array([0,0,0,0,0,0,255&t.default_IsEncrypted,255&t.default_IV_size].concat(Qs(t.default_KID)));return e.box(e.types.tenc,n)}},{key:"sinf",value:function(t){var n=new Uint8Array([]),r=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),s=e.schi(t);return e.box(e.types.sinf,n,e.box(e.types.frma,r),e.box(e.types.schm,i),s)}},{key:"av01",value:function(t){return e.box(e.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),t.av1C,t.colr)}},{key:"avc1hev1vvc1",value:function(t){var n,r;t.codecType===aa?(n=e.hvcC(t),r=e.types.hvc1):t.codecType===oa?(n=e.vvcC(t),r=e.types.bvc2):(n=e.avcC(t),r=e.types.avc1);var i=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n];return t.codecType===aa?i.push(e.box(e.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&i.push(e.pasp(t.sarRatio)),e.box.apply(e,[r].concat(i))}},{key:"avcC",value:function(t){var n,r,i,s=[],a=[];return t.sps.forEach((function(e){i=e.byteLength,s.push(i>>>8&255),s.push(255&i),s.push.apply(s,$s(e))})),t.pps.forEach((function(e){i=e.byteLength,a.push(i>>>8&255),a.push(255&i),a.push.apply(a,$s(e))})),e.box(e.types.avcC,new Uint8Array((n=(r=[1,s[3],s[4],s[5],255,224|t.sps.length]).concat.apply(r,s).concat([t.pps.length])).concat.apply(n,a)))}},{key:"vvcC",value:function(t){var n=t.vvcC;return e.box(e.types.bv2C,new Uint8Array(n))}},{key:"hvcC",value:function(t){var n=t.hvcC;if(n instanceof ArrayBuffer||n instanceof Uint8Array)return n;var r,i=t.vps,s=t.sps,a=t.pps;if(n){var o=n.generalProfileCompatibilityFlags,l=n.generalConstraintIndicatorFlags,u=(i.length&&1)+(s.length&&1)+(a.length&&1);r=[1,n.generalProfileSpace<<6|n.generalTierFlag<<5|n.generalProfileIdc,o>>>24,o>>>16,o>>>8,o,l[0],l[1],l[2],l[3],l[4],l[5],n.generalLevelIdc,240,0,252,252|n.chromaFormatIdc,248|n.bitDepthLumaMinus8,248|n.bitDepthChromaMinus8,0,0,n.numTemporalLayers<<3|n.temporalIdNested<<2|3,u];var c=function(e){var t;r.push(e.length>>8,e.length),(t=r).push.apply(t,$s(e))};i.length&&(r.push(160,0,i.length),i.forEach(c)),s.length&&(r.push(161,0,s.length),s.forEach(c)),a.length&&(r.push(162,0,a.length),a.forEach(c))}else r=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(r))}},{key:"pasp",value:function(t){var n,r,i=(r=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}(n,r)||Fs(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=i[0],a=i[1];return e.box(e.types.pasp,new Uint8Array([s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var n=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+n,0,0,0,4,15+n,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([n]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){return e.box.apply(e,[e.types.mvex].concat($s(t.map((function(t){return e.trex(t.id)})))))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trex1",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]))}},{key:"trex2",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]))}},{key:"moof",value:function(t){return e.box.apply(e,[e.types.moof,e.mfhd(t[0].samples?t[0].samples[0].gopId:0)].concat($s(t.map((function(t){return e.traf(t)})))))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){var n=e.tfhd(t.id),r=e.tfdt(t.baseMediaDecodeTime),i=0;if(t.isVideo&&t.videoSenc&&t.videoSenc.forEach((function(e){i+=8,e.subsamples&&e.subsamples.length&&(i+=2,i+=6*e.subsamples.length)})),t.videoSencLength=i,t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)){if(t.isVideoEncryption){if(t.isVideo){var s=e.saiz(t),a=e.saio(t),o=e.trun1(t),l=e.senc(t);return e.box(e.types.traf,n,r,s,a,o,l)}if(t.isAudioEncryption){var u=e.sbgp(),c=e.saiz(t),h=e.saio(t),d=e.senc(t),f=e.trun1(t);return e.box(e.types.traf,n,r,u,c,h,d,f)}var p=e.sbgp(),g=e.trun1(t);return e.box(e.types.traf,n,r,p,g)}if(t.isVideo){var m=e.trun1(t);return e.box(e.types.traf,n,r,m)}var v=e.sbgp(),y=e.saiz(t),_=e.saio(t),T=e.senc(t),b=e.trun1(t);return e.box(e.types.traf,n,r,v,y,_,T,b)}var S=e.sdtp(t);return e.box(e.types.traf,n,r,S,e.trun(t.samples,S.byteLength+76))}},{key:"sdtp",value:function(t){var n=new Na;return t.samples.forEach((function(e){n.write(new Uint8Array(t.isVideo?[e.keyframe?32:16]:[16]))})),e.box(e.types.sdtp,this.extension(0,0),n.buffer)}},{key:"trun1",value:function(t){var n=new Na,r=Na.writeUint32(t.samples.length),i=null;if(t.isVideo){var s=t.videoSencLength;i=Na.writeUint32(76+16*t.samples.length+s+77),!t.isVideoEncryption&&t.isAudioEncryption&&(i=Na.writeUint32(76+16*t.samples.length+20))}else{var a=76+12*t.samples.length+52;t.isAudioEncryption&&(a=76+12*t.samples.length+8*t.audioSenc.length+105),i=Na.writeUint32(a)}return t.samples.forEach((function(e){n.write(Na.writeUint32(e.duration)),n.write(Na.writeUint32(e.size)),n.write(Na.writeUint32(e.keyframe?33554432:65536)),t.isVideo&&n.write(Na.writeUint32(e.cts?e.cts:0))})),e.box(e.types.trun,this.extension(0,t.flags),r,i,n.buffer)}},{key:"senc",value:function(t){var n=new Na,r=t.samples.length,i=t.isVideo?16:8,s=t.isVideo?2:0,a=[],o=0;return t.isVideo?(a=t.videoSenc,o=t.videoSencLength):a=t.audioSenc,o=o||i*r,n.write(Na.writeUint32(16+o),e.types.senc,this.extension(0,s)),n.write(Na.writeUint32(r)),a.forEach((function(e){for(var t=0;t<e.InitializationVector.length;t++)n.write(new Uint8Array([e.InitializationVector[t]]));e.subsamples&&e.subsamples.length&&(n.write(Na.writeUint16(e.subsamples.length)),e.subsamples.forEach((function(e){n.write(Na.writeUint16(e.BytesOfClearData)),n.write(Na.writeUint32(e.BytesOfProtectedData))})))})),n.buffer}},{key:"saio",value:function(t){var n=12*t.samples.length+141;!t.isVideo&&t.isAudioEncryption&&(n=149);var r=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n]);return e.box(e.types.saio,r)}},{key:"saiz",value:function(t){var n=t.samples.length,r=new Uint8Array([0,0,0,0,16,n>>24&255,n>>16&255,n>>8&255,255&n]);return e.box(e.types.saiz,r)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return e.box(e.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t){var n=Math.floor(t/($a+1)),r=Math.floor(t%($a+1));return e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r]))}},{key:"trun",value:function(t,n){var r=t.length,i=12+16*r;n+=8+i;var s=new Uint8Array(i);s.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0);for(var a=0;a<r;a++){var o=t[a],l=o.duration,u=o.size,c=o.flag,h=void 0===c?{}:c,d=o.cts,f=void 0===d?0:d;s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,h.isLeading<<2|(null===h.dependsOn||void 0===h.dependsOn?1:h.dependsOn),h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|(null===h.isNonSyncSample||void 0===h.isNonSyncSample?1:h.isNonSyncSample),61440&h.degradationPriority,15&h.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*a)}return e.box(e.types.trun,s)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat($s(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===sa?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var n=t.ext,r=[e.stsd(t),e.stts(n.stts),e.stsc(n.stsc),e.stsz(n.stsz),e.stco(n.stco)];return n.stss.length&&r.push(e.stss(n.stss)),n.ctts.length&&r.push(e.ctts(n.ctts)),e.box.apply(e,[e.types.stbl].concat(r))}},{key:"stts",value:function(t){var n=t.length,r=new Uint8Array(8*n),i=0;return t.forEach((function(e){var t=e.value,n=e.count;r.set([n>>24,n>>16&255,n>>8&255,255&n,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,Hs(new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}},{key:"stsc",value:function(t){var n=t.length,r=new Uint8Array(12*n),i=0;return t.forEach((function(e){var t=e.firstChunk,n=e.samplesPerChunk,s=e.sampleDescIndex;r.set([t>>24,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s],i),i+=12})),e.box(e.types.stsc,Hs(new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}},{key:"stsz",value:function(t){var n=t.length,r=new Uint8Array(4*n),i=0;return t.forEach((function(e){r.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,Hs(new Uint8Array([0,0,0,0,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}},{key:"stco",value:function(t){var n=t.length,r=new Uint8Array(4*n),i=0;return t.forEach((function(e){r.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,Hs(new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}},{key:"stss",value:function(t){var n=t.length,r=new Uint8Array(4*n),i=0;return t.forEach((function(e){r.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,Hs(new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}},{key:"ctts",value:function(t){var n=t.length,r=new Uint8Array(8*n),i=0;return t.forEach((function(e){var t=e.value,n=e.count;r.set([n>>24,n>>16&255,n>>8&255,255&n,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,Hs(new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}},{key:"styp",value:function(){return e.box(e.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var n=t.timescale,r=t.samples[0].duration,i=r*t.samples.length,s=t.samples[0].sampleOffset*r,a=8;t.samples.forEach((function(e){a+=e.size}));var o=0;if(t.isVideo){var l,u=0;t.videoSenc&&(l=t.videoSenc),t.isVideo&&l.forEach((function(e){u+=8,e.subsamples&&e.subsamples.length&&(u+=2,u+=6*e.subsamples.length)})),t.videoSencLength=u,o=a+141+16*t.samples.length+u,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(o=a+16*t.samples.length+84)}else o=a+116+12*t.samples.length,t.useEME&&t.isAudioEncryption&&(o=a+169+12*t.samples.length+8*t.audioSenc.length);var c=new Uint8Array([0,0,0,0,0,0,0,255&t.id,n>>24&255,n>>16&255,n>>8&255,255&n,s>>24&255,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,1,0,o>>16&255,o>>8&255,255&o,i>>24&255,i>>16&255,i>>8&255,255&i,144,0,0,0]);return e.box(e.types.sidx,c)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}])}();Oa=Ua,Ns(Ua,"types",["av01","av1C","avc1","avcC","hvc1","hvcC","dinf","dref","edts","elst","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp","bvc2","bv2C"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),Ns(Ua,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),Ns(Ua,"FTYPAVC1",Oa.box(Oa.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),Ns(Ua,"FTYPHEV1",Oa.box(Oa.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),Ns(Ua,"DINF",Oa.box(Oa.types.dinf,Oa.box(Oa.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),Ns(Ua,"VMHD",Oa.box(Oa.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),Ns(Ua,"SMHD",Oa.box(Oa.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),Ns(Ua,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),Ns(Ua,"STTS",Oa.box(Oa.types.stts,Oa.StblTable)),Ns(Ua,"STSC",Oa.box(Oa.types.stsc,Oa.StblTable)),Ns(Ua,"STSZ",Oa.box(Oa.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),Ns(Ua,"STCO",Oa.box(Oa.types.stco,Oa.StblTable));var Fa=function(){return Bs((function e(t,n,r){As(this,e),this.videoTrack=t,this.audioTrack=n;var i=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=i&&Number(i[1])<50,this.log=new La("FMP4Remuxer",!r||!r.openLog||!r.openLog)}),[{key:"remux",value:function(){var e,t,n,r,i,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.videoTrack,l=this.audioTrack,u=o.exist(),c=l.exist(),h=[];return s&&(a&&a.initMerge?(u&&h.push(this.videoTrack),c&&h.push(this.audioTrack),n=Ua.initSegment(h)):(u&&(e=Ua.initSegment([this.videoTrack])),c&&(t=Ua.initSegment([this.audioTrack])))),u&&o.hasSample()&&(r=this._remuxVideo()),c&&l.hasSample()&&(i=this._remuxAudio()),o.samples=[],l.samples=[],{initSegment:n,videoInitSegment:e,audioInitSegment:t,videoSegment:r,audioSegment:i}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=e.samples,n=/av01/.test(e.codec),r=0;n?t.forEach((function(e){r+=e.data.byteLength})):t.forEach((function(e){r+=e.units.reduce((function(e,t){return e+t.byteLength}),0),r+=4*e.units.length}));var i=new Uint8Array(r);if(n)for(var s,a=0,o=t.length,l=0;a<o;a++)s=t[a],i.set(s.data,l),s.size=s.data.byteLength,l+=s.size;else for(var u,c=new DataView(i.buffer),h=function(e,n){n=t[d];var r=0;n.units.forEach((function(t){c.setUint32(e,t.byteLength),e+=4,i.set(t,e),e+=t.byteLength,r+=4+t.byteLength})),n.size=r,p=e,u=n},d=0,f=t.length,p=0;d<f;d++)h(p,u);var g=Ua.mdat(i);return Hs(Ua.moof([e]),g)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));e.samples.reduce((function(e,n){return t.set(n.data,e),e+n.size}),0);var n=Ua.mdat(t);return Hs(Ua.moof([e]),n)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}])}(),Ha=Object.defineProperty,Va=(e,t,n)=>((e,t,n)=>t in e?Ha(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);const ja={MEDIA_EXPIRED:"MEDIA_EXPIRED",INIT_FAIL:"INIT_FAIL",PARSE_ERROR:"PARSE_ERROR",PLAYER_LOG:"PLAYER_LOG",BUFFERED_RESET:"BUFFERED_RESET"},za="real_time_speed",Xa="is unsupported",Ka="buffer_control",Wa="cdn",Qa="pcdn",qa=new Map,Ya=new Map,Ja=new Map,Za="gop",eo="size",to={BUFFER_CONTROLS:"buffer_control"},no="timer_update",ro="h264",io="h265",so="h266",ao="0.2.17",oo={416:Qr[Wr.NETWROK_RANGE_NOT_SATISFIABLE],403:Qr[Wr.NETWORK_FORBIDDEN],404:Qr[Wr.NETWORK_NOTFOUND],timeout:Qr[Wr.NETWORK_TIMEOUT],"4xx":`${Qr[Wr.NETWORK]}4XX`,"5xx":`${Qr[Wr.NETWORK]}5XX`,networkError:Qr[Wr.NETWORK],contentError:`${Qr[Wr.NETWORK]}contentError`,mse:Qr[Wr.MEDIA][Wr.SUB_TYPES.MSE_OTHER],mseOpen:Qr[Wr.MEDIA][Wr.SUB_TYPES.MSE_ADD_SB],mseAppend:Qr[Wr.MEDIA][Wr.SUB_TYPES.MSE_APPEND_BUFFER],mse_hijack:Qr[Wr.MEDIA][Wr.SUB_TYPES.MSE_HIJACK],eme_hijack:Qr[Wr.MEDIA][Wr.SUB_TYPES.EME_HIJACK],metaError:Qr[Wr.DEMUX][Wr.SUB_TYPES.MP4],muxError:Qr[Wr.REMUX][Wr.SUB_TYPES.FMP4],other:Qr[Wr.OTHER],waitTimeout:Qr[Wr.RUNTIME][Wr.SUB_TYPES.BUFFERBREAK_ERROR],waitTimeoutWithHidden:Qr[Wr.RUNTIME][Wr.SUB_TYPES.WAITING_TIMEOUT_ERROR],drm:Qr[Wr.DRM][Wr.SUB_TYPES.LICENSE]},lo=Wr;class uo{constructor(e,t,n){let r=0,i=0;n&&n.range&&n.range.length>1&&(r=n.range[0],i=n.range[1]);const s=function(e){return oo[e]||e}(t);return{errorCode:s,errorType:e,errorMessage:(null==n?void 0:n.httpText)||(null==n?void 0:n.message),url:null==n?void 0:n.url,httpCode:t,version:ao,rangeStart:r,rangeEnd:i,ext:n,mediaError:{code:s,message:(null==n?void 0:n.httpText)||(null==n?void 0:n.message)}}}}class co{constructor(e,t,n){return{errorCode:t,errorType:e,version:ao,errorMessage:n.msg,ext:n,mediaError:{code:t,message:n.msg}}}}const ho=[{range:[0,90],size:614400},{range:[90,120],size:819200},{range:[120,Number.MAX_VALUE],size:1024e3}];function fo(e,t,n){let r=n>51200?Math.min(n,t):t;if(!e)return r;for(let i=0;i<ho.length;i++)if(e>=ho[i].range[0]&&e<ho[i].range[1]){r=Math.min(Math.max(r,ho[i].size),n>0?n:t);break}return r}const po=function(){try{return typeof localStorage<"u"&&"setItem"in window.localStorage&&!!window.localStorage.setItem}catch{return!1}}()&&!function(){const e="_localstorage_support_test";try{return window.localStorage.setItem(e,!0),window.localStorage.removeItem(e),!1}catch{return!0}}(),go=yo(),mo=function(){if(po)try{return!!window.localStorage.getItem("playertestlog")}catch{return!1}return!1}(),vo={1:"debug",2:"log",3:"warn",4:"error"};function yo(){if(po)try{return!!window.localStorage.getItem("playerlog")}catch{return!1}return!1}function _o(e,t,n,...r){const i=vo[t];i&&e&&e[i]&&e[i](n,...r)}function To(e="div",t="",n={},r=""){const i=document.createElement(e);return i.className=r,i.innerHTML=t,Object.keys(n).forEach((t=>{const r=t,s=n[t];"video"===e||"audio"===e||"live-video"===e?s&&i.setAttribute(r,s):i.setAttribute(r,s)})),i}function bo(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}function So(){try{return parseInt(performance.now(),10)}catch{return(new Date).getTime()}}function Po(e,t){try{const n=e.indexOf("?");return n<0?Object.keys(t).forEach(((n,r)=>{e+=0===r?`?${n}=${t[n]}`:`&${n}=${t[n]}`})):Object.keys(t).forEach((r=>{n===e.length-1?e+=`${r}=${t[r]}`:e+=`&${r}=${t[r]}`})),e}catch{return e}}function wo(e,t){return Object.keys(t).forEach((n=>{const r=bo(t[n]),i=bo(e[n]);"Array"===r?("Array"!==i&&(e[n]=[]),e[n].push(...t[n])):"Object"===r?("Object"!==i&&(e[n]={}),wo(e[n],t[n])):e[n]=t[n]})),e}function ko(e,t){try{return e&&t?parseInt(t*e/8,10):0}catch{return 0}}function Mo(e,t){const n=[];let r=0;e&&n.push(e),t&&n.push(t),n.every((e=>(e&&(r+=e.byteLength),!0)));const i=new Uint8Array(r);let s=0;return n.every((e=>(e&&(i.set(e,s),s+=e.byteLength),!0))),i}function Eo(e,t,n){let r=null,i=null;return r=e<t.length-1?t[e]:t[t.length-1],i=e<n.length-1?n[e]:n[n.length-1],[Math.min((null==r?void 0:r.range[0])||1/0,(null==i?void 0:i.range[0])||1/0),Math.max(null==r?void 0:r.range[1],null==i?void 0:i.range[1])]}function Ro(e){if("String"!==bo(e)||!e)return"";const t=e.split("/");let n="";return t.length>3&&t[2]&&(n=t[2]),n}function xo(e){let t,n=0;for(;n<10;)try{if(t=new Uint8Array(e),t&&t.byteLength>0)break;n++}catch{n<10?n++:console.error("repeat data cache  new array failed final",10)}return t}const Do={playBtnClick:(e,t,n,r)=>{e.paused||e.waitingMoreBuffer&&(e.waitingMoreBuffer=!1),r.call(e,t,n)}},Io={waiting:(e,t)=>{const{player:n,eventName:r}=e;n.waitingMoreBuffer=!0,t(r,e)},play:(e,t)=>{const{player:n,eventName:r}=e;n.waitingMoreBuffer||t(r,e)},pause:(e,t)=>{const{player:n,eventName:r}=e;n.waitingMoreBuffer||t(r,e)},seeking:(e,t)=>{const{player:n,eventName:r}=e;n.isSeekingStart=!0,t(r,e)},progress:(e,t)=>{_o(">>>>progress");const{player:n,eventName:r}=e;if(n.waitingMoreBuffer){const e=n.getBufferedRange(n.buffered2);0===e[0]&&0===e[1]||(void 0===n.inWaitingStart||n.isSeekingStart?(_o("progress startplay or seek ended"),e[1]-n.currentTime>=(n.config.canplayWaterLevel||1)||e[1]>n.duration-1?(_o("progress out bufferWaterLevel"),n.play()):(_o("progress not out bufferWaterLevel"),n.emit("waiting"))):(_o("progress video waiting end"),e[1]-n.currentTime>=(n.config.bufferWaterLevel||5)||e[1]>n.duration-1?(_o("progress out bufferWaterLevel"),n.play()):(_o("progress not out bufferWaterLevel"),n.emit("waiting"))))}t(r,e)},playing:(e,t)=>{const{player:n,eventName:r}=e;_o("playing");const i=n.getBufferedRange(n.buffered2);if(0===i[0]&&0===i[1])return _o("playing currentTime no buffer, not out bufferWaterLevel"),n.waitingMoreBuffer=!0,n.pause(),void t.call("waiting",e);void 0===n.inWaitingStart||n.isSeekingStart?(_o("playing startplay or seek ended"),i[1]-n.currentTime>=(n.config.canplayWaterLevel||1)||i[1]>n.duration-1?(_o("playing out bufferWaterLevel"),n.waitingMoreBuffer=!1,n.isSeekingStart=!1,t(r,e)):(_o("playing not out bufferWaterLevel"),n.waitingMoreBuffer=!0,n.pause(),t.call("waiting",e))):(_o("playing video waiting ended"),i[1]-n.currentTime>=(n.config.bufferWaterLevel||5)||i[1]>n.duration-1?(_o("playing out bufferWaterLevel"),n.waitingMoreBuffer=!1,t(r,e)):(_o("playing not out bufferWaterLevel"),n.waitingMoreBuffer=!0,n.pause(),t.call("waiting",e)))}};function Co(e,t){return Math.round(8*e*1e3/t/1024)}function Lo(e){var t,n;return!((null==(t=null==e?void 0:e.message)?void 0:t.indexOf("Failed to fetch"))>=0||null!=e&&e.response&&(null==(n=e.response)?void 0:n.status)>=400&&e.response.status<=599)}function Oo(e,t,n){e.video&&e.video.addEventListener(t,n)}function Ao(e,t,n){e.video&&e.video.removeEventListener(t,n)}function Go(e){return e&&e.video&&"function"==typeof e.video.getStats?e.video.getStats():null}function Bo(e){const{kid:t,drmKeyToken:n,secretKey:r,keyValue:i,drm:s}=e;return t||n||r||i||s}function No(e){const{cachedBufferDur:t,loadTarDuration:n,loadDuration:r,forceSetMin:i}=e,{PCDNInBuffer:s,PCDNOutBuffer:a,loadSize:o}=e;return{buffer_dur:t||-1,load_tar_dur:n||-1,load_dur:r||-1,force_set_min:i,in_buf:s||-1,out_buf:a||-1,load_size:o||-1}}const $o={"x-cache":"x_cache","x-response-sinfo":"server_ip","x-response-cinfo":"x-response-cinfo","content-range":"content-range","content-length":"content-length","content-type":"content-type"};function Uo(e){const t={};return!e||!e.get||Object.keys($o).forEach((n=>{const r=$o[n];e.get(n)&&(t[r]=e.get(n))})),t}function Fo(e){const t=$o["content-range"];if(e&&e.get&&e.get(t)){const n=e.get(t).split("/");if(2===(null==n?void 0:n.length))return n[1]}return null}const Ho="error",Vo="metaReady",jo="moov_request_Progress",zo="progress_event",Xo="updateEME",Ko="init_MSE",Wo="chaneg_url",Qo="update_load_fragmentIdx",qo="remove_pcdn_node",Yo="load_error",Jo="cancel_loaded_len",Zo="load_len_not_match_error",el="close",tl="forbidden",nl={},rl=class e extends U{constructor(t,n,r,i=[],s){var a;super(),Va(this,"markErrHost",(e=>{e&&(nl[e]=!0,this.log($r.WARN,"[mp4loader markErrHost]",e))})),Va(this,"onprogressDataArrive",(async(e,t,n,r)=>{var i;const s=(null==(i=null==n?void 0:n.priOptions)?void 0:i.type)||Wa,a=this.adaptTimeRange[n.index].range;if(e&&e.byteLength>0?(!this._optionDataLenInfo[s]&&(this._optionDataLenInfo[s]=0),this._optionDataLenInfo[s]+=e.byteLength,this._receiveDataPos=null==n?void 0:n.range[1],a&&n.range[1]>a[1]&&!t&&(t=!0,this.log($r.LOG,"[onprogressDataArrive] receive data, check state set true >>> index,",n.index,",range,",JSON.stringify(n.range))),this.cacheRepeatData(this.adaptTimeRange[n.index].repeatRange,n.range,e),this.log($r.LOG,"[onprogressDataArrive] receive data, >>> index,",n.index,",range,",JSON.stringify(n.range),", dataLen,",e.byteLength,",loadType,",s,t),this._mux(e,n.range[0],n.index,t)):this.log($r.LOG,"[onprogressDataArrive] receive data null, >>> index,",n.index,",range,",JSON.stringify(n.range),", dataLen,",null==e?void 0:e.byteLength,",loadType,",s,t),t){this._optionDataLenInfo[s]=0;const e=Uo(r.headers);this.totalSize||(this.totalSize=function(e){try{const t=Object.keys(e).filter((e=>"content-range"===e));if(t.length>0){const n=e[t[0]].split("/");if(2===(null==n?void 0:n.length))return parseInt(n[1],10)}return 0}catch(e){return console.error(e),0}}(e));const t=a&&a.length>=0?Number(a[1]):0;if((null==a?void 0:a.length)>0&&(!t||t&&((null==n?void 0:n.range[1])===t+1||this.totalSize===t)))this.adaptTimeRange[n.index].downloaded=!0,this.log($r.LOG,"[FragLoadDowned],fragmentIdx,",n.index,",rangeEnd,",n.range[1]);else{await this.cancelLoading();const{startTime:t,endTime:i}=this.adaptTimeRange[n.index];this.emit(Zo,[t,i]);const o=s===Wa?this.url:this._pcdnNodeList[0].url,l=Ro(o);this.emit(Yo,{src:o,host:l,errorCode:oo.contentError,message:"progress dataLen not match",range:JSON.stringify(a),headers:e}),this.log($r.LOG,"[FragLoadDowned check false, len is not match],fragmentIdx,",n.index,",rangeEnd,",n.range[1],JSON.stringify(a),JSON.stringify(e),o,null==r?void 0:r.url),await this.loadAllFragmentData(this._curLoadSegIdx,this._loadSuccessCallBack)}}})),this.timeRecord={startMuxTime:-1,startLoadTime:-1,newMP4Time:So(),startLoadMetaTime:-1},this.updateUrl(t,i||[]),this._bitRate=n||0,this.options=e.getDefaultConfig(),Object.keys(r).map((e=>{void 0!==r[e]&&null!==r[e]&&(this.options[e]=r[e])})),this.logger=r.logger,this.timeRange=[],this.adaptTimeRange=[],this.firstFrameTime=s||{},this.fileSize=null==r?void 0:r.fileSize,this.totalSize=0,this.CHUNK_SIZE=(null==(a=this.options)?void 0:a.firstLoadSize)||fo(r.duration,this.options.chunkSize,this.fileSize),this._firstLoadSize=this.CHUNK_SIZE,this.log($r.LOG,"[getFirstLoadSize], firstLoadSize ",this._firstLoadSize,",dur,",r.duration,",chunkSize,",this.CHUNK_SIZE,",fileSize,",this.fileSize),this._repeatInfo={startPos:-1,curDataPos:0,usedPos:0,data:xo(1048576)},this.meta=null,this.preloadCache=null,this.videoTrak=null,this.audioTrak=null,this._loadSuccessCallBack=null,this._isPending=!1,this.metaLoading=!1,this.MP4Loader=new Ea({url:t,vid:`${r.vid}-${n}`,retry:r.retryCount||2,retryDelay:r.retryDelay||1e3,timeout:r.timeout||3e3,segmentDuration:r.segmentDuration,fixEditListOffset:r.fixEditListOffset,...r.reqOptions,loaderType:r.loaderType,retryCheckFunc:Lo,openLog:go}),this.MP4Demuxer=null,this.FMP4Remuxer=null,this._needInitSegment=!0,this._bitRateInfoMap=new Map,this._switchBitRate=!1,this._segmentToBitRateMap=new Map,this.useEME=!1,this.secretKey=null,this.decryptKey=null,this.keyValue=null,this.initTransMuxWorker(),this.seekTime=-1,this.changeBitRateTime=-1,this._PCDNState=el,this._pcdnNodeList=[],this.loadInfo={},this.pcdnTraceInfo=null,this._loadedDataState=!1,this._PCDNSwitchCnt=0,this._isUseCDN=!0,this._curLoadSegIdx=0,this._receiveDataPos=-1,this._optionDataLenInfo={},this._lastPCDNUrl="",this._lastTargetDur=0,this.pcdnVVStat=this.resetPCDNVVStat(),this.pSCCancelCnt=0,this._lastDemuxSampleIdxRange={video:0,audio:0},this._mediaEndTime=-1}static get pcdnDownLoadReqCnt(){const{pcdn_download_request_cnt:t,pcdn_download_failed_cnt:n}=e;return e.pcdn_download_request_cnt=0,e.pcdn_download_failed_cnt=0,{pcdn_download_request_cnt:t,pcdn_download_failed_cnt:n}}static getDefaultConfig(){return{onProcessMinLen:1024,xhrSetup:null,chunkSize:8e5,isCache:!1,playerId:"",vid:"",afterLoadeddataCallBackLen:0,ext:{}}}get size(){return this.fileSize}initTransMuxWorker(){}updateSecretKey(e,t,n,r){var i;this.useEME=e,!e&&t?(this.log($r.LOG,"[updateSecretKey] ,force enableWorker"),this.options.enableWorker=!0,this.transmuxerWorkerControl||this.initTransMuxWorker()):!e&&r&&(this.keyValue=r),this.log($r.LOG,"[updateSecretKey] ,useEME, ",e,",secretKey,",t,",decryptKey",n),null==(i=this.transmuxerWorkerControl)||i.updateValue({secretKey:t,decryptKey:n})}updateLoadedDataDone(){this._loadedDataState=!0}get PCDNSwitchCnt(){return this._PCDNSwitchCnt}updateLoadInfo(e,t){this.loadInfo||(this.loadInfo={}),this.loadInfo[e]||(this.loadInfo[e]={},this.loadInfo[e].loadLen=0),this.loadInfo[e].loadLen+=t}async updatePCDNState(e){if(this._PCDNState!==tl&&this._PCDNState!==e&&this.log($r.LOG,"[pcdn state update]",this._PCDNState," - ",e),e===tl)this._PCDNState=e;else if(this._PCDNState!==tl&&this._PCDNState!==e){if(this._isUseCDN||e!==el)this._PCDNState=e;else{if(this._PCDNState=e,this.adaptTimeRange[this._curLoadSegIdx].downloaded||this._switchBitRate)return void this.log($r.LOG,"[pcdn] switch cdn ",this._curLoadSegIdx,"downloaded",",switchBitRate, ",this._switchBitRate);await this.cancelLoading(),this.pSCCancelCnt++;const t=this._curLoadSegIdx;this.log($r.LOG,"[pcdn] cancelLoading ",t,"switch cdn load");const n=this.getFragRange(t);if(this._receiveDataPos&&this._receiveDataPos>=n[0]&&this._receiveDataPos<=n[1]){const e=n[0];n[0]=this._receiveDataPos,this.log($r.LOG,"[pcdn] switch cdn, adject range",t,JSON.stringify(n),",oldRange,",`${e} - ${n[1]}`)}this._receiveDataPos=-1,await this.startLoad(n,t)}this.log($r.LOG,"[pcdn] openPCDN ",e)}}updateNode(e){if(e&&e.length>0){const t=e.filter((e=>{if(!Object.prototype.hasOwnProperty.call(nl,Ro(null==e?void 0:e.url)))return e}));this._pcdnNodeList=t}}clearPCDNNodeList(){this.log($r.LOG,"[pcdn] clearPCDNNodeList"),this._pcdnNodeList=[]}get isUpdateNode(){return!this._pcdnNodeList||!this._pcdnNodeList.length}isUsePCDN(){var e;return"open"===this._PCDNState&&(null==(e=this._pcdnNodeList)?void 0:e.length)>0}async changeBitRate(e){e.bitrate!==this._bitRate&&(this.updateUrl(e._mainURL,e._backupURL),this._bitRate=e.bitrate,this._receiveDataPos=-1,await this.MP4Loader.changeUrl(this.url,`${this.options.vid}-${this._bitRate}`,this.CHUNK_SIZE),this._pcdnNodeList=null,this.emit(Wo,this.url),this._switchBitRate=!0,this._mediaEndTime=-1,this.log($r.LOG,"[switchBitrate] changeUrl, bitRate,",this._bitRate,"url",this.url))}_getByPreload(e,t,n,r){try{if(e&&e.byteLength>=t){const i={endTime:(new Date).getTime(),startTime:(new Date).getTime(),index:r,range:[],vid:this.options.vid,from:"local"};if(n<=e.byteLength){const r=e.slice(t,n);return i.range=[t,n],i.state=!0,{buffer:r,context:i,state:!0}}{const n=e.byteLength-1,r=e.slice(t,n);return i.range=[t,n],{context:i,buffer:r,state:!1}}}return null}catch(e){return console.error("[MP4] _getByPreload",t,n,e),null}}log(e,t,...n){const{options:r}=this,i=r&&r.vid?`[MP4]${this._logTag} ${r.vid} ${t}`:`[MP4]${this._logTag} ${t}`;_o(this.logger,e,i,...n)}async errorHandler(e,t,n={}){const{response:r,message:i}=e,s=this.options?this.options.vid:"";let a=null;if(this._isPending=!0,r){const o=Uo(r.headers);if(a=new uo("network",r.status,{httpText:r.httpText,message:i,url:r.url,range:n.range,headers:o}),this.log($r.LOG,`[MP4] [${s}] errorHandler error state:[${t}],\n          _isPending:[${this._isPending}] `,null==r?void 0:r.status,i),this.backUrl&&this.backUrl.length>0){const r=this.backUrl.shift();if(this.updateUrl(r,this.backUrl),this.log($r.LOG,`[${s}] errorHandler start backUpUrl retry`,this.backUrl.length,r),this._isPending=!1,this.MP4Loader&&(await this.MP4Loader.changeUrl(this.url,`${this.url}-${this._bitRate}`,this.CHUNK_SIZE),this.emit(Wo,this.url)),this.emit(zo,{type:"error",error:e}),"getMetaInfo"===t)return void this.getMetaInfo();if("loadFragment"===t){const{fragIndex:e,range:t}=n;if(null!==e&&e>=0&&t)return this.resetFragmentLoadState(e),void this.loadFragment(e,t)}}a.context=n,a.response=r,this.log($r.LOG,`errorHandler end, ${JSON.stringify(n)}`),this.emit(Ho,a,t)}else this.log($r.LOG,`errorHandler other end, ${t},${null==r?void 0:r.status}, ${i}`),a=e,a.context=n,this.emit(Ho,a,t)}async init(e){var t,n,r;this.url&&await this.MP4Loader.changeUrl(this.url,`${this.options.vid}-${this._bitRate}`,this.CHUNK_SIZE),this.emit(Wo,this.url),this.meta=null;const{meta:i,mediaSegList:s,buffer:a,fileSize:o,initSeg:l,bitrate:u,adaptTimeRange:c,repeatData:h}=e;if(i&&i.ext){o&&(this.fileSize=o),this.meta=i,this.videoTrak=i.ext.videoTrak,this.audioTrak=i.ext.audioTrak,this.meta.videoSamplesLen=this.videoTrak.reduce(((e,t)=>e+t.frames.length),0),this.meta.audioSamplesLen=this.audioTrak.reduce(((e,t)=>e+t.frames.length),0),this._bitRate=u,this.timeRange=this.getTimeRange(),this.adaptTimeRange=function(e){const t=[];if(!e||!e.length||0===e.length)return t;for(let n=0;n<e.length;n++){const r=e[n],i={};for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&(i[e]=r[e]);t.push(i)}return t}(c),s?(this.preloadCache={segList:s||[],initSeg:l},(null==(t=this.adaptTimeRange)?void 0:t.length)>0&&(null==h?void 0:h.byteLength)>0&&this.cacheRepeatData(this.adaptTimeRange[0].repeatRange,this.adaptTimeRange[0].repeatRange,h)):a&&(null==(n=this.adaptTimeRange)?void 0:n.length)>0&&(null==a?void 0:a.byteLength)>0&&this.cacheRepeatData(this.adaptTimeRange[0].range,this.adaptTimeRange[0].range,a),this.adaptTimeRange.map((e=>{e.downloaded=!1,e.isLoading=!1}));for(let e=0;e<this.adaptTimeRange.length;e++)null==(r=this.updateTimeRangeInAdaptTimeRangeIdx)||r.call(this,this.adaptTimeRange[e].timeRangeIdx,e);const e={meta:i,videoSegments:i.ext.videoTrak,audioSegments:i.ext.audioTrak,bufferLoaded:a||null};this._bitRateInfoMap.set(this._bitRate,e),this.emit(Vo,this.meta)}else await this.getMetaInfo()}getTimeRange(){const e=[];let t=null;for(let n=0;this.videoTrak&&n<this.videoTrak.length;n++){const{startTime:r}=this.videoTrak[n],{endTime:i}=this.videoTrak[n];t={startTime:r,endTime:i,duration:i-r,downloaded:!1,isLoading:!1},e.push(t)}if(this.audioTrak&&this.audioTrak.length>e.length)for(let n=e.length;n<this.audioTrak.length;n++){const r=Math.max(this.audioTrak[n].startTime,t?t.endTime:0),i=Math.max(this.audioTrak[n].endTime,t?t.endTime:0);t={startTime:r,endTime:i,duration:i-r,downloaded:!1,isLoading:!1},e.push(t)}return e}async getMetaInfo(e=!0){var t;try{const t=So();this.metaLoading=!0,this.log($r.LOG,"getMetaInfo start, bitRate,",this._bitRate,",url,",this.MP4Loader.url),this.resetRepeatInfo();const n=async(n,r,i,s,a)=>{var o;if(s){await this.cancelLoading();const e=new co(lo.DEMUX,oo.metaError,{msg:JSON.stringify(s)});return void this.errorHandler(e,"getMetaInfo",{range:[0,this._firstLoadSize]})}!this.fileSize&&a&&(this.fileSize=Number(Fo(a.headers)));const l=(null==(o=null==i?void 0:i.priOptions)?void 0:o.type)||Wa;if(n&&(this.cacheRepeatData([0,this._firstLoadSize],i.range,n),!this._optionDataLenInfo[l]&&(this._optionDataLenInfo[l]=0),this._optionDataLenInfo[l]+=n.byteLength),r&&this._optionDataLenInfo[l]&&(this._optionDataLenInfo[l]=0),i.meta&&!this.meta){this.firstFrameTime.metaload=So()-t;const n=i.meta;this.videoTrak=n.videoSegments,this.audioTrak=n.audioSegments,this.timeRange=this.getTimeRange();const r=this.videoTrak.reduce(((e,t)=>e+t.frames.length),0),s=this.audioTrak.reduce(((e,t)=>e+t.frames.length),0);this.meta={...n.meta,ext:{videoTrak:this.videoTrak,audioTrak:this.audioTrak},videoSamplesLen:r,audioSamplesLen:s,fileSize:this.fileSize},this._bitRateInfoMap.set(this._bitRate,n),this.log($r.LOG,"meta reach, bitRate,",this._bitRate,this._repeatInfo.curDataPos),e&&this.emit(Vo,this.meta)}if(this.meta&&r&&(this.log($r.LOG,"[getMetaInfo req end]",this._repeatInfo.curDataPos),this.metaLoading=!1),this._loadedDataState){let e=!1;this._repeatInfo.curDataPos-this._repeatInfo.usedPos>=this.options.afterLoadeddataCallBackLen&&(e=!0),this.meta&&(e||r)&&(this.log($r.LOG,"emit moov_req_progress loadeddata after",JSON.stringify(i.range)),this.emit(jo))}else this.meta&&(n||r)&&(this.log($r.LOG,"emit moov_req_progress loadeddata before",JSON.stringify(i.range)),this.emit(jo))},r=this._firstLoadSize-1;await this.MP4Loader.loadMetaProcess(this.MP4Loader.cache,[0,r],n)}catch(e){this.log($r.ERROR,"[MP4] trigger errorHandler getMetaInfo",null==(t=null==e?void 0:e.response)?void 0:t.status,null==e?void 0:e.message),this.loadError(e,"getMetaInfo",!1,{url:e.url||this.url,range:[0,this._firstLoadSize]})}}getFragmentIdx(e){let t,n;if(this.videoTrak.length){if(t=this.videoTrak.find((t=>t.startTime<=e&&t.endTime>e)),n=this.audioTrak.find((t=>t.startTime<=e&&t.endTime>e)),t&&n)return Math.min(t.index,n.index);if(t||n)return t?t.index:n.index;{let e=Number.MAX_VALUE;return this.videoTrak&&this.videoTrak.length>0&&(e=this.videoTrak.length-1),this.audioTrak&&this.audioTrak.length>0&&(e=Math.min(this.audioTrak.length-1,e)),e}}return n=this.audioTrak.find((t=>t.startTime<=e&&t.endTime>e)),n?n.index:0}async _checkHasMeta(){var e,t,n,r;let i=this._bitRateInfoMap.get(this._bitRate);if(i)this.log($r.LOG,"[switchBitrate], not need load InitSegment, bitRate, ",this._bitRate),this.meta=i.meta;else{this.log($r.LOG,"[switchBitrate], need load InitSegment, bitRate, ",this._bitRate),this.metaLoading=!0;const r=await this.MP4Loader.loadMeta(this.MP4Loader.cache,Math.round(this.CHUNK_SIZE/2));this.log($r.LOG,"[switchBitrate], loadMeta end, ",this._bitRate),this.metaLoading=!1;const{videoTrak:s,audioTrak:a}=this,o=s.reduce(((e,t)=>e+t.frames.length),0),l=a.reduce(((e,t)=>e+t.frames.length),0),u=Number(Fo(null==(n=null==(t=null==(e=null==r?void 0:r.responses)?void 0:e[0])?void 0:t.response)?void 0:n.headers));this.fileSize=u,this.log($r.LOG,"[switchBitrate], fileSize set , ",u),this.meta={...r.meta,ext:{videoTrak:r.videoSegments,audioTrak:r.videoSegments},videoSamplesLen:o,audioSamplesLen:l,fileSize:u},i=r,i.fileSize=u,this._bitRateInfoMap.set(this._bitRate,r)}this.videoTrak=i.videoSegments,this.audioTrak=i.audioSegments,this.fileSize=i.fileSize,this.emit(Xo,this.meta),this.emit(Ko,this.meta),this.timeRange=this.getTimeRange();for(let e=0;e<this.adaptTimeRange.length;e++)null==(r=this.updateTimeRangeInAdaptTimeRangeIdx)||r.call(this,this.adaptTimeRange[e].timeRangeIdx,e);return this._firstLoadSize=0,!0}async load(e,t){var n;if(this._loadSuccessCallBack=t,this._switchBitRate&&!this.metaLoading){this.log($r.LOG,"[switchBitrate], switch bitRate start load, bitRate,",this._bitRate,", fragIndex,",e);const t=await this._checkHasMeta();if(this.changeBitRateTime>0){this.resetFragmentLoadState(e,!0),this.resetRepeatInfo();const t=this.getFragmentIdx(this.changeBitRateTime),n=e;if((e=this.getAdaptIdxBySrcIdx(t))<0)return void this.log($r.ERROR,"[switchBitrate] start new bitrate fragIndex error");n!==e&&this.resetFragmentLoadState(e),this._curLoadSegIdx=e;const r=this.adaptTimeRange[e];this.log($r.LOG,"[switchBitrate], need update load fragIndex",e,",oldFragIndex",n,",stTime,",this.changeBitRateTime,",newBitrateadaptTimeRange,",r.startTime,"-",r.endTime),this.emit(Qo,e),this.seekTime=this.changeBitRateTime,this.changeBitRateTime=-1}this.log($r.LOG,"[switchBitrate], reset adaptTimeRange state,",e),this._needInitSegment=!0,this.resetTansmuxer(),t&&(this._switchBitRate=!1)}if(this._switchBitRate&&this.metaLoading)return;const r=this.getFragRange(e);let i=this.getFragmentFromCache(e,r);if(i&&this._needInitSegment&&!i.initSeg&&(i=null,this.log($r.LOG,"[mp4.load], segment ,",e,"Data In Cache but not has init, so not use cacheData")),i){const{video:t,audio:n}=i.muxSampleIdxRange;this._lastDemuxSampleIdxRange.video=t,this._lastDemuxSampleIdxRange.audio=n,this.log($r.LOG,"[mp4.load], segment ,",e,"Data In Cache",JSON.stringify(r),", needInit,",this._needInitSegment,",muxSampleIdxRange,",JSON.stringify(i.muxSampleIdxRange));const s=this.adaptTimeRange[e];s.downloaded=!0,s.isLoading=!0,this._needInitSegment=!1,this._loadSuccessCallBack&&this._loadSuccessCallBack(i)}else if(this.log($r.LOG,"loadFragment,",e,",bitRate,",this._bitRate,",range,",JSON.stringify(r)),this.seekTime>0){const t=this.getSubRange(e,this.seekTime,r);null==(n=this.resetDemuxSampleIdx)||n.call(this,this.seekTime,t),this.loadFragment(e,t),this.seekTime=-1}else this.loadFragment(e,r)}getFragmentFromCache(e,t){const{preloadCache:n}=this;if(!n||!n.segList)return null;let r=-1;const{segList:i,initSeg:s}=n;for(let t=0;t<i.length;t++)if(i[t].index===e){r=t;break}if(r<0)return null;{const n=i[r];if(n.range[1]>=t[1]){const{startTime:r=0,endTime:i=0}=this.adaptTimeRange[e],a=[r,i];return{buffer:n.buffer,range:t,muxSampleIdxRange:n.muxSampleIdxRange,context:{range:t,fragIndex:e,state:!0,adaptTimeRange:[a[0],a[1]]},state:!0,initSeg:this._needInitSegment?s:void 0}}return null}}cacheRepeatData(e,t,n){var r;if(e&&null!=e&&e.length&&null!=(r=this._repeatInfo.data)&&r.byteLength&&(this._repeatInfo.startPos<0&&t[0]+n.byteLength>=e[0]&&t[0]+n.byteLength<=e[1]+1&&(this._repeatInfo.startPos=e[0]),this._repeatInfo.startPos>=0&&t[0]+n.byteLength>=e[0]&&t[0]+n.byteLength<=e[1]+1)){const r=this._repeatInfo.startPos+this._repeatInfo.curDataPos-t[0];if(r<0)return;const i=n.slice(r);if(this._repeatInfo.curDataPos+i.byteLength<this._repeatInfo.data.byteLength)this._repeatInfo.data.set(i,this._repeatInfo.curDataPos),this._repeatInfo.curDataPos+=i.byteLength,this.log($r.LOG,", repeatInfo,startPos,",this._repeatInfo.startPos,", curDataPos,",this._repeatInfo.startPos+this._repeatInfo.curDataPos,",curAppendLen,",i.byteLength);else try{const t=xo(Math.max(2*this._repeatInfo.data.byteLength,2*(e[1]-e[0])));if(!t)return;t.set(this._repeatInfo.data.slice(0,this._repeatInfo.curDataPos),0),t.set(i,this._repeatInfo.curDataPos),this._repeatInfo.curDataPos+=i.byteLength,delete this._repeatInfo.data,this._repeatInfo.data=t,this.log($r.LOG,"_repeatInfo,startPos,",this._repeatInfo.startPos,", curDataPos,",this._repeatInfo.curDataPos)}catch{console.error("repeat data cache  new array failed")}}}_mux(e,t,n,r){const{firstFrameTime:i,timeRecord:s}=this;i.firstmux<0&&s.startMuxTime<0&&(this.timeRecord.startMuxTime=So(),i.startMuxTime=So()-s.startLoadTime);const a=this.getSamplesRange(n,"video"),o=this.getSamplesRange(n,"audio");this.log($r.LOG,"mux videoSampleRange,",a,o);const l=[t,t+e.byteLength];if(this.transmuxerWorkerControl){const i={range:l,state:r,fragIndex:n};this.log($r.LOG,"[transmuxerworker start] ,range, ",JSON.stringify(l),",dataLen,",e.byteLength,i),this.transmuxerWorkerControl.transmux(this.workerSequence,e,t,a,o,this.meta.moov,this.useEME,this.secretKey,i)}else try{this.MP4Demuxer||(this.MP4Demuxer=new Ba(this.videoTrak,this.audioTrak,null,{openLog:go}));const u=this.MP4Demuxer.demuxPart(e,t,a,o,this.meta.moov,this.useEME,this.keyValue);!this.FMP4Remuxer&&(!this.checkCodecH265()||this.options.supportHevc)&&(this.FMP4Remuxer=new Fa(this.MP4Demuxer.videoTrack,this.MP4Demuxer.audioTrack,{openLog:go}));const{videoTrack:c,audioTrack:h}=u,d=null==c?void 0:c.samples,f=(null==d?void 0:d.length)>0?d[0].sampleOffset:-1,p=(null==d?void 0:d.length)>0?d[d.length-1].sampleOffset:-1,g=null==h?void 0:h.samples,m=(null==g?void 0:g.length)>0?g[0].sampleOffset:-1,v=(null==g?void 0:g.length)>0?g[g.length-1].sampleOffset:-1;let y;this.updateDemuxSampleIdxRange([f,p],[m,v]),this.log($r.LOG,"[mux],videoTimeRange,",null==c?void 0:c.startPts,"-",null==c?void 0:c.endPts,",videoSampleIdx",f,"-",p,",audioTimeRange,",null==h?void 0:h.startPts,"-",null==h?void 0:h.endPts,",audioSampleIdx",m,"-",v,n,JSON.stringify(l),r);const _=r||(null==d?void 0:d.length)>0?null==c?void 0:c.startPts:-1,T=r||(null==d?void 0:d.length)>0?null==c?void 0:c.endPts:-1,b=r||(null==g?void 0:g.length)>0?null==h?void 0:h.startPts:-1,S=r||(null==g?void 0:g.length)>0?null==h?void 0:h.endPts:-1,P=[Math.min(_,b),Math.max(T,S)];if(this.FMP4Remuxer){const e=this.FMP4Remuxer.remux(this._needInitSegment,{initMerge:!0,range:l});e.initSegment&&(this._needInitSegment=!1),y={buffer:Mo(e.audioSegment,e.videoSegment),range:l,state:r,context:{range:l,fragIndex:n,timeRange:P},initSeg:e.initSegment}}else y={videoTrack:c,audioTrack:h,buffer:null,range:l,state:r,context:{range:l,fragIndex:n,timeRange:P}};i.firstmux<0&&s.startMuxTime>0&&(i.firstmux=So()-s.startMuxTime),this._loadSuccessCallBack&&this._loadSuccessCallBack(y)}catch(r){const i=null==r?void 0:r.message;this.log($r.ERROR,"mux err:",i);const s=new co(lo.REMUX,oo.muxError,{msg:i});this.errorHandler(s,"mux",{fragIndex:n,range:[t,t+e.byteLength]})}}updateDemuxSampleIdxRange(e,t){(null==e?void 0:e[1])>=0&&(this._lastDemuxSampleIdxRange.video=e[1]),(null==t?void 0:t[1])>=0&&(this._lastDemuxSampleIdxRange.audio=t[1]),this.log($r.LOG,"updateDemuxSampleIdxRange",JSON.stringify(this._lastDemuxSampleIdxRange))}async loadFragment(e,t){this._curLoadSegIdx=e;const n=this.adaptTimeRange[e];if(this._isPending||0===(null==t?void 0:t[1])||!n||n.isLoading||0===(null==t?void 0:t.length))return;this._segmentToBitRateMap.set(e,this._bitRate),this.timeRecord.startLoadTime<0&&(this.timeRecord.startLoadTime=So());const{startPos:r,curDataPos:i}=this._repeatInfo,{usedPos:s}=this._repeatInfo;if(t.length>=2&&t[1]&&t[1]>0&&t[0]>=r&&t[1]<r+i){n.isLoading=!0;const a=Math.max(t[0],r+s),o=new Uint8Array(this._repeatInfo.data.slice(a-r,t[1]-r+1));if(this.log($r.LOG,"[mp4.loadFragment] has all data: ",a,t[1]),this.log($r.LOG,"[mp4.loadFragment] ",",repeatInfo, startPos,",r,", usedPos,",r+s,",curDataPos, ",r+i),n.downloaded=!0,this.metaLoading||0===r)this._repeatInfo.usedPos=0,this.log($r.LOG,"[mp4.loadFragment] has all data set repeatInfo.usedPos = 0");else{const e=n.range[0]-r,t=n.range[1]+1-r,i=new Uint8Array(this._repeatInfo.data.slice(e,t));this.resetRepeatInfo(),this.cacheRepeatData(n.repeatRange,n.range,i)}this._mux(o,a,e,!0)}else if(t.length>=2&&t[0]&&t[0]>=r&&t[0]<=r+i){if(!n.isLoading){const a=Math.max(t[0],r+s),o=Math.min(t[1]+1,r+i),l=new Uint8Array(this._repeatInfo.data.slice(a-r,o-r));if(l.byteLength>0){this._repeatInfo.usedPos=o-this._repeatInfo.startPos;const n=this._repeatInfo.usedPos;return this.log($r.LOG,"[mp4.loadFragment] has part data: ",a,a+l.byteLength),this.log($r.LOG,"[mp4.loadFragment] ",",repeatInfo, startPos,",r,", usedPos,",r+n,",curDataPos, ",r+i),void this._mux(l,a,e,t[1]<=r+n)}if(!this.metaLoading&&!n.isLoading){this.log($r.LOG,"[mp4.loadFragment] load part data >>> ",r+i,t[1]),n.isLoading=!0;const a=[r+s,t[1]],o=null==n?void 0:n.repeatRange;if(o&&o[0]<a[0]){const e=[n.repeatRange[0],a[0]],{startPos:t,curDataPos:r,data:i}=this._repeatInfo,s=i.slice(e[0]-t,r);this.resetRepeatInfo(),this.cacheRepeatData(n.repeatRange,e,s)}else this.resetRepeatInfo();await this.startLoad(a,e)}}}else(!this.metaLoading||t[0]>r)&&!n.isLoading&&(n.isLoading=!0,this.log($r.LOG,"[mp4.loadFragment],ready to load all data ,segmentIdx, ",e,",range >>> ",t),this.resetRepeatInfo(),await this.startLoad(t,e))}resetRepeatInfo(){this.log($r.LOG,", resetRepeatInfo"),this._repeatInfo.startPos=-1,this._repeatInfo.curDataPos=0,this._repeatInfo.usedPos=0}setSwitchPCDNCallBack(e){this._switchPCDNCallBack=e}updateChangeBitRateTime(e){this.changeBitRateTime=e}async startLoad(t,n,r=!1){var i,s,a,o;const{firstFrameTime:l}=this;0===n&&(null==l?void 0:l.first_gop_req_cnt)<0?l.first_gop_req_cnt=1:n>0&&(null==l?void 0:l.first_gop_req_cnt)<0&&(l.first_gop_req_cnt=0);const u=this.selectedPCDN(r),c=u||this.url;this.log($r.LOG,"[startLoad], ",n,JSON.stringify(t),c);try{await this.MP4Loader.loadData(t,this.MP4Loader.cache,{index:n,onProgress:this.onprogressDataArrive,onProcessMinLen:this.options.onProcessMinLen,url:c,headers:u?{"X-Origin-Server-Host":this._domain}:null,priOptions:{type:u?Qa:Wa}})}catch(r){const l=(null==(s=null==(i=null==r?void 0:r.options)?void 0:i.priOptions)?void 0:s.type)===Qa||!!u;let c=null;const h=r.url||(l?u:this.url);l?(this.pcdnVVStat.conn_fail_num++,e.pcdn_download_failed_cnt++,c=this._pcdnNodeList.shift(),this.emit(qo,c),this.log($r.ERROR,"pcdn load err, retry use cdn,range",t,",fragIndex",n,(null==r?void 0:r.isTimeout)||(null==(a=null==r?void 0:r.response)?void 0:a.status),null==r?void 0:r.message,h),await this.startLoad(t,n,!0)):this.log($r.ERROR,"cdn load err,range",JSON.stringify(t),",fragIndex",n,(null==r?void 0:r.isTimeout)||(null==(o=null==r?void 0:r.response)?void 0:o.status),null==r?void 0:r.message,h),this.loadError(r,"loadFragment",l,{range:t,fragIndex:n,url:h})}}loadError(e,t,n,r){var i,s;!e.response&&(e.response={}),e.isTimeout?e.response.status=oo.timeout:null!=(i=null==e?void 0:e.response)&&i.status||(e.response.status=oo.networkError);const a=Ro(null==r?void 0:r.url);this.markErrHost(a),this.emit(Yo,{src:null==r?void 0:r.url,host:a,errorCode:null==(s=null==e?void 0:e.response)?void 0:s.status,message:null==e?void 0:e.message,range:(null==r?void 0:r.range)&&JSON.stringify(r.range),headers:null==r?void 0:r.headers}),n||this.errorHandler(e,t,r)}async loadAllFragmentData(t,n,r,i=!1){var s,a,o,l,u,c;if(this.hasDestroyed)return;this.resetRepeatInfo();const h=(null==(s=this.adaptTimeRange[t])?void 0:s.range)||this.getFragRange(t);this._curLoadSegIdx=t;const d=this.selectedPCDN(i),f=Po(d||this.url,{__rand:(new Date).getTime()});try{this.log($r.LOG,",[loadAllFragmentData], index,",t,",rang,",JSON.stringify(h),", use-pcdn,",!!d);const e=await this.MP4Loader.loadData(h,this.MP4Loader.cache,{index:t,url:f,headers:d?{"X-Origin-Server-Host":this._domain}:null,priOptions:{type:d?Qa:Wa}});if(this.log($r.LOG,"loadAllFragmentData after",t,JSON.stringify(h)),!e||!e.data){const e=new Error("response null");return void(r?r(e):this.loadError(e,"loadFragment",!!d,{range:h,fragIndex:t,url:d||this.url}))}const{data:i}=e;if((null==i?void 0:i.byteLength)>0&&h&&h.length>=2)this._receiveDataPos=h[0]+(null==i?void 0:i.byteLength),this._loadSuccessCallBack=n,this.adaptTimeRange[t].downloaded=!0,this.cacheRepeatData(this.adaptTimeRange[t].repeatRange,h,i),this._mux(i,h[0],t,!0);else{const n=Uo(null==(a=null==e?void 0:e.response)?void 0:a.headers);this.log($r.LOG,"[FragLoadDowned check false, retry load],fragmentIdx,",t,",dataLen,",null==i?void 0:i.byteLength,JSON.stringify(h),JSON.stringify(n),f);const r=new Error("dataLen not match");this.resetRepeatInfo();const s=this.adaptTimeRange[t];this.emit(Zo,[s.startTime,s.endTime]),this.loadError(r,"loadFragment",!!d,{range:h,fragIndex:t,url:f,headers:n})}}catch(i){const s=(null==(l=null==(o=null==i?void 0:i.options)?void 0:o.priOptions)?void 0:l.type)===Qa||!!d;s?(e.pcdn_download_failed_cnt++,this._pcdnNodeList.shift(),this.log($r.ERROR,"[loadAllFragmentData] ,pcdn load err, retry use cdn,fragIndex",t,i.isTimeout||(null==(u=null==i?void 0:i.response)?void 0:u.status),null==i?void 0:i.message),await this.loadAllFragmentData(t,n,r,!0)):this.log($r.ERROR,"[MP4] loadAllFragmentData error",{fragIndex:t,range:JSON.stringify(h)},i.isTimeout||(null==(c=null==i?void 0:i.response)?void 0:c.status),null==i?void 0:i.message),this.loadError(i,"loadFragment",s,{range:h,fragIndex:t,url:i.url||(s?d:this.url)})}}currentLoadUseUrl(){var e;return this._isUseCDN?this.url:(null==(e=this._pcdnNodeList)?void 0:e.length)>0?this._pcdnNodeList[0].url:""}getCurSwitchPCDNCnt(){return this._PCDNSwitchCnt}selectedPCDN(t){if(this._PCDNState===tl||t)return void(this._isUseCDN=!0);let n;if(this.isUsePCDN()){if(this._isUseCDN){if(this._switchPCDNCallBack){const e=this._switchPCDNCallBack();e>0&&(this.options.switchPCDNMaxCnt=e)}if(this._PCDNSwitchCnt>=this.options.switchPCDNMaxCnt)return this._isUseCDN=!0,this.log($r.LOG,"cdn switch pcdn outlimit, curSwitchCnt ,",this._PCDNSwitchCnt,",maxCnt,",this.options.switchPCDNMaxCnt),null;this._PCDNSwitchCnt++,this.log($r.LOG,"cdn switch pcdn, curSwitchCnt,",this._PCDNSwitchCnt,",maxCnt,",this.options.switchPCDNMaxCnt)}this._isUseCDN=!1,n=Po(this._pcdnNodeList[0].url,{__vid:this.options.vid}),this._lastPCDNUrl!==n&&(this.emit(Wo,n),this._lastPCDNUrl=n,this.pcdnVVStat.conn_req_num+=1),e.pcdn_download_request_cnt++}else this._isUseCDN||(this.log($r.LOG,"pcdn switch cdn PCDNSwitchCnt,",this._PCDNSwitchCnt,",maxCnt,",this.options.switchPCDNMaxCnt),this.pcdnVVStat.conn_jump_num+=1),this._isUseCDN=!0;return n}async cancelLoading(){this.MP4Loader&&await this.MP4Loader.cancel(),this._optionDataLenInfo[Qa]&&this._optionDataLenInfo[Qa]>0&&(this.emit(Jo,{load_type:Qa,len:this._optionDataLenInfo[Qa]}),this._optionDataLenInfo[Qa]=0),this._optionDataLenInfo[Wa]&&this._optionDataLenInfo[Wa]>0&&(this.emit(Jo,{load_type:Wa,len:this._optionDataLenInfo[Wa]}),this._optionDataLenInfo[Wa]=0)}updateUrl(e,t){const n=Ro(e);this._defaultDomain||(this._defaultDomain=n),n.indexOf("www.")<0?this._domain=n:this._domain=this._defaultDomain,this.url=e,this.backUrl=t||[]}getDataBitRate(e){return this._segmentToBitRateMap.get(e)}checkCodecH265(){return this.meta&&(this.meta.videoCodec.indexOf("hvc1")>-1||this.meta.videoCodec.indexOf("hev1")>-1)}checkCodecH266(){return this.meta&&this.meta.videoCodec.indexOf("bvc2")>-1}destroy(){this.hasDestroyed||(this.resetTansmuxer(),this.transmuxerWorkerControl&&this.transmuxerWorkerControl.destroy(),this.fileSize=0,this.totalSize=0,this._isPending=!1,this.metaLoading=!1,this.resetRepeatInfo(),delete this._repeatInfo.data,this._bitRateInfoMap.clear(),this._segmentToBitRateMap.clear(),this.MP4Loader&&(this.MP4Loader.cancel(),this.MP4Loader.destroy()),this.removeAllListeners(),this.hasDestroyed=!0,this.pcdnVVStat=this.resetPCDNVVStat())}resetPCDNVVStat(){return{try_req_node:0,req_node_succ:0,has_ret_node:0,conn_req_num:0,conn_fail_num:0,conn_jump_num:0}}resetTansmuxer(){var e;null==(e=this.resetDemuxSampleIdx)||e.call(this),this.MP4Demuxer&&this.MP4Demuxer.reset(),this.MP4Demuxer=null,this.FMP4Remuxer&&this.FMP4Remuxer.reset(),this.FMP4Remuxer=null,this.transmuxerWorkerControl&&this.transmuxerWorkerControl.reset()}getMediaEndTime(){if(this._mediaEndTime>0)return this._mediaEndTime;const{videoTrak:e,audioTrak:t}=this;if((null==e?void 0:e.length)>0){const{endTime:t}=e[e.length-1];this._mediaEndTime=this._mediaEndTime<0?t:Math.min(t,this._mediaEndTime)}if((null==t?void 0:t.length)>0){const{endTime:e}=t[t.length-1];this._mediaEndTime=this._mediaEndTime<0?e:Math.min(e,this._mediaEndTime)}return this._mediaEndTime}};Va(rl,"pcdn_download_request_cnt",0),Va(rl,"pcdn_download_failed_cnt",0);let il=rl;class sl extends il{constructor(e,t,n,r=[],i,s){super(e,t,n,r,i,s),this._logTag=`${s}_${Za}`}updateAdaptTimeRange(e,t){this._lastTargetDur=t;const n=this.adaptTimeRange;for(let r=0;r<n.length;r++){const{timeRangeIdx:i}=n[r];if(e>=i[0]&&e<i[1])return this.log($r.LOG,"has adaptTimeRange,startSrcIdx, ",e,",adaptTimeRangeIdx",r,", dur,",t,JSON.stringify(n[r])),r}let r=n.length>0?n[n.length-1].timeRangeIdx[1]:0;if(r>=this.timeRange.length)return n.length-1;for(;r<e;){const{startTime:e}=this.timeRange[r],{endTime:t}=this.timeRange[r],n={startTime:e,endTime:t,timeRangeIdx:[r,r+1],duration:t-e,downloaded:!1,isLoading:!1};this.adaptTimeRange.push(n),this.updateTimeRangeInAdaptTimeRangeIdx(n.timeRangeIdx,this.adaptTimeRange.length-1),this.log($r.LOG,"gap adaptTimeRange,adaptTimeRangeIdx, ",this.adaptTimeRange.length-1,JSON.stringify(n)),r++}let i=0,s=r,a=r;for(;a<this.timeRange.length;a++){if(!(i<t)){s=a;break}i+=this.timeRange[a].endTime-this.timeRange[a].startTime}a===this.timeRange.length&&(s=this.timeRange.length);const o=[r,s],{startTime:l}=this.timeRange[o[0]],u=o[1]===this.timeRange.length?this.timeRange[o[1]-1].endTime:this.timeRange[o[1]].startTime,c={startTime:l,endTime:u,timeRangeIdx:o,duration:u-l,downloaded:!1,isLoading:!1};return this.log($r.LOG,"update adaptTimeRange,startIdx,",o[0],", dur,",t,JSON.stringify(c)),this.adaptTimeRange.push(c),this.updateTimeRangeInAdaptTimeRangeIdx(o,this.adaptTimeRange.length-1),this.adaptTimeRange.length-1}updateTimeRangeInAdaptTimeRangeIdx(e,t){for(let n=e[0];n<e[1];n++)n<this.timeRange.length&&(this.timeRange[n].adaptTimeRangeIdx=t)}getAdaptIdxBySrcIdx(e,t){var n;const r=this.adaptTimeRange.length;if(!t&&e>=(null==(n=this.adaptTimeRange[r-1])?void 0:n.timeRangeIdx[1])){const t=this._lastTargetDur||5;this.updateAdaptTimeRange(e,t)}for(let t=0;t<this.adaptTimeRange.length;t++){const{timeRangeIdx:n}=this.adaptTimeRange[t];if(n&&e>=n[0]&&e<n[1])return t}return-1}getFragmentIdx(e){let t,n;if(this.videoTrak.length){if(t=this.videoTrak.find((t=>t.startTime<=e&&t.endTime>e)),n=this.audioTrak.find((t=>t.startTime<=e&&t.endTime>e)),t&&n)return Math.min(t.index,n.index);if(t||n)return t?t.index:n.index;{let e=Number.MAX_VALUE;return this.videoTrak&&this.videoTrak.length>0&&(e=this.videoTrak.length-1),this.audioTrak&&this.audioTrak.length>0&&(e=Math.min(this.audioTrak.length-1,e)),e}}return n=this.audioTrak.find((t=>t.startTime<=e&&t.endTime>e)),n?n.index:0}resetFragmentLoadState(e,t=!1){this.log($r.LOG,", resetFragmentLoadState, fragIndex, ",e,",changeBitrate,",t);for(let n=0;n<this.adaptTimeRange.length;n++)if(n<e?(this.adaptTimeRange[n].downloaded=!0,this.adaptTimeRange[n].isLoading=!0):(this.adaptTimeRange[n].downloaded=!1,this.adaptTimeRange[n].isLoading=!1),t){this.adaptTimeRange[n].range=null;const{timeRangeIdx:t}=this.adaptTimeRange[n];if(t[0]>=this.timeRange.length){this.log($r.WARN,"fix adaptTimeRange fragIndex",e," ,timeRangeIdx[0] >= this.timeRange.length, so end",t[0],this.timeRange.length,",endFragment,",n),this.adaptTimeRange=this.adaptTimeRange.slice(0,n);break}t[1]>=this.timeRange.length&&(this.log($r.WARN,"fix adaptTimeRange fragIndex",e," ,timeRangeIdx[1],",t[1],">>>>",this.timeRange.length,",endFragment,",n),t[1]=this.timeRange.length,this.adaptTimeRange=this.adaptTimeRange.slice(0,n+1)),this.adaptTimeRange[n].startTime=this.timeRange[t[0]].startTime,this.adaptTimeRange[n].endTime=t[1]>=this.timeRange.length?this.timeRange[this.timeRange.length-1].endTime:this.timeRange[t[1]].endTime,this.adaptTimeRange[n].range=this.getFragRange(n)}}calculateRange(e){let t=null,n=null,r=null,i=null;const s=e<this.adaptTimeRange.length?this.adaptTimeRange[e].timeRangeIdx:null;if(!s)return this.log($r.warn,"calculateRange err",e,JSON.stringify(this.adaptTimeRange)),[];const a=s[0],o=s[1];this.log($r.LOG,"getFragRange, timeRangeIdx,",JSON.stringify(s));const l=this.videoTrak;l&&(t=a<l.length?l[a]:l[l.length-1],n=o<l.length?l[o-1]:l[l.length-1]);const u=this.audioTrak;u&&(r=a<u.length?u[a]:u[u.length-1],i=o<u.length?u[o-1]:u[u.length-1]);const c=Math.min((null==t?void 0:t.range[0])||1/0,(null==r?void 0:r.range[0])||1/0),h=[c,Math.max(c,(null==n?void 0:n.range[1])||0,(null==i?void 0:i.range[1])||0)];return this.log($r.LOG,"calculateRange",e,h[0],"-",h[1]),h}getTimeRangeByIdx(e){let t=null;const n=this.videoTrak;n&&(t=e<n.length?n[e]:n[n.length-1]);let r=null;const i=this.audioTrak;return i&&(r=e<i.length?i[e]:i[i.length-1]),[Math.min((null==t?void 0:t.range[0])||1/0,(null==r?void 0:r.range[0])||1/0),Math.max((null==t?void 0:t.range[1])-1||0,(null==r?void 0:r.range[1])-1||0)]}getFragRange(e){var t;if(e<this.adaptTimeRange.length&&null!=(t=this.adaptTimeRange[e])&&t.range)return this.log($r.LOG,"getFragRange exist",e,JSON.stringify(this.adaptTimeRange[e].range)),this.adaptTimeRange[e].range;const n=this.calculateRange(e);if(e<this.adaptTimeRange.length){this.adaptTimeRange[e].range=n;const t=this.adaptTimeRange[e].timeRangeIdx[1];if(t<this.timeRange.length){const r=this.getTimeRangeByIdx(t);(null==r?void 0:r.length)>1&&r[0]<r[1]&&n[1]>r[0]&&(this.adaptTimeRange[e].repeatRange=[r[0],n[1]])}}return n}getSubRange(e,t,n){const r=this.adaptTimeRange[e].timeRangeIdx;let i=r[0];for(let e=r[0];e<r[1];e++)if(t>=this.timeRange[e].startTime&&t<this.timeRange[e].endTime){i=e;break}const s=[this.getSrcFragRange(i)[0],n[1]];return this.log($r.LOG,">>>>>getSubRange finalRange ",JSON.stringify(s),",oldRange,",JSON.stringify(n)),s}getSrcFragRange(e){let t=null,n=null;this.log($r.LOG,"getFragRange, timeRangeIdx, srcFragment,",JSON.stringify(e));const r=this.videoTrak;r&&(t=e<r.length?r[e]:r[r.length-1]);const i=this.audioTrak;i&&(n=e<i.length?i[e]:i[i.length-1]);const s=[Math.min((null==t?void 0:t.range[0])||1/0,(null==n?void 0:n.range[0])||1/0),Math.max((null==t?void 0:t.range[1])-1||0,(null==n?void 0:n.range[1])-1||0)];return this.log($r.LOG,",getSrcFragRange",e,s),s}getSamplesRange(e,t){const n=[],r=this.adaptTimeRange[e].timeRangeIdx;switch(t){case"video":if(this.videoTrak&&r[0]<this.videoTrak.length){const{frames:e}=this.videoTrak[r[0]];n.push(e[0].index);const t=this.videoTrak.length,i=r[1]-1,s=i<t?this.videoTrak[i].frames:this.videoTrak[t-1].frames;n.push(s[s.length-1].index)}break;case"audio":if(this.audioTrak&&r[0]<this.audioTrak.length){const{frames:e}=this.audioTrak[r[0]];n.push(e[0].index);const t=this.audioTrak.length,i=r[1]-1,s=i<t?this.audioTrak[i].frames:this.audioTrak[t-1].frames;n.push(s[s.length-1].index)}break;default:console.warn("[getSamplesRange] type ",t," is invalid")}return n}}function al(){const e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/");return t>0||n>0}function ol(){return!!navigator.requestMediaKeySystemAccess&&!function(){const e=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent),t=al(),n=function(){const{mimeTypes:e}=navigator,t=navigator.userAgent;let n=!1;return e&&t.indexOf("Chrome")>1&&(n=Object.keys(e).some((t=>!!(e[t].type&&e[t].type.indexOf("360")>-1||e[t].type&&e[t].type.indexOf("application/vnd.chromium.remoting-viewer")>-1||e[t].description&&e[t].description.indexOf("360")>-1)))),n}(),r=navigator.userAgent.indexOf("Firefox")>0,i=navigator.userAgent.indexOf("Edge")>0;return e||t||n||r||i}()}function ll(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){console.log(e)}return!1}function ul(){const e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported}class cl{constructor(){let e,t;const n=new Promise(((n,r)=>{e=n,t=r}));return n.id=`${(new Date).getTime()}_${parseInt(100*Math.random())}`,n.resolve=function(t){e(t),n.state="fulfilled"},n.reject=function(e){t(e),n.state="rejected",n.isBreak="DESTROYED"===e},n.state="pending",n}resolve(e){}reject(e){}}class hl extends zi{init(){return Promise.resolve()}preloadPredict(e){return e}}const dl="h264";function fl(e){let{mediaType:t,definition:n,codecType:r,vtype:i}=e;const{vid:s}=e;return t=t||"video",n=n||"-1",r=r||dl,i=i||Xi.MP4,s?`${s}#${t}#${r}#${i}#${n}`:null}function pl(e,t){return function(e,t){let n=-1;for(let r=0;r<e.length;r++)if(t===e[r].data.vid){n=r;break}return n}(e,t)>=0}function gl(e,t){for(let n=0;n<e.length;n++)if(e[n]===t)return n;return-1}function ml(e,t){return gl(e,t)>=0}const{PRELOAD_TYPES:vl}=Pi,yl="preload_ended";let _l=0,Tl=!0,bl=null;class Sl extends ji{constructor(e,t){var n;const r=Sl.getDefaultConfig(e);Object.keys(e).forEach((t=>{r[t]=e[t]})),super(r),Va(this,"_updateRealTimeSpeed",(e=>{_l=e.speed,this.emit(za,e)})),this.video=null,this._mp4=null,this._pendingPromise=null,this.playerId=t.playerId||"default",this._nextPreloadCount=0,this.isActive=!0,this.MP4Loader=null,this.playingVids=[],this.playingVids1=[],this.loadingCount=0;const{logCacheLevel:i,logMaxSize:s}=this.options.logCacheConfig;this.logger=new Fr("[Mp4Preloader]",{logCacheLevel:i,logMaxSize:s}),void 0===e.supportHevc&&!(typeof MediaSource>"u"||!MediaSource.isTypeSupported)&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))&&(this.options.supportHevc=!0),this.loadRangeType=(null==(n=this.options)?void 0:n.loadRangeType)||Za,_o($r.DEBUG,"[Preloader] new preloader, playerId",this.playerId),this.update({preloadMaxCacheCount:this.options.preloadMaxCacheCount})}static get PRELOAD_TYPES(){return vl}static get BitRateAdapter(){return bl}static set BitRateAdapter(e){bl=e}static getDefaultConfig(){return{supportHevc:!1,preloadTime:5,preloadSize:0,preloadType:0,segmentMinDuration:5,vtype:"MP4",codecType:"h264",preloadCacheType:1,preloadMaxCacheCount:5,globalKey:null,autoPreload:!1,reqOptions:null,getRequestOptionsCallback:null,minBufferLength:5,timeout:3e3,autoCheck:{enable:!0,interval:1e3},logCacheConfig:{logCacheLevel:2,logMaxSize:204800},pcdnConfig:{openPreloadPCDN:!1,enterMinBuffer:10,outMaxBuffer:5,pcdn_duration:2,pcdn_open:!0,openPCDN:!0,minDuration:25,trackerUrl:""},switchPCDNMaxCnt:2,retryCount:1,retryDelay:1e3,loaderType:"fetch"}}static registerPreloader(e,t){return e.vtype=Xi.MP4,Sl.BitRateAdapter=t,new Sl(e,this)}static getInfoByUniqueKey(e){return function(e){const t=e.split("#"),n=["vid","mediaType","codecType","vtype","definition"],r={};return t.forEach(((e,t)=>{r[n[t]]=e})),r}(e)}static generateUniqueKey(e){return fl(e)}static disable(){Tl=!1}static enable(){Tl=!0}set codecType(e){this.options.codecType=e}get codecType(){return this.options.codecType}get vtype(){return this.options.vtype}log(e,t,...n){_o(this.logger,e,t,...n)}update(e){Object.keys(e).forEach((t=>{this.options[t]=e[t]})),this.preloadManager.setMaxCache?this.preloadManager.setMaxCache(this.options.preloadMaxCacheCount):this.preloadManager._cacheInst._maxCache=this.options.preloadMaxCacheCount}get currentPreloadInst(){return this.preloadManager._currentPreloadInst}startCheckTask(){this.preloadManager.startCheckTask()}stopCheckTask(){this.preloadManager.stopCheckTask()}getPreloadMetaByVid(e){const{allCachedKeys:t,allCachedTimeKeys:n}=this;return function(e,t,n){const r=[];let i="";Object.keys(t).forEach((t=>{const n=function(e){if(!e)throw new Error(`key ${e} is empty`);const t=e.split("#");if(t.length<5)throw new Error(`key ${e} is not right format`);return{vid:t[0],mediaType:t[1],codecType:t[2],vtype:t[3],definition:t[4],order:-1,timeStamp:0,total:0}}(t);n.vid===e&&(r.push(n),i=t)}));let s=null;if(i){const e=function(e){const t=[];return Object.keys(e).forEach((n=>{t.push(Number(e[n]))})),t.sort(((e,t)=>e-t))}(n),t=Number(n[i]),a=function(e,t){for(let n=0;n<e.length;n++)if(e[n]===t)return n;return-1}(e,t);s=r[0],s.timeStamp=t,s.order=a,s.total=e.length}return s}(e,t,n)}async getPreloadMemoryInfo(){const{allCachedKeys:e}=this;let t=0,n=0;for(const r in e)if(e.hasOwnProperty(r)){n++;try{const e=await this.getPreLoadData(r);t+=(null==e?void 0:e.memory)||0}catch{}}return{memory:t,cnt:n}}getPreloadUnuseInfo(){const e=[];for(const[t,n]of Ya)if(Ja.get(t))Ya.delete(t);else{const r=t.split("#"),i=(null==r?void 0:r.length)>0?r[0]:t;e.push({vid:i,bw:(null==n?void 0:n.bw)||0,pbw:(null==n?void 0:n.pbw)||0})}return e}generateUniqueKey(e){return fl(e)}addPlayingItem(e,t){const n=this.checkPlaying("_playerId",e);n>-1?this.playingVids[n].vid=t:this.playingVids.push({vid:t,_playerId:e}),this.log($r.LOG,"addPlayingItem",n,e,t,this.playingVids)}delPlayingItem(e){const t=this.checkPlaying("_playerId",e);this.log($r.LOG,"delPlayingItem",t,e,this.playingVids),t>-1&&this.playingVids.splice(t,1)}checkPlaying(e,t){const n=this.playingVids;for(let r=0;r<n.length;r++)if(t===n[r][e])return r;return-1}before(){this.handlers={checkIfCanPreload:()=>this.checkIfCanPreload(),start:e=>{const t=e.payload||[];if(0===t.length)return Promise.reject(new Error("preload_is_null"));const{vid:n}=e;let r=e.vtype||Xi.MP4,i=e.codecType||dl;const s=this.getUserSelectDefinition(),a=this.checkCacheKey(n,t,s,r,i);if(this.log($r.LOG,`${this.playerId} ${n}`,`codecType:${i} vtype:${r} hasCache:${a}`),a||"MP3"===r)return Promise.reject(new Error(`vtype_${r}`));const o=this.getInitDefinition(t,this.options.definition,s);if(this.log($r.LOG,` ${this.playerId} ${n} getInitDefinition`,null==o?void 0:o.definition),!o)return Promise.reject(new Error("definition_error"));const{definition:l,orgDefinition:u}=o,c=o.vtype||r,h=o.codecType||i,d=e.preloadTime||this.options.preloadTime,f=e.preloadSize||this.options.preloadSize||Math.pow(25,4)-1,p=this.generateUniqueKey({vid:n,definition:l,vtype:c,codecType:h});this._nextPreloadCount>0&&this._nextPreloadCount--,_o($r.LOG,`${n} start duration:${o.duration} preloadTime:${d} cacheKey:${p},playerId:${this.playerId}`);const g={vid:n,definition:l,orgDefinition:u,preloadTime:d,preloadSize:f,cacheKey:p,codecType:h,vtype:c,...o};return e.reqOptions&&(g.reqOptions=e.reqOptions),this.loadingCount++,this.log($r.LOG,`start preload,${n} loadingCount:${this.loadingCount},playerId:${this.playerId}`),this.start(g)},onRequest:({url:e,range:t,extData:n},r)=>this.getData(e,t,n,r)},this.loggerConfig={logger:()=>{},openLog:!1},this.predictInst=new hl(this.loggerConfig)}start(e){const t={mediaInfos:{dynamic_video_list:[],dynamic_audio_list:[]},onObtain:()=>{const e=new cl;return e.resolve(t.mediaInfos),e},onTransform:()=>{const t=new cl;this._pendingPromise=t;const{preloadType:n}=this.options;return this.emit("preload_start",{...e,type:n}),n===vl.DURATION?this.loadByPreloadTime(e,t):this.loadByChunkSize(e,t),t}};return Promise.resolve(t)}getInitDefinition(e,t,n=null){let r=null;return Sl.BitRateAdapter?(r=Sl.BitRateAdapter.select(e,this.codecType,this.vtype),this.log($r.DEBUG,"Mp4Preloader.BitRateAdapter",null==r?void 0:r.type,null==r?void 0:r.definition,null==r?void 0:r.bitrate)):r=function(e,t){let n=null;if(!e||e.length<1)return n;for(let r=0;r<e.length;r++){const i=e[r];if(i.definition===t){n=i;break}}return n||(n=e[0]),n}(e,t),r||(r=e[0]),r}getPreLoadData(e){const t=new cl;return this.getItemSameVid(e).then((e=>{if(this.log($r.DEBUG,"[Preloader] getPreLoadData",!!e.value),e.value){const{mediaSegList:n,meta:r,type:i,buffer:s,preloadTime:a,vid:o,cacheKey:l,definition:u,orgDefinition:c,byteLength:h,duration:d,fileSize:f,from:p,vtype:g,codecType:m,initSeg:v,bitrate:y,adaptTimeRange:_,repeatData:T,memory:b}=e.value,S={vid:o,type:i,vtype:g,codecType:m,definition:u,orgDefinition:c,bitrate:y,cacheKey:l,duration:d||0,byteLength:h,from:p,adaptTimeRange:_,repeatData:T,memory:b,meta:r,preloadTime:a};i===vl.SIZE?(S.buffer=s,S.fileSize=f||0):(S.mediaSegList=n,S.fileSize=f||0,S.initSeg=v),t.resolve(S)}else t.resolve(null)})).catch((e=>{t.reject(e)})),t}async setPreLoadData(e,t){var n,r;const i=new cl,{mediaSegList:s,meta:a,vid:o,definition:l,orgDefinition:u,type:c,buffer:h,duration:d,byteLength:f,preloadTime:p,fileSize:g,from:m,vtype:v,codecType:y,initSeg:_,bitrate:T,adaptTimeRange:b,repeatData:S}=t,P={codecType:y,vtype:v,vid:o,definition:l,orgDefinition:u,cacheKey:e,type:c,from:m,meta:a,fileSize:g,adaptTimeRange:b,repeatData:S,bitrate:T,memory:0};if(P.memory+=(null==S?void 0:S.byteLength)||0,c===vl.SIZE)P.buffer=h,P.byteLength=f||0,P.preloadSize=f||0,P.preloadTime=p||0,P.fileSize=g,P.buffer&&P.buffer.byteLength>0&&(P.memory+=(null==h?void 0:h.byteLength)||0,this.setItem(e,P),i.resolve(!0));else if(P.mediaSegList=[],P.duration=d,P.byteLength=f||0,P.preloadTime=p||0,P.initSeg=_,P.memory+=(null==_?void 0:_.byteLength)||0,P.fileSize=g,s.forEach((e=>{var t;P.memory+=(null==(t=null==e?void 0:e.buffer)?void 0:t.byteLength)||0,P.mediaSegList.push(e)})),a&&0===s.length)this.log($r.LOG,"[Preloader] meta setPreLoadData1 success",e,null==(n=null==P?void 0:P.mediaSegList)?void 0:n.length),this.setItem(e,P),i.resolve(!0);else{const t=s.every((e=>!!e.buffer&&e.state));this.log($r.LOG,"[Preloader] mediaSegList setPreLoadData1 success",e,null==(r=null==P?void 0:P.mediaSegList)?void 0:r.length,t),t||i.resolve(!1),this.setItem(e,P).then((()=>{this.log($r.LOG,"[Preloader] setPreLoadData1 success",e)})),i.resolve(!0)}return i}getInitCacheData(e,t){const n={type:e,meta:null,byteLength:0,fileSize:0,bitrate:0,preloadTime:0};return e===vl.DURATION?(n.mediaSegList=[],n.initSeg=null,n.duration=0):n.buffer=null,Object.keys(t).map((e=>{n[e]=t[e]})),n}updatePreCacheData(e,t,n,r,i,s,a,o,l){const{mediaSegList:u,type:c}=e;if(c===vl.SIZE||-1===i)return e.buffer=Ki(Uint8Array,e.buffer.buffer||[],new Uint8Array(t)),e;let h=-1;for(let e=0;e<u.length;e++)if(u[e].index===i){h=e;break}const d=s||[0,0];if(h>-1)t&&(u[h].buffer=Ki(Uint8Array,u[h].buffer||[],new Uint8Array(t))),n.length>1&&(u[h].range.length>1?u[h].range[1]=n[1]:u[h].range=n),-1!==a[1]&&(r=u[h].range[1]>=a[1]),u[h].state=r;else{const{video:l,audio:c}=o;e.duration=d[1],u.push({buffer:t,range:n||[],index:i,totalRange:a||[],timeRange:[d[0],d[1]],muxSampleIdxRange:{video:l,audio:c},state:r});const h=`${null==t?void 0:t.byteLength},${JSON.stringify(n)},${i},${JSON.stringify(a)},${JSON.stringify(s)}`;this.log($r.DEBUG,`[Preloader] ${e.cacheKey} mediaSegList set, dataLen`,h)}return r&&(e.byteLength+=n[1]-n[0],e.preloadTime+=l),r}checkCacheKey(e,t,n,r=Xi.MP4,i=dl){const s=this.getPreloadMetaByVid(e);if(s)return this.generateUniqueKey(s);if(n){const t=this.generateUniqueKey({vid:e,definition:n,vtype:r,codecType:i});return this.hasItemSameVid(t)?t:null}for(let n=0;n<t.length;n++){const s=this.generateUniqueKey({vid:e,definition:t[n].definition,vtype:r,codecType:i});if(this.hasItemSameVid(s))return s}return null}attachPlayer(e){this.video=e.video?e.video:e}detachPlayer(){this.video=null}checkIfCanPreload(){let e;if(!Tl||this.loadingCount>=1||!this.isActive)return e=!1,e;if(this.video){const{minBufferLength:t,startPreloadControl:n,startPreloadMinBuffer:r,startPreloadMinPosTime:i}=this.options;e=function(e,t){if(!e)return!1;const n=function(e,t){const n=[0,0];if(e)for(let r=0,i=e.length;r<i&&(n[0]=e.start(r),n[1]=e.end(r),!(n[0]<=t&&t<=n[1]));r++);return n[0]-t<=0&&t-n[1]<=0?n:[0,0]}(e.buffered,e.currentTime),{startPreloadControl:r,startPreloadMinBuffer:i,startPreloadMinPosTime:s,minBufferLength:a}=t;if(r){const t=Math.max(n[1]-e.currentTime,0);if(t>i){if(e.currentTime>s)return!0;if(e.currentTime>e.duration/2)return!0}else if(e.currentTime+i+1>e.duration&&e.currentTime+t>e.duration-1)return!0}else{const t=e.duration>a+5?a:e.duration/2,r=Math.min(e.currentTime+a,e.duration),i=n[1]-r;if(e.currentTime>t&&(i>0||Math.abs(i)<1))return!0}return!1}(this.video,{startPreloadControl:n,startPreloadMinBuffer:r,startPreloadMinPosTime:i,minBufferLength:t})}else e=this._nextPreloadCount>0;return _o($r.DEBUG,"[Preloader] checkIfCanPreload",!!this.video,`nextPreloadCount:${this._nextPreloadCount} ret:${e}`),e}startPreloadNext(e=1){let t=!0;return this._nextPreloadCount=e,(this.loadingCount>=1||!this.isActive)&&(t=!1),t&&this.preloadNext(),t}get realTimeSpeed(){return _l}getRequestOption(e){const{getRequestOptionsCallback:t,reqOptions:n}=this.options;let r=null;return r=e.reqOptions?e.reqOptions:"Function"===bo(t)?t(e):n,r||{}}loadByPreloadTime(e,t){var n;const{vid:r,cacheKey:i,preloadTime:s,definition:a,orgDefinition:o,duration:l,bitrate:u}=e,{codecType:c,vtype:h,size:d}=e;let f="Array"===bo(e.url)?e.url[0].src:e.url;if(!f)return void this._endLoadFragments();f=Po(f,{__vid:r});const{segmentMinDuration:p}=this.options,g=s>=p?p:s,m=this.getRequestOption({...e,url:f});this.log($r.DEBUG,"[Preloader] loadByPreloadTime",`${e.cacheKey}, definition:${e.definition},segmentMinDuration:${g}`);const v=d||ko(u,l),y=null==(n=null==e?void 0:e.pktOffsetMap)?void 0:n.find((e=>{var t;return(null==e?void 0:e.time)===((null==(t=this.options)?void 0:t.firstLoadTimePos)||5)})),_=null==y?void 0:y.offset;this._mp4=new sl(f,u,{segmentDuration:g,codecType:this.codecType,chunkSize:this.options.preloadSize,firstLoadSize:_,duration:l,fileSize:v,playerId:this.playerId,vid:r,useUrlRange:!1,retryCount:1,retryDelay:1e3,supportHevc:this.options.supportHevc,retryCheckFunc:Lo,switchPCDNMaxCnt:Number.MAX_VALUE,logger:this.logger,reqOptions:m,fixEditListOffset:this.options.fixEditListOffset},[],this.firstFrameTime,"[Preloader]");const T=this.getInitCacheData(vl.DURATION,{vid:r,definition:a,orgDefinition:o,cacheKey:i,codecType:c,vtype:h,bitrate:u||0});this._mp4.once("metaReady",(async n=>{var s;const a=this._mp4;a&&(this.log($r.DEBUG,`[Preloader] ${r} metaReady ${null==(s=null==T?void 0:T.mediaSegList)?void 0:s.length}`),T.meta=n,T.from=2,T.fileSize=a.size,await a.cancelLoading(),!a.hasDestroyed&&(a.metaLoading=!1,this.emit("prf_meta_ready",{...T}),await this.setPreLoadData(i,T),!a.hasDestroyed&&this.startLoadByFragments(T,e,t)))})),this._mp4.on(Ho,(e=>{this.log($r.ERROR,`[Preloader] ${r} loadByPreloadTime error`),this._endLoadFragments(),this.emit("error",e)})),this._mp4.on(Jo,(e=>{this.bwEventEmit(r,e.load_type,e.len,null,i,e)})),this._mp4.MP4Loader.on(za,(e=>{var t;if((null==e?void 0:e.len)>0){const n=(null==(t=null==e?void 0:e.priOptions)?void 0:t.type)||Wa,s=Co(e.len,e.time);this.bwEventEmit(r,n,e.len,s,i,e)}})),this._mp4.init({})}bwEventEmit(e,t,n,r,i,s){const a=Ya.get(i)||{bw:0,pbw:0};(!t||t===Wa)&&(a.bw=a.bw+n,this.emit("prf_data_size",{vid:e,task_type:2,cdn_size:n,cdn_speed:r,...s})),Ya.set(i,a),this._updateRealTimeSpeed({speed:r,type:t||Wa})}async loadByChunkSize(e){var t;const{vid:n,cacheKey:r,definition:i,orgDefinition:s,duration:a,bitrate:o,codecType:l,vtype:u,size:c}=e,{options:h}=this;let d="Array"===bo(e.url)?e.url[0].src:e.url;if(!d)return void this._endLoadChunk();d=Po(d,{__vid:n});const f=c||ko(o,a),p=null==(t=null==e?void 0:e.pktOffsetMap)?void 0:t.find((e=>(null==e?void 0:e.time)===((null==h?void 0:h.firstLoadTimePos)||5))),g=null==p?void 0:p.offset,m=fo(a,8e5,f);this.log($r.LOG,`${n} loadByChunkSize`,e.cacheKey,e.definition,g||m);const v=this.getInitCacheData(vl.SIZE,{vid:n,definition:i,orgDefinition:s,cacheKey:r,codecType:l,vtype:u,fileSize:c,bitrate:o||0}),y=this.getRequestOption({...e,url:d});this.MP4Loader=new Ea({url:d,vid:`${n}-${o}`,retry:h.retryCount||2,retryDelay:h.retryDelay||1e3,timeout:h.timeout||3e3,...y,loaderType:h.loaderType,retryCheckFunc:Lo,openLog:yo(),fixEditListOffset:h.fixEditListOffset}),this.MP4Loader.on(za,(e=>{var t;if((null==e?void 0:e.len)>0){const i=(null==(t=null==e?void 0:e.priOptions)?void 0:t.type)||Wa,s=Co(e.len,e.time);this.bwEventEmit(n,i,e.len,s,r)}}));try{let e=new Uint8Array(0),t=0,i=null,s=null;const a=async(a,o,l,u,c)=>{var h;if(v.fileSize||(v.fileSize=Number(Fo(c.headers))),a&&l.range&&l.range[0]===t&&(e=Ki(Uint8Array,e,new Uint8Array(a)),t+=a.byteLength),l.meta){await this.MP4Loader.cancel();const u=(null==(h=null==a?void 0:a.priOptions)?void 0:h.type)||Wa;this.bwEventEmit(n,u,e.byteLength,null,r);const c=l.meta,f=c.videoSegments,p=c.audioSegments;s={...c.meta,ext:{videoTrak:f,audioTrak:p}},v.meta=s,i=Eo(0,f,p),v.buffer=e.slice(i[0]),v.byteLength=v.buffer.byteLength;const g=Eo(1,f,p);let m=[];g[0]<g[1]&&i[1]>g[0]&&(m=[g[0],i[1]]);const y=(null==f?void 0:f.length)>0?f:p,{startTime:_}=y[0],{endTime:T}=y[0],b={startTime:_,endTime:T,range:[...i],repeatRange:m,duration:T-_,downloaded:!1,isLoading:!1,timeRangeIdx:[0,1]};v.adaptTimeRange=[b],this.log($r.LOG,`${n} loadMetaProcess ret`,r,e.byteLength,JSON.stringify(i),v.buffer.byteLength,JSON.stringify(m)),this.setPreLoadData(r,v);const S=[t,i[1]];this.log($r.LOG,`${r} loadMetaProcess end, loadOneChunk start`,o,JSON.stringify(S),t,e.byteLength),this._loadOneChunk(v,S,d,b.duration)}};await this.MP4Loader.loadMetaProcess(this.MP4Loader.cache,[0,g||m],a)}catch(e){console.error(`[Preloader] ${r} loadByChunkSize error`,e),this._endLoadChunk()}}async _loadOneChunk(e,t,n,r){if((null==t?void 0:t.length)>0&&t[0]>=t[1])return this._endLoadChunk(),void this.emit(yl,e);const i=n,{vid:s,cacheKey:a,buffer:o}=e;try{const n=await this.MP4Loader.loadData(t,this.MP4Loader.cache,{index:0,url:i,priOptions:{}});this.log($r.LOG,`${s} _loadOneChunk`,JSON.stringify(t),a);const{response:l,data:u}=n;if(u){if(this._endLoadChunk(),l&&l.headers){const t=ko(l.headers);t&&(e.fileSize=t)}e.buffer=Mo(o,u),e.byteLength=e.buffer.byteLength,e.preloadTime+=r,this.log($r.LOG,`${s} _loadOneChunk ret`,a,e.buffer.byteLength,null==u?void 0:u.byteLength),e.from=4,this.setPreLoadData(a,e)}else this._endLoadChunk()}catch(e){this.log($r.ERROR,`[Preloader] ${s} loadByChunkSize error`,null==e?void 0:e.message),this._endLoadChunk()}}_endLoadChunk(){this.log($r.LOG,`_endLoadChunk loadingCount:${this.loadingCount}`,this._pendingPromise?this._pendingPromise.state:null),this._pendingPromise&&(this._pendingPromise.resolve(),this._pendingPromise=null),this.loadingCount>0&&this.loadingCount--,this.MP4Loader&&(this.MP4Loader.cancel(),this.MP4Loader.destroy(),this.MP4Loader=null)}getAdaptRanges(e,t){const{timeRange:n}=e;for(let r=0;r<n.length&&n[r].startTime<=t;r++)e.updateAdaptTimeRange(r,1),e.getFragRange(r);return this._mp4.adaptTimeRange}async startLoadByFragments(e,t){const{preloadTime:n,vid:r}=t;this.log($r.LOG,`[Preloader] ${r} startLoadByFragments`,t);const i=this.getAdaptRanges(this._mp4,n),s=e=>{this.log($r.ERROR,`[Preloader] ${r} _failedCallback error`,null==e?void 0:e.message),this.emit("error",e),this._endLoadFragments()},a=async t=>{var n;if(!this._mp4)return;const{buffer:r,context:o,state:l,initSeg:u}=t,{fragIndex:c,range:h,timeRange:d}=o,{_repeatInfo:f,adaptTimeRange:p}=this._mp4,g=p[c],m=null==g?void 0:g.range,v=null==g?void 0:g.duration;!e.initSeg&&u&&(e.initSeg=u,e.adaptTimeRange=p);const y=this._mp4._lastDemuxSampleIdxRange;e.repeatData=(null==(n=f.data)?void 0:n.slice(0,f.curDataPos))||[];const _=this.updatePreCacheData(e,r,h,l,c,d,m,y,v);this.log($r.LOG,`[Preloader] ${e.cacheKey} _successCallback`,c,l,_,e),e.from=3,_&&(await this.setPreLoadData(e.cacheKey,e),c>=i.length-1?(this.log($r.LOG,`[Preloader] ${e.cacheKey} mp4.load end`,c),this.emit(yl,e),this._endLoadFragments()):(this.log($r.LOG,`[Preloader] ${e.cacheKey} mp4.load start`,c+1),await this._mp4.loadAllFragmentData(c+1,a,s)))};await this._mp4.loadAllFragmentData(0,a,s)}_endLoadFragments(){this.log($r.LOG,`[Preloader] _endLoadFragments loadingCount:${this.loadingCount},${this.playerId}`,this._pendingPromise?this._pendingPromise.state:null),this._pendingPromise&&(this._pendingPromise.resolve(),this._pendingPromise=null),this.loadingCount>0&&this.loadingCount--,this._mp4&&(this._mp4.cancelLoading(),this._mp4.destroy(),this._mp4=null)}getFragment(e,t,n,r,i,s={}){const a=new cl;return this.getData(e,t,s,!1).then((e=>{r.createFragment(new Uint8Array(e.res),t[0]-r.mdatStart,n,{range:t,context:e.context}).then((e=>{a.resolve(e)}))})),a}getPreloadUrl({url:e,range:t,definition:n,vid:r}){return[{url:e,range:t,extData:{cacheKey:Sl.generateUniqueKey({vid:r,start:t[0],end:t[1],definition:n}),vid:r,format:"mp4"}}]}getRangeList(e){const{allCachedKeys:t}=this,n={timeRange:[],contentRange:[]};for(const r in t)if(t.hasOwnProperty(r)&&r.indexOf(e)>-1){const e=r.split("#");0===e[2].indexOf("pretime")?n.timeRange.push([0,parseFloat(e[2].slice(7))]):n.contentRange.push([parseInt(e[2]),parseInt(e[3])])}return n}hasItemSameVid(e){if(!e)return null;const t=e.split("#"),n=Object.keys(this.allCachedKeys);for(let r=0;r<n.length;r++){const i=n[r];if(i===e)return i;const s=i.split("#");if(s.length>=4&&t.length>=4&&s[0]===t[0]){if(0===s[2].indexOf("pretime")&&0===t[2].indexOf("pretime"))return i;{const e=[parseInt(s[2]),parseInt(s[3])],n=[parseInt(t[2]),parseInt(t[3])];if(n[0]>=e[0]&&n[1]>n[0]&&n[1]<=e[1])return i}}}return null}removeOthers(e=[]){const{allCachedKeys:t}=this;for(const n in t)if(t.hasOwnProperty(n)&&n.split("#").length>=1){const t=n.split("#")[0];e.every((e=>e.split("#").length>=1&&e.split("#")[0]!==t))&&(this.log($r.LOG,`remove cache:${n}`),this.cacheInst.removeItem(n))}}removeAll(){const{allCachedKeys:e}=this;for(const t in e)e.hasOwnProperty(t)&&(this.log($r.DEBUG,`remove cache:${t}`),this.cacheInst.removeItem(t))}removeAllPreloadTask(){this.preloadManager._preloadDataList=[],this.playingVids=[]}getItemSameVid(e,t){const n=this.hasItemSameVid(e);return this.log($r.DEBUG,`getItemSameVid: key:${e} checkResult:${n}`),n?this.cacheInst.getItem(n,t).then((e=>({value:e,key:n}))):Promise.resolve({})}setItem(e,t){return this.cacheInst.setItem(e,t)}removeItem(e,t){return this.cacheInst.removeItem(e,t)}get allCachedKeys(){return this.cacheInst._allCachedKeys||{}}get allCachedTimeKeys(){return this.cacheInst._allCachedTimeKeys||{}}get cacheInst(){return this.preloadManager._cacheInst}get preloadQueueList(){return this.preloadManager._preloadDataList||[]}cancelPreloadByVid(e,t){if(!e)return;const{_preloadDataList:n}=this.preloadManager,r=[];for(let t=0;t<n.length;t++){const{data:i}=n[t];i.vid!==e?r.push(n[t]):this.log($r.LOG,"cancelPreloadByVid",e)}this.preloadManager._preloadDataList=r;const i=this.currentPreloadInst,s=i&&i.options?i.options:{};this.log($r.LOG,"cancelPreloadByVid",e,t,e===s.vid,s),s.vid===e&&this.cancelLoading(),this.addPlayingItem(t,e)}addPlayingVid(e){if(!e)return;const{_preloadDataList:t}=this.preloadManager,n=function(e,t){return e.filter((e=>e.data.vid!==t))}(t,e);this.preloadManager._preloadDataList=n;const r=this.currentPreloadInst,i=r&&r.options?r.options:{};this.log($r.LOG,"cancelPreloadByVid",e,e===i.vid,i),i.vid===e&&this.cancelLoading(),ml(this.playingVids1,e)||this.playingVids1.push(e)}removePlayingVid(e){const t=gl(this.playingVids1,e);t>=0&&this.playingVids1.splice(t,1)}cancelLoading(){this.log($r.LOG,"cancelLoading"),this._endLoadFragments(),this._endLoadChunk()}clearTaskItem(e){const{preloadManager:t}=this;if(t._currentPreloadInst){const{_toLoadList:n}=t._currentPreloadInst,r=[];n.map((t=>(t._playerId!==e&&r.push(t),t))),t._currentPreloadInst._toLoadList=r}const n=[],r=[];this.log($r.LOG,"clearTaskItem before",e,t._preloadDataList.length),t._preloadDataList.map((t=>(t._playerId!==e?n.push(t):r.push(t.data.vid),t))),this.log($r.LOG,"clearTaskItem",e,r.join(","),t._preloadDataList.length),t._preloadDataList=n}clearTask(){const{preloadManager:e}=this;e._preloadDataList=[]}addPreloader(e){if(!e.data)return;const{_preloadDataList:t}=this.preloadManager,{vid:n}=e.data,r=pl(t||[],n),i=ml(this.playingVids1,n);if(this.log($r.LOG,"[Preloader] addPreloader checkIfVidInList",n,r),r||i)return;const s=wo({},e);s.vtype||(s.vtype=Xi.MP4),this.addDashPreloader(s)}addPreloaderList(e=[]){const t=[],{_preloadDataList:n}=this.preloadManager;for(let r=0;r<e.length;r++){const{vid:i,vtype:s}=e[r].data,a=pl(n||[],i),o=ml(this.playingVids1,i);if(this.log($r.LOG,"[Preloader] addPreloaderList checkIfVidInList",i,a,o),a||o)continue;const l=wo({},e[r]);s||(l.data.vtype=Xi.MP4),t.push(l)}return this.log($r.LOG,`[Preloader] addPreloaderList length is ${t.length}`),this.addDashPreloaderList(t),t}setUserSelectDefinition(e){this.preloadManager&&(this.preloadManager.userDefinition=e)}getUserSelectDefinition(){return this.preloadManager.userDefinition||null}cancel(e){this.clearTaskItem(e),this.delPlayingItem(e,null)}destroy(e){this.cancelLoading(),this.clearTaskItem(e),this.delPlayingItem(e,null)}on(e,t,...n){super.on(e,t,...n)}off(e,t,...n){super.off(e,t,...n)}}var Pl=Object.defineProperty,wl=(e,t,n)=>((e,t,n)=>t in e?Pl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);function kl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ml(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function El(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ll(r.key),r)}}function Rl(e,t,n){return t&&El(e.prototype,t),n&&El(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function xl(e,t,n){return(t=Ll(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Dl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Il(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dl(Object(n),!0).forEach((function(t){xl(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Cl(e){return function(e){if(Array.isArray(e))return kl(e)}(e)||function(e){if(typeof Symbol<"u"&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return kl(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kl(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ll(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}function Ol(e){return Ol="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ol(e)}var Al=typeof window<"u"&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,Gl={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},Bl="%c[xgplayer]",Nl={config:{debug:Al?3:0},logInfo:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.config.debug>=3&&(t=console).log.apply(t,[Bl,Gl.info,e].concat(r))},logWarn:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.config.debug>=1&&(t=console).warn.apply(t,[Bl,Gl.warn,e].concat(r))},logError:function(e){var t;if(!(this.config.debug<1)){for(var n=this.config.debug>=2?"trace":"error",r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];(t=console)[n].apply(t,[Bl,Gl.error,e].concat(i))}}},$l=function(){return Rl((function e(t){Ml(this,e),this.bufferedList=t}),[{key:"start",value:function(e){return this.bufferedList[e].start}},{key:"end",value:function(e){return this.bufferedList[e].end}},{key:"length",get:function(){return this.bufferedList.length}}])}(),Ul={createDom:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=r,i.innerHTML=t,Object.keys(n).forEach((function(t){var r=t,s=n[t];"video"===e||"audio"===e||"live-video"===e?s&&i.setAttribute(r,s):i.setAttribute(r,s)})),i},createDomFromHtml:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{var r=document.createElement("div");r.innerHTML=e;var i=r.children;return r=null,i.length>0?(i=i[0],n&&Ul.addClass(i,n),t&&Object.keys(t).forEach((function(e){i.setAttribute(e,t[e])})),i):null}catch(e){return Nl.logError("util.createDomFromHtml",e),null}},hasClass:function(e,t){if(!e||!t)return!1;try{return Array.prototype.some.call(e.classList,(function(e){return e===t}))}catch{var n=e.className&&"object"===Ol(e.className)?e.getAttribute("class"):e.className;return n&&!!n.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}},addClass:function(e,t){if(e&&t)try{t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.add(t)}))}catch{Ul.hasClass(e,t)||(e.className&&"object"===Ol(e.className)?e.setAttribute("class",e.getAttribute("class")+" "+t):e.className+=" "+t)}},removeClass:function(e,t){if(e&&t)try{t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.remove(t)}))}catch{Ul.hasClass(e,t)&&t.split(/\s+/g).forEach((function(t){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className&&"object"===Ol(e.className)?e.setAttribute("class",e.getAttribute("class").replace(n," ")):e.className=e.className.replace(n," ")}))}},toggleClass:function(e,t){e&&t.split(/\s+/g).forEach((function(t){Ul.hasClass(e,t)?Ul.removeClass(e,t):Ul.addClass(e,t)}))},classNames:function(){for(var e=arguments,t=[],n=function(n){"String"===Ul.typeOf(e[n])?t.push(e[n]):"Object"===Ul.typeOf(e[n])&&Object.keys(e[n]).map((function(r){e[n][r]&&t.push(r)}))},r=0;r<arguments.length;r++)n(r);return t.join(" ")},findDom:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,n=arguments.length>1?arguments[1]:void 0;try{e=t.querySelector(n)}catch(r){Nl.logError("util.findDom",r),0===n.indexOf("#")&&(e=t.getElementById(n.slice(1)))}return e},getCss:function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]},padStart:function(e,t,n){for(var r=String(n),i=0|t,s=Math.ceil(i/r.length),a=[],o=String(e);s--;)a.push(r);return a.join("").substring(0,i-o.length)+o},format:function(e){if(window.isNaN(e))return"";e=Math.round(e);var t=Ul.padStart(Math.floor(e/3600),2,0),n=Ul.padStart(Math.floor((e-3600*t)/60),2,0),r=Ul.padStart(Math.floor(e-3600*t-60*n),2,0);return("00"===t?[n,r]:[t,n,r]).join(":")},event:function(e){if(e.touches){var t=e.touches[0]||e.changedTouches[0];e.clientX=t.clientX||0,e.clientY=t.clientY||0,e.offsetX=t.pageX-t.target.offsetLeft,e.offsetY=t.pageY-t.target.offsetTop}e._target=e.target||e.srcElement},typeOf:function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},deepCopy:function(e,t){if("Object"===Ul.typeOf(t)&&"Object"===Ul.typeOf(e))return Object.keys(t).forEach((function(n){"Object"!==Ul.typeOf(t[n])||t[n]instanceof Node?"Array"===Ul.typeOf(t[n])?e[n]="Array"===Ul.typeOf(e[n])?e[n].concat(t[n]):t[n]:e[n]=t[n]:void 0===e[n]||void 0===e[n]?e[n]=t[n]:Ul.deepCopy(e[n],t[n])})),e},deepMerge:function(e,t){return Object.keys(t).map((function(n){var r;"Array"===Ul.typeOf(t[n])&&"Array"===Ul.typeOf(e[n])?"Array"===Ul.typeOf(e[n])&&(r=e[n]).push.apply(r,Cl(t[n])):Ul.typeOf(e[n])!==Ul.typeOf(t[n])||null===e[n]||"Object"!==Ul.typeOf(e[n])||t[n]instanceof window.Node?null!==t[n]&&(e[n]=t[n]):Ul.deepMerge(e[n],t[n])})),e},getBgImage:function(e){var t=(e.currentStyle||window.getComputedStyle(e,null)).backgroundImage;if(!t||"none"===t)return"";var n=document.createElement("a");return n.href=t.replace(/url\("|"\)/g,""),n.href},copyDom:function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,(function(e){t.setAttribute(e.name,e.value)})),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},setInterval:function(e,t,n,r){e._interval[t]||(e._interval[t]=window.setInterval(n.bind(e),r))},clearInterval:function(e,t){clearInterval(e._interval[t]),e._interval[t]=null},setTimeout:function(e,t,n){e._timers||(e._timers=[]);var r=setTimeout((function(){t(),Ul.clearTimeout(e,r)}),n);return e._timers.push(r),r},clearTimeout:function(e,t){var n=e._timers;if("Array"===Ul.typeOf(n)){for(var r=0;r<n.length;r++)if(n[r]===t){n.splice(r,1),clearTimeout(t);break}}else clearTimeout(t)},clearAllTimers:function(e){var t=e._timers;"Array"===Ul.typeOf(t)&&(t.map((function(e){clearTimeout(e)})),e._timerIds=[])},createImgBtn:function(e,t,n,r){var i,s,a,o=Ul.createDom("xg-".concat(e),"",{},"xgplayer-".concat(e,"-img"));return o.style.backgroundImage='url("'.concat(t,'")'),n&&r&&(["px","rem","em","pt","dp","vw","vh","vm","%"].every((function(e){return!(n.indexOf(e)>-1&&r.indexOf(e)>-1&&(i=parseFloat(n.slice(0,n.indexOf(e)).trim()),s=parseFloat(r.slice(0,r.indexOf(e)).trim()),a=e,1))})),o.style.width="".concat(i).concat(a),o.style.height="".concat(s).concat(a),o.style.backgroundSize="".concat(i).concat(a," ").concat(s).concat(a),o.style.margin="start"===e?"-".concat(s/2).concat(a," auto auto -").concat(i/2).concat(a):"auto 5px auto 5px"),o},Hex2RGBA:function(e,t){var n=[];if(/^\#[0-9A-F]{3}$/i.test(e)){var r="#";e.replace(/[0-9A-F]/gi,(function(e){r+=e+e})),e=r}return/^#[0-9A-F]{6}$/i.test(e)?(e.replace(/[0-9A-F]{2}/gi,(function(e){n.push(parseInt(e,16))})),"rgba(".concat(n.join(","),", ").concat(t,")")):"rgba(255, 255, 255, 0.1)"},getFullScreenEl:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},checkIsFunction:function(e){return e&&"function"==typeof e},checkIsObject:function(e){return null!==e&&"object"===Ol(e)},hide:function(e){e.style.display="none"},show:function(e,t){e.style.display=t||"block"},isUndefined:function(e){if(typeof e>"u"||null===e)return!0},isNotNull:function(e){return null!=e},setStyleFromCsstext:function(e,t){t&&("String"===Ul.typeOf(t)?t.replace(/\s+/g,"").split(";").map((function(t){if(t){var n=t.split(":");n.length>1&&(e.style[n[0]]=n[1])}})):Object.keys(t).map((function(n){e.style[n]=t[n]})))},filterStyleFromText:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],n=e.style.cssText;if(!n)return{};var r=n.replace(/\s+/g,"").split(";"),i={},s={};return r.map((function(e){if(e){var n=e.split(":");n.length>1&&(function(e,t){for(var n=0,r=t.length;n<r;n++)if(e.indexOf(t[n])>-1)return!0;return!1}(n[0],t)?i[n[0]]=n[1]:s[n[0]]=n[1])}})),e.setAttribute("style",""),Object.keys(s).map((function(t){e.style[t]=s[t]})),i},getStyleFromCsstext:function(e){var t=e.style.cssText;if(!t)return{};var n=t.replace(/\s+/g,"").split(";"),r={};return n.map((function(e){if(e){var t=e.split(":");t.length>1&&(r[t[0]]=t[1])}})),r},preloadImg:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e){var r=new window.Image;r.onload=function(e){r=null,t&&t(e)},r.onerror=function(e){r=null,n&&n(e)},r.src=e}},stopPropagation:function(e){e&&e.stopPropagation()},scrollTop:function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},scrollLeft:function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0},checkTouchSupport:function(){return"ontouchstart"in window},getBuffered2:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=[],r=0;r<e.length;r++)n.push({start:e.start(r)<.5?0:e.start(r),end:e.end(r)});n.sort((function(e,t){return e.start-t.start||t.end-e.end}));var i=[];if(t)for(var s=0;s<n.length;s++){var a=i.length;if(a){var o=i[a-1].end;n[s].start-o<t?n[s].end>o&&(i[a-1].end=n[s].end):i.push(n[s])}else i.push(n[s])}else i=n;return new $l(i)},getEventPos:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.touches&&e.touches.length>0&&(e=e.touches[0]),{x:e.x/t,y:e.y/t,clientX:e.clientX/t,clientY:e.clientY/t,offsetX:e.offsetX/t,offsetY:e.offsetY/t,pageX:e.pageX/t,pageY:e.pageY/t}},requestAnimationFrame:function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(t)return t(e)},getHostFromUrl:function(e){if("String"!==Ul.typeOf(e))return"";var t=e.split("/"),n="";return t.length>3&&t[2]&&(n=t[2]),n},cancelAnimationFrame:function(e){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;t&&t(e)},isMSE:function(e){return e.media&&(e=e.media),!!(e&&e instanceof HTMLMediaElement)&&(/^blob/.test(e.currentSrc)||/^blob/.test(e.src))},isBlob:function(e){return"string"==typeof e&&/^blob/.test(e)},generateSessionId:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=(new Date).getTime();try{e=parseInt(e)}catch{e=0}return t+=e,window.performance&&"function"==typeof window.performance.now&&(t+=parseInt(window.performance.now())),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)}))},createEvent:function(e){var t;return"function"==typeof window.Event?t=new Event(e):(t=document.createEvent("Event")).initEvent(e,!0,!0),t},adjustTimeByDuration:function(e,t,n){return t&&e&&(e>t||n&&e<t)?t:e},createPositionBar:function(e,t){var n=Ul.createDom("xg-bar","",{"data-index":-1},e);return t.appendChild(n),n},getTransformStyle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,scale:1,rotate:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n={scale:"".concat(e.scale||1),translate:"".concat(e.x||0,"%, ").concat(e.y||0,"%"),rotate:"".concat(e.rotate||0,"deg")};return Object.keys(n).forEach((function(e){var r=new RegExp("".concat(e,"\\([^\\(]+\\)"),"g"),i="".concat(e,"(").concat(n[e],")");r.test(t)?(r.lastIndex=-1,t=t.replace(r,i)):t+="".concat(i," ")})),t},convertDeg:function(e){return Math.abs(e)<=1?360*e:e%360},getIndexByTime:function(e,t){var n=t.length,r=-1;if(n<1)return r;if(e<=t[0].end||n<2)r=0;else if(e>t[n-1].end)r=n-1;else for(var i=1;i<n;i++)if(e>t[i-1].end&&e<=t[i].end){r=i;break}return r},getOffsetCurrentTime:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if((n=r>=0&&r<t.length?r:Ul.getIndexByTime(e,t))<0)return-1;var i=t.length,s=t[n],a=s.start,o=s.end,l=s.cTime,u=s.offset;return e<a?l:e>=a&&e<=o?e-u:e>o&&n>=i-1?o:-1},getCurrentTimeByOffset:function(e,t){var n=-1;if(!t||t.length<0)return e;for(var r=0;r<t.length;r++)if(e<=t[r].duration){n=r;break}if(-1!==n){var i=t[n].start;return n-1<0?i+e:i+(e-t[n-1].duration)}return e}},Fl=/(Android)\s([\d.]+)/,Hl=/(Version)\/([\d.]+)/,Vl=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],jl={get device(){return jl.os.isPc?"pc":"mobile"},get browser(){if(typeof navigator>"u")return"";var e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter((function(n){return t[n].test(e)})))[0]},get os(){if(typeof navigator>"u")return{};var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),n=/(?:SymbianOS)/.test(e)||t,r=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),s=/(?:iPad|PlayBook)/.test(e)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,a=s||r&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e),o=/(?:iPhone)/.test(e)&&!a;return{isTablet:a,isPhone:o,isIpad:s,isIos:o||s,isAndroid:r,isPc:!(o||r||n||a),isSymbian:n,isWindowsPhone:t,isFireFox:i}},get osVersion(){if(typeof navigator>"u")return 0;var e=navigator.userAgent,t="",n=(t=/(?:iPhone)|(?:iPad|PlayBook)/.test(e)?Hl:Fl)?t.exec(e):[];if(n&&n.length>=3){var r=n[2].split(".");return r.length>0?parseInt(r[0]):0}return 0},get isWeixin(){return!(typeof navigator>"u")&&!!/(micromessenger)\/([\d.]+)/.exec(navigator.userAgent.toLocaleLowerCase())},isSupportMP4:function(){var e={isSupport:!1,mime:""};if(typeof document>"u")return e;if(this.supportResult)return this.supportResult;var t=document.createElement("video");return"function"==typeof t.canPlayType&&Vl.map((function(n){"probably"===t.canPlayType('video/mp4; codecs="'.concat(n,'"'))&&(e.isSupport=!0,e.mime+="||".concat(n))})),this.supportResult=e,t=null,e},isMSESupport:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(typeof MediaSource>"u"||!MediaSource)return!1;try{return MediaSource.isTypeSupported(e)}catch(t){return this._logger.error(e,t),!1}},isHevcSupported:function(){return!(typeof MediaSource>"u"||!MediaSource.isTypeSupported)&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))},probeConfigSupported:function(e){var t={supported:!1,smooth:!1,powerEfficient:!1};if(!e||typeof navigator>"u")return Promise.resolve(t);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(e);var n=e.video||{},r=e.audio||{};try{var i=MediaSource.isTypeSupported(n.contentType),s=MediaSource.isTypeSupported(r.contentType);return Promise.resolve({supported:i&&s,smooth:!1,powerEfficient:!1})}catch{return Promise.resolve(t)}}},zl="3.0.21",Xl={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106},Kl=Rl((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};Ml(this,e);var r=t&&t.i18n?t.i18n.ERROR_TYPES:null;if(t.media){var i=n.mediaError?n.mediaError:t.media.error||{},s=t.duration,a=t.currentTime,o=t.ended,l=t.src,u=t.currentSrc,c=t.media,h=c.readyState,d=c.networkState,f=n.errorCode||i.code;Xl[f]&&(f=Xl[f]);var p={playerVersion:zl,currentTime:a,duration:s,ended:o,readyState:h,networkState:d,src:l||u,errorType:n.errorType,errorCode:f,message:n.errorMessage||i.message,mediaError:i,originError:n.originError?n.originError.stack:"",host:Ul.getHostFromUrl(l||u)};return n.ext&&Object.keys(n.ext).map((function(e){p[e]=n.ext[e]})),p}if(arguments.length>1){for(var g={playerVersion:zl,domain:document.domain},m=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],v=0;v<arguments.length;v++)g[m[v]]=arguments[v];return g.ex=r?(r[arguments[0]]||{}).msg:"",g}})),Wl="loadeddata",Ql="loadstart",ql="definition_change",Yl="after_definition_change";function Jl(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];var a=t.call.apply(t,[e].concat(i));!n||"function"!=typeof n||(a&&a.then?a.then((function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];n.call.apply(n,[e].concat(r))})):n.call.apply(n,[e].concat(i)))}function Zl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[e]&&(this.__hooks[e]=null),function(){var r=arguments,i=this;if(n.pre)try{var s;(s=n.pre).call.apply(s,[this].concat(Array.prototype.slice.call(arguments)))}catch(t){throw t.message="[pluginName: ".concat(this.pluginName,":").concat(e,":pre error] >> ").concat(t.message),t}if(this.__hooks&&this.__hooks[e])try{var a,o=(a=this.__hooks[e]).call.apply(a,[this,this].concat(Array.prototype.slice.call(arguments)));o?o.then?o.then((function(e){!1!==e&&Jl.apply(void 0,[i,t,n.next].concat(Cl(r)))})).catch((function(e){throw e})):Jl.apply(void 0,[this,t,n.next].concat(Array.prototype.slice.call(arguments))):void 0===o&&Jl.apply(void 0,[this,t,n.next].concat(Array.prototype.slice.call(arguments)))}catch(t){throw t.message="[pluginName: ".concat(this.pluginName,":").concat(e,"] >> ").concat(t.message),t}else Jl.apply(void 0,[this,t,n.next].concat(Array.prototype.slice.call(arguments)))}.bind(this)}function eu(e,t){var n=this.__hooks;if(n)return n.hasOwnProperty(e)?(n&&(n[e]=t),!0):(console.warn("has no supported hook which name [".concat(e,"]")),!1)}function tu(e,t){var n=this.__hooks;n&&delete n[e]}function nu(e,t){Nl.logError("[".concat(e,"] event or callback cant be undefined or null when call ").concat(t))}var ru=function(){return Rl((function e(t){Ml(this,e),Ul.checkIsFunction(this.beforeCreate)&&this.beforeCreate(t),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.__hooks={},t&&t.map((function(t){e.__hooks[t]=null})),Object.defineProperty(e,"hooks",{get:function(){return e.__hooks&&Object.keys(e.__hooks).map((function(t){if(e.__hooks[t])return t}))}})}(this),this.__args=t,this.__events={},this.__onceEvents={},this.config=t.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(t)}),[{key:"beforeCreate",value:function(e){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(e){this.player=e.player,this.playerConfig=e.player&&e.player.config,this.pluginName=e.pluginName?e.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=e.player&&e.player.logger}},{key:"updateLang",value:function(e){e||(e=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var e=Ul.checkTouchSupport()?"touch":"mouse";return this.playerConfig&&("touch"===this.playerConfig.domEventType||"mouse"===this.playerConfig.domEventType)&&(e=this.playerConfig.domEventType),e}},{key:"on",value:function(e,t){var n=this;e&&t&&this.player?"string"==typeof e?(this.__events[e]=t,this.player.on(e,t)):Array.isArray(e)&&e.forEach((function(e){n.__events[e]=t,n.player.on(e,t)})):nu(this.pluginName,"plugin.on(event, callback)")}},{key:"once",value:function(e,t){var n=this;e&&t&&this.player?"string"==typeof e?(this.__onceEvents[e]=t,this.player.once(e,t)):Array.isArray(e)&&e.forEach((function(r){n.__onceEvents[r]=t,n.player.once(e,t)})):nu(this.pluginName,"plugin.once(event, callback)")}},{key:"off",value:function(e,t){var n=this;e&&t&&this.player?"string"==typeof e?(delete this.__events[e],this.player.off(e,t)):Array.isArray(e)&&e.forEach((function(r){delete n.__events[e],n.player.off(r,t)})):nu(this.pluginName,"plugin.off(event, callback)")}},{key:"offAll",value:function(){var e=this;["__events","__onceEvents"].forEach((function(t){Object.keys(e[t]).forEach((function(n){e[t][n]&&e.off(n,e[t][n]),n&&delete e[t][n]}))})),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(e){var t;if(this.player){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.player).emit.apply(t,[e].concat(r))}}},{key:"emitUserAction",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.player){var r=Il(Il({},n),{},{pluginName:this.pluginName});this.player.emitUserAction(e,t,r)}}},{key:"hook",value:function(e,t){return Zl.call.apply(Zl,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return eu.call.apply(eu,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return tu.call.apply(tu,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.player)return n&&(t.pluginName=n),this.player.registerPlugin({plugin:e,options:t})}},{key:"getPlugin",value:function(e){return this.player?this.player.getPlugin(e):null}},{key:"__destroy",value:function(){var e=this,t=this.player,n=this.pluginName;this.offAll(),Ul.clearAllTimers(this),Ul.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map((function(t){e[t]=null})),t.unRegisterPlugin(n),this.__hooks=null}}],[{key:"defineGetterOrSetter",value:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&Object.defineProperty(e,n,t[n])}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}])}();class iu{constructor(e){wl(this,"onTick",(e=>{this&&(this.cancelPending&&this.cancelPending(),this.alive&&(this.onTick_&&this.onTick_(),e&&e()))})),this.onTick_=e,this.timeoutId=null,this.alive=!0}tickAfter(e,t=null){return this.cancelPending?this.cancelPending():this.cancelPending=()=>{clearTimeout(this.timeoutId),this.timeoutId=null},this.alive=!0,this.timeoutId=setTimeout(this.onTick,1e3*e,t),this}tickEvery(e){this.tickAfter(e,(()=>{this.tickEvery(e)}))}stop(){this.alive=!1,this.cancelPending&&(this.cancelPending(),this.cancelPending=null)}}class su extends U.EventEmitter{constructor(e){super(),this.masterTimer=void 0,this.onVisibleChange=()=>{const e=this.masterTimer||this.workerTimer;this.stop(),e&&this.start()},this.options=e,document.addEventListener("visibilitychange",this.onVisibleChange)}start(){const{frequency:e}=this.options;this.stop(),this.masterTimer=new iu((()=>{try{(this.masterTimer||this.workerTimer)&&this.emit(no)}catch{}})),this.masterTimer.tickEvery(e)}stop(){this.workerTimer&&(this.workerTimer=void 0),this.masterTimer&&(this.masterTimer.stop(),this.masterTimer=void 0)}destroy(){this.removeAllListeners(),document.removeEventListener("visibilitychange",this.onVisibleChange),this.stop()}}const au="DESTROYED",ou="xglog_cache",lu="degrade",uu="fps_stuck";let cu=null,hu=null,du=null,fu=null,pu=null,gu=0,mu=null;class vu extends ru{constructor(e){var t,n;super(e),wl(this,"_onChangeConfig",(e=>{if(e){const t=e.nextBufferLength===this.config.minBufferLength;if(this.setConfig(e),e.nextBufferLength&&!t)try{this._onTimeUpdate()}catch{}}})),wl(this,"fpsStuckHandle",(e=>{const{player:t,mse:n}=this;if(this.fpsStuckTime||(this.fpsStuckTime=e.currentTime,this.log($r.LOG,"fpsStuckHandle, currentTime,",e.currentTime)),this.fpsStuckTime>0){const e=t.bufferedPoint;n.clearOpQueues(ni.VIDEO),this.log($r.LOG,"fpsStuckHandle, remove,",e.start,"-",e.end,",seekTime,",this.fpsStuckTime),null==n||n.remove(ni.VIDEO,e.start,e.end).then((()=>{t.currentTime=this.fpsStuckTime,this.fpsStuckTime=null}))}})),wl(this,"_retryHook",(()=>{const{player:e,playerConfig:t}=this,{paused:n}=e;this.softDecode?e.vtype="MP4_MSE_SOFT":e.vtype="MP4_MSE",this._defInited=!1;const r=e.currentTime||0;return this.log($r.LOG,"retryHook ",t.vid,this.codecType,r),this._addMetaDataEvent((()=>{r&&(e.currentTime=r,this.log($r.LOG,"retryHook update currentTime",t.vid,this.codecType,r)),n?e.pause():e.play(),this._removeMetaDataEvent()})),this.destroyMSE(),this._reset(),this.playerStartInit(t.url),!1})),wl(this,"_playHook",((e,...t)=>{this._usePaused=!1,this._canceLoading=!1,this.log($r.LOG,"playHook"),this._startProgress()})),wl(this,"_pauseHook",((e,...t)=>{var n,r;this._usePaused=!0,this.log($r.LOG,"pauseHook",t[0],null==(n=this.player)?void 0:n.currentTime),t.indexOf(null==(r=to)?void 0:r.BUFFER_CONTROLS)<0&&(clearTimeout(this.checkResumePlayTimer),this.checkResumePlayTimer=null,this.log($r.LOG,"pause hook clear buffer_control state")),this._loadStuckCheck()})),wl(this,"abrSwitchURL",(async e=>{const{playerConfig:t}=this,n=t.definition.list;let r=0;for(let t=0;t<n.length;t++)if(e.definition===n[t].definition){r=t;break}const i=this.player.curDefinition;this.changeDefinition(n[r],i,!0)})),wl(this,"timerHandle",(()=>{this._requestTimer&&this._onTimeUpdate()})),wl(this,"changeDefineCanPlay",((e,t,n,r)=>{const{player:i}=this;if(i.ended)return void(i.currentTime=0);const{_changeDefState:s}=this;i.currentTime=s?s.currentTime:e,(s?s.paused:t)?i.pause():i.play(),this._changeDefState=null,i.emit(Yl,{from:n,to:r})})),wl(this,"changeDefinition",((e,t,n)=>{var r,i;const{player:s,playerConfig:a,mp4:o,config:l}=this;if(t||(t=s.curDefinition),this._MSEError=!1,this._isReceiveEndedEvent=!1,this.useVideoLoad)return"__auto__"===e.url&&(e.url=a.definition.list[0].url),void du.call(this.player,e,t);const{definitionList:u}=s,c=u.filter((t=>t.definition===e.definition));c.length>0&&(e=c[0]);const h=this._handlerUrl(e.url);if(!h)return;if(l._mainURL=h.main,l._backupURL=h.backup,e._mainURL=l._mainURL,e._backupURL=l._backupURL,l.switchBitRateWay&&!n)return void this.oldChangeDefinition(e,t);const d="自动"===e.definition||"auto"===e.definition;if(n)this.log($r.LOG,"[switchBitrate:ABR], ready to switch bitRate, ",e.bitrate,e.definition);else{let n=!1;if(d)this._abrService&&this._abrService.enable(),n=!0;else{this._abrService&&this._abrService.disable();const n=null==(r=a.definition)?void 0:r.list;if(n&&(!e.bitrate||!e.uri||!e.size||!e.duration))for(let r=0;r<n.length;r++)if(e.definition===n[r].definition){e.bitrate=n[r].bitrate,e.uri=n[r].uri||t.uri,e.size=n[r].size||ko(e.bitrate,a.duration),e.duration=n[r].duration||this.playerConfig.duration;break}}null==(i=this.adaptRange)||i.updateBitrate(e.bitrate),s.emit(ql,{from:t,to:e}),setTimeout((()=>{this._abrService&&this._abrService.updateAutoDefiDesc(s.curDefinition.definition,!d)})),n&&(e=s.curDefinition),this.log($r.LOG,"[switchBitrate:CBS],switch bitRate, ",e.bitrate,e.definition)}if(s.curDefinition=e,this.mp4.clearPCDNNodeList(),this.checkPCDN(),!o)return;["keyValue","kid","secretKey","drm","getLicenseUrl","drmKeyToken","sessionId"].forEach((t=>{l[t]=e[t]}));let f=null;Bo(this.config)?(this._initSecret(),f=this._secretkey.getLicenseSecret()):(f=new cl,f.resolve()),f.then((async r=>{var i;null!=r&&r.secretKey&&(!l.keyValue&&(l.secretKey=r.secretKey),l.decryptKey=r.decryptKey),a.url=e.url;let u=0,c=!1;if(this._abrService&&this._abrService.isCurrentInAbr()){const e=s.getBufferedRange(s.buffered2);u=e[1],u<s.currentTime&&(u=s.currentTime,this.log($r.LOG,"abr,bufferRange is invalid, adjust",e,",timeStart,",u))}else u=s.currentTime,c=!0;const h=o.getFragmentIdx(u);let d=this.getAdaptTimeRangeIdx(h);d<0&&(d=this._curLoadSegmentIdx),this.log($r.LOG,`switchBitrate point: ${d}`,`startTime: ${o.adaptTimeRange[d].startTime}`,`currentTime: ${s.currentTime}, timeStart: ${u}`),c&&s.emit("definitionSwitchTime",o.adaptTimeRange[d].startTime+1);const f=Math.max(o.adaptTimeRange[d].startTime,s.currentTime);this._definitionChangePointInfo={changeStartTime:f,changeInfo:{from:t,to:e}},this.changeState("changeDefinition",{abr:n,fragIndex:d,startTime:o.adaptTimeRange[d].startTime,currentTime:s.currentTime}),o&&(o.updateChangeBitRateTime(u),this.canDownload=!1,await o.cancelLoading(),o.metaLoading&&(o.metaLoading=!1)),this._removeBuffeEndTime=o.adaptTimeRange[d].startTime,this._isChangeDefinition=!0;const p=s.getBufferedRange(s.buffered),g=null==(i=this._abrService)?void 0:i.isCurrentInAbr();p[1]>0&&p[1]-s.currentTime>5&&(!this._abrService||!g)&&(this.mse.clearOpQueues(ni.VIDEO),this.removeBuffer(ni.VIDEO,s.currentTime+5,p[1])),this.log($r.LOG,"switchBitrate: resetFragmentLoadState,",d),o.resetFragmentLoadState(d),this._curLoadSegmentIdx=d,await this.mp4.changeBitRate(e),this._setCurrentDefinition(e.bitrate),this._emitDefinitionChangeDetailEvent(u),this.canDownload=!0,this._onTimeUpdate();const m={width:e.width||e.vwidth,height:e.height||e.vheight};s.emit("RESOLUTION_UPDATE",m)})).catch((t=>{this.log($r.ERROR,"switchBitrate: GET_LICENSE_ERROR,",null==t?void 0:t.message);const n=new Kl(this.player,{errorType:lo.DRM,errorCode:oo.drm,errorMessage:(null==t?void 0:t.message)||"GET_LICENSE_ERROR",vid:a.vid});t.errorType="GET_LICENSE_ERROR",this.emit("GET_LICENSE_ERROR",n),this.changeState("LICENSE_ERROR",{d:e.definition})}))})),wl(this,"_onVideoError",(e=>{var t,n,r,i;const{player:s}=this;this.changeState("video_error",{code:e.code||(null==(n=null==(t=null==s?void 0:s.video)?void 0:t.error)?void 0:n.code),message:e.message||(null==(i=null==(r=null==s?void 0:s.video)?void 0:r.error)?void 0:i.message),videoType:this.useVideoLoad})})),wl(this,"removeBuffer",((e,t,n,r)=>{var i;const s=this.getBufferDur();null==(i=this.mse)||i.remove(e,t,n).then((()=>{const e=this.getBufferDur(),t=s-e;t>0&&(this.emit("removeBuffer",{removeDur:t}),this.log($r.LOG,"removeBuffer dur,",t)),r&&r()}))})),wl(this,"_onPause",(()=>{this._loadStuckCheck()})),wl(this,"_onPlaying",(()=>{var e,t,n;this.changeState("playing",{curtime:this.player.currentTime,buffer:JSON.stringify(null==(t=null==(e=this.player)?void 0:e.buffered2)?void 0:t.bufferedList)}),this._waitAdjustTimeCnt>0&&this._waitInBufferTimer&&(this._waitAdjustTimeCnt-=1,this.changeState("waitInBuffer_resume"),this.log($r.WARN,"[waitInBuffer resume play], waitAdjustTimeCnt,",this._waitAdjustTimeCnt)),clearTimeout(this._waitInBufferTimer),this._waitInBufferTimer=null;const{mp4:r,player:i}=this,{resumePlayWaterLevel:s}=this.config;if(r){if(!(r&&r.meta&&r.meta.duration-i.currentTime<=s)&&(this.waitLevelStartTime<0&&(this.waitLevelStartTime=i.currentTime),this.playFlag||(this.playFlag=!0),s>0&&i.currentTime-this.waitLevelStartTime>=2)){const e=i.getBufferedRange(i.buffered2);e[1]>0&&e[1]-i.currentTime<s?(i.paused||(this.emit(Ka,{type:"waiting"}),i.pause(null==(n=to)?void 0:n.BUFFER_CONTROLS),this.log($r.LOG,"[!!!!!buffer not rich, pause],currentTime, ",i.currentTime,", bufferEnd,",e[1])),clearTimeout(this.checkResumePlayTimer),this.checkResumePlayTimer=setTimeout(this._onPlaying,s/2*1e3)):i.isBufferControlPaused&&i.paused&&(this.log($r.LOG,"[!!!!!buffer rich, play],, currentTime, ",i.currentTime,", bufferEnd,",e[1]),clearTimeout(this.checkResumePlayTimer),this.checkResumePlayTimer=null,i.isBufferControlPaused=!1,this.emit(Ka,{type:"playing"}),i.play())}}else this.checkResumePlayTimer>0&&(clearTimeout(this.checkResumePlayTimer),this.checkResumePlayTimer=null,i.isBufferControlPaused&&(i.isBufferControlPaused=!1),i.paused&&i.play())})),wl(this,"_lowDecoder",(()=>{const e=Go(this.player);this.log($r.WARN,`H265 lowdecode: ${this.playerConfig.vid} `,e,", h265Degrade, ",this.config.h265Degrade),this.config.h265Degrade&&this._onDegrade()})),wl(this,"_onError",(e=>{this._onDegrade(e)})),wl(this,"_onDegrade",(e=>{var t;const{player:n,playerConfig:r,config:i}=this;Ao(n,"lowdecode",this._onDegrade),Ao(n,"error",this._onError),null==(t=this.mp4)||t.destroy();const{currentTime:s}=n;if(this.log($r.WARN,"[h265 degrade], vid,",r.vid,",currtime,",s),this.emit(lu,{errc:null==e?void 0:e.errorCode,err_msg:(null==e?void 0:e.errorMessage)||(null==e?void 0:e.message),codec_type:this.codecType,media_type:r.mediaType}),null!=i&&i.H264Config){const{H264Config:e}=i;["drm","getLicenseUrl","kid","keyValue","secretKey","isEncrypt","useEME"].forEach((t=>{i[t]=e[t]||null}))}const a={mp4encryptplayer:i,mediaType:"video",codecType:ro},o=(null==r?void 0:r.H264DefinitionList)||[];if(o.length>0){r.definition.list=o,r.url=o[0].url,r.defaultBitrate=o[0].bitrate,r.defaultDefinition=o[0].definition,this.isH265DegradeH264=!0,n.playNext(a);const e=()=>{n.currentTime=s,this.isH265DegradeH264=!1,this.log($r.LOG,"H265DegradeH264 update currentTime",s),this._removeMetaDataEvent()};this._addMetaDataEvent(e)}else n.pause(),this._reset(),this.checkReUseMSE(!1),this.log($r.ERROR,"H265 error,degrade h264 but no h264 url"),this.emit("error",e)})),wl(this,"_onMp4MetaReady",(e=>{var t,n;if(!this.mp4)return;go&&console.log(">>>>_onMp4MetaReady",So());const r=this.firstFrameTime;r.metaload=this.mp4.firstFrameTime.metaload,r.bitrate=this.player.curDefinition.bitrate;const i=this._checkMetaInfo(e);if(this.emit(Vo,{...e,error:i,timeRange:(null==(t=this.mp4)?void 0:t.timeRange)||[]}),i)this._errorHandler(i);else{try{this._initEME(this.mp4,e),this.softDecode?(this.log($r.LOG,"initH265MseProxy"),this._initH265MseProxy()):this.player.video instanceof HTMLVideoElement&&(this.log($r.LOG,"initMse"),this._initMse(e)),null==(n=this._initPromise)||n.resolve()}catch(e){return void this._errorHandler(new Kl(this.player,{errorType:lo.MEDIA,errorCode:oo.eme_hijack,errorMessage:(null==e?void 0:e.message)||"eme or mse catch err",vid:this.playerConfig.vid}))}if(this.mp4&&this.mp4.timeRange){const e=[];this.mp4.timeRange.every((t=>(e.push({startTime:t.startTime,endTime:t.endTime}),!0))),this.emit("KEYFRAMETIME",e)}this._loadData()}})),wl(this,"_onMp4Error",(async(e,t)=>{const{vid:n}=this.playerConfig;console.error("[Index] _onMp4Error",n,e),this.changeState("MP4_ERROR",{state:t,errmsg:(null==e?void 0:e.errorMessage)||(null==e?void 0:e.message),errorType:null==e?void 0:e.errorType,code:null==e?void 0:e.errorCode,httpCode:null==e?void 0:e.httpCode}),this._errorHandler(e)})),wl(this,"_onMp4Progress",(e=>{this.emit("progress_event",e)})),wl(this,"_onMp4DataCallBack",(()=>{this._isMseInit&&this._onTimeUpdate()})),wl(this,"_updateDrmConfig",(e=>{const{config:t,mp4:n}=this;n.updateSecretKey(t.useEME,t.secretKey,t.decryptKey,t.keyValue),this._secretkey&&e.kid&&this._secretkey.updateKid(e.kid)})),wl(this,"_updateMSE",(e=>{const{player:t}=this;t.video instanceof HTMLVideoElement&&(this.log($r.LOG,"updateMse",e.videoCodec),this._initMse(e))})),wl(this,"_onVideoTimeUpdate",(()=>{var e,t;const{mse:n,player:r}=this;this.waitLevelStartTime<0&&(this.waitLevelStartTime=r.currentTime),this.checkReStartTimer(),this._isEnded(),r.isSeeking&&(r.isSeeking=!1),!this.useVideoLoad&&n&&this._removeBuffeEndTime>0&&r.currentTime>this._removeBuffeEndTime+1&&(this.log($r.LOG,"remove old bitrate buffer",this._removeBuffeEndTime),this.removeBuffer(ni.VIDEO,0,this._removeBuffeEndTime-1),this._removeBuffeEndTime=0);const i=this._definitionChangePointInfo;if(i&&r.currentTime>i.changeStartTime){r.emit(Yl,i.changeInfo);const n=i.changeInfo||{};this.log($r.LOG,Yl,", currentTime,",r.currentTime,",from ",null==(e=null==n?void 0:n.from)?void 0:e.definition," to ",null==(t=null==n?void 0:n.to)?void 0:t.definition),this._definitionChangePointInfo=null}!this.useVideoLoad&&null===this._requestTimer&&!this._offineLine&&!this._canceLoading&&this._startProgress()})),wl(this,"_onBufferedReset",(()=>{this.mp4&&this.mp4.videoTrak&&this.mp4.resetFragmentLoadState(0)})),wl(this,"_onOnlineHandler",(()=>{this._offineLine=!1;const{playerConfig:e,player:t}=this,{currentTime:n,paused:r}=t;if(this.log($r.LOG,"online useVideoLoad:",this.useVideoLoad,this._hasStartProgressBack),this.useVideoLoad){const i=()=>{n&&(t.currentTime=n),this.log($r.LOG,"onOnlineHandler update currentTime",e.vid,this.codecType,this._currentTime),r?t.pause():t.play(),this._removeMetaDataEvent()};this._addMetaDataEvent(i),this._setPlayerSrc(e.url)}else this._hasStartProgressBack&&this._startProgress(),this._hasStartProgressBack=!1})),wl(this,"_onOfflineHandler",(()=>{this._offineLine=!0,this.log($r.LOG,"offline, ",this._hasStartProgress),this._hasStartProgress&&(this._stopProgress(),this._hasStartProgressBack=!0)})),wl(this,"_loadDataSuccess",(e=>{var t,n,r;if(this.isDestroy||!this.mse&&!this.mseProxy)return;const i=this.firstFrameTime;if(i.startload_stmux<0){const{startMuxTime:e,firstmux:t}=this.mp4.firstFrameTime;i.startload_stmux=e,i.firstmux=t}i.loadst_loadeddata<0&&(i.loaddata=So()-this.loadstart);try{e.initSeg&&(this._appendInitSeg(e.initSeg),(!e.buffer||e.buffer.byteLength<1)&&this._onTimeUpdate());const{buffer:i,state:s,context:a,videoTrack:o,audioTrack:l}=e;this.debugInfo.loadIndx=a?a.fragIndex:-1;const u=null==(r=null==(n=null==(t=this.mp4)?void 0:t.adaptTimeRange[a.fragIndex])?void 0:n.timeRangeIdx)?void 0:r[1];if(this.mse&&s&&(!i||i.byteLength<=0)&&u>=this.mp4.timeRange.length){const{buffered:e}=this.player;e&&(null==e?void 0:e.length)>0&&(this.bufferEndTime=e.end(e.length-1)),this._isEnded(),this.log($r.LOG,"loaded ended !!!==>>>",JSON.stringify(a.range),", fragIndex,",a.fragIndex,", bufferEndTime,",this.bufferEndTime,",meta_duration,",this.mp4.meta.duration)}if(i&&this.mse){if(i&&i.byteLength>0){this._appendBuffer(ni.VIDEO,i,a,s);const e=this.getDataBitRate(a.fragIndex);this.player.emit("addVideoBufferEnd",{start:Math.floor(a.startPts),end:a.endPts,bandwidth:e.bitrate})}}else this.mseProxy&&(o&&o.samples.length>0||l&&l.samples.length>0)&&(this.log($r.LOG,"[livevideo] append,index,",a.fragIndex,",range,",JSON.stringify(e.context.range),", timeRange,",a.timeRange),this.mseProxy.appendBuffer(o,l))}catch(e){this.changeState("APPEND_DATA_ERROR",{errMsg:null==e?void 0:e.message});const t=new Kl(this.player,{errorType:lo.MEDIA,errorCode:oo.mseAppend,vid:this.playerConfig.vid,errorMessage:e.message,mediaError:{code:oo.mseAppend,message:e.message}});this._errorHandler(t)}null!=e&&e.state&&this._onTimeUpdate()})),wl(this,"_onResumePlaying",(()=>{this._resumePlay=!0})),wl(this,"_seekOnce",(e=>{const{player:t}=this;t&&(t.currentTime=e+.1*Math.pow(2,this._currentSeekTimes||0),this._currentSeekTimes++,this.log($r.LOG,`当前第${this._currentSeekTimes}次Seek，currentTime=${null==t?void 0:t.currentTime}`))})),wl(this,"_onWaiting",(()=>{var e,t,n;this.checkReStartTimer(),this._isEnded();const r=null==(t=null==(e=this.player)?void 0:e.buffered2)?void 0:t.bufferedList;this.changeState("waiting",{curtime:this.player.currentTime,buffer:JSON.stringify(r)});const{player:i,config:s,playerConfig:a,mp4:o}=this;clearTimeout(this._waitInBufferTimer),this._waitInBufferTimer=null;const l=i.currentTime;this.log($r.LOG,",[onWaiting],curTime, ",l,",buffer,",JSON.stringify(r),",dur,",null==(n=null==o?void 0:o.meta)?void 0:n.duration);const u=i.bufferedPoint;u.end>0&&u.end-l>=2?this._waitAdjustTimeCnt<s.waitJampBufferMaxCnt?this._waitInBufferTimer=setTimeout((()=>{this._waitAdjustTimeCnt++,this.changeState("waitInBuffer_seek",{waitAdjustTimeCnt:this._waitAdjustTimeCnt,curTime:l}),i.currentTime=i.currentTime+.5}),s.waitingInBufferTimeOut):this._errorHandler(new Kl(this.player,{errorType:lo.RUNTIME,errorCode:oo.waitTimeout,errorMessage:"onWaitTimeout_in_buffer",vid:a.vid})):this._loadStuckCheck()})),wl(this,"_onEnded",(()=>{this.log($r.LOG,"[player.onEnded], stopProgress"),this._stopProgress()})),wl(this,"_errorHandler",(e=>{const{player:t,playerConfig:n,preLoadData:r}=this;if(!t||this.useVideoLoad)return;if(e.errorCode===oo[403]&&this._emitExpireEvent(e)&&this.config.urlExpireDisableErrorEvent)return this.log($r.LOG,"_errorHandler urlExpireDisableErrorEvent",this.config.urlExpireDisableErrorEvent,",errorCode,",e.errorCode),this._stopProgress(),void this.emit(ou);if("object"!=typeof e){const t={};t.err=e,e=t}e.ext||(e.ext={});const i=t.paused;if(e.ext.vid=n.vid,e.ext.preloadHit=this.hitpreload?1:0,e.ext.preloadCached=r?r.duration:0,e.ext.timerStep=Math.max(...this.timerStepList),e.ext.codectype=this.codecType,e.errorMessage=e.message,e=new Kl(t,e),this.log($r.ERROR,"_errorHandle",`preState is ${i}`,null==e?void 0:e.errorCode,(null==e?void 0:e.message)||(null==e?void 0:e.errorMessage)),!e.url&&(e.url=t.src),e.errd&&"object"==typeof e.errd&&this.mp4&&(e.errd.url=this.mp4.url,e.url=this.mp4.url),this.player.emit("playCatch",this.player.vtype,e),this.emit("DATA_REPORT",e),this.mp4&&this.mp4.cancelLoading(),this._abrService&&this._abrService.disable(),this.canDownload=!1,this.mp4&&this.mp4.bufferCache&&this.mp4.bufferCache.clear(),this.checkIsDegraded(e))this.player.vtype="MP4_2",this._initPromise&&this.removeAndRejectInitPromise(e),this._startDegradedPlayback(e,i);else{this.log($r.ERROR,"final error !!!!, ",n.vid,null==e?void 0:e.errorCode,(null==e?void 0:e.errorMessage)||(null==e?void 0:e.message)),this.player.pause(),this._reset();const{currentTime:r}=t;this.destroyMSE(),t.currentTime=r,this.emit("error",e)}this.emit(ou)})),wl(this,"_onSeeking",(async()=>{var e,t,n;if(this._isReceiveEndedEvent=!1,this.useVideoLoad)return;const{player:r,mp4:i}=this;this.waitLevelStartTime=r.currentTime;const s=r.currentTime;if(this.changeState("seeking",{curTime:s}),this.log($r.LOG,"[seeking], curTime,",s,",buffer,",JSON.stringify(r.buffered2.bufferedList)),!i||!i.meta)return;this._startProgress(),this.endofstream=!1,i.bufferUsedPos=0,i.metaLoading=!1,this._definitionChangePointInfo&&(this._definitionChangePointInfo.changeStartTime=s,this.log("[seeking update definitionChangePointInfo.changeStartTime]",s)),i.changeBitRateTime>0&&(i.updateChangeBitRateTime(s),this.log("[seeking update changeBitRateTime]",s));const a=r.bufferedPoint;let o=!1,l=0;if(a.end>0){if(o=!0,i.meta.duration-a.end<.5)return void this.log("[seeking in buffered range], buffer end,",a.end,", duration,",null==(e=null==i?void 0:i.meta)?void 0:e.duration);const t=i.getFragmentIdx(a.end);l=this.getAdaptTimeRangeIdx(t),i.seekTime=a.end,l<0&&(l=this._curLoadSegmentIdx),this.log($r.LOG,"[seeking in buffered range], seekTime ",s,",bufferRange,",a.start,"-",a.end,", fragIndex,",l)}if(!o){i.seekTime=s;const e=i.getFragmentIdx(s);l=this.getAdaptTimeRangeIdx(e),this.log($r.LOG,"[seekTime out buffer range], srcFragIndex,",e,", fragIndex,",l),l<0&&(l=this._curLoadSegmentIdx),this.log($r.LOG,"[seekTime out buffer range], curTime,",s,", srcFragIndex,",e,", adaptIdx,",l);const{mse:t}=this;if(t&&null!=t&&t.isFull()){const e=r.buffered2.bufferedList,t=e[e.length-1];this._checkRemoveSourceBuffer([t.start,t.end],r.currentTime,!0,!0)}}this._curLoadSegmentIdx===l&&null!=(t=i.adaptTimeRange[l])&&t.isLoading?this.log($r.LOG,"[seeking in buffered range], seek fragIndex is current load segmentIdx",l):(i.canDownload=!1,await i.cancelLoading(),i.resetFragmentLoadState(l),this.log($r.LOG,"[seekTime resetFragmentLoadState],adaptIdx,",l,"mp4.seekTime",i.seekTime,JSON.stringify(i.adaptTimeRange)),null==(n=this.mse)||n.clearOpQueues(ni.VIDEO),this._curLoadSegmentIdx=l,this.canDownload=!0,this._onTimeUpdate(),this._isEnded())})),this.initLog(null==(n=null==(t=this.player.playerId)?void 0:t.toString())?void 0:n.slice(-4)),this._pendingPromises=[],this._allInitPromise=new cl,this._isInit=!1,this._isEventInit=!1,this.playerId=this.player.playerId,this.preloader=null,this.log($r.LOG,"playerId",this.playerId,this.playerConfig.vid),this._useVideoLoad=!1,this.mse=null,this.mp4=null,this.eme=null,this._isMseInit=!1,this._corePromise=null,this._initPromise=null,this._hasStartProgress=!1,this._hasStartProgressBack=!1,this._curLoadSegmentIdx=0,this._abrService=null,this._checkRemoveBufferLastTime=So(),this.playFlag=!1,this.config.resumePlayWaterLevel=Math.min(this.config.minBufferLength,this.config.resumePlayWaterLevel),this.checkResumePlayTimer=null,this._MSEError=!1,this.loadstart=-1,this._loadStartEventTime=-1,this._waitAdjustTimeCnt=0,this._waitInBufferTimer=null,this.codecType=this.playerConfig.codecType?this.playerConfig.codecType.toLowerCase():ro,this.playerConfig.vtype&&(this._vtype=this.playerConfig.vtype.toUpperCase()),this.isActive=!0,this.firstFrameTime={newplayer:So(),initmse_sbopen:-1,mseopen:-1,metaload:-1,metaready_initsegend:-1,startload_stmux:-1,firstmux:-1,apcnt:0,aplen:0,data_ap:-1,loaded_data:-1,loadst_loadeddata:-1,new_loadeddata:-1,bitrate:-1,hitpreload:-1,first_gop_req_cnt:-1},this.debugInfo={},this.states=[],this.removeVideoList=[],this._lastCheckTime=So(),this._lastCheckLagTime=So(),this._changeDefState=null,this._defInited=!1,this._removeBuffeEndTime=0,this._isChangeDefinition=!1,this._lastTimeupdateTime2=0,this.waitLevelStartTime=-1,this.preLoadData=null,this.forPreloadTimeCache=null,this._usePaused=!1,this.endofstream=!1,this.bufferEndTime=-1,this.hitpreload=!1,this.isH265DegradeH264=!1,this.loadstartTimer=null,this.loadeddataTimer=null,this.canplayTimer=null,this.adaptRangeRes=[],this._isReceiveEndedEvent=!1,this._checkEndedTimer=null,this._definitionChangePointInfo=null,pu&&(this.player.preloader=pu),this._lastTimeupdateTime2=0,this.waitLevelStartTime=-1,this.timerStepList=[],window&&window.location.href.indexOf("playerInstance=true")>-1&&(void 0===window.mp4PlayerInstanceList&&(window.mp4PlayerInstanceList=[]),window.mp4PlayerInstanceList.push(void 0)),this._isH265SoftDecoder=!1,this._beforeLoadStartCostTime=0,this._requestTimer=null}static get pluginName(){return"Mp4EncryptPlayer"}static get defaultConfig(){return{onlyInit:!1,useWaterLevel:!1,maxBufferLength:10,minBufferLength:5,tickInSeconds:.2,getLicenseUrl:"",xhrSetup:{},chunkSize:209715,retryCount:1,retryDelay:1e3,timeout:3e3,needPreloadCheck:!1,needAutoBitrate:!0,keyValue:null,drm:null,switchBitRateWay:!1,enableWorker:!1,bufferThreshold:10,removeBufferLen:60,focusUserDefinition:!1,resumePlayWaterLevel:2,waitJampBufferMaxCnt:3,waitingInBufferTimeOut:5e3,waitingTimeOut:1e4,notDegradeErrorList:[],h265Degrade:!1,forceVideoPlay:!1,segmentMinDuration:3,supportHevc:void 0,H264Config:null,reqOptions:{},rangeMaxDuration:15,getRequestOptionsCallback:null,closeDowngrade:!1,loaderType:"fetch",reUseMSE:!1,urlExpireDisableErrorEvent:!1,logCacheConfig:{logCacheLevel:$r.LOG,logMaxSize:204800},noPreloadAddBufferLen:0,enableFPSStuckHandle:!1,loadRangeType:Za,timerInWorker:!1}}static registerPreloader(e){pu=e}static set ENCRYPT_SECRET(e){mu=e}static get speed(){return gu}static get realTimeSpeed(){return gu}static get version(){return ao}setConfig(e){this.config=Object.assign(this.config,e)}initLog(e){const{logCacheLevel:t,logMaxSize:n}=this.config.logCacheConfig;this.logger=new Fr(vu.pluginName+e,{logCacheLevel:t,logMaxSize:n}),go&&Fr.enable()}playerlogger(e){e?Fr.enable():Fr.disable()}afterCreate(){const{playerConfig:e,config:t,player:n}=this;t.width=e.width||0,t.height=e.height||0,e.vid=e.vid||t.vid,ni.isSupported('video/mp4; codecs="avc1.64001f, mp4a.40.5"')&&!al()&&(void 0===t.supportHevc&&null!=jl&&jl.isHevcSupported&&jl.isHevcSupported()&&this.player.video instanceof HTMLVideoElement&&(t.supportHevc=!0),t.supportVvcc=!(typeof MediaSource>"u"||!MediaSource.isTypeSupported)&&MediaSource.isTypeSupported("video/mp4;codecs=bvc2.1.6.L93.B0"),this.softDecode?n.vtype="MP4_MSE_SOFT":n.vtype="MP4_MSE",(!ol()||this.softDecode)&&(t.useEME=!1),t.useEME=!1!==t.useEME,this.checkConfig(),t.onlyInit&&(e.autoplay=!1,e.videoInit=!1,this._hasStartProgress=!1,this._hasStartProgressBack=!1),e.useWaterLevel&&(!e.userGestureEventMiddleware&&(e.userGestureEventMiddleware=Do),!e.videoEventMiddleware&&n.setEventsMiddleware(Io)),this._proxyPlayer(),n.useHooks("play",this._playHook),n.useHooks("pause",this._pauseHook),n.useHooks("retry",this._retryHook),Oo(n,ja.BUFFERED_RESET,this._onBufferedReset),this._bindNetworkStateChange(),this.on("timeupdate",this._onVideoTimeUpdate),this.on(Wl,(()=>{var e;this.changeState("LOADED_DATA"),this.deleteVideo(),this.mp4&&this.mp4.updateLoadedDataDone(),this._firstFrameTime(),this._onTimeUpdate(),this.firstFrameTime.loaded_data=this._loadStartEventTime>0?So()-this._loadStartEventTime:-1,null!=(e=this.config)&&e.enableFPSStuckHandle&&this.on(uu,this.fpsStuckHandle)})),this.on(Ql,(()=>{this.changeState("LOAD_START"),this._loadStartEventTime=So(),this._beforeLoadStartCostTime=(new Date).getTime()-this._tm,this.codecType===io&&!this.config.supportHevc&&(this._isMseInit=!0,this._onTimeUpdate())})),this.on("ended",(()=>{this.log($r.LOG,"mp4plugin receive player video ended event"),this._onEnded()})),this.on("pause",(()=>{this._usePaused=!0})),this.on("play",(()=>{this._usePaused=!1})),this.on("xglog",(e=>{if("firstFrame"===e.eventType){const t=this.preLoadData&&this.preLoadData.definition?this.preLoadData.definition:-1,{player:n,firstFrameTime:r}=this;go&&console.log(`[xgplayer-encrypt-mp4]>>>>firstFrame ${this.playerConfig.vid}, ${e.fvt}, codecType: ${this.codecType}`,`hitPreload: ${this.hitpreload}, video: ${this._useVideoLoad}, preloadBitrate: ${t}`,` metaLoad: ${r.metaload}, mseOpen: ${r.mseopen}`,`curDefinition: ${n.curDefinition.definition},appendInit: ${r.metaready_initsegend}`)}})),n.mp4MseFlag=!0)}_startBufferCheck(){const{player:e}=this;if(!e.video)return;const t=[];if(e.video.buffered){for(let n=0,r=e.video.buffered.length;n<r;n++)t.push([e.video.buffered.start(n),e.video.buffered.end(n)]);t.toString()!==this.lastBuffer&&(this.lastBuffer=t.toString(),this._onBufferReachThreshold())}}_onBufferReachThreshold(){const{player:e,config:t}=this;if(e.video){const n=e.video.buffered,{currentTime:r}=e.video;let i=0,s=0;for(let e=0;e<n.length&&(i=n.start(e),s=n.end(e),!(i<=r&&r<=s));e++);s-r>=t.bufferThreshold&&!this._hasTriggerBufferThreshold&&(this._hasTriggerBufferThreshold=!0,e.emit("BUFFER_THRESHOLD",s-r))}}_startUrlExpiredCheck(){const{definition:e}=this.playerConfig;e&&e.list&&e.list.length>0&&(this.urlExpireTimestamp=e.list[0].url_expire||0,this._handleUrlExpire())}async cancelLoading(){this.mp4&&(this._canceLoading=!0,this.log($r.LOG,"player cancelLoading",this.playerConfig.vid),this._stopProgress(),this.cancelPreloadTask(),await this.mp4.cancelLoading())}checkConfig(){const{playerConfig:e,config:t}=this;let n=e.defaultDefinition,r=e.defaultBitrate;if(!n){const{definition:e}=this.playerConfig;n=e&&e.defaultDefinition?e.defaultDefinition:t.definition}!r&&t.bitrate&&(r=t.bitrate),e.defaultDefinition=n,e.defaultBitrate=r}_addMetaDataEvent(e){const{player:t}=this;this.__mHandler=e,Oo(t,"loadedmetadata",this.__mHandler)}_removeMetaDataEvent(){if(!this.__mHandler)return;const{player:e}=this;Ao(e,"loadedmetadata",this.__mHandler),this.__mHandler=null}beforePlayerInit(){const{player:e}=this,t=this;this._isInit||(ru.defineGetterOrSetter(e,{__url:{get:()=>t.mse?t.mse.url:e.config.url,configurable:!0},downloadSpeed:{get:()=>gu/8,configurable:!0},playerVersion:{get:()=>ao,configurable:!0},menuCodeType:{get:()=>t.mp4&&t.mp4.meta?t.mp4.meta.videoCodec:t.codecType===ro?"avc":"hevc",configurable:!0},playerType:{get:()=>"MP4",configurable:!0},supportMenus:{get:()=>({speed:null==e?void 0:e.mp4MseFlag,cdn:null==e?void 0:e.mp4MseFlag,resolution:null==e?void 0:e.mp4MseFlag}),configurable:!0},preloadActive:{get:()=>this.isActive,set:e=>{this.isActive=e,this.isActive&&this._startProgress()},configurable:!0},performance:{get:()=>this.firstFrameTime,configurable:!0},domain:{get:()=>t.domain,configurable:!0},loadURL:{get:()=>t.loadURL,configurable:!0},abrInstance:{get:()=>t.abrInstance,configurable:!0},pcdnReq:{get:()=>{},configurable:!0},retryInfo:{get:()=>nl,configurable:!0},softDecoder:{get:()=>this._isH265SoftDecoder,configurable:!0},logCache:{get:()=>{if(t.logger)return t.log($r.LOG,`,version:${ao},timerStepList,`,JSON.stringify(this.timerStepList)),t.logger.getLogCache()},configurable:!0},pcdnVVStat:{get:()=>{var e;const{mp4:n,pcdn:r}=t;return n?{...n.pcdnVVStat,trace_id:null==(e=n.pcdnTraceInfo)?void 0:e.trace_id,cancelCnt:(null==n?void 0:n.pSCCancelCnt)||0,is_try_open:r?1:0}:null},configurable:!0},beforeLoadStartCostTime:{get:()=>this.useVideoLoad?0:this._beforeLoadStartCostTime,configurable:!0},bandwidth:{get:()=>{const{mp4:e,playerConfig:n}=t;return function(e,t){const n=e?e.loadInfo:null,r=n?n[Wa]:null,i=n?n[Qa]:null;return{vid:t,cdn:{speed:null==r?void 0:r.loadSpeed,size:r?r.loadLen:0},pcdn:{size:i?i.loadLen:0,...null==e?void 0:e.pcdnTraceInfo}}}(e,null==n?void 0:n.vid)},configurable:!0},ext:{get:()=>t?function(e){var t,n;const r=[],{video:i,currentTime:s,duration:a}=e.player,{playerConfig:o,mp4:l,mse:u,debugInfo:c,_curLoadSegmentIdx:h,states:d,_requestTimer:f,timerStepList:p}=e,g=i?i.buffered:[];if(g.length>0)for(let e=0,t=(null==g?void 0:g.length)||0;e<t;e++)r.push([g.start(e),g.end(e)]);return{type:"MP4",usevideo:e.useVideoLoad?1:0,curTime:s,duration:(null==(t=null==l?void 0:l.meta)?void 0:t.duration)||a,loadIdx:h,curload:null!=l&&l.adaptTimeRange?l.adaptTimeRange[h]:{},buffer:r,speed:null==c?void 0:c.speed,states:d,msequeLen:(null==u?void 0:u.opQueues)&&(null==(n=u.opQueues.video)?void 0:n.length),timer:!!f,timerlist:JSON.stringify(p),maxtimerstep:Math.max(...p),url:null==o?void 0:o.url}}(this):{},configurable:!0},currentDefitionFromPlayer:{get:()=>t.abrInstance&&t.abrInstance.isCurrentInAbr?e._currentDefitionFromPlayer:e.curDefinition,configurable:!0}}),this._isInit=!0)}destroy(){var e,t;const{player:n}=this;n.preloader&&n.preloader.cancel(this.playerId),n.removeHooks("play",this._playHook),n.removeHooks("pause",this._pauseHook),n.removeHooks("retry",this._retryHook),null==(e=this._requestTimer)||e.destroy(),this._requestTimer=null,this._reset(),this.checkReUseMSE(!1),this._secretkey&&mu.destroySecretKey(this._secretkey,this._errorHandler),this.player.playNext=cu,this.player._startInit=hu,this.player.changeDefinition=du,this.player.switchURL=fu,this._unbindNetworkStateChange(),this._unbindEvents(),Ao(n,ja.BUFFERED_RESET,this._onBufferedReset),this._bufferCheckTimer&&clearInterval(this._bufferCheckTimer),this._removeBufferTimer&&(clearTimeout(this._removeBufferTimer),this._removeBufferTimer=null),null!=(t=this.logger)&&t.reset&&this.logger.reset(),this._removeMetaDataEvent(),this.timerStepList=[]}_proxyPlayer(){"function"==typeof this.player.playNext&&(cu=this.player.playNext),this.player.playNext=(...e)=>{this.playNext(...e)},hu=this.player._startInit,fu=this.player.switchURL,du=this.player.changeDefinition,this.player._startInit=this.playerStartInit.bind(this),this.player.switchURL=this.switchURL.bind(this),this.player.changeDefinition=this.changeDefinition.bind(this)}getInitBitrate(){const{player:e,config:t,playerConfig:n}=this;let r=null;const{definitionList:i}=e;if(i&&i.length>0){const{preloader:s}=e;s&&i.forEach((e=>{const t=s.generateUniqueKey({vid:n.vid,definition:e.definition||-1,vtype:n.vtype,codecType:n.codecType});e.cacheKey=t,t&&!r&&s&&s.hasItemSameVid(t)&&(r=e,r.type="preload")}));const{userSelectDefinition:a}=n;r&&a&&t.focusUserDefinition&&n.userSelectDefinition!==r.definition&&(r=null),!r&&this.bitRateAdapter&&(this.bitRateAdapter.speed=il.speed,r=this.getDefinitonFromAdapter(i,a),r&&(r.type="bitRateAdapter"))}if(!r||!r.url){const{url:e,definition:t,defaultDefinition:s}=n,a=(null==t?void 0:t.defaultDefinition)||s;if("Array"===bo(e)&&e.length>0||"String"===bo(e)&&e){const t=this._getDefinitionItem(a),i=n.defaultBitrate||n.bitrate||(null==t?void 0:t.bitrate);r={url:e,definition:(null==t?void 0:t.definition)||a||-1,duration:(null==t?void 0:t.duration)||n.duration||this.config.duration||0,bitrate:i,uri:n.uri||(null==t?void 0:t.uri),file_id:null==t?void 0:t.file_id,size:(null==t?void 0:t.size)||n.size,type:"default"}}else r=i[i.length-1]}return r&&(n.url=r.url,r.networkSpeed=il.speed),e.curDefinition=r,r}_setPlayerSrc(e){const{player:t}=this;this._removeVideoSource(),"Array"===bo(e)?(t.video.removeAttribute("src"),!t._detachSourceEvents&&e.forEach((e=>{t.video.appendChild(To("source","",{src:`${e.src}`,type:`${e.type||""}`}))})),t._attachSourceEvents(t.video,e),t.play()):(t.video.src=e,t.play()),t.mp4MseFlag=!1,t.emit("playertypechange")}_removeVideoSource(e){const{player:t}=this;e=e||t.video;const{children:n}=e;if(n.length>0)for(t._detachSourceEvents(e);n.length>0;)e.removeChild(n[0])}_getDefinitionItem(e){const{definition:t}=this.playerConfig;if(!t||!t.list)return null;for(let n=0;n<t.list.length;n++){const r=t.list[n];if(r.definition===e)return r}return null}async _initAbrService(){}_initSecret(){mu&&(this._secretkey?this._secretkey.updateConfig(this.config):this._secretkey=mu.createSecretKey(this.config,this._errorHandler))}_initMp4Kernel(){const{playerConfig:e,config:t}=this,n=new cl;try{const r=this.player.curDefinition;this.log($r.LOG,`[_initMp4Kernel] ${e.vid} curDefinition`,null==r?void 0:r.definition);const i=this._handlerUrl(e.url);if(!i)return this.log($r.LOG,"emptyUrl"),n.reject(new Error("emptyUrl")),n;if(t._mainURL=i.main,t._backupURL=i.backup,t.forceVideoPlay&&(this.codecType===ro||t.supportHevc))return this.useVideoLoad=!0,this.log($r.LOG,"forceVideoPlay"),n.reject(new Error("forceVideoPlay")),n;const s=[];this._secretkey&&s.push(this._secretkey.getLicenseSecret()),s.push(this._checkPreloader()),Promise.all(s).then((e=>{if(this.isDestroy)return void n.reject(new Error("destroy"));let i=null;if(e&&e.length>0&&(e.length>1&&(!t.keyValue&&(t.secretKey=e[0].secretKey),t.decryptKey=e[0].decryptKey),i=e[e.length-1].data,this.firstFrameTime&&(this.firstFrameTime.hitpreload=i?1:0)),i||!t.needPreloadCheck||this.codecType===io&&!t.supportHevc)if(this._vtype&&"MP3"===this._vtype)this.useVideoLoad=!0,this.log($r.LOG,"vtype_not_MP4"),n.reject(new Error("vtype_not_MP4"));else{const e=t._mainURL;this.player.rawSrc=e,this._initMp4(e,i,{fileSize:r?r.size:0}),this.updateLoadInfo(null==i?void 0:i.cacheKey),this.checkPCDN(),this.initAdaptRange(),this._initAbrService()}else this.useVideoLoad=!0,this.log($r.LOG,"no_preload"),n.reject(new Error("no_preload"))})).catch((t=>{this.log($r.ERROR,"getLicense or checkPreloader reject",null==t?void 0:t.message);const i=new Kl(this.player,{errorType:lo.DRM,errorCode:oo.drm,errorMessage:(null==t?void 0:t.message)||"getLicense or checkPreloader reject",vid:e.vid});this.emit("GET_LICENSE_ERROR",i),this.changeState("LICENSE_ERROR",{d:r?r.definition:0}),n.reject(i)}))}catch(e){n.reject(e)}return n}updateLoadInfo(e){!e||!this.mp4||(this.mp4.loadInfo=qa.get(e),qa.delete(e))}initAdaptRange(){const{config:e,player:t,playerConfig:n}=this,{bitrate:r,duration:i}=t.curDefinition;if(null!=e&&e.adaptRange){let s=null;s=(null==e?void 0:e.loadRangeType)===eo?an:sn,this.adaptRange=new s(t,r,i||n.duration,e.adaptRange)}}checkPCDN(){const{config:e,player:t,playerConfig:n}=this;t.curDefinition,this.pcdn=null}isOpenPCDN(e){}_pcdnReqSuccess(e,t){const{playerConfig:n,player:r,mp4:i}=this;if(!i||!e)return;const s=null.getPCDNReqId(r.curDefinition,n.vid);if(e.req_id&&s!==e.req_id)return void this.log($r.LOG,`,${t} is not match curDefinition reqId', reqId, ', pcdnRet.req_id`,e.req_id);const a=e.nodes||[];this.log($r.LOG,`${n.vid} get peer end,pcdn node update,`,a.length),i.updateNode(a),i.pcdnTraceInfo={uri:e.vid,fid:e.fid,trace_id:e.trace_id},i.pcdnVVStat&&(i.pcdnVVStat.try_req_node+=1,i.pcdnVVStat.req_node_succ+=1,i.pcdnVVStat.has_ret_node+=a.length>0?1:0)}_pcdnReqFail(e,t){const{mp4:n}=this;null!=n&&n.pcdnVVStat&&(n.pcdnVVStat.try_req_node+=1),this.checkURLExpired(e,t)}initTimer(){if(!this._requestTimer){const{timerInWorker:e,tickInSeconds:t}=this.config;this._requestTimer=new su({frequency:t,timerInWorker:e}),this._requestTimer.on(no,this.timerHandle)}}playerStartInit(e){var t;if(this.log($r.LOG,"playerStartInit",this.player.hasStart,this.playerId,e),this.isDestroy)return;const{playerConfig:n,player:r}=this;if(this._usePaused=!1,this.isActive&&0!==(null==r?void 0:r.currentTime)&&!this.config.frameFreeze&&(this.log($r.LOG,"[playerStartInit] reset current  = 0 ,buffer,",JSON.stringify(null==(t=null==r?void 0:r.buffered2)?void 0:t.bufferedList)),this.player.currentTime=0),this._isH265SoftDecoder=this.softDecode,this.config.reUseMSE&&this.mse&&"String"===bo(e)&&/^blob/.test(e)&&e!==this.mse.url&&(e=n.url,this.destroyMSE()),!e||"__auto__"===e||"anytext"===e){const{definition:e}=n,t=function(e){let t="",n=null;const r=e?e.list:[];if(r&&r.length>0&&e.defaultDefinition&&(r.forEach((r=>{r.definition===e.defaultDefinition&&(t=r.url,n=r)})),!t)){const i=r[0];t=i.url,e.defaultDefinition=i.definition,n=i}return n}(e);t&&(n.url=t.url,e.defaultDefinition=t.definition,r.curDefinition=t)}const i=this._defInited?null:this.getInitBitrate();if(n.nullUrlStart&&!i&&!n.url)return;this.initTimer(),Bo(this.config)?this._initSecret():this._secretkey=null,this._defInited=!0,this.log($r.LOG,`[playerStartInit] ${n.vid} curDefinition`,i||this.player.curDefinition);const{config:s}=this,{preloader:a}=this.player;a&&a.addPlayingVid(n.vid);const o=!this.softDecode;if(s.needPreloadCheck&&o&&!this._secretkey){let e,t=!1;const{curDefinition:r}=this.player;if(a&&r&&(e=r.cacheKey?r.cacheKey:a.generateUniqueKey({vid:n.vid,definition:r.definition||-1,vtype:n.vtype,codecType:n.codecType}),t=a.hasItemSameVid(e)),!t){this.useVideoLoad=!0,this.player.vtype="MP4_0",this.log($r.LOG,`[playerStartInit] ${n.vid} no_preload`,!!a,e);const t=new Kl(this.player,{errorType:"runtime",errorTypeCode:lo.runtime,errorCode:oo.other,vid:this.playerConfig.vid,errorMessage:"no preload"});this.player.emit("playCatch",this.player.vtype,t)}}if(this.useVideoLoad){if(e=this.playerConfig.url,s.closeDowngrade)return;return this._sTime=So(),hu.call(this.player,e),void this._startProgress()}if(this.isDestroy)return;if(this.player.mp4MseFlag=!0,this.bufferEndTime=-1,this._tm=(new Date).getTime(),this._initPromise&&"pending"===this._initPromise.state){const e=this._handlerUrl(n.url);if(e&&e.main===s._mainURL)return}this._reset();const{vid:l}=this.playerConfig;this.changeState("PLAYER_START_INIT");const u=this._initMp4Kernel();this._initPromise=u,this._addPendingPromise(this._initPromise),u.then((()=>{this.isDestroy||(this.mse&&(e=this.mse.url),this.changeState("PLAY_INIT_OK"),this._bindEvents(),this._startProgress())})).catch((t=>{let n=!1;if(this._initPromise&&(n=this._initPromise.id!==u.id||this._initPromise.isBreak),this.isDestroy||n||t===au)return;if(this.log($r.LOG,`_initMp4Kernel.catch: ${l} isDestroy:${this.isDestroy},\n          errorCode:${(null==t?void 0:t.errorCode)||oo.other},errMsg:${(null==t?void 0:t.errorMessage)||(null==t?void 0:t.message)}`),(null==t?void 0:t.errorCode)===oo[403]&&this._emitExpireEvent(t)&&s.urlExpireDisableErrorEvent)return this._initPromise=null,this.log($r.LOG,"initMp4Kernel urlExpireDisableErrorEvent",s.urlExpireDisableErrorEvent,",errorCode,",t.errorCode),this._stopProgress(),void this.emit(ou);let r=t;r.errorCode||(r=new Kl(this.player,{errorType:lo.RUNTIME,errorCode:(null==t?void 0:t.errorCode)||oo.other,vid:this.playerConfig.vid,errorMessage:(null==t?void 0:t.errorMessage)||(null==t?void 0:t.message),mediaError:{code:(null==t?void 0:t.httpCode)||oo.other,message:(null==t?void 0:t.errorMessage)||(null==t?void 0:t.message),errorType:null==t?void 0:t.errorType}}),r.url=e),this.changeState("PLAY_INIT_CATCH",{c:r.errorCode,m:(null==t?void 0:t.errorMessage)||(null==t?void 0:t.message),t:null==t?void 0:t.errorType}),this.useVideoLoad=!0,this.player.vtype="MP4_1",this.player.emit("playCatch",this.player.vtype,r);const i=this.checkIsDegraded(r);return this.log($r.WARN,"PLAY_INIT_CATCH final error !!!!, ",l,null==r?void 0:r.errorCode,null==r?void 0:r.errorMessage,",degrade:",i),this.emit(ou),i?void 0:(this.player.pause(),this._reset(),this.emit("error",r),void(this._initPromise=null))})).finally((()=>{var t;if(!this._initPromise)return;const{isBreak:n,id:r}=this._initPromise;if(r!==u.id)return;this._removePendingPromise(this._initPromise),this._initPromise=null,this._usePaused&&(this.playerConfig.autoplay=!1),this.softDecode&&"Array"===bo(e)&&(e=e[0].src),"String"===bo(e)&&!/^blob/.test(e)&&!this.config.frameFreeze&&this.destroyMSE();const i=(null==(t=this.player)?void 0:t.currentSrc)===e;this.changeState("PLAY_INIT_FINALLY",{isDestroy:this.isDestroy,isBreak:n,reUseSrc:i}),!this.isDestroy&&!n&&hu.call(this.player,e),this.reUseMSEEmitEvents(i),this._abrService&&this._abrService.isCurrentInAbr()&&(this._abrService.enable(),this._abrService.execute())}))}async destroyMSE(){var e;await(null==(e=this.mse)?void 0:e.unbindMedia()),this.mse&&this.log($r.LOG,"destroyMSE ",this.playerConfig.vid),this.mse=null}reUseMSEEmitEvents(e){var t;e&&/^blob/.test(null==(t=this.player)?void 0:t.currentSrc)&&(clearTimeout(this.loadstartTimer),clearTimeout(this.loadeddataTimer),clearTimeout(this.canplayTimer),this.loadstartTimer=setTimeout((()=>{clearTimeout(this.loadstartTimer),this.loadstartTimer=null,this.emit(Ql),this.log($r.LOG,"reUseMSE add emit loadstart event")}),10),this.loadeddataTimer=setTimeout((()=>{clearTimeout(this.loadeddataTimer),this.loadeddataTimer=null,this.emit(Wl),this.log($r.LOG,"reUseMSE add emit loadeddataevent")}),50),this.canplayTimer=setTimeout((()=>{clearTimeout(this.canplayTimer),this.canplayTimer=null,this.emit("canplay"),this.log($r.LOG,"reUseMSE add emit canplayevent")}),90))}playNext(e){const{player:t}=this;this._defInited=!1,this._hasTriggerBufferThreshold=!1,t.resetState(),t._currentTime=0,t._duration=0,t.isPlaying=!1,this.preloader&&this.preloader.clearTask(),this._useVideoLoad=!1,this._MSEError=!1;const n=this.softDecode;t.pause(),this._reset(),e.vtype&&(this._vtype=e.vtype.toUpperCase()),t.setConfig(e),this.config.frameFreeze||this.checkReUseMSE(this.config.reUseMSE,!0),this.softDecode?t.vtype="MP4_MSE_SOFT":t.vtype="MP4_MSE";const{codecType:r,mediaType:i}=this.playerConfig;if(this.codecType=r?r.toLowerCase():ro,n!==this.softDecode&&this.h265_h264_switch(i||"video"),this.checkConfig(),this.log($r.LOG,"[Index] playNext",e.vtype,e.vid),t.start(),this.config.reUseMSE&&!this.isH265DegradeH264){const e=()=>{this.log($r.LOG,"[Index] playNext metadata update currentTime = 0"),0!==t.currentTime&&(t.currentTime=0),this._removeMetaDataEvent()};this._addMetaDataEvent(e)}this.emit("playnext")}h265_h264_switch(e){this.log($r.LOG,"[Index],h265_switch_h264",e);const{player:t}=this,{mediaConfig:n}=t,r=To(e,"",n,`xgplayer-${e}-img`);this.removeVideoList.push(t.video);const{muted:i,volume:s}=t.video;r.muted=i,r.volume=s,t.video=r,t.attachVideoEvents(t.video)}next(e){this.playNext(e)}oldChangeDefinition(e,t){const{config:n,player:r,playerConfig:i}=this;r.emit(ql,{from:t,to:e}),r.emit("waiting");const s=r.definitionList,a=s.filter((t=>t.definition===e.definition||t.definition===Number(e.definition))),o=s.filter((e=>e.definition===t.definition||e.definition===Number(t.definition)));if(o.length>0&&(o[0].selected=!1),!(a.length>0))return;(e=a[0]).selected=!0,r.curDefinition=e,this.log($r.LOG,"[oldChangeDefinition],currentTime,",r.currentTime,",from,",t,",to,",e);const{currentTime:l,paused:u}=r;this._changeDefState||(this._changeDefState={currentTime:l,paused:u}),n.definition=e.definition,["keyValue","kid","secretKey","drm","getLicenseUrl","drmKeyToken","sessionId"].forEach((t=>{n[t]=e[t]})),i.url=e.url,i.userSelectDefinition=e.definition,i.defaultDefinition=e.definition,n.focusUserDefinition=!0,r.currentTime=0,r.pause(),this._reset(),this.checkReUseMSE(),this._isMseInit=!1,this.eme=null;const c=this._handlerUrl(e.url);n._mainURL=c.main,n._backupURL=c.backup,this._changeDefineCanPlay&&r.off("canplay",this._changeDefineCanPlay),this._changeDefineCanPlay=()=>{this.changeDefineCanPlay(l,u,t,e),this._changeDefineCanPlay=null},r.once("canplay",this._changeDefineCanPlay),this.player.video.load(),this.playerStartInit(i.url)}_emitDefinitionChangeDetailEvent(e){const{bitrate:t,definition:n,file_id:r,width:i,vwidth:s,height:a,vheight:o}=this._currDefinition;this.player.emit("definitionChangeDetail",{start:e,bitrate:t,definition:n,mediaType:"video",url:this.config._mainURL,fileid:r});const l={width:i||s,height:a||o};this.player.emit("RESOLUTION_UPDATE",l)}_setCurrentDefinition(e){const{config:t}=this.player;if(t.definition&&t.definition.list){const n=t.definition.list.filter((t=>t.bitrate===e));this._currDefinition=n&&n[0]}this._currDefinition||(this._currDefinition={bitrate:e}),e&&(this._currDefinition.bitrate=e)}switchURL(e){if(this.useVideoLoad)return void fu.call(this.player,e);const{player:t,playerConfig:n,config:r}=this;n.definition.list=[e],n.url=e.url,n.defaultBitrate=e.bitrate,n.defaultDefinition=e.definition,["keyValue","kid","secretKey","drm","getLicenseUrl","drmKeyToken","sessionId"].forEach((t=>{r[t]=e[t]})),this._addMetaDataEvent((()=>{t.currentTime=0,this._removeMetaDataEvent()})),this.playNext(r)}_handlerUrl(e){const{playerConfig:t}=this;if(!e)return null;let n;const r=[];if("String"===bo(e))n=e,t.backupURL&&r.push(t.backupURL);else if("Array"===bo(e)&&e.length>0&&(n=e[0].src,e.length>1))for(let n=1;n<e.length;n++)r.push(Po(e[n].src,{__vid:t.vid}));return!(!n&&0===r.length)&&{main:Po(n,{__vid:t.vid}),backup:r}}_firstFrameTime(){const{firstFrameTime:e,player:t,config:n,loadstart:r}=this,i={supportHevc:n.supportHevc,firstmux:this.mp4?this.mp4.firstFrameTime.firstmux:-1,stats:Go(t),loadstart:r};this.firstFrameTime=function(e,t,n={supportHevc:!1,loadstart:0,firstmux:-1,stats:{}}){var r;if(t===ro||n.supportHevc)return e.new_loadeddata<0&&(e.loadst_loadeddata=So()-n.loadstart,e.new_loadeddata=So()-e.newplayer),e;if(t===io){const{stats:t,firstmux:i}=n,{metaload:s,startMuxTime:a}=e,o={};for(let e=0;e<(null==(r=null==t?void 0:t.bootStats)?void 0:r.length);e++)o[t.bootStats[e].action]=t.bootStats[e].dot;const l={...t,metaload:s,startload_stmux:a,firstmux:i,...o};return delete l.bootStats,l}}(e,this.codecType,i)}_bindEvents(){this.log($r.LOG,"bindEvents,",this._isEventInit);const{config:e,player:t}=this;this._isEventInit||(this.on("seeking",this._onSeeking),this.on("waiting",this._onWaiting),this.on("error",this._onVideoError),this.on("playing",this._onPlaying),this.on("pause",this._onPause),this.on("detectGap",(()=>{e.gapDegrade&&e.useEME&&(e.useEME=!1,this._replay())})),this.on(on.CHANGE_FLYING_PLUGIN_CONFIG,this._onChangeConfig),t.setEventsMiddleware({error:(e,n)=>{var r;const i=null==e?void 0:e.error,s={errorCode:null==i?void 0:i.code,errorMessage:null==i?void 0:i.message,videoType:this.useVideoLoad};if(this.changeState("video_error.Middleware",s),this.codecType===io&&(null==i?void 0:i.message.indexOf("video decoder initialization failed"))>=0&&this.emit("DECODER_FAILED",{codecType:this.config.codecType,vid:this.playerConfig.vid}),this.log($r.ERROR,"error middleware",JSON.stringify(s),", isDegrade,",!this._MSEError&&!this.useVideoLoad,t.currentTime),!this._MSEError&&!this.useVideoLoad)return t.vtype="MP4_2",this._MSEError=!0,null==(r=this.mp4)||r.cancelLoading(),this._startDegradedPlayback(s,t.paused),void this.emit(ou);this.emit(ou),this.useVideoLoad&&n(e.eventName,null==e?void 0:e.error)}})),this._isEventInit=!0}getBufferDur(){var e;if(null==(e=this.player)||!e.buffered)return 0;const{buffered:t}=this.player;let n=0;for(let e=0,r=t.length;e<r;e++)n+=t.end(e)-t.start(e);return n}deleteVideo(){var e;if((null==(e=this.removeVideoList)?void 0:e.length)>0){for(let e=0;e<this.removeVideoList.length;e++){const t=this.removeVideoList[e],n=t.parentNode;n&&n.removeChild(t),this.log($r.WARN,"[_removeVideoSource]")}this.removeVideoList=[]}}_unbindEvents(){var e;this.log($r.LOG,"unbindEvents,",this._isEventInit),this.off("seeking",this._onSeeking),this.off("waiting",this._onWaiting),this.off("ended",this._onEnded),this.off("error",this._onError),this.off("playing",this._onPlaying),this.off("pause",this._onPause),this.off(on.CHANGE_FLYING_PLUGIN_CONFIG,this._onChangeConfig),this._isEventInit=!1,null!=(e=this.config)&&e.enableFPSStuckHandle&&this.off(uu,this.fpsStuckHandle)}changeState(e,t={}){this._pTime||(this._pTime=So());const n=So()-this._pTime,r=So()-this._sTime;this.log($r.LOG,`>>>changeState[${e}]`,n,r,JSON.stringify(t)),this.states.push({state:e,t1:n,t2:r,data:t}),this._pTime=So()}get softDecode(){var e,t;return"xg-video"===(null==(t=null==(e=this.player)?void 0:e.config)?void 0:t.mediaType)}_initH265MseProxy(){const{player:e}=this;e.video instanceof HTMLVideoElement&&this.h265_h264_switch(this.playerConfig.mediaType);const t=e.video;this.softDecode&&t.setPlayMode&&t.setPlayMode("VOD"),this.mseProxy=t,this.softDecode&&(e.forceDegradeToVideo=()=>{},Oo(e,"lowdecode",this._lowDecoder),Oo(e,"error",this._onError))}notSupportError(e){return this.log($r.LOG,e,Xa),new Kl(this.player,{errorType:lo.MEDIA,errorCode:oo.mse,errorMessage:`${e} ${Xa}`,vid:this.playerConfig.vid})}removeAndRejectInitPromise(e){this._initPromise&&(this._removePendingPromise(this._initPromise),this._initPromise.reject(e))}_initMp4(e,t={},n={}){var r,i,s,a,o,l,u;const{config:c,player:h,playerConfig:d}=this;this.mp4&&(this.mp4.destroy(),this.mp4=null),this.changeState("MP4_NEW",{});let f=0;null!=(r=null==c?void 0:c.pcdnConfig)&&r.openPCDN&&(f=(null==(i=null==c?void 0:c.pcdnConfig)?void 0:i.switchPCDNMaxCnt)||2),null!=(s=null==c?void 0:c.pcdnConfig)&&s.adaptPCDNConfig&&(f=0),this._setCurrentDefinition(h.curDefinition.bitrate);let p=sl;null==c||c.loadRangeType;const g=null==(o=null==(a=h.curDefinition)?void 0:a.pktOffsetMap)?void 0:o.find((e=>(null==e?void 0:e.time)===((null==c?void 0:c.firstLoadTimePos)||5))),m=null==g?void 0:g.offset,v=function(e,t){const{getRequestOptionsCallback:n,reqOptions:r}=e;let i=null;return i=t.reqOptions?t.reqOptions:"Function"===bo(n)?n(t):r,{...r,...i}}(this.config,{url:e});this.mp4=new p(e,h.curDefinition.bitrate,{segmentDuration:c.segmentMinDuration,enableWorker:c.enableWorker,codecType:this.codecType,chunkSize:c.chunkSize,firstLoadSize:m,duration:d.duration||0,fileSize:n.fileSize||0,playerId:this.playerId,vid:d.vid,useUrlRange:c.useUrlRange,retryCount:c.retryCount,retryDelay:c.retryDelay,timeout:c.timeout,onProcessMinLen:c.onProcessMinLen,supportHevc:c.supportHevc,afterLoadeddataCallBackLen:c.afterLoadeddataCallBackLen,firstLoadBuffer:c.firstLoadBuffer,logger:this.logger,switchPCDNMaxCnt:f,reqOptions:v,fixEditListOffset:c.fixEditListOffset},this.config._backupURL,this.firstFrameTime,""),this.mp4.once(Vo,this._onMp4MetaReady),this.mp4.on(Ho,this._onMp4Error),this.mp4.on(Xo,this._updateDrmConfig),this.mp4.on(Ko,this._updateMSE),this.mp4.on(zo,this._onMp4Progress),this.mp4.on(jo,this._onMp4DataCallBack),this.mp4.on(Yo,(e=>{this.player&&this.player.emit("source_error",e)})),this.mp4.on(Zo,(e=>{var t,n;const{player:r,config:i}=this;this.emit(ou),this.log($r.LOG,"not match remove buffer start,buffer,",JSON.stringify(null==(t=null==r?void 0:r.buffered2)?void 0:t.bufferedList),", removeRange,",JSON.stringify(e)),null==(n=this.mse)||n.remove(ni.VIDEO,e[0]+.1,e[1]-.1).then((()=>{var e;this.log($r.LOG,"not match remove buffer end,",JSON.stringify(null==(e=null==r?void 0:r.buffered2)?void 0:e.bufferedList));const{currentTime:t}=r;(null==i?void 0:i.loadRangeType)===eo&&(r.currentTime=t,this.log($r.LOG,"not match remove buffer end, fix currentTime",r.currentTime))})).catch((()=>{}))})),this.mp4.on(qo,(e=>{this.pcdn&&e&&this.pcdn.removePCDNNode(e.vid,e.bitrate,e.url)})),this.mp4.on(Wo,(e=>{this.player&&(this.player.rawSrc=e,this.player.emit("initialUrl",{url:e}),this.player.emit("changeHost",Ro(e)))})),this.mp4.on(Qo,(async e=>{var t;await(null==(t=this.mp4)?void 0:t.cancelLoading()),this._curLoadSegmentIdx=e,this.log($r.LOG,"[update curLoadSegmentIdx]",e)})),this.mp4.on(Jo,(e=>{var t,n,r;if(!this.player)return;const{vid:i}=d,s={vid:i,taskType:1,changeCnt:null==(t=this.mp4)?void 0:t.getCurSwitchPCDNCnt(),traceId:null==(r=null==(n=this.mp4)?void 0:n.pcdnTraceInfo)?void 0:r.trace_id},a=function(e,t,n={}){const{vid:r,taskType:i,changeCnt:s,traceId:a}=n,{bitrate:o,definition:l,file_id:u}=t,c={vid:r,task_type:i,change_cnt:s,definition:l,bitrate:o,fileid:u};return((null==e?void 0:e.load_type)||Wa)===Wa?c.cdn_size=e.len:(c.pcdn_size=e.len,c.trace_id=a),c}(e,this._currDefinition,s);this.player.emit("prf_data_size",a);const o=(null==e?void 0:e.load_type)||Wa;this.mp4&&this.mp4.updateLoadInfo(o,e.len),mo&&console.log("prf_data_size emit, vid,",i,",loadType,",o,", task_type, 1",",len,",e.len)})),this.mp4.MP4Loader.on(za,(e=>{var t,n,r,i,s,a,o,l,u,c;gu=e.speed,function(e,t){e.speed||(e.speed=[]);const{speed:n}=e;n.push(t),n.length>10&&n.shift()}(this.debugInfo,e.speed);const h=(null==(t=null==e?void 0:e.priOptions)?void 0:t.type)||Wa;this.emit(za,{speed:e.speed,type:h,...e});const d=(null==(n=this.playerConfig)?void 0:n.vid)||(null==e?void 0:e.vid);if((null==e?void 0:e.len)>0){if(!this.player)return;const t=(null==(r=null==e?void 0:e.priOptions)?void 0:r.type)||Wa,n=(null==(i=this.adaptRangeRes)?void 0:i.length)>0?this.adaptRangeRes.shift():{},h=null==(s=this.mp4)?void 0:s.getCurSwitchPCDNCnt(),{bitrate:f,definition:p,file_id:g}=this._currDefinition,m={vid:d,task_type:1,change_cnt:h,bitrate:f,definition:p,fileid:g},v=No(n),y=function(e,t){const n=Co(t.len,t.time),r={cdn_size:0,cdn_speed:0,pcdn_size:0,pcdn_speed:0};return e===Wa?(r.cdn_size=t.len,r.cdn_speed=n):(r.pcdn_size=t.len,r.pcdn_speed=n),r}(t,e),_={...m,...v,...y},{idx:T}=n;this.player.emit("prf_data_size",_),mo&&console.log("prf_data_size emit,",T,JSON.stringify(_));const b=e.index?null==(l=null==(o=null==(a=this.mp4)?void 0:a.adaptTimeRange[e.index])?void 0:o.timeRangeIdx)?void 0:l[1]:null;if(b&&b>=this.mp4.timeRange.length-1)for(;(null==(u=this.adaptRangeRes)?void 0:u.length)>0;){const e=this.adaptRangeRes.shift(),t=null==(c=this.mp4)?void 0:c.getCurSwitchPCDNCnt(),n={...m,...y,...No(e)};n.change_cnt=t,this.player.emit("prf_data_size",n),mo&&console.log("prf_data_size emit,",T,JSON.stringify(n))}this.mp4&&this.mp4.updateLoadInfo(t,e.len)}})),null!=(l=null==c?void 0:c.pcdnConfig)&&l.adaptPCDNConfig&&(null==(u=this.mp4)||u.setSwitchPCDNCallBack((()=>{const{pcdn:e}=this;if(!e)return-1;const t=e.getPCDNChangeCnt()||-1;return this.log($r.LOG,"[updateSwitchPCDNMaxCnt]",t),t}))),this.changeState("MP4_INIT",{}),this.emit("loadstart_mse"),t||(t={}),this.mp4.init(t),this._emitDefinitionChangeDetailEvent(0)}_checkPreloader(){const{playerConfig:e}=this,t=new cl,n={method:"checkPreloader",success:0,type:"error",cacheKey:""};this.changeState("CHECK_PRELOAD");const{curDefinition:r,preloader:i}=this.player;if(!i)return this.changeState("PRELOAD_ERROR",{t:2}),n.success=0,n.error=new Error("no_preloader"),t.resolve(n),t;const s=r.cacheKey?r.cacheKey:i.generateUniqueKey({vid:e.vid,definition:r.definition||-1,vtype:e.vtype,codecType:e.codecType});return n.cacheKey=s,s?i.getPreLoadData(s).then((e=>{if(e){const{bitrate:i,orgDefinition:a}=e;if(i&&r.bitrate&&i!==r.bitrate)return this.preLoadData=null,n.success=0,n.error=new Error(`bitrate_not_match_cut_${r.bitrate}_cache_${i}`),this.changeState("PRELOAD_ERROR",{bitrate:i,ck:s}),t.resolve(n),void this.log($r.LOG,`>>>check Preloader bitrate_not_match cacheKey${s}\n                curDefinition:${r.bitrate}  cache:${i}`);r.orgDefinition=a,go&&console.log(">>>>check Preloader result",s,e),this.preLoadData=e,this.emit("PRELOAD_INFO",this.preLoadData),this.emit("hitCache",e),n.success=1,n.data=e,Ja.set(s,!0),this.changeState("PRELOAD_OK",{l:this.preLoadData.byteLength,ck:s}),e.mediaSegList&&e.mediaSegList.length>0||e.buffer&&e.buffer.byteLength>0?this.hitpreload=!0:this.hitpreload=!1,t.resolve(n)}else this.preLoadData=null,this.changeState("PRELOAD_ERROR",{t:0}),n.success=0,n.error=new Error("none_preload"),t.resolve(n)})):(this.changeState("PRELOAD_ERROR",{t:2}),n.success=0,n.error=new Error("none_preload"),t.resolve(n)),t}_initEME(e,t){var n,r;const i=Bo(this.config),{useEME:s}=this.config;if(i&&s&&!mu.checkEMEValid())return this.log($r.ERROR,"checkEMEInValid"),void this._errorHandler(new Kl(this.player,{errorType:lo.MEDIA,errorCode:oo.eme_hijack,errorMessage:"checkEMEInValid",vid:this.playerConfig.vid}));const{player:a,config:o}=this;this._updateDrmConfig(t),this.log($r.LOG,"useEME: ",o.useEME),null==(n=this._secretkey)||n.setOptions('video/mp4; codecs="avc1.64001E"','audio/mp4; codecs="mp4a.40.2"'),null==(r=this._secretkey)||r.setupEME(a.video)}async _initMse(e,t=!1){var n;const{useEME:r}=this.config;if(Bo(this.config)&&r&&!mu.checkMSEValid())return this.log($r.ERROR,"checkMSEInValid "),void this._errorHandler(new Kl(this.player,{errorType:lo.MEDIA,errorCode:oo.mse_hijack,errorMessage:"checkMSEInValid",vid:this.playerConfig.vid}));if(null==(n=this.player)||n.emit("codecsupdate",e.videoCodec),this.config.frameFreeze){if(this.log($r.LOG,"release freezed frame"),this.mse){const e=this.mse;this.mse=null,await e.unbindMedia()}this.player&&this.player.src&&(this.player.removeAttribute("src"),this.player.load())}else this.updateMSEDuration();const i=function(e,t){const n=e&&e.checkCodecH265(),r=e&&e.checkCodecH266(),i=!!t.videoCodec,s=!!t.audioCodec;let a;return a=i&&s?n?'video/mp4; codecs="hev1.1.6.L93.B0, mp4a.40.5"':r?'video/mp4; codecs="bvc2.1.6.L93.B0, mp4a.40.5"':'video/mp4; codecs="avc1.64001E, mp4a.40.5"':i?n?'video/mp4; codecs="hev1.1.6.L93.B0"':r?'video/mp4; codecs="bvc2.1.6.L93.B0"':'video/mp4; codecs="avc1.64001E"':'video/mp4; codecs="mp4a.40.5"',a}(this.mp4,e),s={[ni.VIDEO]:{mimeType:"video/mp4",codec:i}};let a;this.mse?(this.log($r.LOG,"MSE exit"),a=new cl,a.resolve()):(this.log($r.LOG,"new MSE"),this.mse=new ni,a=this.mse.bindMedia(this.player.video)),a.then((e=>{var n;this.changeState("MSE_OPEN");const{firstFrameTime:r}=this;r.initmse_sbopen=null==e?void 0:e.costtime,this._loadStartEventTime>0&&(r.mseopen=So()-this._loadStartEventTime);const i=Object.keys(s);try{for(let e=0;e<i.length;e++){const r=i[e];null==(n=this.mse)||n.createOrChangeSource(r,s[r].codec).then((()=>{this.changeState("MSE_OPEN_DONE"),this._isMseInit=!0,this._onTimeUpdate()})).catch((async e=>{var n;this.config.reUseMSE=!1,this.log($r.WARN,"MSE createOrChangeSource catch err: ",null==e?void 0:e.message),await(null==(n=this.mse)?void 0:n.unbindMedia()),this.mse=null,this._isMseInit=!1,t?this.MSEErrorHandle(e):this._initMse(this.mp4.meta,!0)}))}}catch(e){this.MSEErrorHandle(e)}})).catch((e=>this.MSEErrorHandle(e))),this.changeState("MSE_INIT")}MSEErrorHandle(e){const t=new Kl(this.player,{errorType:lo.mse,errorCode:oo.mse,vid:this.playerConfig.vid,errorMessage:e.message,mediaError:{code:oo.mse,message:e.message}});this.log($r.ERROR,"initMse error: ",null==e?void 0:e.message),this._errorHandler(t)}_appendInitSeg(e){!this.mse||this._MSEError||(this.changeState("MSE_INITSEG"),this.mse.append(ni.VIDEO,e,{vid:this.playerConfig.vid,range:null,dataLen:e.byteLength,isinit:!0}).then((e=>{this.firstFrameTime.metaready_initsegend=null==e?void 0:e.costtime,this.changeState("MSE_INITSEG_OK",{costtime:null==e?void 0:e.costtime})})),this.config.useEME&&this._secretkey&&this._secretkey.encryptHandle())}_checkMetaInfo(e){if(!e)return new Kl(this.player,{errorType:lo.DEMUX,errorCode:oo.metaError,errorMessage:"meta is null",vid:this.playerConfig.vid});const t=this.mp4.checkCodecH265(),n=this.mp4.checkCodecH266();return this.changeState("MP4_META_READY",{isH265:t,isH266:n}),!t||(this.codecType!==io&&(this.codecType=io,this.log($r.LOG,"codecType fix ",this.codecType)),this.softDecode||this.config.supportHevc)?n&&(this.codecType!==so&&(this.codecType=so,this.log($r.LOG,"codecType fix ",this.codecType)),!this.config.supportVvcc)?this.notSupportError(this.codecType):null:this.notSupportError(this.codecType)}_stopProgress(){this.log($r.LOG,"stopProgress",this._hasStartProgress),this._hasStartProgress=!1,this._requestTimer&&this._requestTimer.stop(),this._bufferBreakTimer&&(clearTimeout(this._bufferBreakTimer),this._bufferBreakTimer=null,this._bufferBreakFlag=void 0),this._seekResumTimer&&(clearTimeout(this._seekResumTimer),this._seekResumTimer=null)}checkReStartTimer(){const e=So()-this._lastTimeupdateTime2;e>2*this.config.tickInSeconds*1e3&&!this._offineLine&&(this.log($r.LOG,"checkReStartTimer reStart timer",e,So()),this._stopProgress(),this._startProgress(),this._lastTimeupdateTime2=So())}_bindNetworkStateChange(){window.addEventListener("online",this._onOnlineHandler),window.addEventListener("offline",this._onOfflineHandler)}_unbindNetworkStateChange(){window.removeEventListener("online",this._onOnlineHandler),window.removeEventListener("offline",this._onOfflineHandler)}_onSuperStart(e){const{player:t}=this;_o(`_onSuperStart:${e}`,this.mse),t.video.src=e,this.once("canplay",(()=>{t.play(),this.on("waiting",this._onWaiting)}))}_appendBuffer(e,t,n={},r){const{mse:i,playerConfig:s,player:a}=this,{vid:o}=s;this.log($r.LOG,"appendStart",o,n.fragIndex,JSON.stringify(n.range)),this._MSEError?this.log($r.ERROR,"_MSEError, not append return"):i.append(e,t,{vid:o,fragIndex:n.fragIndex,range:n.range,dataLen:t.byteLength,state:r}).then((e=>{var t,i,s,o,l,u,c;const h=a.getBufferedRange();this.log($r.LOG,"appendEnd ",null==(t=null==e?void 0:e.context)?void 0:t.fragIndex,JSON.stringify(null==(i=null==e?void 0:e.context)?void 0:i.range),null==(s=null==e?void 0:e.context)?void 0:s.dataLen,", costTime,",null==e?void 0:e.costtime,", opt,",null==e?void 0:e.name,",buffer,",JSON.stringify(h),a.currentTime),this.checkBufferArriveEndTime();const d=this.firstFrameTime;if(d.loadst_loadeddata<0){d.apcnt++;const t=(null==(o=null==e?void 0:e.context)?void 0:o.dataLen)||0,n=(null==e?void 0:e.costtime)||0;d.aplen+=t,d.data_ap+=n;let r=!1;for(let e=this.states.length-1;e>=0;e--)if("APPEND_DATA_OK"===this.states[e].state){this.states[e].data.cnt+=1,this.states[e].data.costime+=n,this.states[e].data.dataLen+=t,r=!0;break}r||this.changeState("APPEND_DATA_OK",{costime:n,dataLen:t,cnt:1})}const f=null==(c=null==(u=null==(l=this.mp4)?void 0:l.adaptTimeRange[n.fragIndex])?void 0:u.timeRangeIdx)?void 0:c[1];if(this.mse&&r&&f>=this.mp4.timeRange.length){const{buffered:e}=this.player;e&&(null==e?void 0:e.length)>0&&(this.bufferEndTime=e.end(e.length-1)),this._isEnded(),this.log($r.LOG,"loaded ended !!!==>>>",JSON.stringify(n.range),", fragIndex,",n.fragIndex,", bufferEndTime,",this.bufferEndTime,",meta_duration,",this.mp4.meta.duration)}})).catch((e=>{const{player:t,mse:r}=this;if(this._MSEError||!t)return;const i=t.media||t.video;if(e&&null!=r&&r.isFull()){this.log($r.WARN,"[MSE is full]");const e=t.getBufferedRange(t.buffered2);this._checkRemoveSourceBuffer(e,t.currentTime,!0)}else{const r=`${null!=i&&i.error?[i.error.code,i.error.message].join("-"):"MEDIA_EMPTY"}`,s=`${(null==e?void 0:e.errorCode)||""}-${(null==e?void 0:e.errorMessage)||(null==e?void 0:e.message)||"MSE_EMPTY"}|${r}`;this._MSEError=!0,this.changeState("_MSEError",{fragIndex:null==n?void 0:n.fragIndex,range:null==n?void 0:n.range}),this.log($r.LOG,"MSE append error",null==n?void 0:n.fragIndex,null==n?void 0:n.range);const a=new Kl(t,{errorType:lo.MEDIA,errorCode:oo.mseAppend,vid:o,errorMessage:s,mediaError:{code:oo.mseAppend,message:s}});this._errorHandler(a)}}))}async _loadData(){if(this.mp4&&this._isMseInit){this.loadstart<0&&(this.loadstart=So());try{await this.mp4.load(this._curLoadSegmentIdx,this._loadDataSuccess)}catch(e){this.log($r.ERROR,"[Index] _loadData error",this.playerConfig.vid,null==e?void 0:e.message)}}}getDataBitRate(e){const{mp4:t,playerConfig:n}=this,{definition:r}=n;if(!t||!r||r.list)return 0;const i=t.getDataBitRate(e),{list:s}=r;let a=0;for(let e=0;s&&e<s.length;e++)if(s[e].bitrate===i){a=s[e];break}return a}_loadStuckCheck(){var e;const{config:t,player:n}=this;if(!t.disableBufferBreakCheck){const r=n.isUserActive;if(n.currentTime-(this._lastCurrentTime||0)>.1||!r&&n.paused||r&&this.playFlag&&n.paused)(1===this._bufferBreakFlag||2===this._bufferBreakFlag)&&(this.log($r.LOG,"视频没有卡死,重置卡死标记,curtime,",n.currentTime),this._bufferBreakFlag=0,clearTimeout(this._bufferBreakTimer),this._bufferBreakFlag=null);else if(!this._bufferBreakFlag){this._bufferBreakFlag=1;const i=JSON.stringify(null==(e=null==n?void 0:n.buffered2)?void 0:e.bufferedList);this.log($r.LOG,`卡死计时开始! ${t.waitingTimeOut}ms后确认卡死,`,n.currentTime,i),this._bufferBreakTimer=setTimeout((()=>{if(!(this.isDestroy||t.disableInactiveWaitingCheck&&(!r||null!=n&&n.paused))){if(1===this._bufferBreakFlag){const e=n.currentTime,t=n.bufferedPoint;if(t.end>0&&t.end-e>=2)return void this.retrySeekResum(e)}this._bufferBreakFlag=2,this.waitTimeoutDegrade()}}),t.waitingTimeOut)}this._lastCurrentTime=n.currentTime}}waitTimeoutDegrade(){var e,t,n;const{player:r}=this;this.changeState("wait_timeout"),this.log($r.LOG,"确认卡死!!!,curtime,",r.currentTime,JSON.stringify(null==(e=null==r?void 0:r.buffered2)?void 0:e.bufferedList),",duration,",null==(n=null==(t=this.mp4)?void 0:t.meta)?void 0:n.duration),this.emit("waittimeout");const i=document.hidden||"hidden"===document.visibilityState,s=new Kl(this.player,{errorType:lo.RUNTIME,errorCode:i?oo.waitTimeoutWithHidden:oo.waitTimeout,errorMessage:"wait_timeout",vid:this.playerConfig.vid});this._errorHandler(s)}async retrySeekResum(e){const{player:t,config:n}=this;if(this.changeState("retrySeek"),this.log($r.LOG,"卡死但有超过2s的buffer,seek下!!!"),clearTimeout(this._seekResumTimer),this._resumePlay=!1,n.waitingRetrySeekTimes>0&&n.waitingRetryDuration){const r=Math.min(n.waitingRetrySeekTimes,3);this._currentSeekTimes=0,this.off("playing",this._onResumePlaying),this.once("playing",this._onResumePlaying);const i=()=>{if(t&&!this._resumePlay&&!t.paused)return this._currentSeekTimes<r?(this._seekOnce(e),void(this._seekResumTimer=setTimeout(i,n.waitingRetryDuration))):(this.waitTimeoutDegrade(),void(this._seekResumTimer=null));this.log($r.LOG,`当前播放实例已恢复或处于暂停状态，退出重试 player=${!!t},_resumePlay=${this._resumePlay},paused=${null==t?void 0:t.paused}`)};return this._seekOnce(e),void(this._seekResumTimer=setTimeout(i,n.waitingRetryDuration))}t.currentTime=e+1,this.once("playing",(()=>{this._resumePlay=!0})),this._seekResumTimer=setTimeout((()=>{this._resumePlay||this.waitTimeoutDegrade(),this._seekResumTimer=null}),Math.ceil(n.waitingTimeOut/2))}_isInBuffer(e,t=0){let n=!1;const{buffered:r}=this.player.video;for(let i=0;i<r.length;i++){const s=r.start(i)-t,a=r.end(i)+t;if(s<=e.startTime&&e.endTime<=a){n=!0;break}}return n}_doubleCheckBuffer(e){const{player:t}=this;if(!(e.startTime>t.currentTime&&t.video&&t.video.buffered))return!0;const{buffered:n}=t.video;return 1===n.length||this._isInBuffer(e,.2)}checkURLExpired(e,t){var n,r,i,s;const a=function(e){if(!e||"String"!==bo(e))return 0;let t=0;try{const n=new RegExp("(\\?|&)x-tos-expires=([^&]*)(&|$)"),r=e.match(n);if(null!==r)t=parseInt(r[2],10);else{const n=e.split("/");n.length>5&&8===n[4].length&&(t=parseInt(n[4],16))}return t>0?t<parseInt((new Date).getTime()/1e3,10)?1:2:0}catch{return 0}}(this.config._mainURL);1===a&&this.pcdn&&(this.pcdn=null);const o=(null==(n=null==e?void 0:e.response)?void 0:n.url)||(null==(r=this.config.pcdnConfig)?void 0:r.trackerUrl);null==(s=this.player)||s.emit("source_error",{host:Ro(o),src:o,errorCode:null==(i=null==e?void 0:e.response)?void 0:i.status,message:`${null==e?void 0:e.message}-${a}${t}`})}pushTimerStep(){var e;(null==(e=this.timerStepList)?void 0:e.length)>10&&this.timerStepList.shift(),this._lastTimeupdateTime2>0&&this.timerStepList.push(So()-this._lastTimeupdateTime2)}_onTimeUpdate(){this.pushTimerStep(),this._lastTimeupdateTime2=So();const{mse:e,mp4:t,player:n,config:r}=this;if(!n||this.useVideoLoad||!t)return;this.checkBufferArriveEndTime();const i=n.getBufferedRange();So()-this._lastCheckTime>1e3&&(this._lastCheckTime=So(),this._loadStuckCheck(),this._startUrlExpiredCheck(),this._checkRemoveSourceBuffer(i,n.currentTime));const{timeRange:s}=t;if(s&&!(s.length<1)&&(e||this.mseProxy)&&this.canDownload){let e=r.maxBufferLength,t=!1;(this.playFlag&&n.paused||!this.isActive)&&(t=!0);const{nextBufferLength:s,minBufferLength:a,adaptRange:o,noPreloadAddBufferLen:l}=r,u=null==o?void 0:o.targetCacheControl;t?e=n.isInstNext&&s>=0?s:a:u&&(e=this.adaptRange.getAdaptCacheBuffer()),!this.preLoadData&&u&&(e+=l);const c=n.currentTime+e;i[1]-c<0&&(this.isOpenPCDN(i[1]),(null==r?void 0:r.loadRangeType)===eo?this.sizeRangeCheckLoad(t,e,i[1]-n.currentTime):this.gopRangeCheckLoad(t,c,e)),this.playFlag&&!this._hasTriggerBufferThreshold&&this._startBufferCheck()}}sizeRangeCheckLoad(e,t,n){var r,i,s;const{player:a,mp4:o}=this,{adaptTimeRange:l}=o,u=l.length;if(!u||(null==(r=l[u-1])?void 0:r.range[1])<(o.size-1||a.curDefinition.size-1)||!l[u-1].downloaded){const r=l.findIndex((e=>!e.isLoading));if(null==l||!l.length||r>=0||l[u-1].downloaded){const{adaptRangeRes:u,loadDuration:c}=this.calculateAdaptRange(e,t),h=null==(i=this.adaptRange)?void 0:i.getAdaptRangeSize(c);h>0&&(u.loadSize=h),u.loadDuration=c,this._curLoadSegmentIdx=r<0?o.updateAdaptTimeRange(null,c,h):r;let d=this._curLoadSegmentIdx;l[d].downloaded||(d=Math.max(d-1,0));const f=l[d];if(n>0&&(null==f?void 0:f.endTime)-a.currentTime>=t)return;const p=l[this._curLoadSegmentIdx];if(this._curLoadSegmentIdx>=0&&this._isInBuffer(p)&&!this._isChangeDefinition&&this._curLoadSegmentIdx>=0&&p.endTime-p.startTime>1){const e=l[this._curLoadSegmentIdx];return e.downloaded=!0,e.isLoading=!0,this.log($r.LOG,`onTimeUpdate, ${this._curLoadSegmentIdx} download segment, has buffer`,p.startTime,p.endTime,a.currentTime),void(o.seekTime=p.endTime)}u.idx=this._curLoadSegmentIdx,(!this.adaptRangeRes.length||(null==(s=this.adaptRangeRes[u.length-1])?void 0:s.idx)!==this._curLoadSegmentIdx)&&(this.adaptRangeRes.push(u),this.log($r.LOG,"adaptRangeRes>>>>",u)),this.log($r.LOG,"[onTimeUpdate],load index==>>>, ",this._curLoadSegmentIdx,JSON.stringify(l[this._curLoadSegmentIdx])),this._loadData()}}}gopRangeCheckLoad(e,t,n){const{timeRange:r,adaptTimeRange:i}=this.mp4,{player:s}=this;r.every(((r,a)=>{var o,l,u,c;if(void 0!==r.adaptTimeRangeIdx&&r.adaptTimeRangeIdx>=0&&i&&i[r.adaptTimeRangeIdx].downloaded)return!0;const h=this.mp4.getAdaptIdxBySrcIdx(a,!0),d=h>=0?i[h]:null,f=h>=0&&this._isInBuffer(d);if(!this._isChangeDefinition&&h>=0&&d.endTime-d.startTime>1&&f)return i[h].downloaded=!0,i[h].isLoading=!0,this.log($r.LOG,`onTimeUpdate, ${h} download segment, has buffer`,d.startTime,d.endTime,s.currentTime),!0;if(r.startTime-s.currentTime<t){if(h<i.length&&null!=(o=i[h])&&o.isLoading)return!1;const{adaptRangeRes:t,loadDuration:r}=this.calculateAdaptRange(e,n);this._curLoadSegmentIdx=this.mp4.updateAdaptTimeRange(a,r),t.idx=this._curLoadSegmentIdx,null!=(u=null==(l=this.config)?void 0:l.adaptRange)&&u.rangeControl&&(t.loadDuration=this.mp4.adaptTimeRange[this._curLoadSegmentIdx].duration),(!this.adaptRangeRes.length||(null==(c=this.adaptRangeRes[this.adaptRangeRes.length-1])?void 0:c.idx)!==this._curLoadSegmentIdx)&&(this.adaptRangeRes.push(t),this.log($r.LOG,"adaptRangeRes>>>>",t));const d=i[this._curLoadSegmentIdx];if(this._isInBuffer(d))return d.downloaded=!0,d.isLoading=!0,this.log($r.LOG,`onTimeUpdate_, ${this._curLoadSegmentIdx} download segment, has buffer`,d.startTime,d.endTime,s.currentTime),!0;this.log($r.LOG,"[onTimeUpdate],load index==>>>, ",this._curLoadSegmentIdx,JSON.stringify(this.mp4.adaptTimeRange[this._curLoadSegmentIdx])),this._loadData()}}))}checkBufferArriveEndTime(){const{player:e,mse:t,mp4:n}=this;if(!e||!t||!n)return;const r=e.getBufferedRange(),i=n.getMediaEndTime();i>0&&r[1]>=i&&!t.isEnded&&(this.log($r.LOG,"checkBufferArriveEndTime endOfStream, enfTime",i,", bufferRange,",JSON.stringify(r),",currentTime,",e.currentTime),t.endOfStream())}calculateAdaptRange(e,t){var n,r;let i;const s={forceSetMin:e};null!=(n=this.pcdn)&&n.isOpenAdaptPCDN&&(s.PCDNInBuffer=this.pcdn.curPCDNInBuffer,s.PCDNOutBuffer=this.pcdn.curPCDNOutBuffer);const a=null==(r=this.config)?void 0:r.adaptRange;return!this.playFlag||e?i=this.config.minBufferLength:null!=a&&a.rangeControl?(i=this.adaptRange.getAdaptLoadDuration(),s.loadTarDuration=i):i=this.config.rangeMaxDuration,null!=a&&a.targetCacheControl&&(s.cachedBufferDur=t),!this.playFlag&&null!=a&&a.rangeControl&&(s.loadTarDuration=i),{adaptRangeRes:s,loadDuration:i}}checkReUseMSE(e,t){var n;const{mse:r}=this;if(r)if(e||this.config.reUseMSE){r.clearOpQueues(ni.VIDEO,t),r.abort(ni.VIDEO);const e=null==(n=this.player)?void 0:n.buffered;if((null==e?void 0:e.length)>0){const t=e.end(e.length-1);this.log($r.LOG,"reUseMSE remove buffer, 0-",t),this._canUpdateDuration=!1,this.removeBuffer(ni.VIDEO,0,t,(()=>{var e,t;this._canUpdateDuration=!0,null!=(t=null==(e=this.mp4)?void 0:e.meta)&&t.duration&&this.updateMSEDuration()}))}}else r.unbindMedia(),this.mse=null,this._unloadVideo()}updateMSEDuration(){var e;const{mse:t,mp4:n}=this,r=null==(e=null==n?void 0:n.meta)?void 0:e.duration;this._canUpdateDuration&&r&&r!==t.duration&&(this.log($r.LOG,"updateMSEDuration ",r,",oldDuration,",t.duration),t.updateDuration(r),this._canUpdateDuration=null)}_reset(){this._definitionChangePointInfo=null,this._isReceiveEndedEvent=!1,this.adaptRangeRes=[],this.states=[],this.hitpreload=!1,this._sTime=So(),this._isChangeDefinition=!1,this._removeBuffeEndTime=0,this._usePaused=!1,this.useVideoLoad=!1,this._isMseInit=!1,this.endofstream=!1,this._curLoadSegmentIdx=0,this.emitExpireTimestamp=null,this.preLoadData=null,this.forPreloadTimeCache=null,this.playFlag=!1,this.waitLevelStartTime=-1,this._waitAdjustTimeCnt=0,this._initPromise&&"pending"===this._initPromise.state&&this._initPromise.reject(au),clearTimeout(this.checkResumePlayTimer),this.checkResumePlayTimer=null,this._stopProgress(),this.mp4&&(this.mp4.destroy(),this.mp4=null),this.mseProxy&&(Ao(this.player,"lowdecode",this._onDegrade),Ao(this.player,this._onError)),this.config.frameFreeze||this._unloadVideo(),this._cancelPendingPromises(),this._abrService&&(this._abrService.destroy(),this._abrService=null);const e=this.firstFrameTime;Object.keys(e).forEach((t=>{e[t]="apcnt"===t||"aplen"===t?0:"newplayer"===t?So():-1})),clearTimeout(this._waitInBufferTimer),this._waitInBufferTimer=null,this.canDownload=!0,this.loadstart=-1,this._loadStartEventTime=-1,this.startLoadData=-1}removeErrorUrls(e,t,n){return e.errorCode===oo[403]&&this._emitExpireEvent(e),n}checkIsDegraded(e){const{notDegradeErrorList:t}=this.config;return!((null==t?void 0:t.length)>0&&(e.errorCode===oo.timeout&&t.indexOf("timeout")>=0||e.errorCode===oo[403]&&(t.indexOf(403)>=0||t.indexOf("403")>=0)||e.errorCode===oo[404]&&(t.indexOf(404)>=0||t.indexOf("404")>=0)))}_startDegradedPlayback(e,t){this.canDownload=!1;const{player:n,playerConfig:r,config:i}=this;this.endofstream=!1,this._currentTime=n.currentTime||0,this.player.pause(),this._reset(),this._replay=null;const{H264DefinitionList:s}=r;if(this.codecType===io&&this.softDecode)this.log($r.LOG,"h265 softDecode err,degrade use 264 play",r.vid),this._onDegrade(e);else if(this.codecType===ro||i.supportHevc||i.supportVvcc||(null==s?void 0:s.length)>0){const{drm:a,kid:o,drmKeyToken:l,keyValue:u,secretKey:c}=i;if(a||o||l||u||c)a&&Object.keys(a).map((t=>{a&&(e[t]=a[t])})),this.log($r.ERROR,"final error !!!!, ",r.vid,null==e?void 0:e.errorCode,null==e?void 0:e.errorMessage),this.emit("error",e);else{this.log($r.LOG,this.codecType,"MSE degrade video,",r.vid,n.currentTime),this.emit(lu,{errc:null==e?void 0:e.errorCode,err_msg:(null==e?void 0:e.errorMessage)||(null==e?void 0:e.message),codec_type:this.codecType,media_type:r.mediaType}),this.useVideoLoad=!0,this.destroyMSE();const i=()=>{this._currentTime&&(n.currentTime=this._currentTime),this.log($r.LOG,"DegradedPlayback update currentTime",r.vid,this.codecType,this._currentTime),t?this.player.pause():this.player.play(),this._removeMetaDataEvent()};this._addMetaDataEvent(i);let a=r.url;if((null==s?void 0:s.length)>0){const e=s.length,t=this.player.curDefinition.definition;let n=t&&s.find((e=>e.definition===t));n||(r.H264DefinitionList.sort(((e,t)=>e.bitrate-t.bitrate)),n=r.H264DefinitionList[Math.floor(e/2)]),n&&(a=n.url,this.playerConfig.codecType=ro,this.codecType=ro)}this._setPlayerSrc(a)}}else this.log($r.ERROR,"degrade player failed"),this.emit("error",e)}getAdaptTimeRangeIdx(e){var t,n;const{config:r,adaptRange:i}=this;let s=r.segmentMinDuration;return i&&null!=(t=null==r?void 0:r.adaptRange)&&t.rangeControl&&(s=i.getAdaptLoadDuration()),null==(n=this.mp4)?void 0:n.updateAdaptTimeRange(e,s)}_startProgress(){this.initTimer(),this._requestTimer.start(),this._hasStartProgress=!0}_unloadVideo(){this.log($r.LOG,"unloadVideo");const{player:e}=this;try{e.video&&e.video.src&&!/^blob/.test(e.currentSrc)&&!/^blob/.test(e.video.src)&&(this.log($r.LOG,"unloadVideo src"),e.video.removeAttribute("src"),e.video.load())}catch(e){this.log($r.ERROR,"unloadVideo error",null==e?void 0:e.message)}}_addPendingPromise(e){this._pendingPromises.push(e)}_removePendingPromise(e){this.log($r.LOG,"removePendingPromise",null==e?void 0:e.id);const t=this._pendingPromises.indexOf(e);t>-1&&this._pendingPromises.splice(t,1)}_cancelPendingPromises(){this._pendingPromises.length>0&&this._pendingPromises.forEach((e=>{e.reject(au)})),this._pendingPromises=[]}_onMediaExpired(){this.log($r.LOG,"MediaExpired stopProgress"),this._stopProgress(),this.emit(ja.MEDIA_EXPIRED)}_isEnded(){var e,t;const{player:n,mp4:r}=this,i=n.bufferedPoint,s=i?i.end:0,a=n.currentTime;a>1&&s>a&&(s-a>=2||n.duration-a<1)&&2===n.video.readyState?So()-this._lastCheckLagTime>=3e3&&(this.log($r.LOG,"[has buffer but waiting,seek 0.2 adjust],curTime,",a,", bufferend,",s,", duration,",null==(e=null==r?void 0:r.meta)?void 0:e.duration),n.currentTime=a+.2,this._lastCheckLagTime=So()):this._lastCheckLagTime=So();const{seeking:o}=n.video;return!this.endofstream&&this.bufferEndTime>0&&this.mse&&!o&&this.bufferEndTime-a<.5&&(this.log($r.LOG,"[isEnded endOfStream],curTime,",n.currentTime,", bufferend,",s,", duration,",null==(t=null==r?void 0:r.meta)?void 0:t.duration),this.endofstream=!0,this.mse.endOfStream().then((()=>{}))),!!(r&&r.meta&&!o&&r.meta.duration-a<.5)&&(this._stopProgress(),this.log($r.LOG,"[isEnded],stopProgress and endOfStream,curTime, ",n.currentTime,", bufferend,",s,", duration,",r.meta.duration),this.mse&&this.mse.endOfStream().then((()=>{})),!0)}emitVideoEvent(e){if(this._checkEndedTimer)return;const{player:t,mp4:n}=this;this._checkEndedTimer=setTimeout((()=>{this._checkEndedTimer=null,!this._isReceiveEndedEvent&&n.meta.duration-t.currentTime<.5&&(this.log($r.LOG,"[ do emit video ended event],curTime,",t.currentTime,", bufferend,",e,", duration,",n.meta.duration),this.emit("ended"))}),2e3)}_clearMediaKeys(){const{player:e}=this;e.video&&"function"==typeof e.video.setMediaKeys&&e.video.setMediaKeys(null).catch((()=>{}))}_checkRemoveSourceBuffer(e,t,n,r){const{mse:i,mp4:s,player:a}=this;if(i&&s&&a&&(n&&(clearTimeout(this._removeBufferTimer),this._removeBufferTimer=null),e||(e=a.getBufferedRange(a.buffered2)),t||(t=a.currentTime),!(!n&&So()-this._checkRemoveBufferLastTime<=this.config.removeBufferLen||this.endofstream)&&(this._checkRemoveBufferLastTime=So(),e&&e[0]>=0&&(t-e[0]>this.config.removeBufferLen||i.isFull())))){const n=r?e[1]:t-(i.isFull()?0:15),a=s.getFragmentIdx(n);if(a>0&&(r||s.timeRange[a].startTime<t)){const n=Math.floor(Math.min(s.timeRange[a].startTime,e[1])),r=Math.max(s.timeRange[0].endTime+1,e[0]);r<n?(this.log($r.LOG,"[checkremoveSourceBuffer], remove range==>>>",r,n,t),this.removeBuffer(ni.VIDEO,r,n)):i.isFull()&&!this._removeBufferTimer&&(this._removeBufferTimer=setTimeout((()=>{this._checkRemoveSourceBuffer(null,null,!0)}),1e4))}}}onMediaUpdate(e){const{vid:t,kid:n,url:r}=e,{player:i,config:s,playerConfig:a}=this;if(t===a.vid&&n===s.kid&&r){this.playerConfig.url=r;const e=this._handlerUrl(r);s._mainURL=e.main,s._backupURL=e.backup;const t=s._mainURL;return i.rawSrc=r,this.useVideoLoad?i.src=r:this.mp4&&this.mp4.updateUrl(t),!0}return!1}enableAutoBuffer(e){if(e){if(!this._allInitPromise)return void this.log($r.LOG,"player destroyed!!");this._allInitPromise.then((()=>{this.log($r.LOG,"enableAutoBuffer true"),this._startProgress()}))}else this._stopProgress(),this.log($r.LOG,"enableAutoBuffer false")}get bitRateAdapter(){if(!this.player||!this.player.plugins)return null;if(this.config.needAutoBitrate){const{bitrateselector:e}=this.player.plugins;return e}return null}getDefinitonFromAdapter(e,t){if(!this.bitRateAdapter)return null;const n=this.bitRateAdapter;return n.getSuitableBitrate?n.getSuitableBitrate(e,t):n.bitRateAdapter?n.bitRateAdapter.select(e):null}addPreloader(e={}){e.playerId=this.playerId;const{preloader:t}=this.player;t?t.addPreloader(e,this.playerConfig.vid,this.playerId):this.log($r.LOG,"preloader has destroyed")}addPreloaderList(e=[]){const{preloader:t}=this.player;t?t.addPreloaderList(e,this.playerConfig.vid,this.playerId):this.log($r.LOG,"preloader has destroyed")}log(e,t,...n){const{vid:r}=this.playerConfig||{},i=r?`[Index]${r} ${t}`:`[Index] ${t}`;_o(this.logger,e,i,...n)}_emitInitFail(e){this.log($r.ERROR,"initFail, reason:",e),this.emit(ja.INIT_FAIL,e)}set useVideoLoad(e){this._useVideoLoad=e}get useVideoLoad(){return this._useVideoLoad}get ready(){return this._allInitPromise}get speed(){return parseInt(il.speed,10)}get version(){return ao}get realTimeSpeed(){return gu}get opQueueLen(){const e=this.mse&&this.mse._queue?this.mse._queue[ni.VIDEO]:[];return e?e.length:0}get loadSegmentTimeRange(){if(!this.mp4)return[0,0,0,0];const e=this.mp4.adaptTimeRange;if(e&&e.length>0&&this._curLoadSegmentIdx>=0&&this._curLoadSegmentIdx<e.length){const t=e[this._curLoadSegmentIdx];if(t.isLoading){const e=t.range;return[Number(t.startTime),Number(t.endTime),...e]}}return[0,0,0,0]}get preloadState(){return this.player.preloader&&this.player.preloader.loadingCount}get moovSize(){return 0}get isDestroy(){return!this.player}cancelPreloadTask(){this.preloader&&this.preloader.cancelLoading(this.player.playerId)}removeAllPreloadData(){this.preloader&&this.preloader.removeAll()}removeAllPreloadTask(){this.preloader&&this.preloader.removeAllPreloadTask()}get domain(){return Ro(this.loadURL)}get loadURL(){const{player:e}=this;let t=e.currentSrc;return/^blob/.test(e.currentSrc)&&(t=this.mp4.currentLoadUseUrl()),t}get abrInstance(){return this._abrService?this._abrService.abrInstance:null}_handleUrlExpire(){const{config:e,player:t}=this,{paused:n}=t;(new Date).getTime()/1e3>=this.urlExpireTimestamp&&this.urlExpireTimestamp>0&&!n&&e.getServerTime&&(t.serverTimeDiffPromise=t.serverTimeDiffPromise||e.getServerTime().catch((()=>0)),t.serverTimeDiffPromise.then((e=>{if(e&&(t.serverTimeDiff=(new Date).getTime()/1e3-e),(new Date).getTime()/1e3>=this.urlExpireTimestamp+t.serverTimeDiff){this.urlExpireTimestamp=(new Date).getTime()/1e3+86400;const e=new uo("network",oo[403]);this._emitExpireEvent(e)}})))}_emitExpireEvent(e){const{player:t}=this,n=(new Date).getTime()/1e3;return this.emitExpireTimestamp?n-this.emitExpireTimestamp>300&&(this.emitExpireTimestamp=n,t.emit("MEDIA_EXPIRED",e),!0):(this.emitExpireTimestamp=n,t.emit("MEDIA_EXPIRED",e),!0)}reportBugPostPlayerLog(){this.emit(ou)}}vu.isSupported=function(){return ul()&&ll()&&!al()},vu.isEMESupported=ol,vu.isSupportedWithXgmse=function(){return ll()&&!al()},vu.isMediaSourceSupported=ul,vu.isWebAssemblySupported=ll,vu.CUSTOM_EVENTS=ja;var yu=n(5267),_u=n(65350),Tu=n(27111),bu=n(90543),Su=n(80249),Pu=n(61906);const wu=e=>e<10?"0"+e:e,ku=(e,t=!1)=>{const n=[];let r=Math.floor(e/1e3),i=Math.floor(r/60);const s=Math.floor(i/24);return r-=60*i,i-=24*s,s&&n.push(wu(s)),n.push(wu(i)),n.push(wu(r)),t?n.join(":")+"."+(e/1e3).toFixed(3).split(".").pop():n.join(":")},Mu=Date.now(),Eu=()=>window.performance?performance.now():Date.now()-Mu,Ru=(Symbol.toStringTag,e=>"[object Object]"===Object.prototype.toString.call(e)),xu=(e,t)=>{const n=Object.assign({},e);return Object.keys(t).forEach((r=>{if(void 0===e[r]){const e=t[r];Ru(n[r])&&Ru(e)?n[r]=xu(n[r],e):n[r]=e}})),n},Du=Object.freeze(Object.defineProperty({__proto__:null,combineDefaultOptions:xu,isObject:Ru},Symbol.toStringTag,{value:"Module"})),Iu=()=>!!(typeof window<"u"&&window.document),Cu={trace:0,debug:1,log:2,info:3,warn:4,error:5},Lu={0:"",1:"gray",2:"",3:"lightblue",4:"",5:""},Ou=[];let Au=4,Gu=0,Bu=!1,Nu=2e3,$u=[],Uu=0;const Fu=Object.keys(Cu);class Hu{constructor(e){this.__level=Au,this.__mode=Gu,this.__styled=Bu,this.__name=e,this.__apply(),Ou.push(this)}formatArgs(e,t,n){if(!this.__styled)return n.unshift(t),n;const r=[`%c${t}`],i=[`color:${Lu[e]}`];return n.forEach((e=>{"number"==typeof e?(e%1==0?r.push("[35;2;200;80;244m%d[39m"):r.push("[35;2;200;80;244m%f[39m"),i.push(e)):e instanceof Node?(r.push("%o"),i.push(e)):"object"==typeof e?(r.push("%O"),i.push(e)):r.push(e)})),i.unshift(r.join(" ")),i}__apply(){1===this.__mode?Fu.forEach((e=>{Cu[e]>=this.__level&&(this[e]=(...t)=>{const n=`[${e}][${this.__name}][${ku(Eu(),!0)}]`;$u.push({id:Uu++,level:e,name:this.__name,prefix:n,timestamp:Date.now(),message:t.join(" ")}),$u.length>Nu&&$u.shift()})})):0===this.__mode&&Fu.forEach((e=>{const t=Cu[e];t>=this.__level&&(this[e]=(...n)=>{var r;const i=`[${ku(Eu(),!0)}][${e}][${this.__name}]`;null==(r=console[e])||r.apply(console,this.formatArgs(t,i,n))})}))}trace(...e){}debug(...e){}log(...e){}info(...e){}warn(...e){}error(...e){}setName(e){this.__name=e}setMode(e){this.__mode=e,this.__apply()}setLevel(e){this.__level=e,this.__apply()}setStyled(e){this.__styled=e}reset(){this.__level=4,this.__mode=0}}const Vu={createLogger:e=>new Hu(e),getLogs:()=>$u,setSize(e){Nu=e},setMode(e){Gu=e,Ou.forEach((t=>t.setMode(e)))},setLevel(e){Au=e,Ou.forEach((t=>t.setLevel(e)))},setStyled(e){Bu=e,Ou.forEach((t=>t.setStyled(e)))},reset(){Ou.forEach((e=>e.reset())),$u=[]}};try{const e=Iu(),t=e?localStorage.getItem("ttplayer_logger_level"):"",n=e?localStorage.getItem("ttplayer_logger_mode"):"",r=e?localStorage.getItem("ttplayer_logger_styled"):"";"string"==typeof t&&Vu.setLevel(parseInt(t,10)),"string"==typeof n&&Vu.setMode(parseInt(n,10)),("1"===r||"true"===r)&&Vu.setStyled(!0)}catch{}const ju=class{constructor(){this._eventMap=new Map,this._blockMap=new Map}emit(e,...t){const n=this._eventMap.get(e);let r=!0;if(n)for(let e=0,i=n.length;e<i;e++)!1===n[e].apply(this,t)&&(r=!1);return r}once(e,t){const n=(...r)=>(this.off(e,n),t.apply(this,r));this.on(e,n)}dedup(e,t){const n=this._eventMap.get(e);n?n.every((e=>e!==t))&&n.push(t):this._eventMap.set(e,[t])}on(e,t){this._eventMap.has(e)?this._eventMap.get(e).push(t):this._eventMap.set(e,[t])}off(e,t){this._eventMap.has(e)&&(t?this._eventMap.set(e,this._eventMap.get(e).filter((e=>e!==t))):this._eventMap.delete(e))}removeAllListeners(){this._eventMap.clear()}block(...e){e.forEach((e=>{const t=this._eventMap.get(e);t&&(this._blockMap.set(e,t),this._eventMap.delete(e))}))}unblock(...e){e.forEach((e=>{const t=this._blockMap.get(e);t&&(this._eventMap.set(e,t),this._blockMap.delete(e))}))}};ju.remap=(e,t,n)=>Object.keys(n).map((r=>{const i=(...e)=>t.emit(n[r],...e);return e.on(r,i),()=>e.off(r,i)}));let zu=ju;class Xu extends zu{constructor(e={}){super(),this._lastUpdateTime=0,this._cacheSpeeds=[],this._logger=Vu.createLogger("network-speed"),this._timeout=6e5,this._unit=1024,this._timeout=e.timeout||this._timeout}_calculateSpeed(e,t){const n=e/this._unit/t;n<=0||n===1/0?this._logger.warn(`invalid speed: ${n}`):(this._cacheSpeeds.push(n),this._cacheSpeeds.length>10&&this._cacheSpeeds.shift(),this.emit("downloaded",{byteSpeed:n,byteLength:e,duration:t,timescale:1}))}start(){this._lastUpdateTime=Eu()}download(e){const t=Eu(),n=(t-this._lastUpdateTime)/1e3;this._lastUpdateTime=t,n>this._timeout?this._logger.warn(`time diff: ${n}`):this._calculateSpeed(e,n)}getAverageSpeed(){return this._cacheSpeeds.reduce(((e,t)=>e+t),0)/this._cacheSpeeds.length}getLatestSpeed(){return this._cacheSpeeds[this._cacheSpeeds.length-1]}reset(){this._cacheSpeeds=[],this._lastUpdateTime=0}}var Ku=n(67975),Wu=n(61978);const Qu="ttplayer-poster";class qu{constructor(e){this.__timer=-1,this.__faded=!1,this.__src="",this.__objectFit="contain",this.visible=!1;const t=document.createElement("div");t.className=Qu,this.__el=t,this.src=e}get src(){return this.__src}set src(e){this.__src=e,this.__el.style.backgroundImage=`url(${e})`}set objectFit(e){const t="fill"===e?"100% 100%":e;this.__el.style.backgroundSize=t,this.__objectFit=e}get objectFit(){return this.__objectFit}updateStyle(e){Object.keys(e).forEach((t=>{"objectFit"===t?this.objectFit=e[t]:this.__el.style[t]=e[t]}))}show(e){this.visible||(this.visible=!0,this.__el.className=Wu(Qu,"ttplayer-show"),null==e||e())}hide(e={},t){const n=!0===e.fade;if(this.visible){const r=Wu(Qu,n&&"ttplayer-fade");this.__timer>=0&&window.clearTimeout(this.__timer),e.delay?this.__timer=window.setTimeout((()=>{this.__timer=-1,this.visible=!1,this.__el.className=r,this.__faded=n,null==t||t()}),e.delay):(this.visible=!1,this.__el.className=r,this.__faded=n,null==t||t())}else this.__faded&&!n&&(this.__faded=!1,this.__el.className=Qu)}attach(e){e.appendChild(this.__el)}detach(){var e;this.__faded=!1,window.clearTimeout(this.__timer),null==(e=this.__el.parentNode)||e.removeChild(this.__el)}}const Yu="ttplayer-videohide";var Ju=(e=>(e.CANPLAY="canplay",e.TIMEUPDATE="timeupdate",e))(Ju||{});class Zu extends zu{constructor(e){super(),this.HideTrigger=Ju,this.__logger=Vu.createLogger("poster"),this.__updatedStyle={},this.__posters=[],this.__src="",this.__visible=!1,this.__autoPause=!1,this.__autoMute=!0,this.__hideOptions={fade:!0,delay:0,trigger:"canplay"},this.__selfCallPaused=!1,this.__handleSrcPreSetter=()=>{this.show()},this.__handleSeekPreSetter=()=>{this.__controller.removePreSetter("currentTime",this.__handleSeekPreSetter),this.hide()},this.__handlePausePreGetter=(e,t)=>()=>{t(),this.__selfCallPaused=!1,this.__controller.replaceGetter("pause",null)},this.__handleMutePreSetter=(e,t,n)=>{this.__reservedMuted=n},this.__handleLoadedData=()=>{const{trigger:e}=this.__tempHideOptions||this.__hideOptions;"timeupdate"===e?this.__controller.dedup("timeupdate",this.__handleTimeUpdateWithPoster):"canplay"===e&&this.__controller.dedup("canplay",this.__handleCanplay),this.__video.autoplay&&this.__togglePauseVideo(!1)},this.__handleCanplay=()=>{this.__controller.off("canplay",this.__handleCanplay),this.hide()},this.__handleTimeUpdateWithPoster=()=>{this.__controller.paused&&0===this.__controller.currentTime||(this.__controller.off("timeupdate",this.__handleTimeUpdateWithPoster),this.hide())};const{controller:t}=e;this.__controller=t,this.__video=t.getElement(),this.__container=document.createElement("div"),this.__styleContainer=document.createElement("style"),this.__styleContainer.innerHTML=".ttplayer-poster-enhance{position:static!important}.ttplayer-poster{position:absolute;top:0;left:0;width:100%;height:100%;background-position:center center;background-repeat:no-repeat;background-size:contain;pointer-events:none;z-index:1;opacity:0}.ttplayer-poster.ttplayer-fade{transition:opacity .3s ease-out 0s}.ttplayer-poster.ttplayer-hide{opacity:0}.ttplayer-poster.ttplayer-show{opacity:1}.ttplayer-videohide{visibility:hidden}",document.head.appendChild(this.__styleContainer),t.addPreSetter("src",this.__handleSrcPreSetter)}__togglePauseVideo(e){const{delay:t}=this.__hideOptions;if(!(this.__autoPause&&t>0))return;const n=this.__video;e?(n.paused||(n.pause(),this.__selfCallPaused=!0,this.__logger.info("since autoPause=true, the video is paused automatically")),this.__controller.replaceGetter("pause",this.__handlePausePreGetter)):n.paused&&this.__selfCallPaused&&(this.__controller.replaceGetter("pause",null),n.play(),this.__selfCallPaused=!1,this.__logger.info("resume playback automatically when the poster is hidden",n.paused))}__toggleMuteVideo(e){const{delay:t}=this.__hideOptions;if(!(this.__autoMute&&t>0))return;const n=this.__video;e?(void 0===this.__reservedMuted&&(this.__reservedMuted=n.muted),n.muted=!0,this.__controller.removePreSetter("muted",this.__handleMutePreSetter),this.__controller.addPreSetter("muted",this.__handleMutePreSetter),this.__logger.info("since autoMute=true, the video is muted automatically")):void 0!==this.__reservedMuted&&(this.__controller.removePreSetter("muted",this.__handleMutePreSetter),n.muted=this.__reservedMuted,this.__reservedMuted=void 0,this.__logger.info("restore the muted state of the video",n.muted))}__setVideoVisible(e){const t=this.__video;this.src&&(e?t.className=t.className.replace(new RegExp("\\s*?"+Yu,"g"),""):-1===t.className.indexOf(Yu)&&(t.className=Wu(t.className,Yu)))}__createPoster(e){const t=new qu(e);return this.__updatedStyle&&t.updateStyle(this.__updatedStyle),t.attach(this.__container),t}__appendToCache(e){this.__posters.some((t=>t.src===e))||(this.__posters.length?this.__posters[0].src=e:this.__posters.push(this.__createPoster(e)))}__forceShow(e){this.__posters.forEach((t=>{t.src===this.__src?t.show(e):t.hide()}));try{this.emit("show")}catch(e){console.error(e)}}set hideTrigger(e){this.__hideOptions.trigger=e}get hideTrigger(){return this.__hideOptions.trigger}set fade(e){this.__hideOptions.fade=e}get fade(){return this.__hideOptions.fade}set delay(e){this.__hideOptions.delay=e}get delay(){return this.__hideOptions.delay}set autoPause(e){this.__autoPause=e}set autoMute(e){this.__autoMute=e}get visible(){return this.__visible}set src(e){this.__src=e,this.__appendToCache(e),this.__visible&&this.__forceShow()}get src(){return this.__src}set objectFit(e){this.__updatedStyle.objectFit=e,this.__posters.forEach((t=>{t.objectFit=e}))}get objectFit(){return this.__updatedStyle.objectFit}set cache(e){const t=new Set(e),n=[],r=this.__posters.filter((e=>t.has(e.src)?(t.delete(e.src),!0):!!e.visible||void n.push(e)));this.__posters=r.concat(Array.from(t).map((e=>{const t=n.pop();return t?(t.src=e,t):this.__createPoster(e)}))),n.forEach((e=>e.detach()))}get cache(){return this.__posters.map((e=>e.src))}show(e){this.__tempHideOptions=void 0,this.__controller.removePreSetter("currentTime",this.__handleSeekPreSetter),this.__controller.addPreSetter("currentTime",this.__handleSeekPreSetter),this.__controller.off("loadeddata",this.__handleLoadedData),this.__controller.once("loadeddata",this.__handleLoadedData),this.__src&&!this.__visible&&(this.__visible=!0,this.__forceShow(e),this.__toggleMuteVideo(!0),this.__setVideoVisible(!1),this.__logger.info("poster showed, src:",this.__src))}hide(e){if(!this.__visible)return;this.__setVideoVisible(!0),this.__visible=!1,this.__togglePauseVideo(!0);const t=[];this.__posters.forEach((e=>{e.src===this.__src?t.push(e):e.hide()}));const n=()=>{this.__toggleMuteVideo(!1),this.__togglePauseVideo(!1),null==e||e(),this.__logger.info("poster hided, src:",this.__src,this.__tempHideOptions);try{this.emit("hide")}catch(e){console.error(e)}};t.length?t.forEach((e=>{e.hide(this.__tempHideOptions||this.__hideOptions,n)})):n()}setTempHideOptions(e){this.__tempHideOptions=Du.combineDefaultOptions(e,this.__hideOptions)}preventDefault(){this.__controller.removePreSetter("src",this.__handleSrcPreSetter)}attach(e){e.appendChild(this.__container)}destroy(){var e;document.head.removeChild(this.__styleContainer),this.__posters.forEach((e=>e.detach())),this.__controller.off("canplay",this.__handleCanplay),this.__controller.off("timeupdate",this.__handleTimeUpdateWithPoster),this.__controller.off("loadeddata",this.__handleLoadedData),this.__controller.replaceGetter("paused",null),this.__controller.removePreSetter("muted",this.__handleMutePreSetter),this.__controller.removePreSetter("src",this.__handleSrcPreSetter),this.__controller.removePreSetter("currentTime",this.__handleSeekPreSetter),null==(e=this.__container.parentNode)||e.removeChild(this.__container)}}var ec=(e=>(e.POSTER="poster",e))(ec||{}),tc=(e=>(e[e.NETWORK=2100]="NETWORK",e[e.NETWORK_TIMEOUT=2101]="NETWORK_TIMEOUT",e[e.NETWORK_FORBIDDEN=2103]="NETWORK_FORBIDDEN",e[e.DEMUX_MP4=3300]="DEMUX_MP4",e[e.REMUX_FMP4=4100]="REMUX_FMP4",e[e.MEDIA_ABORTED=5101]="MEDIA_ABORTED",e[e.MEDIA_NETWORK=5102]="MEDIA_NETWORK",e[e.MEDIA_DECODE=5103]="MEDIA_DECODE",e[e.MEDIA_SRC_NOT_SUPPORTED=5104]="MEDIA_SRC_NOT_SUPPORTED",e[e.MEDIA_UNSUPPORT=5105]="MEDIA_UNSUPPORT",e[e.MEDIA_EMPTY_SRC=5106]="MEDIA_EMPTY_SRC",e[e.MEDIA_MSE_ADD_SB=5200]="MEDIA_MSE_ADD_SB",e[e.MEDIA_MSE_SB_APPEND=5201]="MEDIA_MSE_SB_APPEND",e[e.MEDIA_MSE_OTHER=5202]="MEDIA_MSE_OTHER",e[e.MEDIA_MSE_OVERFLOW=5203]="MEDIA_MSE_OVERFLOW",e[e.MEDIA_MSE_HIJACKED=5204]="MEDIA_MSE_HIJACKED",e[e.MEDIA_MSE_SB_CHANGE_TYPE=5205]="MEDIA_MSE_SB_CHANGE_TYPE",e[e.MEDIA_MSE_SB_REMOVE=5206]="MEDIA_MSE_SB_REMOVE",e[e.OTHER=8e3]="OTHER",e[e.OTHER_PARAMS=8100]="OTHER_PARAMS",e[e.RUNTIME_NO_CANPLAY=9001]="RUNTIME_NO_CANPLAY",e[e.RUNTIME_BUFFER_BREAK=9002]="RUNTIME_BUFFER_BREAK",e[e.RUNTIME_WAITING_TIMEOUT=9003]="RUNTIME_WAITING_TIMEOUT",e))(tc||{});const nc=class e extends Error{constructor(e,t){super(t),this.name="PlayerError",this.code=e,this.category=tc[e],this.message=t||this.category}static fromMediaError(t){switch(t.code){case 1:return new e(5101,t.message);case 2:return new e(5102,t.message);case 3:return new e(5103,t.message);case 4:return new e(5104,t.message);default:return new e(8e3,t.message)}}};nc.Code=tc;let rc=nc;const ic=["playnext","exception"],sc=["canplay","canplaythrough","durationchange","emptied","ended","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","stalled","suspend","seeked","seeking","resize","timeupdate","volumechange","waiting"];class ac extends zu{constructor(e){super(),this._logger=Vu.createLogger("controller"),this.__replacedGetterMap=new Map,this.__replacedSetterMap=new Map,this.__preSetterMap=new Map,this.__videoOffCallbackMap=new Map,this.__remapOffCallbacks=[],this.__videoEventProxyMap=new Map,this.__currSourceIndex=0,this.willEmitEventNameSet=new Set,this.__handleSrcPreSetter=(e,t,n)=>{Array.isArray(n)?(this.__sources=n,this.__currSourceIndex=0):this.__sources=void 0},this.processError=()=>{const e=this.__core.error?rc.fromMediaError(this.__core.error):new rc(rc.Code.OTHER,"The error event was triggered, but video.error is null");if(this.__sources)if(this.__currSourceIndex++,this.__currSourceIndex<this.__sources.length){const t=this.__core.currentTime;this.__core.src=this.__sources[this.__currSourceIndex].url,this.__core.load(),this.__core.currentTime=t,this.__core.play(),this.emit("exception",e)}else this.emit("error",e);else this.emit("error",e)},this.play=async()=>new Promise((e=>{this.__core.play().then((()=>{e(null)})).catch((t=>{this._logger.warn(t),e(t)}))})),this.pause=()=>this.__core.pause();const t=Ku(e,{objectFit:"contain"}),{objectFit:n,attributes:r,...i}=t,s=document.createElement("video");return s instanceof HTMLVideoElement&&(r&&Object.keys(r).forEach((e=>{s.setAttribute(e,r[e])})),s.setAttribute("data-version","0.3.1"),s.style.width="100%",s.style.height="100%",s.style.verticalAlign="middle"),this.coreName="video-element",this.coreVersion="",this.__core=s,this.__bindEvents(),Object.assign(this,i),e.container.appendChild(s),this.__posterManager=new Zu({controller:this}),this.__posterManager.attach(t.container),this.addPreSetter("src",this.__handleSrcPreSetter),new Proxy(this,{set:(e,t,n)=>{if(0===t.indexOf("_"))return e[t]=n,!0;const r=this.__preSetterMap.get(t);if(r&&r.some((r=>!1===r(e,e[t],n))))return!0;const i=this.__replacedSetterMap.get(t);return i?i(e,e[t],n):e[t]!==n&&(e[t]=n,this.emit("update",t,e[t],n)),!0},get:(e,t)=>{if(0===t.indexOf("_"))return e[t];const n=this.__replacedGetterMap.get(t);return n?n(e,e[t]):e[t]}})}__bindVideoEvent(e,t){this.__videoOffCallbackMap.has(e)||(this.__core.addEventListener(e,t,!1),this.__videoOffCallbackMap.set(e,(()=>{this.__core.removeEventListener(e,t,!1)})))}__bindEvents(){sc.forEach((e=>{this.__bindVideoEvent(e,(()=>this.emit(e))),this.willEmitEventNameSet.add(e)})),ic.forEach((e=>{this.willEmitEventNameSet.add(e)})),[{onName:"error",emitName:"error",callback:this.processError}].forEach((e=>{this.__videoEventProxyMap.set(e.onName,e),this.__bindVideoEvent(e.onName,e.callback),this.willEmitEventNameSet.add(e.emitName)})),zu.remap(this,this,{loadedmetadata:"update",play:"update",pause:"update",volumechange:"update",ratechange:"update"}).forEach((e=>{this.__remapOffCallbacks.push(e)}))}getInternalModule(e){if(e===ec.POSTER)return this.__posterManager;throw new rc(rc.Code.OTHER_PARAMS,`Module [${e}] not found, please use InternalModuleName as parameter`)}getElement(){return this.__core}getCore(){return this.__core}addPreSetter(e,t){const n=this.__preSetterMap.get(e);n?n.push(t):this.__preSetterMap.set(e,[t])}removePreSetter(e,t){const n=this.__preSetterMap.get(e);n&&n.length&&this.__preSetterMap.set(e,n.filter((e=>e!==t)))}replaceSetter(e,t){t?this.__replacedSetterMap.set(e,t):this.__replacedSetterMap.delete(e)}replaceGetter(e,t){t?this.__replacedGetterMap.set(e,t):this.__replacedGetterMap.delete(e)}disableEvents(e){e.forEach((e=>{const t=this.__videoOffCallbackMap.get(e);t&&(t(),this.__videoOffCallbackMap.delete(e))}))}enableEvents(e){e.forEach((e=>{const t=this.__videoEventProxyMap.get(e);t?this.__bindVideoEvent(e,t.callback):this.__bindVideoEvent(e,(()=>this.emit(e)))}))}get videoWidth(){return this.__core.videoWidth}get videoHeight(){return this.__core.videoHeight}get objectFit(){return this.__core.style.objectFit}set objectFit(e){this.__core.style.objectFit=e}get error(){return this.__core.error}get buffered(){return this.__core.buffered}get duration(){return this.__core.duration}get paused(){return this.__core.paused}get ended(){return this.__core.ended}get rawSrc(){return this.currentSrc}get currentSrc(){return this.__core.currentSrc}set src(e){this.emit("playnext"),Array.isArray(e)?e.length>0&&(this.__core.src=e[this.__currSourceIndex].url):this.__core.src=e}get src(){return this.__core.src||""}set sources(e){this.__sources=e,this.__currSourceIndex=0}get sources(){return this.__sources}set sourceIndex(e){this.__currSourceIndex=e}get sourceIndex(){return this.__currSourceIndex}set poster(e){this.__posterManager.src=e}get poster(){return this.__posterManager.src}set autoplay(e){this.__core.autoplay=e}get autoplay(){return this.__core.autoplay}set crossOrigin(e){this.__core.crossOrigin=e}get crossOrigin(){return this.__core.crossOrigin}set currentTime(e){this.__core.currentTime=e}get currentTime(){return this.__core.currentTime}set volume(e){this.__core.volume=e}get volume(){return this.__core.volume}set muted(e){this.__core.muted=e}get muted(){return this.__core.muted}set playbackRate(e){this.__core.playbackRate=e}get playbackRate(){return this.__core.playbackRate}set loop(e){this.__core.loop=e}get loop(){return this.__core.loop}set lang(e){this.__core.lang=e}get lang(){return this.__core.lang}set preload(e){this.__core.preload=e}get preload(){return this.__core.preload}destroy(){var e;this.__remapOffCallbacks.forEach((e=>e())),this.__remapOffCallbacks=[],this.__videoOffCallbackMap.forEach((e=>e())),this.__videoOffCallbackMap.clear(),this.__videoEventProxyMap.clear(),this.removeAllListeners(),this.__posterManager.destroy(),this.__preSetterMap.clear(),this.__replacedSetterMap.clear(),this.__replacedGetterMap.clear(),this.__core.src="",this.__core.load(),null==(e=this.__core.parentNode)||e.removeChild(this.__core)}}class oc{constructor(e){var t;this.__logger=Vu.createLogger("plugin-manager"),this.__map=new Map,this.__context={...e.context,pluginManager:this},null==(t=e.plugins)||t.forEach((e=>{e&&this.register(e)}))}get(e){return this.__map.get(e)}register(e){this.__map.has(e.name)?this.__logger.warn(`[${e.name}] already exists`):(e.install(this.__context),this.__map.set(e.name,e),this.__logger.info(`[${e.name}] has been registered`))}unregister(e){const t="string"==typeof e?e:e.name,n=this.__map.get(t);n&&(this.__map.delete(t),n.uninstall(this.__context),this.__logger.info(`[${n.name}] has been unregistered`))}destroy(){this.__map.forEach((e=>{e.uninstall(this.__context),this.__logger.info(`[${e.name}] has been uninstalled`)})),this.__map.clear()}}const lc=typeof window<"u"&&window.document,uc=Vu.createLogger("ttplayer"),cc=!!lc&&"true"===localStorage.getItem("ttplayer_record_event"),hc=class extends zu{constructor(e){super(),this.getInternalModule=e=>this.__controller.getInternalModule(e);const t=[];if(e.plugins)for(const n of e.plugins)n&&n.name&&n.install&&t.push(n);const{src:n,...r}=e;this.__controller=new ac(Object.assign(r)),this.__controller.willEmitEventNameSet.forEach((e=>{this.__controller.on(e,((...t)=>{this.emit(e,...t)}))})),cc&&this._enableDebugLog(),this.__pluginManager=new oc({context:{container:e.container,controller:this.__controller},plugins:t}),n&&(this.__controller.src=n)}_enableDebugLog(){const e=["timeupdate","progress","durationchange"];let t="",n=0;this.__controller.willEmitEventNameSet.forEach((r=>{this.__controller.on(r,(()=>{t!==r&&(e.includes(r)?n++:n=0,n<e.length+1&&uc.log("event emitted -",r)),t=r}))}))}getElement(){return this.__controller.getElement()}getPlugin(e){return this.__pluginManager.get(e)}get coreName(){return this.__controller.coreName}get coreVersion(){return this.__controller.coreVersion}get error(){return this.__controller.error}get buffered(){return this.__controller.buffered}get duration(){return this.__controller.duration}get paused(){return this.__controller.paused}get ended(){return this.__controller.ended}get rawSrc(){return this.__controller.rawSrc}get currentSrc(){return this.__controller.currentSrc}set src(e){this.__controller.src=e}get src(){return this.__controller.src}set poster(e){this.__controller.poster=e}get poster(){return this.__controller.poster}set autoplay(e){this.__controller.autoplay=e}get autoplay(){return this.__controller.autoplay}set crossOrigin(e){this.__controller.crossOrigin=e}get crossOrigin(){return this.__controller.crossOrigin}set currentTime(e){this.__controller.currentTime=e}get currentTime(){return this.__controller.currentTime}set volume(e){this.__controller.volume=e}get volume(){return this.__controller.volume}set muted(e){this.__controller.muted=e}get muted(){return this.__controller.muted}set playbackRate(e){this.__controller.playbackRate=e}get playbackRate(){return this.__controller.playbackRate}set objectFit(e){this.__controller.objectFit=e}get objectFit(){return this.__controller.objectFit}get videoWidth(){return this.__controller.videoWidth}get videoHeight(){return this.__controller.videoHeight}set loop(e){this.__controller.loop=e}get loop(){return this.__controller.loop}set lang(e){this.__controller.lang=e}get lang(){return this.__controller.lang}play(){return this.__controller.play()}pause(){this.__controller.pause()}set preload(e){this.__controller.preload=e}destroy(){this.removeAllListeners(),this.__pluginManager.destroy(),this.__controller.destroy()}};hc.InternalModuleName=ec;let dc=hc;var fc=(e=>(e[e.IDLE=0]="IDLE",e[e.LOADING=1]="LOADING",e[e.LOAD_END=2]="LOAD_END",e[e.SUSPENDED=3]="SUSPENDED",e[e.ERROR=4]="ERROR",e))(fc||{});class pc extends zu{constructor(e={}){super(),this._status=0,this.network=new Xu,this.pos=0,this.total=1/0,this.url="",this.$options=Du.combineDefaultOptions(e,{timeout:6e4})}_handleError(e){"AbortError"!==e.name&&(this.abort(),this._status=4,this.$logger.error(e),this.emit("error",e))}_changeStatus(e){this._status=e}async _getFinalRequestParams(e,t){const{onBeforeRequest:n}=this.$options;if(n){const r=await n(this.url,t);r&&(e=r.url||e,t=r.params||t)}return{requestURL:e,requestParams:t}}changeOptions(e){e&&(this.$options=Du.combineDefaultOptions(e,this.$options))}changeUrl(e){this.url!==e&&(this.$logger.info(`change url: ${this.url} -> ${e}`),this.url=e,this._changeStatus(3))}getOptions(){return this.$options}get status(){return this._status}jump(e){this.pos=e}load(e,t,n){return this.reset(),this.url=e,this.loadRange(t,n)}reset(){this.abort(),this.pos=0,this.total=1/0,this.url="",this.network.reset()}destroy(){this.network.removeAllListeners(),this.removeAllListeners(),this.reset()}}class gc extends pc{constructor(){super(...arguments),this.$logger=Vu.createLogger("fetch-loader"),this.__timer=-1,this.__handleTimeout=()=>{this.abort(),this._handleError(new rc(rc.Code.NETWORK_TIMEOUT,"Request timed out, please try again"))},this.__read=async e=>{for(this.__reader=e;;){const t=await e.read();if(!this.__reader)return;if(t.done)return this.__reader=void 0,this.__abortController=void 0,this._changeStatus(fc.LOAD_END),void this.emit("loadend");{const e=this.pos;this.pos+=t.value.byteLength,this.network.download(t.value.byteLength),this.emit("loadeddata",{pos:e,data:t.value})}}}}static isSupported(){return typeof AbortController<"u"&&typeof ReadableStream<"u"}__cancel(){clearTimeout(this.__timer),this.__reader&&(this.__reader.cancel(),this.__reader=void 0),this.__abortController&&!this.__abortController.signal.aborted&&(this.__abortController.abort(),this.__abortController=void 0)}async loadRange(e=0,t=1/0){if(this.status===fc.LOADING)return;if(e>this.total)return void this.$logger.warn(`loadRange, start > total, start=${e} total=${this.total}`);if(e===this.total)return;const{timeout:n,credentials:r}=this.$options,i={},s=e>0||t<1/0;if(s){const n=this.total-1,r=Math.min(n,t);i.Range=`bytes=${e}-${r===n?"":r}`}this.__abortController=new AbortController,this._changeStatus(fc.LOADING),this.emit("loadstart"),void 0!==n&&(this.__timer=window.setTimeout(this.__handleTimeout,n));const{requestURL:a,requestParams:o}=await this._getFinalRequestParams(this.url,{method:"GET",headers:i,credentials:r,signal:this.__abortController.signal});return this.$logger.info(`load, start=${e} end=${t} url=${a}`),this.network.start(),fetch(a,o).then((t=>{var n,r;if(window.clearTimeout(this.__timer),403===t.status)throw new rc(rc.Code.NETWORK_FORBIDDEN,t.statusText);if(!s||416!==t.status&&200!==t.status||this.total!==1/0){if(t.status>=200&&t.status<300){if(this.pos=e,this.total=s?Number(null==(r=null==(n=t.headers.get("Content-Range"))?void 0:n.split("/"))?void 0:r[1])||this.total:Number(t.headers.get("Content-Length"))||this.total,t.body)return this.__read(t.body.getReader());throw new rc(rc.Code.NETWORK,"media stream data does not exist")}throw new rc(rc.Code.NETWORK,t.statusText)}this.$logger.warn(`loadRange, ${t.status}, pos=${this.pos}`),this.total=this.pos,this.emit("loadeddata",{pos:this.pos,data:new Uint8Array})})).catch((e=>{window.clearTimeout(this.__timer),this._handleError(e)}))}resume(){return this.status===fc.SUSPENDED||this.status===fc.LOAD_END?this.loadRange(this.pos):Promise.resolve()}suspend(){this.status===fc.LOADING&&(this.$logger.info(`suspend, url=${this.url}`),this.__cancel(),this._changeStatus(fc.SUSPENDED))}abort(){this.status!==fc.IDLE&&(this.$logger.info(`abort, url=${this.url}`),this.__cancel(),this._changeStatus(fc.IDLE))}}const mc=512e3;class vc extends pc{constructor(){super(...arguments),this.$logger=Vu.createLogger("xhr-loader"),this.__requestSeg=async(e,t)=>{const{credentials:n,timeout:r}=this.$options,i=e>0||t<1/0,s={};if(i){const n=this.total-1,r=Math.min(n,t);s.Range=`bytes=${e}-${r===n?"":r}`}const{requestURL:a,requestParams:o}=await this._getFinalRequestParams(this.url,{credentials:n,headers:s});return new Promise(((e,t)=>{const n=this.__xhr=new XMLHttpRequest;n.open("GET",a,!0),n.withCredentials="include"===o.credentials,n.responseType="arraybuffer",n.onreadystatechange=()=>{n.readyState===XMLHttpRequest.HEADERS_RECEIVED&&(n.status>=200&&n.status<300?this.total===1/0&&(i||(this.total=Number(n.getResponseHeader("Content-Length"))||this.total)):403===n.status?t(new rc(rc.Code.NETWORK_FORBIDDEN,n.statusText)):t(new rc(rc.Code.NETWORK,n.statusText)))},n.onload=()=>{e(new Uint8Array(n.response))},n.onerror=()=>{t(new rc(rc.Code.NETWORK,n.statusText))},n.ontimeout=()=>{t(new rc(rc.Code.NETWORK_TIMEOUT,"Request timed out, please try again"))},n.onabort=()=>{const e=new Error("Request aborted");e.name="AbortError",t(e)},n.timeout=r||0,this.network.start(),n.send()}))},this.__read=async(e,t)=>{let n=e;for(;;){if(n>=t)return;const e=await this.__requestSeg(n,Math.min(t,n+mc-1));if(!this.__xhr)return;if(this.network.download(e.byteLength),n+=e.byteLength,this.total===1/0&&e.byteLength<mc&&(this.total=n),this.pos=n,this.emit("loadeddata",{pos:n-e.byteLength,data:e}),n>=this.total||n>=t||0===e.byteLength)return this._changeStatus(fc.LOAD_END),void this.emit("loadend");if(await this.__waitForNextTick(10),!this.__xhr)return}}}__cancel(){this.__xhr&&(window.clearTimeout(this.__timer),this.__timer=void 0,this.__xhr.abort(),this.__xhr=void 0)}__waitForNextTick(e=0){return new Promise((t=>{this.__timer=window.setTimeout(t,e)}))}async loadRange(e=0,t=1/0){if(this.status!==fc.LOADING){if(e>this.total)return void this.$logger.warn(`loadRange, start > total, start=${e} total=${this.total}`);if(e===this.total)return;return this._changeStatus(fc.LOADING),this.emit("loadstart"),this.$logger.info(`load, start=${e} end=${t} url=${this.url}`),this.__read(e,t).catch(this._handleError)}}resume(){return this.status===fc.SUSPENDED||this.status===fc.LOAD_END?this.loadRange(this.pos):Promise.resolve()}suspend(){this.status===fc.LOADING&&(this.$logger.info(`suspend, url=${this.url}`),this.__cancel(),this._changeStatus(fc.SUSPENDED))}abort(){this.status!==fc.IDLE&&(this.$logger.info(`abort, url=${this.url}`),this.__cancel(),this._changeStatus(fc.IDLE))}}const yc=gc.isSupported()?gc:vc;let _c=yc;const Tc=e=>{_c=e||yc},bc=Vu.createLogger("mutex"),Sc=[],Pc=!!Iu()&&location.search.indexOf("debug_mutex")>-1;Iu()&&(window.__mutex_cache__=Sc);class wc{constructor(e){this._resolves=[],this._rejects=[],this.name=e,Pc&&Sc.push(this)}get locked(){return this._resolves.length>0}lock(){return new Promise(((e,t)=>{this._resolves.push(e),this._rejects.push(t)}))}unlock(e){this._resolves.length&&(this._rejects.shift(),this._resolves.shift()(e))}unlockAll(e){for(;this._resolves.length;)this._rejects.shift(),this._resolves.shift()(e)}throw(e){this._rejects.length&&(this._resolves.shift(),this._rejects.shift()(e))}releaseLock(){this._resolves.length&&bc.log(`releaseLock, name=${this.name}`),this._resolves=[],this._rejects=[]}}var kc=(e=>(e[e.EMPTY=0]="EMPTY",e[e.LOW=1]="LOW",e[e.NORMAL=2]="NORMAL",e[e.HIGH=3]="HIGH",e[e.FULL=4]="FULL",e))(kc||{});class Mc extends zu{constructor(e,t){super(),this._queue=[],this._changeLevel=e=>{if(this.level!==e){const t=this.level;this.level=e,this.emit("levelchange",e,t)}},this._estimatedMaxSize=t,this.level=0,this._algorithm=this._defaultLevelAlgorithm,this._readMutex=new wc(e+".queue.read"),this._writeMutex=new wc(e+".queue.write")}_defaultLevelAlgorithm(e,t){const n=this._queue.length;return t?n>=this._estimatedMaxSize?4:n>=.7*this._estimatedMaxSize?3:n>=.3*this._estimatedMaxSize?2:n>0?1:0:0===n?0:n<=.3*this._estimatedMaxSize?1:n<=.7*this._estimatedMaxSize?2:n<this._estimatedMaxSize?3:4}_calculateLevel(e,t){this._changeLevel(this._algorithm(e,t))}setMaxSize(e){this._estimatedMaxSize=e}setLevelAlgorithm(e){this._algorithm=e||this._defaultLevelAlgorithm}get size(){return this._queue.length}write(e){if(this._readMutex.locked)this._readMutex.unlock(e);else if(this._queue.push(e),this._calculateLevel(e,!0),4===this.level)return this._writeMutex.lock()}first(){return this._queue[0]}getAll(){return this._queue}read(){this._writeMutex.unlock();const e=this._queue.shift();return e&&this._calculateLevel(e,!1),e||this._readMutex.lock()}clear(){this._queue=[],this._changeLevel(0),this._writeMutex.unlock()}releaseRead(){this._readMutex.releaseLock()}releaseWrite(){this._writeMutex.releaseLock()}releaseLock(){this._writeMutex.releaseLock(),this._readMutex.releaseLock()}reset(){this.clear(),this.releaseLock()}}let Ec=0;const Rc=Vu.createLogger("coroutine"),xc=Iu()&&window.queueMicrotask?window.queueMicrotask.bind(window):e=>Promise.resolve().then(e);class Dc{static microTask(e){return xc(e)}static create(e){const{type:t="macro",title:n,onLoop:r,onError:i}=e;let s=!0,a=-1;const o=Ec++,l=`(${o}) ${n}`,u={title:n,id:o,get running(){return s},cancel(){Rc.log(l,a,"canceled"),s=!1,window.clearTimeout(a)}},c=e=>{u.cancel(),Rc.error(l,a,"onLoop error",e),i(e instanceof rc?e:new rc(rc.Code.OTHER,e.message))};return"macro"===t?(Rc.log(l,"created with macro task"),function e(){s&&(a=window.setTimeout((()=>r(u).then(e).catch(c)),0))}()):(Rc.log(l,"created with micro task"),function e(){s&&xc((()=>r(u).then(e).catch(c)))}()),u}}class Ic extends zu{constructor(e){super(),this._pipeTargets=[],this.name=e}changeName(e){this.name=e}_unsetPipeCoroutine(){var e;null==(e=this._pipeCoroutine)||e.cancel(),this._pipeCoroutine=void 0}pipe(e,t){return this._pipeTargets.push(e),this._pipeCoroutine||(this._pipeCoroutine=Dc.create({title:this.name+" --pipe--\x3e "+this._pipeTargets.map((e=>e.name)).join("/"),onLoop:async()=>{const e=await this.read();for(const n of this._pipeTargets)await n.write(t?t(e):e)},onError:e=>this.emit("error",e)})),e}unpipe(e){return this._pipeTargets=this._pipeTargets.filter((t=>t!==e)),0===this._pipeTargets.length&&this._unsetPipeCoroutine(),e}destroy(){this.removeAllListeners(),this._pipeTargets=[],this._unsetPipeCoroutine()}}let Cc=class extends Ic{constructor(e){super(e),this.size=1,this.stdout=new Mc(this.name,this.size)}read(){return this.stdout.read()}flush(){this.stdout.clear()}destroy(){super.destroy(),this.stdout.removeAllListeners(),this.stdout.reset(),this.flush()}};class Lc extends zu{constructor(e){super(),this.size=1,this.name=e,this.stdin=new Mc(this.name,this.size)}write(e){return this.stdin.write(e)}flush(){this.stdin.clear()}destroy(){this.removeAllListeners(),this.stdin.removeAllListeners(),this.stdin.reset(),this.flush()}}class Oc extends Ic{constructor(e){super(e),this.size=1,this.stdin=new Mc(this.name,this.size),this.stdout=new Mc(this.name,this.size)}_unsetCoroutine(){var e;null==(e=this._coroutine)||e.cancel(),this._coroutine=void 0}write(e){return this.stdin.write(e)}read(){return this.stdout.read()}suspend(){this.stdin.releaseRead(),this.stdout.releaseWrite(),this._unsetCoroutine()}resume(){this._unsetCoroutine(),this._coroutine=Dc.create({title:this.name+".transform",onLoop:async()=>{const e=await this.stdin.read(),t=await this.$transform(e);t&&await this.stdout.write(t)},onError:e=>this.emit("error",e)})}flush(){this.stdin.clear(),this.stdout.clear()}destroy(){super.destroy(),this.stdin.removeAllListeners(),this.stdout.removeAllListeners(),this.stdin.reset(),this.stdout.reset(),this._unsetCoroutine(),this.flush()}}var Ac=(e=>(e.LoadedMetadata="loadedmetadata",e.LoadedPackets="loadedpacket",e))(Ac||{});class Gc extends Cc{constructor(e){super(e.name),this._parsers=[],this._handleError=e=>{this.emit("error",e)},this._handleFirstLoadData=e=>{var t;const n=this._parsers.find((t=>t.probe(e.data)));if(n)this._activeParser?this._activeParser.constructor===n.constructor||(this._logger.info(`parserchange, ${(null==(t=this._activeParser)?void 0:t.name)||"N/A"} -> ${n.name}`),this._unbindParserEvents(this._activeParser),this._bindParserEvents(n)):this._bindParserEvents(n),this._activeParser=n,this._activeParser.setLoader(this._loader),this._activeParser.parse(e.data,e.pos);else{const e="no parser can probe the data";this._logger.error(e),this.emit("error",new rc(rc.Code.DEMUX_MP4,e))}},this._handleParserLoadedMetadata=e=>{this._logger.info("metadata loaded",e),this.stdout.write({done:!1,value:{type:Ac.LoadedMetadata,payload:e}})},this._handleParserLoadedPacket=({data:e})=>{this._logger.debug("packets loaded",e.length),this.stdout.write({done:!1,value:{type:Ac.LoadedPackets,payload:e}})},this._handleParserEos=()=>{this.stdout.write({done:!0})},this._logger=Vu.createLogger(e.name),this._loader=new _c(e.loaderOptions),this._parsers=e.parsers,this._resetLoaderEventListeners()}_resetLoaderEventListeners(){this._loader.removeAllListeners(),this._loader.on("error",this._handleError),this._loader.once("loadeddata",this._handleFirstLoadData)}_bindParserEvents(e){e.on("eos",this._handleParserEos),e.on("loadedpackets",this._handleParserLoadedPacket),e.on("loadedmetadata",this._handleParserLoadedMetadata)}_unbindParserEvents(e){e.off("eos",this._handleParserEos),e.off("loadedpackets",this._handleParserLoadedPacket),e.off("loadedmetadata",this._handleParserLoadedMetadata)}changeName(e){super.changeName(e),this._logger.setName(e)}changeOptions(e){this._parsers=e.parsers||this._parsers,this._loader.changeOptions(e.loaderOptions)}getLoader(){return this._loader}load(e){this._activeParser&&this._activeParser.reset(),this._resetLoaderEventListeners(),this._loader.load(e)}seek(e){this._activeParser&&this._activeParser.seek(e)}suspend(){this._loader.suspend()}resume(){this._loader.resume()}abort(){this._loader.abort()}reset(){super.flush(),this._loader.reset()}destroy(){super.destroy(),this._parsers.forEach((e=>e.destroy())),this._loader.destroy()}}class Bc{constructor(e,t,n){this.dv=new DataView(e),this.start=this.offset=t||this.dv.byteOffset,this.end=n?this.start+n:this.dv.byteLength}static fromUint8(e){return new Bc(e.buffer,e.byteOffset,e.byteLength)}static concatUint8s(e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.byteLength),0));let n=0;return e.forEach((e=>{t.set(e,n),n+=e.byteLength})),t}static concatUint8(...e){return this.concatUint8s(e)}get buffer(){return this.dv.buffer}get unreadLength(){return Math.max(this.end-this.offset,0)}get size(){return this.end-this.start}readFloat(e){let t=0;switch(e){case 4:t=this.dv.getFloat32(this.offset);break;case 8:t=this.dv.getFloat64(this.offset);break;default:throw new Error(`read ${e}-byte float is not supported`)}return this.offset+=e,t}back(e){this.offset-=e}skip(e){this.offset+=e}readInt(e){const t=this.offset;switch(this.offset+=e,e){case 1:return this.dv.getInt8(t);case 2:return this.dv.getInt16(t);case 4:return this.dv.getInt32(t);default:throw new Error(`read ${e}-byte integers is not supported`)}}read(e){const t=this.offset;switch(this.offset+=e,e){case 1:return this.dv.getUint8(t);case 2:return this.dv.getUint16(t);case 3:return(this.dv.getUint16(t)<<8)+this.dv.getUint8(t+2);case 4:return this.dv.getUint32(t);default:return this.back(e-4),this.read(e-4)+this.dv.getUint32(t)*Math.pow(256,e-4)}}write(e,t){const n=this.offset;switch(this.offset+=e,e){case 1:return this.dv.setUint8(n,t);case 2:return this.dv.setUint16(n,t);case 3:return this.dv.setUint8(n,t>>>16),this.dv.setUint16(n+1,65535&t);case 4:return this.dv.setUint32(n,t);default:throw new Error(`write ${e}-byte integers is not supported`)}}writeString(e){const t=e.length;for(let n=0;n<t;n++)this.dv.setUint8(this.offset+n,e.charCodeAt(n));this.offset+=t}readToBuffer(e){let t;return t=this.offset||e?this.dv.buffer.slice(this.offset,e?this.offset+e:this.end):this.dv.buffer,this.offset+=t.byteLength,t}readToUint8(e){const t=new Uint8Array(this.dv.buffer,this.offset,e||this.unreadLength);return this.offset+=t.byteLength,t}readString(e){let t=0,n="";for(;t<e;t++)n+=String.fromCharCode(this.dv.getUint8(this.offset)),this.offset++;return n}}class Nc{constructor(){this._bufs=[],this._timer=-1,this._called=!1}append(e){this._bufs.push(e)}download(e,t){this._called||(window.clearTimeout(this._timer),this._timer=window.setTimeout((()=>{const t=new Blob(this._bufs),n=window.URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=e,r.click(),window.URL.revokeObjectURL(n)}),t),this._called=!0)}}var $c=(e=>(e.FLV="FLV",e.MP4="MP4",e.HLS="HLS",e.DASH="DASH",e))($c||{}),Uc=(e=>(e.VIDEO="video",e.AUDIO="audio",e.UNKNOWN="unknown",e))(Uc||{});class Fc{constructor(e,t){this.offset=0,this.val=e,this.size=t}static fromByte(e,t){return new Fc(e.read(t),t<<3)}toUint8(){const e=this.size/8,t=new Uint8Array(e),n=this.offset;this.offset=0;for(let n=0;n<e;n++)t[n]=this.read(8);return this.offset=n,t}skip(e){this.offset+=e}read(e){const t=this.size-this.offset-e;if(t>=0){let n=0,r=0;if(this.offset+=e,this.size>31){for(;r<e;r++)n+=Math.pow(2,r);return this.val/Math.pow(2,t)&n}for(;r<e;r++)n+=1<<r;return this.val>>>t&n}throw new Error("the number of the read operation exceeds the total length limit of bits")}write(e,t){const n=this.size-this.offset-e;if(!(n>=0))throw new Error("the number of the write operation exceeds the total length limit of bits");this.offset+=e,this.size>31?this.val+=t<<n:this.val+=t*Math.pow(2,n)}}var Hc=(e=>(e[e.UNUSED=0]="UNUSED",e[e.NON_IDR_SLICE=1]="NON_IDR_SLICE",e[e.DP_A=2]="DP_A",e[e.DP_B=3]="DP_B",e[e.DP_C=4]="DP_C",e[e.IDR=5]="IDR",e[e.SEI=6]="SEI",e[e.SPS=7]="SPS",e[e.PPS=8]="PPS",e[e.DIVIDER=9]="DIVIDER",e[e.SEQUENCE_END=10]="SEQUENCE_END",e[e.STREAM_END=11]="STREAM_END",e[e.FILL=12]="FILL",e))(Hc||{});class Vc{constructor(e){const t=Fc.fromByte(e,1);this.forbiddenZeroBit=t.read(1),this.refIdc=t.read(2),this.type=t.read(5)}static extractType(e,t=0){return 31&e[t]}static isSlice(e){const t=this.extractType(e);return t>=1&&t<=5}}var jc=(e=>(e[e.TRAIL_N=0]="TRAIL_N",e[e.TRAIL_R=1]="TRAIL_R",e[e.TSA_N=2]="TSA_N",e[e.TSA_R=3]="TSA_R",e[e.STSA_N=4]="STSA_N",e[e.STSA_R=5]="STSA_R",e[e.RADL_N=6]="RADL_N",e[e.RADL_R=7]="RADL_R",e[e.RASL_N=8]="RASL_N",e[e.RASL_R=9]="RASL_R",e[e.VCL_N10=10]="VCL_N10",e[e.VCL_R11=11]="VCL_R11",e[e.VCL_N12=12]="VCL_N12",e[e.VCL_R13=13]="VCL_R13",e[e.VCL_N14=14]="VCL_N14",e[e.VCL_R15=15]="VCL_R15",e[e.BLA_W_LP=16]="BLA_W_LP",e[e.BLA_W_RADL=17]="BLA_W_RADL",e[e.BLA_N_LP=18]="BLA_N_LP",e[e.IDR_W_RADL=19]="IDR_W_RADL",e[e.IDR_N_LP=20]="IDR_N_LP",e[e.CRA=21]="CRA",e[e.VPS=32]="VPS",e[e.SPS=33]="SPS",e[e.PPS=34]="PPS",e[e.ACCESS_UNIT_DELIMITER=35]="ACCESS_UNIT_DELIMITER",e[e.EOS=36]="EOS",e[e.EOB=37]="EOB",e[e.FILLER_DATA=38]="FILLER_DATA",e[e.SEI=39]="SEI",e[e.SEI_SUFFIX=40]="SEI_SUFFIX",e[e.INVALID=64]="INVALID",e))(jc||{});class zc{constructor(e){const t=Fc.fromByte(e,2);this.forbiddenZeroBit=t.read(1),this.type=t.read(6),this.nuhLayerId=t.read(6),this.temporalId=t.read(3)-1}static extractType(e,t=0){return(126&e[t])>>1}static isSlice(e){const t=this.extractType(e);return t>=0&&t<=21}}class Xc{create(e,...t){const n=new Uint8Array(8),r=Bc.fromUint8(n),i=[n,...t.map((e=>new Uint8Array(e)))],s=i.reduce(((e,t)=>e+t.byteLength),0);return r.write(4,s),r.writeString(e),Bc.concatUint8s(i)}avc1(e){const t=e.sar,n=e.naluDatas.some((e=>zc.extractType(e)===jc.VPS)),r=new ArrayBuffer(78),i=new Bc(r);i.write(4,0),i.write(2,0),i.write(2,1),i.write(4,0),i.write(4,0),i.write(4,0),i.write(4,0),i.write(2,e.width),i.write(2,e.height),i.write(4,4718592),i.write(4,4718592),i.write(4,0),i.write(2,1);i.write(1,15),i.writeString("@byted/ttplayer"),i.skip(16),i.write(2,24),i.write(2,65535);const s=2===t.length?this.pasp(t[0],t[1]):new Uint8Array;return n?this.create("hvc1",r,this.hvcC(e),s):this.create("avc1",r,this.avcC(e),s)}avcC(e){const{naluDatas:t}=e,n=[],r=[];t.forEach((e=>{const t=Vc.extractType(e);t===Hc.SPS?n.push(e):t===Hc.PPS&&r.push(e)}));const i=e=>{const t=[e.length];return e.forEach((e=>{t.push(e.byteLength>>>8&255),t.push(255&e.byteLength),e.forEach((e=>t.push(e)))})),t},s=i(n),a=i(r),o=n[0]||[],l=new ArrayBuffer(5),u=new Bc(l);return u.write(1,1),u.write(1,o[1]||0),u.write(1,o[2]||0),u.write(1,o[3]||0),u.write(1,255),this.create("avcC",l,s,a)}btrt(){const e=new ArrayBuffer(12),t=new Bc(e);return t.write(4,1875072),t.write(4,3e6),t.write(4,3e6),this.create("btrt",e)}pasp(e,t){const n=new ArrayBuffer(8),r=new Bc(n);return r.write(4,e),r.write(4,t),this.create("pasp",n)}dinf(){return this.create("dinf",this.dref())}dref(){const e=new ArrayBuffer(8),t=new Bc(e);return t.write(4,0),t.write(4,1),this.create("dref",e,this.url())}esds(e){const{dsiData:t=new Uint8Array}=e,n=new ArrayBuffer(29+t.byteLength),r=new Bc(n);return r.write(4,0),r.write(1,3),r.write(1,23+t.byteLength),r.write(2,1),r.write(1,0),r.write(1,4),r.write(1,15+t.byteLength),r.write(1,64),r.write(1,21),r.write(3,0),r.write(4,96e3),r.write(4,96e3),t.byteLength>0&&(r.write(1,5),r.write(1,t.byteLength),t.forEach((e=>r.write(1,e)))),r.write(1,6),r.write(1,1),r.write(1,2),this.create("esds",n)}ftyp(){const e=new ArrayBuffer(16),t=new Bc(e);return t.writeString("isom"),t.write(4,1),t.writeString("isom"),t.writeString("avc1"),this.create("ftyp",e)}hdlr(e){const t=new ArrayBuffer(37),n=new Bc(t);return n.skip(8),e===Uc.VIDEO?n.writeString("vide"):e===Uc.AUDIO&&n.writeString("soun"),n.skip(12),e===Uc.VIDEO?n.writeString("VideoHandler"):e===Uc.AUDIO&&n.writeString("SoundHandler"),n.write(1,0),this.create("hdlr",t)}hvcC(e){const{naluDatas:t}=e,n=[],r=[],i=[];t.forEach((e=>{const t=zc.extractType(e);t===jc.VPS?n.push(e):t===jc.SPS?r.push(e):t===jc.PPS&&i.push(e)}));const s=(e,t)=>{const n=[128|e,t.length>>>8&255,255&t.length];return t.forEach((e=>{n.push(e.byteLength>>>8&255),n.push(255&e.byteLength),e.forEach((e=>n.push(e)))})),n},a=s(jc.VPS,n),o=s(jc.SPS,r),l=s(jc.PPS,i),u=new ArrayBuffer(23),c=new Bc(u),h=r.length?r[0]:[];c.write(1,1);for(let e=1;e<17;e++)c.write(1,h[e]||0);return c.write(1,248),c.write(1,248),c.write(2,0),c.write(1,15),c.write(1,3),this.create("hvcC",u,a,o,l)}mdat(e){return this.create("mdat",e)}mdhd(e){const t=new ArrayBuffer(24),n=new Bc(t);return n.write(4,0),n.write(4,0),n.write(4,0),n.write(4,e.timescale),n.write(4,0),n.write(2,21956),n.write(2,0),this.create("mdhd",t)}mdia(e){return this.create("mdia",this.mdhd(e),this.hdlr(e.type),this.minf(e))}mfhd(e){const t=new ArrayBuffer(8),n=new Bc(t);return n.write(4,0),n.write(4,e),this.create("mfhd",t)}minf(e){const t=e.type===Uc.VIDEO?this.vmhd():this.smhd();return this.create("minf",t,this.dinf(),this.stbl(e))}moof(e,t,n){const r=this.mfhd(t),i=new Map;let s=0;e.tracks.forEach((e=>i.set(e.type,[]))),n.forEach((e=>{const t=i.get(e.type);t&&(t.push(e),s++)}));const a=Array.from(i.values()).reduce(((e,t)=>t.length?e+1:e),0);let o=8+r.byteLength+60*a+16*s+8;const l=e.tracks.map((e=>{const t=i.get(e.type);if(t&&t.length){const n=this.traf(e,t,o);return o+=t.reduce(((e,t)=>e+t.data.byteLength),0),n}})).filter((e=>!!e));return this.create("moof",r,...l)}moov(e){const t=e.tracks.map((e=>this.trak(e)));return this.create("moov",this.mvhd(e),...t,this.mvex(e))}mp4a(e){const t=new ArrayBuffer(28),n=new Bc(t);return n.write(4,0),n.write(2,0),n.write(2,1),n.write(4,0),n.write(4,0),n.write(2,e.channelCount),n.write(2,e.sampleSize),n.write(4,0),n.write(2,e.sampleRate),n.write(2,0),this.create("mp4a",t,this.esds(e))}mvex(e){return this.create("mvex",...e.tracks.map((e=>this.trex(e))))}mvhd(e){const t=new ArrayBuffer(100),n=new Bc(t);return n.write(4,0),n.write(4,0),n.write(4,0),n.write(4,e.timescale),n.write(4,e.duration),n.write(2,1),n.skip(2),n.write(1,1),n.skip(1),n.skip(10),[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0].forEach((e=>n.write(1,e))),n.skip(24),n.write(4,4294967295),this.create("mvhd",t)}sdtp(e){const t=e.length,n=new ArrayBuffer(4+t),r=new Bc(n);r.write(4,0);for(let n=0;n<t;n++)r.write(1,e[n].flag);return this.create("sdtp",n)}smhd(){const e=new ArrayBuffer(8),t=new Bc(e);return t.write(4,0),t.write(4,0),this.create("smhd",e)}stbl(e){return this.create("stbl",this.stsd(e),this.stts(),this.stsc(),this.stsz(),this.stco())}stco(){const e=new ArrayBuffer(8),t=new Bc(e);return t.write(4,0),t.write(4,0),this.create("stco",e)}stsc(){const e=new ArrayBuffer(8),t=new Bc(e);return t.write(4,0),t.write(4,0),this.create("stsc",e)}stsd(e){const t=new ArrayBuffer(8),n=new Bc(t);return n.write(4,0),n.write(4,1),e.type===Uc.VIDEO?this.create("stsd",t,this.avc1(e)):e.type===Uc.AUDIO?this.create("stsd",t,this.mp4a(e)):this.create("stsd",t)}stsz(){const e=new ArrayBuffer(12),t=new Bc(e);return t.write(4,0),t.write(4,0),t.write(4,0),this.create("stsz",e)}stts(){const e=new ArrayBuffer(8),t=new Bc(e);return t.write(4,0),t.write(4,0),this.create("stts",e)}tkhd(e){const{width:t=0,height:n=0}=e,r=new ArrayBuffer(84),i=new Bc(r);return i.write(4,7),i.write(4,0),i.write(4,0),i.write(4,e.id),i.write(4,0),i.write(4,0),i.write(4,0),i.write(4,0),i.write(4,0),i.write(1,0),i.write(1,0),i.write(2,0),[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0].forEach((e=>i.write(1,e))),i.write(2,t),i.write(2,0),i.write(2,n),i.write(2,0),this.create("tkhd",r)}tfdt(e){const t=new ArrayBuffer(8),n=new Bc(t);return n.write(4,0),n.write(4,e),this.create("tfdt",t)}tfhd(e){const t=new ArrayBuffer(8),n=new Bc(t);return n.write(4,0),n.write(4,e),this.create("tfhd",t)}traf(e,t,n){const r=t.length?t[0].dts:0;return this.create("traf",this.tfhd(e.id),this.tfdt(r),this.trun(t,n))}trak(e){return this.create("trak",this.tkhd(e),this.mdia(e))}trex(e){const t=new ArrayBuffer(24),n=new Bc(t);return n.write(4,0),n.write(4,e.id),n.write(4,1),n.write(4,0),n.write(4,0),n.write(4,65535),this.create("trex",t)}trun(e,t){const n=e.length,r=new ArrayBuffer(12+16*n),i=new Bc(r);i.write(4,3841),i.write(4,e.length),i.write(4,t);for(let t=0;t<n;t++){const n=e[t];i.write(4,n.duration),i.write(4,n.data.byteLength),i.write(4,n.flag),i.write(4,n.pts-n.dts)}return this.create("trun",r)}vmhd(){const e=new ArrayBuffer(12),t=new Bc(e);return t.write(4,1),t.write(2,0),t.write(2,0),t.write(2,0),t.write(2,0),this.create("vmhd",e)}url(){const e=new ArrayBuffer(4);return new Bc(e).write(4,1),this.create("url ",e)}}var Kc=(e=>(e.InitSegmentCreated="init-segment-created",e.DataSegmentCreated="data-segment-created",e))(Kc||{});const Wc=()=>({formatType:$c.MP4,tracks:[],timescale:1e3,duration:0}),Qc=!!Iu()&&"1"===localStorage.getItem("ttplayer_debug_download")&&location.search.indexOf("debug_download")>-1;class qc extends Oc{constructor(e){super(e.name),this._generator=new Xc,this._metadata=Wc(),this._sequenceNumber=0,this._downloader=new Nc,this._logger=Vu.createLogger(e.name)}_patchMetadata(e){this._metadata=Object.assign(this._metadata,e)}_createInitSegment(){const e=Bc.concatUint8(this._generator.ftyp(),this._generator.moov(this._metadata));return Qc&&this._downloader.append(e),e}_createDataSegment(e){if(!e.length)return new Uint8Array;const t=[],n=this._metadata.tracks.map((t=>e.filter((e=>e.type===t.type)))),r=Array.prototype.concat.apply([],n);t.push(this._generator.moof(this._metadata,++this._sequenceNumber,r)),t.push(this._generator.mdat(Bc.concatUint8s(r.map((e=>e.data)))));const i=Bc.concatUint8s(t);return Qc&&(this._downloader.append(i),this._downloader.download("debug.mp4",5e3)),i}_getVideoRandomAccessPoints(e){const t=[];return e.forEach((e=>{e.isKeyframe&&e.type===Uc.VIDEO&&t.push(e.pts/e.timescale)})),t}createDataSegmentAction(e){const t=this._createDataSegment(e),n=e.filter((e=>e.type===Uc.VIDEO)),r=n[0],i=n[n.length-1],s=r?r.dts/r.timescale:0,a=i?(i.dts+i.duration)/i.timescale:r?r.dts+r.duration/r.timescale:0,o={type:Kc.DataSegmentCreated,raps:this._getVideoRandomAccessPoints(n),startDecodeTime:s,endDecodeTime:a,data:t};return this._logger.debug("$transform, type:",o.type,s,"-",a),o}$transform(e){const{value:t,done:n}=e;let r;if(n)return{done:n};if(t)switch(t.type){case Ac.LoadedMetadata:{this._patchMetadata(t.payload);const e=this._createInitSegment();r={type:Kc.InitSegmentCreated,metadata:t.payload,data:e},this._logger.debug("$transform, type:",r.type);break}case Ac.LoadedPackets:r=this.createDataSegmentAction(t.payload)}return r?{done:n,value:r}:void 0}changeName(e){super.changeName(e),this._logger.setName(e)}flush(){super.flush()}reset(){this.flush(),this._sequenceNumber=0,this._metadata=Wc()}}function Yc(e,t){const n=e.length;if(0!==n)for(let r,i,s=0;s<n;s++)if(r=e.start(s),i=e.end(s),r<=t&&i>=t)return{start:r,end:i}}function Jc(e){const t=e.tracks.find((e=>e.type===Uc.VIDEO));return t?t.codec.split(".")[0]:NaN}function Zc(e){const t=e.tracks.find((e=>e.type===Uc.VIDEO));return t?t.width/t.height:NaN}function eh(e){const t=[];return e.tracks.sort((e=>e.type===Uc.VIDEO?-1:1)).forEach((e=>{(e.type===Uc.AUDIO||e.type===Uc.VIDEO)&&t.push(e.codec)})),'video/mp4; codecs="'+t.join(",")+'"'}const th=typeof SourceBuffer<"u"&&!!SourceBuffer.prototype.changeType;class nh extends zu{constructor(e,t){super(),this._logger=Vu.createLogger("sbp"),this._allUpdatingMutex=new wc("sbp.allUpdateEnd"),this._pendingOperates=[],this._runningOperateCallbacks=[],this._notUpdatingCallbacks=[],this._handleError=e=>{this._emitError(new rc(rc.Code.MEDIA_MSE_OTHER,"mse source buffer error"))},this._emitError=e=>{this._logger.error(e),Dc.microTask((()=>this.emit("error",e)))},this._handleUpdateEnd=()=>{try{if(this._runningOperateCallbacks.length&&this._runningOperateCallbacks.shift()(),!this._sb.updating)for(;this._notUpdatingCallbacks.length;)this._notUpdatingCallbacks.shift()()}catch(e){return void(e instanceof rc?this._emitError(e):this._emitError(new rc(rc.Code.MEDIA_MSE_OTHER,e.message||"unknown error")))}this._prepareOperate(),this.emit("updateend")},this._prepareOperate=()=>{var e;if(this._sb.updating||null!=(e=this._video)&&e.error)return;const t=this._pendingOperates.shift();if(t){const e=t.mutex,n=t.callback;this._previousOperateType=t.type,n&&this._runningOperateCallbacks.push(n);try{switch(t.type){case"append":this._prepareAppend(t);break;case"flush":case"remove":this._prepareRemoveOrFlush(t);break;case"changeType":this._prepareChangeType(t);break;case"timestampOffset":this._prepareTimestampOffset(t)}null==e||e.unlock()}catch(t){null!=e&&e.locked?e.throw(t):this._emitError(new rc(rc.Code.MEDIA_MSE_OTHER,t.message))}}else this._allUpdatingMutex.unlock()},this._prepareRemoveOrFlush=e=>{const{start:t,end:n}=e;try{this._logger.debug("remove buffer:",t,"-",n),this._sb.remove(t,n)}catch(e){throw new rc(rc.Code.MEDIA_MSE_SB_REMOVE,e.message)}},this._prepareAppend=e=>{const{data:t}=e;try{this._logger.debug("append buffer:",t.byteLength),this._sb.appendBuffer(t.buffer)}catch(e){throw new rc(rc.Code.MEDIA_MSE_SB_APPEND,e.message)}},this._prepareChangeType=e=>{const{metadata:t}=e;try{const e=eh(t);this._sb.changeType(e),this._logger.info(`mimeType changed, ${this._extra.mimeType} -> ${e}`),this._extra={metadata:t,mimeType:e,videoCodec:Jc(t)}}catch(e){throw new rc(rc.Code.MEDIA_MSE_SB_CHANGE_TYPE,e.message)}},this._prepareTimestampOffset=e=>{const{timestampOffset:t}=e;try{this._sb.timestampOffset=t}catch(e){throw new rc(rc.Code.MEDIA_MSE_OTHER,e.message)}},this._sb=e,this._extra={metadata:t,mimeType:eh(t),videoCodec:Jc(t)},this._sb.addEventListener("updateend",this._handleUpdateEnd),this._sb.addEventListener("error",this._handleError)}static isSupportChangeType(){return th}get mimeType(){return this._extra.mimeType}get videoCodec(){return this._extra.videoCodec}getSourceBuffer(){return this._sb}abort(){if(this._sb.updating&&"append"===this._previousOperateType)try{this._sb.abort()}catch(e){this._logger.warn(e)}}seek(e){const t=!!Yc(this._sb.buffered,e);t||(this._pendingOperates=[]);const n=this._sb.buffered;for(let t,r,i=0,s=n.length;i<s;i++)t=n.start(i),r=n.end(i),(e<t||e>r)&&this._pendingOperates.push({type:"remove",start:t,end:r});return this._prepareOperate(),t}remove(e,t,n){this._pendingOperates.push({type:"remove",callback:n,start:e,end:t}),this._prepareOperate()}append(e,t){const n=new wc("sbp.append"),r=n.lock();return this._pendingOperates.push({type:"append",data:e,mutex:n,callback:t}),this._prepareOperate(),r}changeMetadata(e){const t=new wc("sbp.changeType"),n=t.lock();return this._pendingOperates.push({type:"changeType",metadata:e,mutex:t}),this._prepareOperate(),n}setTimestampOffset(e){this.abort(),this._pendingOperates.push({type:"timestampOffset",timestampOffset:e}),this._prepareOperate()}async flush(){let e;this.abort();try{e=this._sb.buffered}catch{}if(e&&e.length){this._logger.info("buffered range:",0,"-",e.end(e.length-1));const t=new wc("sbp.flush"),n=t.lock();return this._pendingOperates.push({type:"flush",mutex:t,start:0,end:1/0}),this._prepareOperate(),n}}async waitForAllUpdateEnd(){if(this._sb.updating||this._pendingOperates.length)return this._allUpdatingMutex.lock()}onceNotUpdating(e){this._sb.updating?this._notUpdatingCallbacks.push(e):e()}clearWaitOperates(){this._logger.info("clear wait operates",this._pendingOperates.length,this._pendingOperates.map((e=>e.type)).join(",")),this._pendingOperates=this._pendingOperates.filter((e=>"flush"===e.type)),this._runningOperateCallbacks=[],this._notUpdatingCallbacks=[],this._prepareOperate()}releaseLock(){this._pendingOperates.forEach((e=>{var t;return null==(t=e.mutex)?void 0:t.releaseLock()})),this._allUpdatingMutex.releaseLock()}attach(e){this._video=e}detach(){this._video=void 0}destroy(){this.detach(),this._sb.removeEventListener("updateend",this._handleUpdateEnd),this.removeAllListeners(),this.clearWaitOperates(),this.releaseLock()}}var rh=(e=>(e[e.LOW=0]="LOW",e[e.NORMAL=1]="NORMAL",e[e.HIGH=2]="HIGH",e))(rh||{}),ih=(e=>(e[e.TIMEUPDATE=0]="TIMEUPDATE",e[e.UPDATEEND=1]="UPDATEEND",e[e.PROGRESS=2]="PROGRESS",e))(ih||{});class sh extends zu{constructor(e,t){super(),this._logger=Vu.createLogger("video-buffer-manager"),this._appendOutOfRangeTimes=0,this._startupRap=0,this._level=0,this._autoLevelCheck=!1,this._offTriggers=()=>{this._video.removeEventListener("timeupdate",this._handleTimeupdate),this._video.removeEventListener("progress",this._handleProgress)},this._handleProgress=()=>{this._checkBuffer(2)},this._handleTimeupdate=()=>{this._checkBuffer(0),this._checkBufferOverflow()},this._handleUpdateEnd=()=>{this._checkBuffer(1),this._checkBufferOutOfRange()},this._handleCustomError=e=>{this._logger.error(e),this.emit("error",e)},this._video=e,this._options=Du.combineDefaultOptions(t,{maxBackwardBufferDuration:10,minBackwardBufferDuration:5,maxForwardBufferDuration:10,minForwardBufferDuration:5})}get level(){return this._level}setTriggers(e){this._offTriggers(),e.forEach((e=>{switch(e){case 2:return this._video.addEventListener("progress",this._handleProgress);case 0:return this._video.addEventListener("timeupdate",this._handleTimeupdate)}}))}dispatch(e){if(1===e)return this._handleUpdateEnd()}setAutoLevelCheck(e){this._autoLevelCheck=e}_changeWaterLevel(e){if(this._level!==e){const t=this._level;this._level=e,this.emit("levelchange",e,t)}}_checkBuffer(e){if(!this._autoLevelCheck)return;const{maxForwardBufferDuration:t,minForwardBufferDuration:n}=this._options,{currentTime:r,buffered:i}=this._video,s=Yc(i,this.getRefineCurrentTime(r));s&&(s.end-r>t?this._changeWaterLevel(2):s.end-r>n?this._changeWaterLevel(1):this._changeWaterLevel(0),this.emit("bufferchecking",e,s))}_checkBufferOverflow(){const{minBackwardBufferDuration:e,maxBackwardBufferDuration:t}=this._options,{currentTime:n,buffered:r}=this._video,i=[];for(let s,a,o=0,l=r.length;o<l;o++)s=r.start(o),n-s>t&&(a=n-e,i.push({start:s,end:a}));i.length&&this.emit("bufferoverflow",i)}_checkBufferOutOfRange(){const{buffered:e,currentTime:t}=this._video;if(!e.length)return;const n=function(e,t){const n=e.length;if(0!==n){let r,i;for(let s=0;s<n&&(r=e.start(s),i=e.end(s),!(r>t));s++);if(void 0!==r)return{start:r,end:i}}}(e,this.getRefineCurrentTime(t));if(!n||this._lastHitRange&&this._lastHitRange.end===n.end&&this._lastHitRange.start===n.start){if(this._appendOutOfRangeTimes++,this._appendOutOfRangeTimes>2){const r="append out of range";this._logger.warn(r,", currentTime:",t,", lastHitRange:",this._lastHitRange,", hitRange:",n,", buffered.length:",e.length,", bufferRange:",e.length?e.start(0)+":"+e.end(0):void 0),this._handleCustomError(new rc(rc.Code.RUNTIME_BUFFER_BREAK,r))}return!0}this._appendOutOfRangeTimes=0}getRefineCurrentTime(e){return this._startupRap>0&&e<this._startupRap?this._startupRap:e}setStartupRandomAccessPoint(e){this._startupRap=e}forceEmpty(){this._changeWaterLevel(0)}reset(){this._offTriggers(),this._autoLevelCheck=!1,this._level=0,this._startupRap=0,this._appendOutOfRangeTimes=0,this._lastHitRange=void 0}destroy(){this.removeAllListeners(),this._offTriggers()}}var ah=(e=>(e.DEFAULT="default",e.NEXT_VIDEO_READY="next-video-ready",e))(ah||{}),oh=(e=>(e.DEFAULT="default",e.REUSE="reuse",e.REUSE_EXCEPT_CODEC_CHANGE="reuse-except-codec-change",e))(oh||{});class lh extends Lc{constructor(e={}){super("ms.stream"),this._logger=Vu.createLogger("mse"),this._rapSet=new Set,this._firstRap=-1,this._eos=!1,this._skipSeeking=!1,this._clearIsPending=!1,this._metadataAppended=!1,this._handleBufferOverflow=e=>{const t=this._activeMse.sbp;t&&e.forEach((({start:e,end:n})=>{const r=this._findBackwardRandomAccessPoint(n);r-.1>e&&!this._eos&&t.remove(e,r-.1)}))},this._handleSeeking=()=>{var e;if(this._logger.info("seeking event is fired, currenTime=",null==(e=this._video)?void 0:e.currentTime,"skipSeeking=",this._skipSeeking),this._skipSeeking)return void(this._skipSeeking=!1);const t=this._activeMse.sbp,n=this._video;if(!t||!n||!this._metadataAppended)return;const r=this._detector?this._detector.getRefineCurrentTime(n.currentTime):n.currentTime;t.seek(r)||this.emit("msestalled")},this._handleSbpUpdateEnd=()=>{var e;if(this._video&&0===this._video.currentTime){const e=function(e){const t=e.length;if(0!==t){let n,r;for(let i=0;i<t;i++){if(n=e.start(i),r=e.end(i),n>0)return{start:n,end:r};if(r>0)return{start:n,end:r}}}}(this._video.buffered);e&&e.start>0&&this._internalSeek(e.start)}null==(e=this._detector)||e.dispatch(ih.UPDATEEND)},this._handleSbpError=e=>{this.emit("error",e),this.suspend()},this._emitMseLoadeddata=()=>{this.emit("loadedmsedata")},this._emitMseLoadedmetadata=()=>{this.emit("loadedmsemetadata"),this._metadataAppended=!0},this._redrawVideo=()=>{const e=this._video;e&&(e.style.transform="scale(1)",e.style.transform="")},this._options=Du.combineDefaultOptions(e,{clearStrategy:"default"}),this._activeMse=this._createMse(),"default"===this._options.clearStrategy&&(this._backupMse=this._createMse())}static isBlob(e){return 0===e.indexOf("blob:")}_findBackwardRandomAccessPoint(e){let t=-1;for(const n of this._rapSet){if(!(n<e))break;t=n}return t}_createMse(){const e=new MediaSource,t=URL.createObjectURL(e),n=new wc("mse.open"),r={used:!1,mediaSource:e,url:t,mutex:n,destroy:()=>{}},i=()=>{this._logger.info("mse sourceclose")},s=()=>{this._logger.info("mse sourceopen"),n.unlockAll()};return e.addEventListener("sourceopen",s),e.addEventListener("sourceclose",i),r.destroy=()=>{n.releaseLock(),URL.revokeObjectURL(t),e.removeEventListener("sourceopen",s),e.removeEventListener("sourceclose",i)},r}_destroyMse(e){const t=this._activeMse.sbp;if(t){t.destroy();try{e.mediaSource.removeSourceBuffer(t.getSourceBuffer())}catch{}}e.destroy()}_reallocMse(){const e=this._video,t=this._activeMse;return(t.sbp||e&&e.src!==t.url&&t.used)&&(this._destroyMse(t),this._backupMse?(this._activeMse=this._backupMse,this._backupMse=this._createMse()):this._activeMse=this._createMse()),e&&e.src!==this._activeMse.url&&(this._logger.info(`change to mse, ${e.src||"empty"} -> ${this._activeMse.url}`),e.src=this._activeMse.url,this._activeMse.used=!0),this._activeMse}_printMetadata(e){e.tracks.forEach((e=>{e.type===Uc.AUDIO?this._logger.info(`track:${e.type}(${e.id})`,"codec:",e.codec,"duration:",e.duration,"timescale:",e.timescale,"objectType:",e.audioObjectType,"channels:",e.channelCount,"sampleRate:",e.sampleRate,"sampleSize:",e.sampleSize):e.type===Uc.VIDEO?this._logger.info(`track:${e.type}(${e.id})`,"codec:",e.codec,"duration:",e.duration,"timescale:",e.timescale,"width:",e.width,"height:",e.height,"rotation:",e.rotation):this._logger.info(`track: ${e.type}(${e.id})`)}))}async _doRemuxStreamAction(e){var t;switch(e.type){case Kc.InitSegmentCreated:{this._metadata=e.metadata,this._logger.debug("mss-stdin, type:",e.type,e.data.byteLength),this._printMetadata(e.metadata);const{clearStrategy:t}=this._options,n=eh(e.metadata);if("reuse-except-codec-change"===t){const t=this._activeMse.sbp;t&&t.videoCodec!==Jc(e.metadata)&&(this._reallocMse(),"open"!==this._activeMse.mediaSource.readyState&&await this._activeMse.mutex.lock(),this._logger.info("realloc mse, codec changed"))}const r=this._activeMse.sbp,i=e.metadata.duration/e.metadata.timescale;if(r)return r.abort(),await r.flush(),nh.isSupportChangeType()&&await r.changeMetadata(e.metadata),r.onceNotUpdating((()=>{try{this._activeMse.mediaSource.duration=i,this._internalSeek(0),this._logger.info("seek to the start point, mse duration changed to",i,"successfully")}catch(e){throw new rc(rc.Code.MEDIA_MSE_OTHER,e.message)}})),r.append(e.data,this._emitMseLoadedmetadata).then(this._redrawVideo);{let t;"open"!==this._activeMse.mediaSource.readyState&&await this._activeMse.mutex.lock();try{this._activeMse.mediaSource.duration=i,t=this._activeMse.mediaSource.addSourceBuffer(n)}catch(e){throw new rc(rc.Code.MEDIA_MSE_ADD_SB,e.message)}const r=this._activeMse.sbp=new nh(t,e.metadata);return r.attach(this._video),r.on("error",this._handleSbpError),r.on("updateend",this._handleSbpUpdateEnd),r.append(e.data,this._emitMseLoadedmetadata)}}case Kc.DataSegmentCreated:{this._logger.debug("mss-stdin, type:",e.type,e.data.byteLength,",",e.startDecodeTime,"-",e.endDecodeTime);const n=this._activeMse.sbp;if(n){if(e.raps.length&&this._logger.log("enqueue the random access points",JSON.stringify(e.raps)),e.raps.forEach((e=>this._rapSet.add(e))),this._eos){this._logger.warn("append cannot be called after endOfStream");break}const r=this._firstRap<0&&e.raps.length;return r&&(this._firstRap=e.raps[0],null==(t=this._detector)||t.setStartupRandomAccessPoint(this._firstRap)),n.append(e.data,r?this._emitMseLoadeddata:void 0)}throw new rc(rc.Code.MEDIA_MSE_SB_APPEND,"no sourcebuffer")}}}_internalSeek(e){const t=this._video;t&&(this._skipSeeking=!0,t.currentTime=e)}_resetContinuityStates(){this._skipSeeking=!1,this._eos=!1}_resetAllStates(){this._rapSet.clear(),this._metadata=void 0,this._metadataAppended=!1,this._firstRap=-1,this._resetContinuityStates()}_clearImmediately(){super.flush(),this._resetAllStates();const{clearStrategy:e}=this._options;if("reuse"===e||"reuse-except-codec-change"===e){const e=this._activeMse.sbp;e&&(e.abort(),e.clearWaitOperates(),e.flush().then((()=>{const e=this._video;e&&e.autoplay&&e.paused&&(e.play(),this._logger.log("automatically resume the previously paused playback state due to autoplay=true"))})))}else this._reallocMse()}get metadata(){return this._metadata}get url(){return this._activeMse.url}attach(e,t){this._video!==e&&(this.detach(),t.on("bufferoverflow",this._handleBufferOverflow),e.addEventListener("seeking",this._handleSeeking),this._detector=t,this._video=e,this._reallocMse())}detach(){var e;null==(e=this._activeMse.sbp)||e.detach(),this._video&&(this._video.removeEventListener("seeking",this._handleSeeking),this._video=void 0),this._detector&&(this._detector.off("bufferoverflow",this._handleBufferOverflow),this._detector=void 0)}suspend(){var e;this._activeMse.sbp&&this._activeMse.sbp.releaseLock(),this.stdin.releaseRead(),this._activeMse.mutex.releaseLock(),null==(e=this._coroutine)||e.cancel(),this._coroutine=void 0}resume(){this._coroutine?this._logger.warn(`coroutine (${this._coroutine.id}) is running, cannot resume`):this._coroutine=Dc.create({title:"mse.stream",onLoop:async()=>{var e,t;let n=await this.stdin.read();if(this._clearIsPending){let r;if((null==(e=n.value)?void 0:e.type)===Kc.InitSegmentCreated)r=n;else do{r=await this.stdin.read()}while((null==(t=r.value)?void 0:t.type)!==Kc.InitSegmentCreated);r&&(n=r,this._clearIsPending=!1,this._clearImmediately())}n.done?(this._activeMse.sbp&&await this._activeMse.sbp.waitForAllUpdateEnd(),this._activeMse.mediaSource.endOfStream(),this._eos=!0,this._logger.info("endOfStream")):n.value&&await this._doRemuxStreamAction(n.value)},onError:e=>this.emit("error",e)})}async flush(){super.flush(),this._resetContinuityStates();const e=this._activeMse.sbp;if(e)return e.abort(),e.flush()}reset(e=!1){var t;this.suspend(),null!=(t=this._video)&&t.error&&this._reallocMse();const{clearTiming:n}=this._options;e||"next-video-ready"!==n?this._clearImmediately():this._clearIsPending=!0}destroy(){super.destroy(),this._options.clearStrategy="default",this._options.clearTiming="default",this.reset(!0),this.suspend(),this._destroyMse(this._activeMse),this._backupMse&&this._destroyMse(this._backupMse)}}const uh=Vu.createLogger("multiplex"),ch=["error"],hh=["progress"],dh="demux",fh="remux",ph={delay:0};class gh extends zu{constructor(e,t){super(),this._handleVideoError=()=>{const e=this._video.error,t=e?rc.fromMediaError(e):new rc(rc.Code.OTHER,"unknown video error");this._downgrade(t)},this._handleError=e=>{const t=e instanceof rc?e:new rc(rc.Code.OTHER,e.message);this._downgrade(t)},this._downgrade=e=>{this._prevMeta=void 0;const t=this._demuxStream.getLoader().url,n=this._video;if(!lh.isBlob(n.src)||n.src===t)return void this._controller.processError();const r=n.currentTime;uh.warn("downgrade to h5 caused by multiplex error:",e.message),window.clearTimeout(this._levelTimer),this._demuxStream.abort(),this._remuxStream.reset(),this._mediaSourceStream.reset(!0),this._mediaSourceStream.detach(),this._controller.enableEvents(hh),this._videoBufferDetector.setTriggers([ih.PROGRESS,ih.TIMEUPDATE]),0===r&&this._controller.getInternalModule(ec.POSTER).show(),this.emit("downgrade",e)&&(n.src=t,n.currentTime=r,uh.info("downgrade done, currentTime",n.currentTime))},this._handleControllerLoadedMetadata=()=>{this._videoBufferDetector.setAutoLevelCheck(!0)},this._handleVideoBufferChecking=(e,t)=>{const n=this._videoBufferDetector;if(n.level===rh.LOW){if(this._demuxStream.stdout.size>0||this._remuxStream.stdin.size>0||this._remuxStream.stdout.size>0||this._mediaSourceStream.stdin.size>0)return;window.clearTimeout(this._levelTimer),this._demuxStream.resume()}else n.level===rh.HIGH&&(window.clearTimeout(this._levelTimer),this._demuxStream.suspend());const r=this._preloader;if(!r)return;const i=this._video;if(i.autoplay&&!i.played.length)return;const s=i.currentTime,a=Math.max(t.end-s,0),o=Math.min(r.triggerBufferDuration,i.duration),l=Math.min(r.triggerPlayTime,i.duration/2),u=a>=o&&s>=l,c=s+a>=i.duration-1&&s+o>=i.duration-1;u||c?(this.emit("canpreload"),r.preload()):r.suspend(),(e===ih.UPDATEEND||e===ih.PROGRESS)&&this._controller.emit("progress")},this._handleDemuxLevelChange=e=>{e===kc.FULL&&(window.clearTimeout(this._levelTimer),this._levelTimer=window.setTimeout((()=>{this._demuxStream.stdout.level===kc.FULL&&(this._demuxStream.suspend(),uh.warn("demux waterlevel change to full, abort request"))}),1e3))},this._handleVideoLevelChange=(e,t)=>{const n=this._mediaSourceStream;uh.info("video levelchange",t,"->",e),e===rh.HIGH?n.suspend():e===rh.LOW&&n.resume()},this._handleMseStalled=()=>{const e=this._video.currentTime;uh.info("video mse seek stalled, currentTime:",e),window.clearTimeout(this._levelTimer),this._demuxStream.abort(),this._remuxStream.suspend(),this._mediaSourceStream.suspend(),this._demuxStream.flush(),this._remuxStream.flush(),this._mediaSourceStream.flush(),this._mediaSourceStream.resume(),this._remuxStream.resume(),this._demuxStream.seek(e)},this._options=t,this._context=e;const n=this._controller=e.controller;n.on("loadedmetadata",this._handleControllerLoadedMetadata),this._demuxStream=new Gc({name:dh,parsers:this._options.parsers,loaderOptions:this._options.loaderOptions}),this._demuxStream.stdout.on("levelchange",this._handleDemuxLevelChange),this._demuxStream.on("error",this._handleError),this._remuxStream=new qc({name:fh}),this._remuxStream.on("error",this._handleError);const r=this._video=n.getElement();r.addEventListener("error",this._handleVideoError);const i=new sh(r,this._options);i.on("levelchange",this._handleVideoLevelChange),i.on("bufferchecking",this._handleVideoBufferChecking),i.on("error",this._handleError),this._videoBufferDetector=i;const s=new lh(this._options);s.on("msestalled",this._handleMseStalled),s.on("error",this._handleError),s.attach(r,i),this._mediaSourceStream=s,this._setup()}_customizePosterBehavior(e){const{clearStrategy:t,clearTiming:n}=this._options;return n===ah.NEXT_VIDEO_READY?(e.preventDefault(),t===oh.REUSE?void 0:t===oh.REUSE_EXCEPT_CODEC_CHANGE?t=>{var n;if((null==(n=t.value)?void 0:n.type)===Kc.InitSegmentCreated){const n=this._prevMeta,r=t.value.metadata;(!n||Jc(r)!==Jc(n)||Zc(r)!==Zc(n))&&e.show(),this._prevMeta=r}return t}:t=>{var n;return(null==(n=t.value)?void 0:n.type)===Kc.InitSegmentCreated&&e.show(),t}):t===oh.REUSE?t=>{var n;return(null==(n=t.value)?void 0:n.type)===Kc.InitSegmentCreated&&e.setTempHideOptions(ph),t}:t===oh.REUSE_EXCEPT_CODEC_CHANGE?t=>{var n;if((null==(n=t.value)?void 0:n.type)===Kc.InitSegmentCreated){const n=this._prevMeta,r=t.value.metadata;n&&Jc(r)===Jc(n)&&Zc(r)===Zc(n)&&e.setTempHideOptions(ph),this._prevMeta=r}return t}:void 0}_setup(){const{controller:e}=this._context,t=e.getInternalModule(ec.POSTER),n=this._customizePosterBehavior(t);this._remuxStream.resume(),this._mediaSourceStream.resume(),this._demuxStream.pipe(this._remuxStream).pipe(this._mediaSourceStream,n),e.disableEvents(ch),e.replaceGetter("rawSrc",(()=>this._demuxStream.getLoader().url||this._video.currentSrc||"")),e.replaceSetter("src",((e,t,n)=>{n!==t&&(Array.isArray(n)?this._load(n[0].url):this._load(n))}))}_load(e){const{_video:t,_mediaSourceStream:n,_videoBufferDetector:r}=this,{controller:i}=this._context,s=i.getInternalModule(ec.POSTER),a=this._customizePosterBehavior(s);let o;uh.log("------------------------------ divider ------------------------------"),uh.info("url changed to",e),window.clearTimeout(this._levelTimer),i.emit("playnext"),this._preloader&&(o=this._preloader.pull(e),this._preloader.cancel()),uh.info("preloader pull, source=",o?o.src:""),r.reset();try{const l=null==o?void 0:o.error;if(o&&!l){const e=o.stats;e.duration>0&&(this.emit("hitcache",o),Array.isArray(o.src)&&(i.sources=o.src,i.sourceIndex=o.srcIndex)),uh.info(`preloader hitcache:${e.duration>0}, done=${o.done} duration=${e.duration} dataSize=${e.dataSize}`),this._remuxStream.unpipe(n),this._demuxStream.destroy(),this._remuxStream.destroy(),o.demuxStream.changeName(dh),o.remuxStream.changeName(fh),this._remuxStream=o.remuxStream,this._demuxStream=o.demuxStream,this._demuxStream.stdout.on("levelchange",this._handleDemuxLevelChange),this._demuxStream.on("error",this._handleError),this._remuxStream.on("error",this._handleError),i.disableEvents(hh),r.setTriggers([ih.UPDATEEND,ih.TIMEUPDATE]),n.reset(),n.attach(t,r),n.resume(),o.done&&o.remuxStream.stdout.size>0||this._demuxStream.resume(),this.emit("loadstart"),this._remuxStream.pipe(n,a)}else this._options.fallback||l?(l&&this.emit("downgrade",l),uh.info("use pure <video />"),this._demuxStream.abort(),this._demuxStream.reset(),this._remuxStream.reset(),n.reset(),n.detach(),r.setTriggers([ih.PROGRESS,ih.TIMEUPDATE]),i.enableEvents(hh),s.show(),t.src=e,this.emit("loadstart")):(uh.info("use mse"),this._demuxStream.abort(),this._demuxStream.reset(),this._remuxStream.reset(),i.disableEvents(hh),r.setTriggers([ih.UPDATEEND,ih.TIMEUPDATE]),n.reset(),n.attach(t,r),n.resume(),this._demuxStream.load(e),this.emit("loadstart"))}catch(e){e instanceof rc||uh.error(e),this._handleError(e)}}getNetworkMonitor(){return this._demuxStream.getLoader().network}setPreloader(e){this._preloader=e}changeOptions(e){this._options={...this._options,...e},this._demuxStream.changeOptions(this._options)}printDebugMessage(){uh.log("\ndemux.stdout: \n ",this._demuxStream.stdout,"\nremux.stdin: \n ",this._remuxStream.stdin,"\nremux.stdout: \n ",this._remuxStream.stdout,"\nmss.stdout: \n ",this._mediaSourceStream.stdin)}getMetadata(){return this._mediaSourceStream.metadata}destroy(){const{controller:e}=this._context;this._preloader=void 0,this._prevMeta=void 0,this._video.removeEventListener("error",this._handleVideoError),this._videoBufferDetector.off("levelchange",this._handleVideoLevelChange),this._videoBufferDetector.off("bufferchecking",this._handleVideoBufferChecking),this._videoBufferDetector.off("error",this._handleError),e.replaceSetter("src",null),e.enableEvents(ch),e.enableEvents(hh),window.clearTimeout(this._levelTimer),this._demuxStream.destroy(),this._remuxStream.destroy(),this._mediaSourceStream.destroy()}}class mh extends zu{constructor(e){super(),this._logger=Vu.createLogger("multiplex"),this._remapOffCallbacks=[],this.name="multiplex",this._options=e}install(e){const{loaderOptions:t}=this._options;if(t)if("fetch"===t.type){if(!gc.isSupported())return void this._logger.warn("The browser does not support [Fetch API], the plugin will disabled when loaderType='fetch'");Tc(gc)}else"xhr"===t.type?Tc(vc):Tc(null);this.core=new gh(e,this._options),this._preloader&&this.core.setPreloader(this._preloader),this._remapOffCallbacks=zu.remap(this.core,this,{canpreload:"canpreload",hitcache:"hitcache",downgrade:"downgrade",loadstart:"loadstart"}).concat(zu.remap(this.core.getNetworkMonitor(),this,{downloaded:"downloaded"}))}changeOptions(e){this.core?this.core.changeOptions(e):this._options=Du.combineDefaultOptions(this._options,e)}setPreloader(e){this.core?this.core.setPreloader(e):e&&(this._preloader=e)}getMetadata(){if(this.core)return this.core.getMetadata()}uninstall(){var e;null==(e=this.core)||e.destroy(),this._remapOffCallbacks.forEach((e=>e()))}}const vh=class{constructor(e,t){const n=e.offset;this.pos=t,this.size=e.read(4),this.type=String.fromCharCode(e.read(1),e.read(1),e.read(1),e.read(1)).trim(),1===this.size&&(this.size=e.read(8)),this.headerSize=e.offset-n}};vh.MIN_SIZE=8;let yh=vh;class _h{}class Th extends _h{constructor(e){super(),this.version=e.read(1),this.flag=e.read(3)}}class bh extends _h{constructor(e){super(),this.isContainer=!1,this.data=e.readToUint8()}}var Sh=(e=>(e.Video="vide",e.Audio="soun",e.Hint="hint",e))(Sh||{}),Ph=(e=>(e[e.BASE_DATA_OFFSET=1]="BASE_DATA_OFFSET",e[e.SAMPLE_DESC=2]="SAMPLE_DESC",e[e.SAMPLE_DUR=8]="SAMPLE_DUR",e[e.SAMPLE_SIZE=16]="SAMPLE_SIZE",e[e.SAMPLE_FLAGS=32]="SAMPLE_FLAGS",e[e.DUR_EMPTY=65536]="DUR_EMPTY",e[e.DEFAULT_BASE_IS_MOOF=131072]="DEFAULT_BASE_IS_MOOF",e))(Ph||{}),wh=(e=>(e[e.DATA_OFFSET=1]="DATA_OFFSET",e[e.FIRST_FLAG=4]="FIRST_FLAG",e[e.DURATION=256]="DURATION",e[e.SIZE=512]="SIZE",e[e.FLAG=1024]="FLAG",e[e.CTS_OFFSET=2048]="CTS_OFFSET",e))(wh||{});class kh{constructor(e){this._logger=Vu.createLogger("mp4-track"),this.__samples=[],this.__nextSampleIndex=0,this.__meta=this.__createMetadata(e),(e=>{var t,n,r;const{mdia:i}=e||{},s=(null==(t=null==i?void 0:i.minf)?void 0:t.stbl)||{},{stts:a,stsc:o,stsz:l,stss:u,ctts:c}=s,h=s.stco||s.co64,d=[];if(a&&o&&l&&h){const e={};null==u||u.sampleNumbers.forEach((t=>e[t-1]=!0));const t=[];if(c)for(let e,n,r=0;r<c.sampleCounts.length;r++){e=c.sampleCounts[r],n=c.sampleOffsets[r];for(let r=0;r<e;r++)t.push(n)}const i=o.entries;let s=(null==(n=i[0])?void 0:n.samplePerChunk)||1/0,f=(null==(r=i[1])?void 0:r.firstChunk)-1||1/0,p=0,g=0,m=0,v=0,y=0,_=0;a.sampleCounts.forEach(((n,r)=>{var o;for(let T=0;T<n;T++){const n={},T=a.sampleDurations[r];n.index=_,n.size=l.sampleSizes[_]||l.sampleSize,n.pos=h.chunkOffsets[g]+p,n.cts=c?t[_]:0,n.isKeyframe=!u||!!e[_],n.duration=T,n.dts=v,n.flag=n.isKeyframe?33554432:16842752,v+=T,n.isKeyframe&&y++,n.gopId=y,d.push(n),_++,_<s?p+=n.size:(g++,p=0,g>=f&&(m++,f=(null==(o=i[m+1])?void 0:o.firstChunk)-1||1/0),s+=i[m].samplePerChunk)}}))}return d})(e).forEach((e=>{this.addSample(e)}))}__createMetadata(e){const{mdia:t}=e,{mdhd:n,hdlr:r,minf:i}=t||{},{stbl:s}=i||{},{stsd:a}=s||{},o=n||{},l=r||{},u=e.tkhd||{},c={id:u.trackId||0,timescale:o.timescale||1e3,duration:u.duration||0};switch(l.handlerType){case Sh.Video:return Object.assign(c,this.__createExtraVideoMetadata(a,e.tkhd));case Sh.Audio:return Object.assign(c,this.__createExtraAudioMetadata(a));default:return Object.assign(c,this.__createUnknownTrackMetadata())}}__createUnknownTrackMetadata(){return{type:Uc.UNKNOWN}}__createExtraAudioMetadata(e){var t;const{mp4a:n}=e||{},r=n||{},i=(null==n?void 0:n.esds)||(null==(t=null==n?void 0:n.wave)?void 0:t.esds)||{};return{type:Uc.AUDIO,codec:i.codec||"",audioObjectType:i.audioObjectType||0,dsiData:i.dsiData,sampleRate:r.sampleRate||0,channelCount:r.channelCount||0,sampleSize:r.sampleSize||0}}__createExtraVideoMetadata(e,t){var n,r,i;const{rotation:s}=t||{},{avc1:a,hev1:o,hvc1:l}=e||{},u=(null==a?void 0:a.avcC)||(null==o?void 0:o.hvcC)||(null==l?void 0:l.hvcC),c=(null==u?void 0:u.nalus)||[],h=(null==(n=null==a?void 0:a.avcC)?void 0:n.spsList)||(null==(r=null==o?void 0:o.hvcC)?void 0:r.spsList)||(null==(i=null==l?void 0:l.hvcC)?void 0:i.spsList),{sar:d,width:f,height:p,codec:g}=(null==h?void 0:h[0])||{};return{type:Uc.VIDEO,naluDatas:c.map((e=>e.data)),rotation:s||0,codec:g||"",sps:h||[],sar:d||[],width:f||0,height:p||0}}getMetadata(){return this.__meta}getSamples(){return this.__samples}getNextSample(){return this.__samples[this.__nextSampleIndex]}getNextSampleSize(){return this.__nextSampleIndex<this.__samples.length?this.__samples[this.__nextSampleIndex].size:0}getNextSamplePos(){if(this.__nextSampleIndex<this.__samples.length)return this.__samples[this.__nextSampleIndex].pos;if(this.__samples.length){const e=this.__samples[this.__samples.length-1];return e.pos+e.size}return-1}addSample(e){this.__samples.push(e)}__convertSampleToPacket(e,t,n=0){const r=e.pos-n;if(r>=0&&e.pos+e.size<=t.byteLength+n)return{index:e.index,pos:e.pos,duration:e.duration,flag:e.flag,dts:e.dts,pts:e.dts+e.cts,isKeyframe:e.isKeyframe,timescale:this.__meta.timescale,type:this.__meta.type,codec:this.__meta.codec||"",data:t.subarray(r,r+e.size)}}processPackets(e,t=0){const n=[];for(let r=this.__nextSampleIndex,i=this.__samples.length;r<i;r++){const i=this.__convertSampleToPacket(this.__samples[r],e,t);if(!i)break;this.__nextSampleIndex++,n.push(i)}return n}seek(e){const t=e*this.__meta.timescale,n=this.__samples.length;let r;if(n){if(r=this.__samples[0],r.dts+r.cts>t)return this.__nextSampleIndex=0,r;{let e=-1;for(let i=0;i<n&&(r=this.__samples[i],!(r.dts+r.cts>t));i++)r.isKeyframe&&(e=i);if(e>-1)return this.__nextSampleIndex=e,this.__samples[e];this._logger.warn("seek out of range")}}else this._logger.warn("no samples")}}class Mh{constructor(e){const{trak:t,mvhd:n}=e,r=n||{};this.__tracks=(t||[]).filter((e=>!!e)).map((e=>new kh(e))).filter((e=>e.getMetadata().type!==Uc.UNKNOWN)),this.__meta={formatType:$c.MP4,duration:r.duration||0,timescale:r.timescale||0,tracks:this.__tracks.map((e=>e.getMetadata()))}}getTrackById(e){return this.__tracks.find((t=>t.getMetadata().id===e))}getTracks(){return this.__tracks}getMetadata(){return this.__meta}}class Eh extends zu{constructor(e={}){var t;super(),this._onLoad=e=>{this.parse(e.data,e.pos)},this.__customLoader=e.loader,this.__backupLoader=new _c(null==(t=this.__customLoader)?void 0:t.getOptions()),this.loader.on("loadeddata",this._onLoad)}get loader(){return this.__customLoader||this.__backupLoader}load(e){this.loader.load(e)}setLoader(e){this.loader&&this.loader.off("loadeddata",this._onLoad),this.__customLoader=e,this.loader.on("loadeddata",this._onLoad)}reset(){this.setLoader()}destroy(){this.loader.off("loadeddata",this._onLoad),this.loader.destroy()}}class Rh extends Th{constructor(e){super(e),this.isContainer=!0,e.skip(2),this.bitReferenceId=e.read(2),this.codeStreamVersion=e.read(4),e.skip(4),e.skip(8),this.width=e.read(2),this.height=e.read(2),this.horizontalResolution=e.read(4),this.verticalResolution=e.read(4),e.skip(4),this.frameCount=e.read(2);const t=Math.min(e.read(1),32);this.compressorName=e.readString(t),e.skip(32-(t+1)),this.depth=e.read(2),e.skip(2)}}function xh(e,t){return+(e+"."+t)}function Dh(e){return e.toString(16).padStart(2,"0")}const Ih=new Date("1904-01-01T00:00:00Z").getTime();function Ch(e){return e&&e+1e3*Ih}class Lh{constructor(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}skipBits(e){let t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=8*t,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32)throw new Error("Cannot read more than 32 bits at a time");return this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t,n,r=8,i=8;for(t=0;t<e;t++)0!==i&&(n=this.readEG(),i=(r+n+256)%256),r=0===i?r:i}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}function Oh(e){const t=e.byteLength,n=[];let r=1;for(;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return e;const i=t-n.length,s=new Uint8Array(i);let a=0;for(r=0;r<i;a++,r++)a===n[0]&&(a++,n.shift()),s[r]=e[a];return s}const Ah=[100,110,122,244,44,83,86,118,128,138,144],Gh=[[0,1],[1,1],[12,11],[10,11],[16,11],[40,33],[24,11],[20,11],[32,11],[80,33],[18,11],[15,11],[64,33],[160,99],[4,3],[3,2],[2,1]],Bh=[1,2,2,1],Nh=[1,2,1,1];class $h{constructor(){this.videoFormat=0,this.videoFullRangeFlag=0,this.colourDescriptionPresentFlag=0,this.colourPrimaries=0,this.transferCharacteristics=0,this.matrixCoeffs=0,this.sar=[]}decodeVuiParams(e){if(e.readBits(1)){const t=e.readUByte();255===t?(this.sar[0]=e.readUByte()<<8|e.readUByte(),this.sar[1]=e.readUByte()<<8|e.readUByte()):this.sar=Gh[t]}e.readBits(1)&&e.skipBits(1),e.readBits(1)&&(this.videoFormat=e.readBits(3),this.videoFullRangeFlag=e.readBits(1),this.colourDescriptionPresentFlag=e.readBits(1),this.colourDescriptionPresentFlag&&(this.colourPrimaries=e.readUByte(),this.transferCharacteristics=e.readUByte(),this.matrixCoeffs=e.readUByte()))}}class Uh extends $h{constructor(e){super(),this.generalProfileSpace=0,this.generalTierFlag=0,this.cropLeft=0,this.cropRight=0,this.cropTop=0,this.cropBottom=0;const t=new Lh(Oh(e.subarray(1)));if(this.generalProfileIdc=t.readUByte(),this.generalProfileCompatibility=t.readUByte(),this.generalLevelIdc=t.readUByte(),this.spsId=t.readUEG(),this.codec=this.__generateCodec(),Ah.indexOf(this.generalProfileIdc)>-1){if(this.chromaFormatIdc=t.readUEG(),3===this.chromaFormatIdc&&t.skipBits(1),this.bitDepthLuma=t.readUEG()+8,this.bitDepthChroma=t.readUEG()+8,t.skipBits(1),t.readBits(1))for(let e=0,n=3!==this.chromaFormatIdc?8:12;e<n;e++)t.readBits(1)&&(e<6?t.skipScalingList(16):t.skipScalingList(64))}else this.chromaFormatIdc=1,this.bitDepthLuma=8,this.bitDepthChroma=8;t.skipUEG();const n=t.readUEG();if(0===n)t.skipUEG();else if(1===n){t.skipBits(1),t.skipEG(),t.skipEG();for(let e=0,n=t.readUEG();e<n;e++)t.skipEG()}t.skipUEG(),t.skipBits(1);const r=t.readUEG()+1,i=t.readUEG()+1,s=t.readBits(1);if(s||t.skipBits(1),t.skipBits(1),this.crop=t.readBits(1),this.crop){const e=1<<(1===this.chromaFormatIdc||2===this.chromaFormatIdc?1:0),n=2-s<<(1===this.chromaFormatIdc?1:0);this.cropLeft=t.readUEG()*e,this.cropRight=t.readUEG()*e,this.cropTop=t.readUEG()*n,this.cropBottom=t.readUEG()*n}this.width=16*r-(this.cropRight+this.cropLeft),this.height=16*i-(this.cropTop+this.cropBottom),t.readBits(1)&&this.decodeVuiParams(t)}__generateCodec(){return"avc1."+[this.generalProfileIdc,this.generalProfileCompatibility,this.generalLevelIdc].map((e=>Dh(e))).join("")}}class Fh{constructor(e){let t;this.generalProfileCompatibilityFlags=[],this.generalConstraintIndicatorFlags=[],this.separateColourPlaneFlag=0,this.checkProfileIdc=0,this.maxSubLayersMinus1=0,this.sar=[],this.__generateCodec=()=>{const e=["hvc1"],t=this.generalProfileSpace;e.push((t>0&&t<4?String.fromCharCode(64+t):"")+this.generalProfileIdc.toString()),e.push(this.generalProfileCompatibilityFlags.reverse().reduce(((e,t)=>e<<1|t),0).toString(16)),e.push((this.generalTierFlag?"H":"L")+this.generalLevelIdc);const n=[];for(let e=!1,t=5;t>=0;t--){const r=this.generalConstraintIndicatorFlags[t];(r||e)&&(n.unshift(r.toString(16)),e=!0)}return e.concat(n).join(".")};const n=new Lh(Oh(e.subarray(2)));for(this.vpsId=n.readBits(4),this.maxSubLayersMinus1=n.readBits(3),this.temporalIdNested=n.readBits(1),this.generalProfileSpace=n.readBits(2),this.generalTierFlag=n.readBits(1),this.generalProfileIdc=n.readBits(5),t=0;t<32;t++)this.generalProfileCompatibilityFlags[t]=n.readBits(1),0===this.generalProfileIdc&&t>0&&this.generalProfileCompatibilityFlags[t]&&(this.generalProfileIdc=t);for(t=0;t<6;t++)this.generalConstraintIndicatorFlags.push(n.readUByte());this.generalLevelIdc=n.readUByte();const r=[],i=[];for(t=0;t<this.maxSubLayersMinus1;t++)r[t]=n.readBits(1),i[t]=n.readBits(1);if(this.maxSubLayersMinus1>0)for(n.skipBits(2*(8-this.maxSubLayersMinus1)),t=0;t<this.maxSubLayersMinus1;t++)r[t]&&(n.skipBits(16),n.skipBits(16),n.skipBits(16),n.skipBits(16),n.skipBits(24)),i[t]&&n.skipBits(8);if(this.spsId=n.readUEG(),this.codec=this.__generateCodec(),this.chromaFormatIdc=n.readUEG(),3===this.chromaFormatIdc&&(this.separateColourPlaneFlag=n.readBits(1),this.separateColourPlaneFlag&&(this.chromaFormatIdc=0)),this.width=n.readUEG(),this.height=n.readUEG(),n.readBits(1)){const e=Bh[this.chromaFormatIdc],t=Nh[this.chromaFormatIdc];this.width-=n.readUEG()*e+n.readUEG()*e,this.height-=n.readUEG()*t+n.readUEG()*t}}}var Hh=(e=>(e[e.OD=1]="OD",e[e.IOD=2]="IOD",e[e.ESD=3]="ESD",e[e.DCD=4]="DCD",e[e.DSI=5]="DSI",e[e.SLCD=6]="SLCD",e))(Hh||{});class Vh{constructor(e){this.tag=e.read(1),this.size=0;let t=e.read(1);for(;128&t;)this.size=(127&t)<<7,t=e.read(1);this.size+=127&t}static extractDescriptors(e){const t=[];let n,r,i;for(;e.unreadLength>2&&(n=new Vh(e),!(n.size<=0));){switch(i=new Bc(e.buffer,e.offset,n.size),e.skip(n.size),n.tag){case 3:r=new zh(n,i);break;case 4:r=new Xh(n,i);break;case 5:r=new Kh(n,i);break;case 6:r=new Wh(n,i);break;default:r=null}r&&(i.unreadLength&&(r.children=Vh.extractDescriptors(i)),t.push(r))}return t}}class jh{constructor(e){this.probe=e,this.children=[]}static findDescriptor(e,t){let n;return e.some((e=>(n=e.probe.tag===t?e:jh.findDescriptor(e.children,t),!!n))),n}}class zh extends jh{constructor(e,t){super(e),this.streamDependenceFlag=0,this.URLFlag=0,this.OCRStreamFlag=0,this.esId=t.read(2),this.esFlag=t.read(1),128&this.esFlag&&(this.streamDependenceFlag=t.read(2)),64&this.esFlag&&(this.URLFlag=t.read(1),t.skip(this.URLFlag)),32&this.esFlag&&(this.OCRStreamFlag=t.read(2))}}class Xh extends jh{constructor(e,t){super(e),this.mpeg4Audio=t.read(1),this.audioStream=t.read(1),this.bufferSize=t.read(3),this.maxBitrate=t.read(4),this.avgBitrate=t.read(4)}}class Kh extends jh{constructor(e,t){super(e),this.data=t.readToUint8(),t.back(this.data.byteLength);const n=Fc.fromByte(t,2);this.objectType=n.read(5),31===this.objectType&&(this.objectType=32+n.read(6))}}class Wh extends jh{constructor(e,t){super(e),this.esId=t.read(2)}}const Qh=Object.freeze(Object.defineProperty({__proto__:null,BoxBody:_h,BoxHeader:yh,FullBoxBody:Th,UnknownBoxBody:bh,avc1:Rh,avcC:class extends _h{constructor(e){super(),this.isContainer=!1,this.spsList=[],this.nalus=[],this.configVersion=e.read(1),this.generalProfileIdc=e.read(1),this.generalProfileCompatibility=e.read(1),this.generalLevelIdc=e.read(1),this.lengthSizeMinusOne=3&e.read(1),this.numOfSequenceParameterSets=31&e.read(1);for(let t=0;t<this.numOfSequenceParameterSets;t++){const t=e.read(2),n=e.readToUint8(t);this.spsList.push(new Uh(n)),this.nalus.push({type:Hc.SPS,data:n})}this.numOfPictureParameterSets=31&e.read(1);for(let t=0;t<this.numOfPictureParameterSets;t++){const t=e.read(2);this.nalus.push({type:Hc.SPS,data:e.readToUint8(t)})}}},btrt:class extends _h{constructor(e){super(),this.isContainer=!0,this.bufferSizeDB=e.read(4),this.maxBitrate=e.read(4),this.avgBitrate=e.read(4)}},chan:_h,co64:class extends Th{constructor(e){super(e),this.isContainer=!1,this.chunkOffsets=[];for(let t=e.read(4),n=0;n<t;n++)this.chunkOffsets.push(e.read(8))}},colr:class extends _h{constructor(e){super(),this.isContainer=!1,this.colorPrimaries=0,this.transferCharacteristics=0,this.matrixCoefficients=0,this.fullRangeFlag=0,this.colorType=e.readString(4),"nclx"===this.colorType?(this.colorPrimaries=e.read(2),this.transferCharacteristics=e.read(2),this.matrixCoefficients=e.read(2),this.fullRangeFlag=e.read(1)>>7,this.iccProfile=new Uint8Array):"rICC"===this.colorType||"prof"===this.colorType?this.iccProfile=e.readToUint8():this.iccProfile=new Uint8Array}},ctts:class extends Th{constructor(e){super(e),this.isContainer=!1,this.sampleCounts=[],this.sampleOffsets=[];for(let t=e.read(4),n=0;n<t;n++)this.sampleCounts[n]=e.read(4),this.sampleOffsets[n]=e.read(4)}},dinf:class extends _h{constructor(){super(...arguments),this.isContainer=!0}},dref:class extends Th{constructor(e){super(e),this.isContainer=!0,this.entryCount=e.read(4)}},edts:class extends _h{constructor(){super(...arguments),this.isContainer=!0}},elst:class extends Th{constructor(e){super(e),this.isContainer=!1,this.entries=[];const t=e.read(4),n=1===this.version;for(let r=0;r<t;r++)this.entries.push({segmentDuration:e.read(n?8:4),mediaTime:e.read(n?8:4),mediaRateInteger:e.read(2),mediaRateFraction:e.read(2)})}},esds:class extends Th{constructor(e){super(e),this.isContainer=!1,this.codec="",this.descriptors=[],this.audioObjectType=0,this.descriptors=Vh.extractDescriptors(e);const t=jh.findDescriptor(this.descriptors,Hh.DCD),n=jh.findDescriptor(this.descriptors,Hh.DSI);n&&(this.audioObjectType=n.objectType,this.dsiData=n.data,t&&(this.codec="mp4a."+t.mpeg4Audio.toString(16)+"."+n.objectType))}},fiel:_h,free:_h,frma:class extends _h{constructor(e){super(),this.isContainer=!1,this.dataFormat=e.readString(4)}},ftyp:class extends _h{constructor(e){for(super(),this.isContainer=!1,this.majorBrand=e.readString(4).trim(),this.minorVersion=e.read(4),this.compatibleBrands=[];e.unreadLength>3;)this.compatibleBrands.push(e.readString(4))}},hdlr:class extends Th{constructor(e){super(e),this.isContainer=!1,this.name="",this.preDefined="",this.handlerType="",0===this.version&&(this.preDefined=e.readString(4).trim(),this.handlerType=e.readString(4).trim(),e.skip(12),this.name=e.readString(e.unreadLength).trim())}},hvc1:class extends Rh{},hvcC:class extends _h{constructor(e){let t;super(),this.isContainer=!1,this.generalProfileCompatibilityFlags=[],this.generalConstraintIndicatorFlags=[],this.spsList=[],this.nalus=[],this.configVersion=e.read(1),t=Fc.fromByte(e,1),this.generalProfileSpace=t.read(2),this.generalTierFlag=t.read(1),this.generalProfileIdc=t.read(5),t=Fc.fromByte(e,4),this.generalProfileCompatibilityFlags=Array.from(Array(32)).map((()=>t.read(1))),this.generalConstraintIndicatorFlags=Array.from(Array(6)).map((()=>e.read(1))),this.generalLevelIdc=e.read(1),this.minSpatialSegmentationIdc=4095&e.read(2),this.parallelismType=3&e.read(1),this.chromaFormatIdc=3&e.read(1),this.bitDepthLumaMinus8=7&e.read(1),this.bitDepthChromaMinus8=7&e.read(1),this.avgFrameRate=e.read(2),t=Fc.fromByte(e,1),this.constantFrameRate=t.read(2),this.numTemporalLayers=t.read(3),this.temporalIdNested=t.read(1),this.lengthSizeMinusOne=t.read(2);const n=e.read(1);for(let t=0;t<n;t++){const t=Fc.fromByte(e,1),n=t.read(1);t.skip(1);const r=t.read(6),i=e.read(2);for(let t=0;t<i;t++){const t=new Uint8Array(e.read(2)).map((()=>e.read(1)));this.nalus.push({completeness:n,type:r,data:t}),r===jc.SPS&&this.spsList.push(new Fh(t))}}}},ilst:_h,keys:_h,mdhd:class extends Th{constructor(e){super(e),this.isContainer=!1,1===this.version?(this.createTime=Ch(e.read(8)),this.modifyTime=Ch(e.read(8)),this.timescale=e.read(4),this.duration=e.read(8)):(this.createTime=Ch(e.read(4)),this.modifyTime=Ch(e.read(4)),this.timescale=e.read(4),this.duration=e.read(4));const t=e.read(2),n=e=>31&e+96;this.language=String.fromCharCode(n(t>>10),n(t>>5),n(t)).trim(),this.quality=xh(e.readInt(1),e.readInt(1))}},mdia:class extends _h{constructor(){super(...arguments),this.isContainer=!0}},meta:_h,mfhd:class extends Th{constructor(e){super(e),this.isContainer=!1,this.sequenceNumber=e.read(4)}},minf:class extends _h{constructor(){super(...arguments),this.isContainer=!0}},moof:class extends _h{constructor(){super(...arguments),this.isContainer=!0,this.traf=[]}},moov:class extends _h{constructor(){super(...arguments),this.isContainer=!0,this.trak=[]}},mp4a:class extends _h{constructor(e){if(super(),this.isContainer=!0,this.dataReferenceIndex=0,this.channelCount=0,this.sampleSize=0,this.sampleRate=0,e.unreadLength<28)return;e.skip(6),this.dataReferenceIndex=e.read(2);const t=e.read(2);e.skip(6),this.channelCount=e.read(2),this.sampleSize=e.read(2),e.skip(4),this.sampleRate=e.read(4)>>>16,1===t?(e.skip(4),e.skip(4),e.skip(4),e.skip(4)):2==t&&(e.skip(4),this.sampleRate=e.read(8),this.channelCount=e.read(4),e.skip(4),this.sampleSize=e.read(4),e.skip(4),e.skip(4),e.skip(4))}},mvhd:class extends Th{constructor(e){super(e),this.isContainer=!1,this.matrix=[],this.createTime=Ch(e.read(4)),this.modifyTime=Ch(e.read(4)),this.timescale=e.read(4),this.duration=e.read(4),this.rate=+(e.read(2)+"."+e.read(2)),this.volume=+(e.read(1)+"."+e.read(1)),e.skip(10);for(let t=0;t<9;t++)this.matrix.push(+(e.read(2)+"."+e.read(2)));e.skip(24),this.nextTrackId=e.read(4)}},pasp:class extends _h{constructor(e){super(),this.isContainer=!1,this.hSpacing=e.read(4),this.vSpacing=e.read(4)}},pssh:class extends Th{constructor(e){super(e),this.isContainer=!1,this.systemIds=[],this.keyIds=[];for(let t=0;t<16;t++)this.systemIds.push(Dh(e.read(1)));if(this.version>0){const t=e.read(4);for(let n=0;n<t;n++){const t=Array.from(Array(16)).map((()=>Dh(e.read(1)))).join("");this.keyIds.push(t)}}const t=e.read(4);this.data=e.readToUint8(t)}},sbgp:class extends Th{constructor(e){super(e),this.isContainer=!0,this.entries=[],this.groupingType=e.readString(4),1===this.version?this.groupingTypeParameter=e.read(4):this.groupingTypeParameter=0;const t=e.read(4);for(let n=0;n<t;n++)this.entries.push({sampleCount:e.readInt(4),groupDescriptionIndex:e.readInt(4)})}},schi:class extends _h{constructor(){super(...arguments),this.isContainer=!0}},senc:class extends Th{constructor(e){super(e),this.isContainer=!1,this.samples=[],this.sampleCount=e.read(4),this.byte=e}caculateSamples(e=8){for(let t=0;t<this.sampleCount;t++){const t=[];for(let n=0;n<e;n++)t.push(this.byte.read(1));const n=this.byte.read(2),r=[];for(let e=0;e<n;e++)r.push({bytesOfClearData:this.byte.read(2),bytesOfProtectedData:this.byte.read(4)});this.samples.push({initializationVector:t,subsamples:r})}}},sgpd:_h,sidx:class extends Th{constructor(e){super(e),this.isContainer=!1,this.references=[],this.trackId=e.read(4),this.timescale=e.read(4),0===this.version?(this.pts=e.read(4),this.offset=e.read(4)):(this.pts=e.read(8),this.offset=e.read(8)),e.skip(2);const t=e.read(2);for(let n=0;n<t;n++){const t=Fc.fromByte(e,4),n=e.read(4),r=Fc.fromByte(e,4);this.references.push({type:t.read(1),size:t.read(31),duration:n,startWithSap:r.read(1),sapType:r.read(3),sapDeltaTime:r.read(28)})}}},sinf:class extends _h{constructor(){super(...arguments),this.isContainer=!0}},smhd:class extends Th{constructor(e){super(e),this.isContainer=!1,this.balance=e.read(2)}},stbl:class extends _h{constructor(){super(...arguments),this.isContainer=!0}},stco:class extends Th{constructor(e){super(e),this.isContainer=!1,this.chunkOffsets=[];for(let t=e.read(4),n=0;n<t;n++)this.chunkOffsets.push(e.read(4))}},stsc:class extends Th{constructor(e){super(e),this.isContainer=!1,this.entries=[];for(let t=e.read(4),n=0;n<t;n++)this.entries.push({firstChunk:e.read(4),samplePerChunk:e.read(4),sampleDescriptionIndex:e.read(4)})}},stsd:class extends Th{constructor(e){super(e),this.isContainer=!0,e.skip(4)}},stss:class extends Th{constructor(e){super(e),this.isContainer=!1,this.sampleNumbers=[];for(let t=e.read(4),n=0;n<t;n++)this.sampleNumbers.push(e.read(4))}},stsz:class extends Th{constructor(e){super(e),this.isContainer=!1,this.sampleSizes=[],this.sampleSize=e.read(4);for(let t=e.read(4),n=0;n<t;n++)0===this.sampleSize?this.sampleSizes.push(e.read(4)):this.sampleSizes.push(this.sampleSize)}},stts:class extends Th{constructor(e){super(e),this.isContainer=!1,this.sampleCounts=[],this.sampleDurations=[];for(let t=e.read(4),n=0;n<t;n++)this.sampleCounts[n]=e.read(4),this.sampleDurations[n]=e.read(4)}},tenc:class extends Th{constructor(e){if(super(e),this.isContainer=!1,e.skip(1),0===this.version)e.skip(1),this.cryptByteBlock=0,this.skipByteBlock=0;else{const t=e.read(1);this.cryptByteBlock=t>>4,this.skipByteBlock=15&t}this.isProtected=e.read(1),this.perSampleIvSize=e.read(1),this.isProtected&&!this.perSampleIvSize?this.keyId=Array.from(Array(16)).map((()=>Dh(e.read(1)))).join(""):this.keyId=""}},tfdt:class extends Th{constructor(e){super(e),this.isContainer=!1,1===this.version?this.baseMediaDecodeTime=e.read(8):this.baseMediaDecodeTime=e.read(4)}},tfhd:class extends Th{constructor(e){super(e),this.isContainer=!1,this.baseDataOffset=0,this.defaultSampleDescriptionIndex=0,this.defaultSampleDuration=0,this.defaultSampleSize=0,this.defaultSampleFlag=0,this.trackId=e.read(4),1&this.flag&&(this.baseDataOffset=e.read(8)),2&this.flag&&(this.defaultSampleDescriptionIndex=e.read(4)),8&this.flag&&(this.defaultSampleDuration=e.read(4)),16&this.flag&&(this.defaultSampleSize=e.read(4)),32&this.flag&&(this.defaultSampleFlag=e.read(4))}},tkhd:class extends Th{constructor(e){super(e),this.isContainer=!1,this.matrix=[],this.createTime=Ch(e.read(4)),this.modifyTime=Ch(e.read(4)),this.trackId=e.read(4),e.skip(4),this.duration=e.read(4),e.skip(8),this.layer=e.read(2),this.alternateGroup=e.read(2),this.volume=+(e.read(1)+"."+e.read(1)),e.skip(2),this.matrix=[];for(let t=0;t<36;t++)this.matrix.push(e.read(1));e.back(36);const t=[];for(let n,r=0;r<3;r++)t.push(xh(e.readInt(2),e.readInt(2))),t.push(xh(e.readInt(2),e.readInt(2))),n=e.readInt(4),t.push(xh(n>>30,1073741823&n));this.rotation=function(e){if(e.length<5)return 0;const t=Math.hypot(e[0],e[3]),n=Math.hypot(e[1],e[4]);return 0===t||0===n?0:180*Math.atan2(e[1]/n,e[0]/t)/Math.PI}(t),this.width=+(e.read(2)+"."+e.read(2)),this.height=+(e.read(2)+"."+e.read(2))}},traf:class extends _h{constructor(){super(...arguments),this.isContainer=!0}},trak:class extends _h{constructor(){super(...arguments),this.isContainer=!0}},trex:class extends Th{constructor(e){super(e),this.isContainer=!1,this.trackId=e.read(4),this.defaultSampleDescriptionIndex=e.read(4),this.defaultSampleDuration=e.read(4),this.defaultSampleSize=e.read(4),this.defaultSampleFlag=e.read(4)}},trun:class extends Th{constructor(e){super(e),this.isContainer=!1,this.sampleDurations=[],this.sampleSizes=[],this.sampleFlags=[],this.sampleCTSs=[],this.sampleCount=e.read(4),1&this.flag?this.dataOffset=e.readInt(4):this.dataOffset=0,4&this.flag?this.firstSampleFlag=e.read(4):this.firstSampleFlag=0;for(let t=0;t<this.sampleCount;t++)256&this.flag&&(this.sampleDurations[t]=e.read(4)),512&this.flag&&(this.sampleSizes[t]=e.read(4)),1024&this.flag&&(this.sampleFlags[t]=e.read(4)),2048&this.flag&&(0===this.version?this.sampleCTSs[t]=e.read(4):this.sampleCTSs[t]=e.readInt(4))}},udta:_h,url:_h,vmhd:class extends Th{constructor(e){super(e),this.isContainer=!1,this.graphicsMode=e.read(2),this.opcolor=[e.read(2),e.read(2),e.read(2)]}},wave:class extends _h{constructor(){super(...arguments),this.isContainer=!0}},wide:_h},Symbol.toStringTag,{value:"Module"})),qh=Vu.createLogger("mp4-parser");class Yh extends Eh{constructor(e={}){super(e),this._trexs=[],this._reservedMdatHeaders=[],this.name="MP4Parser",this._handlebox=e=>{const{header:t,body:n}=e;switch(t.type){case"moov":return qh.log("moov box loaded",e),this._media=new Mh(n),this.emit("loadedmetadata",this._media.getMetadata());case"trex":return void this._trexs.push(n);case"moof":{const e=this._media;if(!e)return;return void n.traf.forEach((n=>{if(!n.tfhd)return;const r=e.getTrackById(n.tfhd.trackId||-1),i=this._trexs.find((e=>e.trackId==e.trackId));r&&function(e,t,n){const{tfhd:r,trun:i,tfdt:s}=e,a=[];if(!(s&&i&&s&&r))return a;const{sampleCTSs:o,sampleCount:l,sampleFlags:u,sampleDurations:c,sampleSizes:h,flag:d}=i,{flag:f}=r,p=f&Ph.SAMPLE_DUR?r.defaultSampleDuration:(null==t?void 0:t.defaultSampleDuration)||0,g=f&Ph.SAMPLE_SIZE?r.defaultSampleSize:(null==t?void 0:t.defaultSampleSize)||0,m=f&Ph.SAMPLE_FLAGS?r.defaultSampleFlag:(null==t?void 0:t.defaultSampleFlag)||0;for(let e=0,t=0,v=f&Ph.BASE_DATA_OFFSET?r.baseDataOffset:f&Ph.DEFAULT_BASE_IS_MOOF?n:i.dataOffset+n,y=0;y<l;y++){const n={};n.index=y,n.size=d&wh.SIZE?h[y]:g,n.duration=d&wh.DURATION?c[y]:p,n.dts=e>0?e:s?s.baseMediaDecodeTime:0,n.cts=o[y]||0,e=n.dts+n.duration;let r=m;d&wh.FLAG?r=u[y]:0===y&&d&wh.FIRST_FLAG&&(r=i.firstSampleFlag),n.flag=r,n.isKeyframe=!(16842752&r),n.isKeyframe&&t++,n.gopId=t,n.pos=v,v+=n.size,a.push(n)}return a}(n,i,t.pos).forEach((e=>{r.addSample(e)}))}))}}},this.on("loadedbox",this._handlebox)}_parseMetaBox(e,t,n){var r;const i=[];for(;e.unreadLength>=yh.MIN_SIZE;){const s=new yh(e,t+e.offset);if(!s.size){const e=`box ${s.type} invalid size ${s.size}`;qh.error(e),this.emit("error",new rc(rc.Code.DEMUX_MP4,e));break}if("mdat"===s.type)return e.back(s.headerSize),{break:!1,boxes:i,mdatHeader:s};if("moov"===s.type&&this._media){qh.warn("moov box has already loaded");break}const a=s.size-s.headerSize;if(e.unreadLength<a){e.back(s.headerSize);break}{const t=new Bc(e.buffer,e.offset,a);e.skip(a);const o=Qh[s.type];let l;o?l=new o(t):(l=new bh(t),qh.warn(`box ${s.type} has no handler`));const u={header:s,body:l};if(l&&l.isContainer){const e=new Yh;e[s.type]=l,null==(r=e._parseMetaBox(t,s.pos+s.headerSize,n).boxes)||r.forEach((e=>{const t=e.header.type;Array.isArray(l[t])?l[t].push(e.body):l[t]=e.body}))}i.push(u),null==n||n(u)}}return{break:!0,boxes:i}}_parseMdatBox(e,t,n){const{media:r,mdatHeader:i}=n,s=e.offset+t,a=e.size+t,o=e.readToUint8(),l=[],u=[];r.getTracks().filter((e=>e.getMetadata().type!==Uc.UNKNOWN)).forEach((e=>{e.processPackets(o,s).forEach((e=>u.push(e)));const t=e.getNextSamplePos();t>=0&&l.push(t),e.getNextSample()})),u.length?this.emit("loadedpackets",{data:u}):qh.debug(`no packet found at mdat rangeStart: ${s}, dataSize: ${a-s}, nextSampleSize: ${r.getTracks().map((e=>e.getNextSampleSize()))}`),e.back(o.byteLength);const c=Math.min(...l)-s;if(c<0){const e="the mdat data does not contain the start position of the next sample";throw new rc(rc.Code.DEMUX_MP4,e)}return e.skip(c),u.length&&i.pos+i.size<a?{break:!1,mdatHeader:void 0}:{break:!0,mdatHeader:i}}_loadTailMoovBox(e){const t=e.pos+e.size;return qh.info("mdat is ahead of moov box, cancel the current request and load moov box first"),this.loader.abort(),this.loader.loadRange(t).then((()=>{qh.info("load moov box success, jump to the start position of mdat box"),this.loader.jump(e.pos),this.loader.status!==fc.SUSPENDED?this.loader.loadRange(e.pos,t-1):qh.info("because the loader is suspended, subsequent mdat data is not loaded")})),{break:!0,discard:!0}}_parseLoop(e,t){this._currMdatHeader||(this._currMdatHeader=this._reservedMdatHeaders.find((e=>e.pos+e.size>t&&e.pos<t)));let n={break:!1};for(;!n.break;)this._currMdatHeader?this._media?(n=this._parseMdatBox(e,t,{mdatHeader:this._currMdatHeader,media:this._media}),this._currMdatParsed=!0,this._currMdatHeader=n.mdatHeader):(n=this._loadTailMoovBox(this._currMdatHeader),this._currMdatHeader=void 0):(n=this._parseMetaBox(e,t,this._handlebox),this._currMdatHeader=n.mdatHeader,n.mdatHeader&&this._reservedMdatHeaders.push(n.mdatHeader));return n}probe(e){const t=[...e.subarray(4,8)].map((e=>String.fromCharCode(e)));return e.byteLength>7&&"ftyp"===t.join("")}parse(e,t=0){const n=this.loader.total<=e.byteLength+t;if(e.byteLength){let n=e,r=t;this._reservedUint8&&(n=Bc.concatUint8(this._reservedUint8,e),r-=this._reservedUint8.byteLength,this._reservedUint8=void 0);const i=Bc.fromUint8(n);!this._parseLoop(i,r).discard&&i.unreadLength&&(this._reservedUint8=i.readToUint8())}n&&this._currMdatParsed&&this.emit("eos")}seek(e){if(this._currMdatHeader=void 0,this._reservedUint8=void 0,this.loader.suspend(),this._media){const t=this._media.getTracks();t.map((t=>t.seek(e)));const n=Math.min(...t.map((e=>e.getNextSamplePos())));this.loader.loadRange(n)}}reset(){super.reset(),this._trexs=[],this._media=void 0,this._currMdatParsed=void 0,this._currMdatHeader=void 0,this._reservedUint8=void 0,this._reservedMdatHeaders=[]}destroy(){super.destroy(),this.off("loadedbox",this._handlebox)}}class Jh extends zu{constructor(){super(...arguments),this._waitingQueue=[],this._preloadingMap=new Map,this._preloadingOrDoneAllSrcMap=new Map,this._preloadingOrDoneDedupSrcMap=new Map,this._logger=Vu.createLogger("preloader"),this._config={maxCount:6,maxCacheCount:4,maxPreloadDuration:5,maxPreloadDataSize:0,maxConcurrency:1,preloadTriggerPlayTime:0,preloadTriggerBufferDuration:3},this._getPreloadStats=e=>{const{maxPreloadDuration:t,maxPreloadDataSize:n}=this._config,r=t>0,i=n>0,s={dataSize:0,duration:0};return(i||r)&&e.stdout.setLevelAlgorithm(((e,a)=>{const o=e.value;let l=!1;if(o){o.type===Kc.InitSegmentCreated&&this.emit("preloadedmetadata",o.metadata);const e=o.type===Kc.DataSegmentCreated?o.endDecodeTime-o.startDecodeTime:0;a?(s.duration+=e,s.dataSize+=o.data.byteLength):(s.duration-=e,s.dataSize-=o.data.byteLength),r&&(l=l||s.duration>=t),i&&(l=l||s.dataSize>=n)}return l?kc.FULL:kc.LOW})),s}}get triggerPlayTime(){return this._config.preloadTriggerPlayTime}get triggerBufferDuration(){return this._config.preloadTriggerBufferDuration}static getSourceUrl(e,t=0){return Array.isArray(e)?e[t]?e[t].url:"":e}_preloadNext(){let e;for(;;){if(e=this._waitingQueue.shift(),!e)return;const t=this.get(e.src);if(!t)break;if(!t.done)return t.demuxStream.resume()}const t=e,n=t.src,r=Jh.getSourceUrl(n),i=Array.isArray(n);this._logger.info("preload next,",`priority=${t.priority}, url=${r}`);const s=new Gc({name:"preload.demux",parsers:[new Yh],loaderOptions:t.loaderOptions}),a=new qc({name:"preload.remux"}),o=s.getLoader(),l=e=>{if(i&&d.srcIndex<n.length-1){d.srcIndex++;const e=n[d.srcIndex].url;if(e)return o.changeUrl(e),void s.resume()}d.error=e,this.emit("error",e)},u=e=>{this.emit("downloaded",e)};o.on("downloaded",u),s.on("error",l),a.on("error",l);const c=e=>{e===kc.FULL&&(this.emit("preloadend",d),d.done=!0,s.suspend(),a.stdout.off("levelchange",c),this._preloadingMap.delete(r),this._preloadingOrDoneDedupSrcMap.size<this._config.maxCacheCount&&this._preloadNext())},h=this._getPreloadStats(a);a.stdout.on("levelchange",c);const d={...t,demuxStream:s,remuxStream:a,stats:h,done:!1,srcIndex:0,unbindPreload:()=>{o.off("downloaded",u),s.off("error",l),a.off("error",l),a.stdout.off("levelchange",c),a.stdout.setLevelAlgorithm(void 0)}};i?(n.forEach((e=>this._preloadingOrDoneAllSrcMap.set(e.url,d))),this._preloadingMap.set(r,d),this._preloadingOrDoneDedupSrcMap.set(r,d)):(this._preloadingMap.set(r,d),this._preloadingOrDoneAllSrcMap.set(r,d),this._preloadingOrDoneDedupSrcMap.set(r,d)),a.resume(),s.pipe(a),this.emit("preloadstart"),s.load(r)}setConfig(e){Object.assign(this._config,e)}preload(){if(!this._waitingQueue.length)return;const{maxConcurrency:e,maxCacheCount:t}=this._config,n=Math.min(e,t-this._preloadingOrDoneDedupSrcMap.size);for(let e=0;e<n;e++)this._preloadNext()}suspend(){this._preloadingMap.forEach((e=>e.demuxStream.suspend()))}cancel(){this._preloadingMap.forEach((e=>e.demuxStream.suspend())),this._preloadingMap.clear()}delete(e){this._logger.info("delete, url=",e),this._waitingQueue.filter((t=>Array.isArray(t.src)?t.src.some((t=>t.url===e)):t.src!==e));const t=this._preloadingOrDoneAllSrcMap.get(e);t&&(t.demuxStream.destroy(),t.remuxStream.destroy(),Array.isArray(t.src)?t.src.some((e=>{this._preloadingOrDoneDedupSrcMap.delete(e.url),this._preloadingOrDoneAllSrcMap.delete(e.url)})):(this._preloadingOrDoneDedupSrcMap.delete(t.src),this._preloadingOrDoneAllSrcMap.delete(t.src)))}add(e){const t=this.get(e.src),n=this._waitingQueue;t?(this._logger.warn(`add, sourceConfig already exists, priority: \n        ${t.priority} -> ${e.priority}, sourceConfig=`,t),t.priority=e.priority,n.push(e)):(n.push(e),this._logger.info("add, sourceConfig=",e)),n.sort(((e,t)=>t.priority-e.priority));const{maxCacheCount:r,maxCount:i}=this._config;if(this._preloadingOrDoneDedupSrcMap.size>=r){const e=Array.from(this._preloadingOrDoneDedupSrcMap.values());e.sort(((e,t)=>t.priority-e.priority));const t=[],r=e.length,s=n.length,a=this._config.maxCacheCount;let o,l,u=r-1,c=s-1;for(;u>=0&&c>=0&&(o=e[u],l=n[c],i<=r+s-t.length||a-t.length>=r);)o.priority<l.priority?(t.push(o.demuxStream.getLoader().url),u--):(t.push(Jh.getSourceUrl(l.src)),c--);t.forEach((e=>this.delete(e)))}}getWaitQueue(){return this._waitingQueue}get(e){if(!Array.isArray(e))return this._preloadingOrDoneAllSrcMap.get(e);{let t;for(const n of e)return t=this._preloadingOrDoneAllSrcMap.get(n.url),t}}pull(e){const t=this.get(e);return t&&(t.unbindPreload(),Array.isArray(t.src)&&t.src.findIndex((t=>t.url===e))>t.srcIndex&&t.demuxStream.getLoader().changeUrl(e)),this._preloadingOrDoneAllSrcMap.delete(e),this._preloadingOrDoneDedupSrcMap.delete(e),this._preloadingMap.delete(e),this._waitingQueue.filter((t=>Array.isArray(t.src)?t.src.some((t=>t.url===e)):t.src===e)),t}clearWaitQueue(){this._waitingQueue=[]}clearAll(){this.clearWaitQueue(),this.cancel(),this._preloadingOrDoneAllSrcMap.clear(),this._preloadingOrDoneDedupSrcMap.forEach((e=>{e.demuxStream.destroy(),e.remuxStream.destroy()})),this._preloadingOrDoneDedupSrcMap.clear()}}const Zh=new Jh;var ed=Object.defineProperty,td=(e,t,n)=>((e,t,n)=>t in e?ed(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class nd extends yu.C{constructor(){super(),td(this,"_proxyEvent",(e=>"playCatch"==e?(t,n)=>{this.trigger(e,{vtype:t,error:n})}:"prf_data_size"==e?e=>{this.trigger("downloaderChunkReady",{chunkSize:e.cdn_size,speed:e.cdn_speed})}:"PRELOAD_INFO"==e?e=>{this.trigger("preloaderInfoReady",{size:e.byteLength||e.total,duration:e.duration,type:e.type||e.vtype,vid:e.vid})}:t=>{this.trigger(e,t)})),this.currentPlayer=null,this.rawEvents=["loadstart","loadeddata","loadedmetadata","durationchange","timeupdate","error","canplay","canplaythrough","volumechange","pause","playing","waiting","ended","seeking","seeked","stalled","abort","play","progress","downloaderError","downloaderChunkReady","memoryCompleted","playCatch","prf_data_size","PRELOAD_INFO","preloaderInfoReady","source_error","source_success","resolutionReady","exception"],this.extensionEvents=["autoplayPrevented"],this._callbacks=[],this.events=this.rawEvents.concat(this.extensionEvents)}set player(e){this.remove(),this.currentPlayer=e,this.bind()}remove(){this.currentPlayer&&this._callbacks.forEach(((e,t)=>{e()}))}bind(){this.currentPlayer&&(this.rawEvents.forEach(((e,t)=>{const n=this._proxyEvent(e);this.currentPlayer.bindEvent&&this.currentPlayer.bindEvent(e,n),this.currentPlayer.on&&this.currentPlayer.on(e,n),this._callbacks.push((()=>{this.currentPlayer.removeEvent&&this.currentPlayer.removeEvent(e,n),this.currentPlayer.off&&this.currentPlayer.off(e,n)}))})),this.extensionEvents.forEach(((e,t)=>{const n=this._proxyEvent(e);this.currentPlayer.proxyOn&&this.currentPlayer.proxyOn(e,n),this._callbacks.push((()=>{this.currentPlayer.proxyOff&&this.currentPlayer.proxyOff(e,n)}))})))}release(){this.remove(),this.currentPlayer=null,this._events=[],this.rawEvents=[],this._callbacks=[]}}class rd extends yu.C{constructor(e){super(),this.autoplay=!0,this.muted=!1,this.preload="auto",this.id="",this.codec="",this.resolution="",this.bandwidth=0,this.cpu=0,this.memory=0,this.userAgent="",this.bitrate=0,this.networkType=""}set extraVideoInfo(e){e&&(e.codec&&(this.codec=e.codec),e.resolution&&(this.resolution=e.resolution),e.id&&(this.id=e.id),e.bitrate&&(this.bitrate=e.bitrate))}}class id{constructor(){td(this,"addChunk",(e=>{this.chunks.push(e),this.chunks.length>=this.limit&&this.chunks.shift()})),td(this,"release",(()=>{this.chunks=[]})),this.chunks=[],this.limit=6,this.lastAverageSpeed=0}get averageSpeed(){let e=0,t=0;for(const n of this.chunks)n.size>0&&n.duration>0&&(e+=n.size,t+=n.duration);return t>0&&(this.lastAverageSpeed=8*e/1024/1024/t),this.lastAverageSpeed}}class sd extends yu.C{constructor(e){super(),this.device=e,this.speedMeasurement=new id}inputChunkInfo(e,t){this.speedMeasurement.addChunk(e,t)}get averageSpeed(){return this.speedMeasurement.averageSpeed}get baseSpeed(){return this.device?this.device.bandwidth:0}get speed(){return this.averageSpeed?this.averageSpeed:this.baseSpeed}}let ad=0;class od extends yu.C{static get UUIDIndex(){return ad++,ad}static set UUIDIndex(e){ad=e}static generateUUID(e){return e+"_Multimedia_"+od.UUIDIndex}constructor(e="RAW",t){super(),this.uuid=od.generateUUID(e),this.type=e,this.element=null,this.player=null,this.forceAutoplay=!1,this.attemptPlayCount=0,this.vqscore=0,this.mvmaf="",this.events=["autoplayPrevented"],this.state=t||Tu.R.ACTIVE,this.bitrateList=[],this.curBitrate=null,this.resolutionInfo=null}style(e,t){this.element&&(this.element.style[e]=t)}set volume(e){this.element&&(this.element.volume=e)}set muted(e){this.element&&(this.element.muted=e)}set playbackRate(e){this.element&&(this.element.playbackRate=e)}get currentTime(){return this.element?this.element.currentTime:0}get duration(){return this.element?this.element.duration:0}get width(){return this.element?this.element.videoWidth:0}get height(){return this.element?this.element.videoHeight:0}get error(){return this.element?this.element.error:null}get attributes(){const{element:e}=this;return{error:(null==e?void 0:e.error)||null,src:(null==e?void 0:e.currentSrc)||"",currentTime:(null==e?void 0:e.currentTime)||0,muted:!(null==e||!e.muted),duration:(null==e?void 0:e.duration)||0,readyState:(null==e?void 0:e.readyState)||0,networkState:(null==e?void 0:e.networkState)||0,buffered:null==e?void 0:e.buffered,volume:(null==e?void 0:e.volume)||1,ended:!(null==e||!e.ended),paused:!(null==e||!e.paused),seeking:!(null==e||!e.seeking),currentSrc:(null==e?void 0:e.currentSrc)||""}}get isReady(){return!!this.element&&this.element.readyState>=2}get curDefinition(){return{url:"",definition:"",bitrate:-1,duration:-1,codecType:"h264"}}get playbackQuality(){return this.element?this.element.getVideoPlaybackQuality():null}getVideoPlaybackQuality(){var e,t;return(null==(t=null==(e=this.element)?void 0:e.getVideoPlaybackQuality)?void 0:t.call(e))||null}proxyOn(e,t){return super.on(e,t)}proxyOff(e,t){return super.off(e,t)}updateConfig(e){}on(e,t){this.element&&this.element.addEventListener(e,t)}off(e,t){this.element&&this.element.removeEventListener(e,t)}once(e,t){}mute(e){this.element&&(this.element.muted=e)}access(){if(this.element)return this.play().then((()=>{this.pause()}))}load(e){if(!this.element)return;let t="";t=e instanceof Array?e.length>0?e[0].src:"":e,this.element.src=t}seek(e){this.element&&(this.element.currentTime=e)}play(){return this.element?this.element.play():Promise.resolve()}replay(){return this.seek(0),this.play()}pause(){this.element&&this.element.pause()}get buffered(){var e;return null==(e=this.element)?void 0:e.buffered}reset(){}release(e){this.attemptPlayCount=0}addSubtitle(e,t){}async enterFullscreen(e){this.element&&(this.element.requestFullscreen?this.element.requestFullscreen():this.element.mozRequestFullScreen?this.element.mozRequestFullScreen():this.element.webkitRequestFullscreen?this.element.webkitRequestFullscreen():this.element.msRequestFullscreen?this.element.msRequestFullscreen():this.element.webkitEnterFullscreen&&this.element.webkitEnterFullscreen())}async exitFullscreen(e){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.webkitExitFullscreen?window.document.webkitExitFullscreen():window.document.msExitFullscreen?window.document.msExitFullscreen():this.element&&this.element.webkitExitFullScreen&&this.element.webkitExitFullScreen()}tryPlay(e){window.setTimeout((()=>{this.attemptPlayCount>=3||(!e.message.match(Tu.P.LoadInterrupt)&&!e.message.match(Tu.P.Abort)&&this.trigger("autoplayPrevented",e),(e.message.match(Tu.P.NoInteract)||e.message.match(Tu.P.SafariNoInteract)||e.message.match(Tu.P.FireFox))&&this.mute(!0),this.play(),this.attemptPlayCount+=1)}),0)}initStyle(){this.element&&(this.element.style.width="100%",this.element.style.height="100%",this.element.style.position="absolute",this.element.style.top="0",this.element.style.left="0",this.element.style["::-webkit-media-controls-enclosure"]={display:"none !important"})}initProperty(){this.element&&(this.element.controls=!1,this.element.loop=!1,this.element.muted=!1,this.element.playsInline=!0,this.element.poster="",this.element.preload="auto")}getVideoDesc(){return{videoType:"mp4"}}preloadResources(e){}updatePreloadCodec(e){}updatePreloadConfig(e){}getPreloadMeta(e){return null}changeState(e){this.state=e}}class ld extends od{constructor(e){super("TT"),this._init(e)}_init(e){this.player=new r.StreamPlayer({withCredentials:!0}),this.player.on("DOWNLOADER_ERROR",(e=>{})),this.player.on("DOWNLOADER_CHUNK_READY",(e=>{})),this.element=this.player.element,this.initStyle(),this.initProperty()}_initLoggerBefore(){}play(){return new Promise(((e,t)=>{this.player.play().then((()=>{e()})).catch((e=>{this.forceAutoplay&&this.tryPlay(e)}))}))}pause(){this.player.pause()}load(e){this.player.load(e)}release(e){super.release(e),this.player.release()}reset(){this.pause(),this.seek(0)}on(e,t){this.player.on(e,t)}off(e,t){this.player.off(e,t)}once(e,t){const n=r=>{t(r),this.player.off(e,n)};this.player.on(e,n)}addSubtitle(e,t){this.player.addSubtitle(e,t)}get isReady(){return this.player.isReady}get playbackQuality(){return this.player?this.player.getQualityInfo():super.playbackQuality}}const ud="MP4",cd="h264",hd="h265",dd={"360P":"360","480P":"480","540P":"540","720P":"720","1080P":"1080","2K":"2k","4K":"4k"};function fd(e){let t="";return Object.keys(dd).forEach((n=>{const r=dd[n];!t&&e.indexOf(r)>-1&&(t=n)})),t}const pd="auto",gd=new class{constructor(){this.config={disablelist:[],diasblePriority:!0,resolutionOrder:["360P","480P","540P","720P","1080P"],priority:{"360P":["adapt_lowest_360_1","normal_360_0"],"480P":["normal_480_1","normal_480_0"],"540P":["adapt_540_1","adapt_lowest_540_1","normal_540_1","lower_540_1","lowest_540_1","normal_540_0","lower_540_0","lowest_540_0"],"720P":["adapt_lower_720_1","normal_720_0","normal_720_1"],"1080P":["adapt_lowest_1080_1","normal_1080_1","normal_1080_0","vladder_1080_1","original_1080_0"]}}}setConfig(e){Object.keys(e).forEach((t=>{this.config[t]=e[t]}))}filterByVtypeAndCodec(e,t,n){return e.filter((e=>e.codecType===t&&e.vtype===n))}duplicatesResolution(e){const t=[],n=[];for(let r=0;r<e.length;r++){const i=e[r],s=i.resolution||"";t.indexOf(s)<0&&(t.push(s),n.push(i))}return n}getResolutionKey(e){return fd(e)}addResolutionKey(e){return e.map((e=>{const t=e.gearName||e.definition||"";return e.resolution=fd(t),e}))}filterByResolution(e,t,n){const{codecType:r,vtype:i}=n,{resolutionOrder:s}=this.config;let a=this.filterByVtypeAndCodec(t,r,i);if(0===a.length&&r===hd&&(a=this.filterByVtypeAndCodec(t,"h264","MP4")),a.length<1||e===pd)return a;let o=s.indexOf(e)||0,l=[];for(;0===l.length&&o>=0;)l=a.filter((e=>e.resolution===s[o])),o--;return l.sort(((e,t)=>t.bitrate-e.bitrate)),l.length>0?l:[t[0]]}filter(e,t){const{codecType:n="h264",vtype:r="MP4"}=t;e.sort(((e,t)=>e.bitrate-t.bitrate)),e=this.addResolutionKey(e);let i=this.filterByVtypeAndCodec(e,n,r);return 0===i.length&&"h265"===n&&(i=this.filterByVtypeAndCodec(e,"h264",r)),i=this.duplicatesResolution(i),i}};function md(e,t,n){const r=n.filter((n=>{if(e===n.vtype&&n.codecType===t)return n}));return r.sort(((e,t)=>e.bitrate-t.bitrate)),r}class vd{constructor(e){this.selectorName="base",this.config={}}updateConfig(e){}getMP4H264List(e){return md(ud,cd,e)}getTargetBitrate(e,t){return 0}select(e,t,n){return null}}class yd extends vd{constructor(e){super(e),this.selectorName="default",this.config={...e}}updateConfig(e){Object.keys(e).forEach((t=>{this.config[t]=e[t]}))}getMP4H264List(e){return md(ud,cd,e)}select(e,t,n){const{quality:r,hevcQuality:i}=t||this.config,{codecType:s,vtype:a}=n||{codecType:cd,vtype:ud},o=md(a,s,e),l=this.getMP4H264List(e),u=s===hd?i:r;let c=null;if(o.length>0){if(c=o.find((e=>e.qualityType===u)),!c){const e=14===u?"720P":"540P",t=gd.filterByResolution(e,o,{codecType:s,vtype:a});c=t.length>0?t[0]:o[0]}}else c=l.find((e=>e.qualityType===r)),c||(c=l.length>0?l[0]:null);return c}}function _d(e){return parseInt(e,10)}function Td(e,t,n=0){return n?1===n?function(e,t){if(!e)return null;let n=-1,r=1/0,i=-1;for(let s=0;s<e.length;s++)i=e[s].bitrate-t,i>0&&i<r&&(r=i,n=s);return n<0?null:e[n]}(e,t):null:function(e,t){if(!e)return null;let n,r=1/0;return e.forEach((e=>{const i=Math.abs(e.bitrate-t);r>i&&(n=e,r=i)})),n||null}(e,t)}const bd=new class{constructor(e={}){this._queue=[],this._config={},this.setConfig(e)}setConfig(e){this._config=Object.assign({},e)}get records(){return this._queue}appendPlayInfo(e){const{duration:t,endBufferTime:n,stalledTime:r,downloadDuration:i,bitrate:s}=e;if(!t||!s||!n)return;const{slidingWindowWeight:a=0,slidingWindowType:o=0,slidingWindowWeightThreshold:l=0,slidingWindowCountThreshold:u=0}=this._config,c=this.getAdjust(this._config,e);let h=0;if(h="time"===a?Math.min(i,t+r):Math.min(i,t)*s,h=_d(h),this._queue.push([c,h,e]),"by_weight"===o){this._queue=this._queue.slice(-30);let e=this._queue.reduce(((e,t)=>e+t[1]),0)-l;for(;e>0;){const t=this._queue.shift();if(!t)break;if(t[1]>e){t[1]-=e,this._queue.unshift(t);break}e-=t[1]}}else this._queue=this._queue.slice(-u)}getAdjust(e,t){const{startBufferTime:n,endBufferTime:r,leaveWithBlock:i,stalledTime:s,pausedTime:a,downloadDuration:o,bitrate:l}=t,{paramBf:u=.3,paramBp:c=.5,paramUpperBl:h=.7,paramUpper:d=1.5}=e;let f=1+((r-n)*u-(s+a)*c)/o;return i&&(f=Math.min(f,h)),i&&(f=Math.min(f,h)),_d(l*Math.max(d,f))}getDefaultBitrate(e){if(!e||0===e.length)return 0;const{defaultTargetBitrate:t=1e6}=this._config;let n=0;for(let r=0;r<e.length;r++)e[r].bitrate<=t&&e[r].bitrate>=n&&(n=e[r].bitrate);return n||(n=e[e.length-1].bitrate),n}getTargetBitrate(e={},t){const n=t.duration;if(!this._queue.length||!n)return 0;const r={...this._config,...e},{paramVlLower:i=.8,paramVlUpper:s=.9,paramVl1:a=.7,paramVl2:o=1e3,bitrateLower:l=2e5,bitrateUpper:u=2e6,slidingWindowExtraction:c}=r;let h=0;const d=this._queue.reduce(((e,t)=>e+t[1]),0);if("weighted_median"===c){const e=d/2;let t=1/0,n=0;this._queue.forEach((i=>{const s=this.getAdjust(r,i[2]);n=Math.abs(e-i[1]),n<t&&(h=s,t=n)}))}else h=this._queue.reduce(((e,t)=>e+t[1]/d*t[0]),0);const f=Math.min(s,Math.max(i,a+o/n));return _d(Math.max(l,Math.min(u,h*f)))}};function Sd(){return bd}class Pd extends vd{constructor(e){super(e),this.selectorName="buffer-info",this.rule=Sd(),this.rule.setConfig(e)}updateConfig(e){this.rule.setConfig(e)}getTargetBitrate(e,t){return this.rule.getTargetBitrate(e,t)}select(e,t,n){const{codecType:r,vtype:i}=n||{codecType:cd,vtype:ud},s=md(i,r,e),a=this.getMP4H264List(e),o=e.length>0?e[0].duration:0,l=(null==t?void 0:t.selectAlgType)||0,u=this.rule.getTargetBitrate(t,{duration:o||0});let c=null;return c=s.length>0?Td(s,u,l)||null:Td(a,u,l)||null,c}}const wd=[];class kd{constructor(e,t={}){this._timer=-1,this._prevPauseTime=0,this.video=null,this._onPlay=()=>{this._calcPausedTime()},this._onPause=()=>{this._prevPauseTime=Date.now()},this._onEnded=()=>{!this._info.downloadDuration&&this._info.canPlayTime&&(this._info.downloadDuration=_d(Date.now()-this._info.canPlayTime)/1e3),this.endPlay(),this.disable()},this._canPlay=()=>{if(!this.video)return;this._info.canPlayTime=Date.now(),this._info.duration=this.video.duration;const e=this.video.buffered;e.length&&(this._info.startBufferTime=e.end(e.length-1))},this._onProgress=()=>{if(!this.video)return;const e=this.video.buffered;this._info.canPlayTime&&e.length&&e.end(e.length-1)+.8>this.video.duration&&(this._info.downloadDuration=_d(Date.now()-this._info.canPlayTime)/1e3)},this._onTick=()=>{const e=this.video;if(!e)return;this._timer=setTimeout(this._onTick,500);const t=e.currentTime;!e.paused||e.ended||0===e.playbackRate||0===e.readyState?(this._prevCurrentTime===t?this._prevStallTime||(this._prevStallTime=Date.now()):this._calcStallTime(),this._prevCurrentTime=t):this._prevCurrentTime=t},this.video=e,this._videoId=e.getAttribute("data-xgplayerid")||(new Date).getTime(),this._timer=0,this._prevPauseTime=0,this._prevStallTime=0,this._prevCurrentTime=0,this.resetInfo(),this.enable(),null!=t&&t.bitrate&&(this.bitrate=t.bitrate),null!=t&&t.vid&&(this._info.vid=t.vid)}static get videoInfoList(){return wd}static checkIsInList(e){for(let t=0;t<wd.length;t++)if(wd[t].video===e)return t;return-1}static attachVideo(e,t={}){if(!e)return;const{duration:n}=e,r=kd.checkIsInList(e);r<0?wd.push({video:e,playInfo:new kd(e,{...t,duration:n||0})}):t.bitrate&&(wd[r].playInfo.bitrate=t.bitrate)}static detachVideo(e){if(!e)return;const t=kd.checkIsInList(e);if(t>=0){const e=wd.splice(t,1);e.length>0&&e[0].playInfo.destroy()}}get isStalling(){return!!this._prevStallTime}set bitrate(e){this._info.bitrate=e}enable(){this.disable();const e=this.video;e&&(e.addEventListener("play",this._onPlay),e.addEventListener("pause",this._onPause),e.addEventListener("loadeddata",this._canPlay),e.addEventListener("progress",this._onProgress),e.addEventListener("ended",this._onEnded),this._timer=setTimeout(this._onTick,500))}disable(){clearTimeout(this._timer),this.resetInfo();const e=this.video;e&&(e.removeEventListener("play",this._onPlay),e.removeEventListener("pause",this._onPause),e.removeEventListener("loadeddata",this._canPlay),e.removeEventListener("progress",this._onProgress),e.removeEventListener("ended",this._onEnded))}endPlay(){if(!this.video)return;const e=this.video.buffered;if(e.length)try{this._info.endBufferTime=e.end(e.length-1)}catch{}this._info.leaveWithBlock=this.isStalling,this._calcPausedTime(),this._calcStallTime();const{downloadDuration:t,canPlayTime:n}=this._info;!t&&n&&(this._info.downloadDuration=_d(Date.now()-n)/1e3),this.updateRuleByPlayInfo()}updateRuleByPlayInfo(){const e=this.getInfo();Sd().appendPlayInfo({duration:e.duration,bitrate:e.bitrate,downloadDuration:e.downloadDuration,startBufferTime:e.startBufferTime,endBufferTime:e.endBufferTime,pausedTime:e.pausedTime,stalledTime:e.stalledTime,leaveWithBlock:e.leaveWithBlock,vid:e.vid})}getInfo(){return this._info}resetInfo(){this._prevPauseTime=0,this._prevStallTime=0,this._prevCurrentTime=0,this._info={vid:"",duration:0,pausedTime:0,stalledTime:0,downloadDuration:0,startBufferTime:0,endBufferTime:0,canPlayTime:0,leaveWithBlock:!1,bitrate:0}}destroy(){this.endPlay(),this.disable(),this.video=null}_calcStallTime(){this._prevStallTime&&(this._info.stalledTime+=_d(Date.now()-this._prevStallTime)/1e3,this._prevStallTime=0)}_calcPausedTime(){this._prevPauseTime&&(this._info.pausedTime+=_d(Date.now()-this._prevPauseTime)/1e3,this._prevPauseTime=0)}}const Md="BitRateAdapter",Ed=new class{constructor(){this.defaultSelector="default";const e={quality:20,hevcQuality:28,minBitrate:0,maxBitrate:0,defaultVtype:"MP4",defaultCodecType:"h264",userSelectResolution:"auto",resolutionOrder:["360P","480P","540P","720P","1080P"],selector:"default",selectConfig:{},selectAlgType:0};this._selectors={default:new yd(e),"buffer-info":new Pd(e)},this.config={...e}}static get PlayingInfo(){return kd}updateConfig(e){const t=this.getSelector(this.defaultSelector);if(Object.keys(e).forEach((n=>{this.config[n]=e[n],t&&(t.config[n]=e[n])})),e.selectConfig){const t=this.getSelector(this.defaultSelector);t&&t.updateConfig(e.selectConfig)}e.filterConfig&&gd.setConfig(e.filterConfig)}setUseSelectResolution(e){this.config.useSelectResolution=e}addSelector(e,t,n){this._selectors[e]=new t(n||{})}getSelector(e){let t=this._selectors[e];return t||(t=this._selectors[this.defaultSelector]||this._selectors.defalut),t}getDefaultSelector(){return this._selectors[this.defaultSelector]}getFixedDefinition(e,t){if(t.length<0)return null;if(1===t.length)return t[0];const n=t.filter((t=>t.definition===e||t.qualityType===e));return n.length>0?n[0]:null}select(e,t,n,r={},i){const s=r.selector||this.config.selector||this.defaultSelector,{defaultVtype:a,defaultCodecType:o}=this.config,l=t||o,u=n||a,c=(null==i?void 0:i.resolution)||this.config.userSelectResolution||pd;let h=null;const d=e.length>0?e[0].uri:"";gd.addResolutionKey(e),e.sort(((e,t)=>e.bitrate-t.bitrate));const f=(null==i?void 0:i.definition)||"",p=gd.getResolutionKey(f);if(f&&"auto"!==c&&p===c&&(h=this.getFixedDefinition(f,e)),h)return(0,bu.l)(Md,d,"select FixedDefinition",`codecType:${l} vtype:${u} userSelectResolution:${c} selector:[${s}] defaultDefinition:${f}`,e,h),h;const g={...this.config.selectConfig,...r.config,quality:this.config.quality,hevcQuality:this.config.hevcQuality};let m=this.getSelector(s);const v=e.length>1?e[0].duration:0,y=gd.filterByResolution(c,e,{codecType:l,vtype:u}),_=m.getTargetBitrate(g,{duration:v})||0;return 0===_&&(m=this.getDefaultSelector()),h=m.select(y,g,{codecType:l,vtype:u,...i}),(0,bu.l)(Md,d,"select return",`codecType:${l} vtype:${u} userSelectResolution:${c} selector:[${s}] targetBitrate:${_}`,e,h),h}filterResolutionList(e,t){const n=e.length>0?e[0].uri:"",r=gd.filter(e,t);return(0,bu.l)(Md,n,"filterResolutionList",t,r),r}attachVideo(e,t){kd.attachVideo(e,t)}detachVideo(e){kd.detachVideo(e)}},Rd={preloadTime:10,segmentMinDuration:10,preloadCacheType:1,preloadMaxCacheCount:5,minBufferLength:10};function xd(e){return"string"==typeof e.url?e.url:e.url.length>0?e.url[0].src:""}function Dd(e){return e===Tu.a.NEW_TT}const Id="[ITTPreloader]";function Cd(e){const{url:t,extra:n,error:r,stats:i,priority:s}=e;(0,bu.l)(Id,"parsePreloadSource",e,n);const{curBitrate:a}=n||{};return r?null:{url:t,vid:null==n?void 0:n.vid,definition:(null==a?void 0:a.definition)||"",qualityType:(null==a?void 0:a.qualityType)||0,vtype:(null==a?void 0:a.vtype)||"",codecType:(null==a?void 0:a.codecType)||"",mediaType:"video",timeStamp:Date.now(),order:s,total:(null==i?void 0:i.dataSize)||0,duration:Math.round(1e3*((null==i?void 0:i.duration)||0))}}function Ld(e,t){const n=e.startPreloadControl;return{maxConcurrency:1,maxCount:t+(e.preloadMaxCacheCount||0),maxCacheCount:e.preloadMaxCacheCount,maxPreloadDuration:e.preloadTime,maxPreloadDataSize:e.preloadSize||0,preloadTriggerPlayTime:n?e.startPreloadMinPosTime:0,preloadTriggerBufferDuration:n?e.startPreloadMinBuffer:e.minBufferLength}}const Od="[MultiMediaPreloader]",Ad=new class{constructor(){if(this.ttPreloader=Zh,this.type=Tu.a.XG,this.codecType="h264",this.ttQueue=[],this.open=!1,this.playingVids=[],this.ttPriority=0,this.getRequestOptionsCallback=null,this.onPreloaderStart=()=>{(0,bu.l)(Od,"onPreloaderStart")},this.onPreloaderEnded=e=>{(0,bu.l)(Od,"onPreloaderEnded",Cd(e)),this.addTTPreloadItem()},this.onPreloaderError=e=>{(0,bu.l)(Od,"onPreloaderError",e),this.addTTPreloadItem()},this.maxQueueCount=3,typeof window>"u")return void(this.preloader=null);this.preloader=Sl.registerPreloader({...Rd}),Sl.BitRateAdapter=Ed,this.ttPreloader=Zh;const e=Ld({...Rd},this.maxQueueCount);Zh.setConfig(e),this.enable()}setType(e){this.type=e}update(e,t){var n;if((0,bu.l)(Od,"update",e,Rd),Dd(t)){const t=Ld({...Rd,...e},this.maxQueueCount);this.ttPreloader.setConfig(t)}else null==(n=this.preloader)||n.update(e);e.getRequestOptionsCallback&&(this.getRequestOptionsCallback=e.getRequestOptionsCallback)}onSelectBitrate(e,t){return Ed.select(e,this.codecType,t||"MP4")}changeCodec(e,t){(0,bu.l)(Od,"changeCodec",e,t),this.codecType=e,Dd(t)?this.ttPreloader:function(e,t){if(e){if(e.codecType===hd&&t===cd){const{allCachedKeys:t}=e;for(const n in t)n.includes(hd)&&e.removeItem(n,(e=>{(0,bu.l)("[changeCodec] remove success",n,e)}))}e.codecType=t}}(this.preloader,e)}attachPlayer(e,t){Dd(t)?this.ttPreloader:function(e,t){null==e||e.attachPlayer(t)}(this.preloader,e)}detachPlayer(e){var t;Dd(e)?this.ttPreloader:null==(t=this.preloader)||t.detachPlayer()}addTTPreloadItem(){let e;for(;!e&&this.ttQueue.length>0;){const t=this.ttQueue.shift();if(!((t?this.playingVids.findIndex((e=>e===(null==t?void 0:t.data.vid))):-1)>-1)&&t){e=t;break}}if(e){const t=function(e,t,n,r,i){const{vid:s,payload:a,getRequestOptionsCallback:o,reqOptions:l}=t.data,u=function(e,t,n){return Ed.select(e,t,n)}(a,n,r);if(u){const r=function(e){return"string"==typeof e?[{url:e}]:e.map((e=>({url:e.src})))}(u.url);if(!r)return null;const c=o||i,h={onBeforeRequest:(e,n)=>{const r=c;let i=null;return r?(i=r({url:e}),i&&(n.credentials=i.credentials)):l&&(n.credentials=l.credentials),(0,bu.l)(Id,"onBeforeRequest",`callback:${!!r}`,i,l,t,n,"url",e),n}},d={src:r,url:r,extra:{vid:s,vtype:u.vtype,bitrateList:a,curBitrate:u},priority:e,loaderOptions:h};return(0,bu.l)(Id,"transformTTPreload",n,u,a,d),d}return null}(this.ttPriority++,e,this.codecType,"MP4",this.getRequestOptionsCallback);!function(e,t){t&&e.add(t)}(this.ttPreloader,t)}}addPreloadList(e,t){return(0,bu.l)(Od,"addPreloadList",t,e),this.open?Dd(t)?(e.forEach((e=>{this.ttQueue.push(e)})),this.addTTPreloadItem(),e):function(e,t){return(null==e?void 0:e.addPreloaderList(t))||[]}(this.preloader,e):[]}clearTask(e){var t;Dd(e)?null==(t=this.ttPreloader)||t.clearWaitQueue():function(e){null==e||e.clearTask()}(this.preloader),this.ttQueue=[]}getPreloadMeta(e,t,n){const r=Dd(n)?function(e,t,n){for(let r=0;r<n.length;r++){const i=xd(n[r]),s=e.get(i)||null;if(s){const e=Cd(s);return(0,bu.l)(Id,"getPreloadMeta",`vid:${t}`,i,s,e),e}}return null}(this.ttPreloader,e,t||[]):function(e,t){return(null==e?void 0:e.getPreloadMetaByVid(t))||null}(this.preloader,e);return(0,bu.l)(Od,"getPreloadMeta",e,n,r),r}addPlayingVid(e,t){(0,bu.l)(Od,"addPlayingVid",e,t),Dd(t)?this.playingVids.push(e):function(e,t){null==e||e.addPlayingVid(t)}(this.preloader,e)}getPlayingVid(e){return Dd(e)?this.playingVids:(t=this.preloader)?t.playingVids1:[];var t}removePlayingVid(e,t){if((0,bu.l)(Od,"removePlayingVid",e,t),Dd(t)){const{playingVids:t}=this,n=t.findIndex((t=>t===e));n>-1&&t.splice(n,1)}else!function(e,t){null==e||e.removePlayingVid(t)}(this.preloader,e)}on(e,t,n){var r,i;Dd(n)?null==(r=this.ttPreloader)||r.on(e,t):null==(i=this.preloader)||i.on(e,t)}off(e,t,n){var r,i;Dd(n)?null==(r=this.ttPreloader)||r.off(e,t):null==(i=this.preloader)||i.off(e,t)}bindTTEvents(){this.ttPreloader.on("preloadend",this.onPreloaderEnded),this.ttPreloader.on("preloadstart",this.onPreloaderStart),this.ttPreloader.on("error",this.onPreloaderError)}unbindTTEvents(){this.ttPreloader.off("preloadend",this.onPreloaderEnded),this.ttPreloader.off("preloadstart",this.onPreloaderStart),this.ttPreloader.off("error",this.onPreloaderError)}disable(){this.open&&(this.open=!1,this.unbindTTEvents())}enable(){this.open||(this.open=!0,this.bindTTEvents())}getCore(e){return Dd(e)?this.ttPreloader:this.preloader}};function Gd(e,t){const{H264DefinitionList:n,h264DefinitionList:r}=e.config,i=r||n;if(i&&i.length>0){const n=i[0];return e.emit("playCatch","MP4_3",{errorCode:(null==t?void 0:t.code)||8200,message:(null==t?void 0:t.message)||"width and height is 0"}),e.setConfig({defaultBitrate:n.bitrate,defaultDefinition:n.definition,url:n.url,codecType:n.codecType}),e.src=n.url,e.play(),!0}return!1}function Bd(){const{regionInfo:e}=Pu.M,{shortData:t,deviceScore:n,gpuScoreData:r}=Pu.M.getInstance().deviceMark;return{playMode:Pu.M.playMode,tag:Pu.M.pageName,subtag:Pu.M.playMode,preTag:Pu.M.prePageName,preSubtag:Pu.M.prePlayMode,region:(null==e?void 0:e.region)||"",isLogin:!(null!=e&&e.isLogin),deviceScore:t,d_score:n||0,gpu:r.gpu||"",vendor:r.vendor||""}}function Nd(e,t){const{minBuffer:n}=t;if(!e||!n)return!0;if(e&&e.length>0){const t=e.end(e.length-1);if((0,bu.c)(t)>=n)return!0}return!1}function $d(e,t=!0){return!e||e.length<1?-1:t?e.end(e.length-1):e.start(e.length-1)}function Ud(e){return e&&e.player?e.player.hasStart?1:0:-1}function Fd(e){return e&&e.player?e.player.isPlaying?1:0:-1}function Hd(e){if(!e)return null;const t=$d(e.buffered);return{buff:t<0?t:(0,bu.c)(t),state:e.state,hasStart:Ud(e),playing:Fd(e)}}const Vd="[XGplayer]";class jd extends od{constructor(e,t){super("XG"),this._onAutoplayPrevent=()=>{var e;(0,bu.l)(Vd,this.uuid,"_onAutoplayPrevent",this.attemptPlayCount),!(this.attemptPlayCount>=3)&&this.forceAutoplay&&(this.mute(!0),null==(e=this.player)||e.play(),this.attemptPlayCount+=1)},this._onAutoplayStart=()=>{var e;(0,bu.l)(Vd,this.uuid,"onAutoplayStart"),null==(e=this.player)||e.off(m,this._onAutoplayPrevent)},this._onCanplay=()=>{if(this.state!==Tu.R.ACTIVE&&this.player){const e=this.player;e.currentTime>.1&&(e.currentTime=0),null==e||e.pause()}},this._onLoadedData=()=>{const e=this.player;if(!e||!e.media)return;const{videoWidth:t,videoHeight:n}=e.media;0===t&&0===n&&(Pu.a.focusDisableHevc({hevcMsg:"width and height is 0",hevcCode:2}),Gd(e),this.updatePreloadCodec("h264")),e.off(c,this._onLoadedData)},this._onTimeupdate=()=>{var e;this.state!==Tu.R.ACTIVE&&(null==(e=this.player)||e.pause())},this.plugins=[],this.metrics=null,this.event=null,this.config={};const n=t||Tu.R.ACTIVE;this.state=n,this._init(e),this.changeState(n)}checkNeedMSE(e){var t;return!(0,bu.i)()&&vu.isMediaSourceSupported()&&!(null!=(t=null==e?void 0:e.extra)&&t.closeMSE)}getVideoMiddleware(){return{error:(e,t)=>{const{player:n}=e;if(n)try{const r=Gd(n,null==e?void 0:e.error);n.setEventsMiddleware({error:null}),r||t("error",e)}catch{t("error",e)}else t("error",e)}}}_getInitBitrate(e,t,n,r){r&&Ed.updateConfig(r);const i=this.getPreloadMeta(t),s=function(e,t){return"h265"!==e||t&&"h265"!==t.codecType?"h264":"h265"}(n,i),a=(null==i?void 0:i.definition)||"";let o=[];if(e.length>0){o=Ed.filterResolutionList(e,{codecType:s,vtype:"MP4"});const t=Ed.select(e,s,"MP4",{},{definition:a});(0,bu.l)(Vd,this.uuid,`userSelectResolution:${Ed.config.userSelectResolution}`,"adapterConfig",r,e,t);let n=null;return"h265"===(null==t?void 0:t.codecType)&&(n=Ed.select(e,"h264","MP4")),t?{curBitrate:t,preloadCodec:(null==i?void 0:i.codecType)||null,preloadDefinition:(null==i?void 0:i.definition)||null,h264birate:n,bitrateList:o}:null}return null}_init(e){var t,n;const r={};e||(e={}),e.enableSubtitle&&this._initSubtitle(),e.enablePreloader&&e.preloader?this._initPreloader(e.preloader):Ad.disable(),e.enableLogger&&e.logger&&this._initLoggerBefore(e.logger);const i=this.checkNeedMSE(e);i?this.plugins.push(vu):r.preload="auto";const{video:s,logger:l,extra:u}=e,h=void 0===(null==s?void 0:s.autoplay)||s.autoplay,d=void 0!==(null==s?void 0:s.muted)&&s.muted;d&&(r.muted=d),this.vqscore=(null==s?void 0:s.vqscore)||0;const f=(null==l?void 0:l.line_app_id)||0,p=(null==l?void 0:l.vid)||"",{actualUrl:v,url:y}=u||{actualUrl:void 0,url:""},_=(null==u?void 0:u.vid)||"",{bitrateList:T=[]}=e,b=(null==s?void 0:s.codecType)||"h264",{bitrateAdapter:S}=e;this.bitrateList=T||[];const P=this._getInitBitrate(T,_,b,S),w=(null==P?void 0:P.curBitrate)||null;(0,bu.l)(Vd,this.uuid,"_init",`[${_}]`,"_getInitBitrate",`initCodec:${b} codecType:${null==w?void 0:w.codecType} preloadCodec:${null==P?void 0:P.preloadCodec} preloadDefinition:${null==P?void 0:P.preloadDefinition} defaultDefinition:${null==s?void 0:s.defaultDefinition} defaultBitrate:${null==s?void 0:s.defaultBitrate} userResolution:${null==S?void 0:S.userSelectResolution} definition:${null==w?void 0:w.definition} bitrate:${null==w?void 0:w.bitrate}`,null==P?void 0:P.h264birate,null==P?void 0:P.bitrateList,T);const k=(null==w?void 0:w.codecType)||b,M=(null==w?void 0:w.url)||v||y||"",E=null!=P&&P.h264birate?[null==P?void 0:P.h264birate]:(null==u?void 0:u.h264BitrateList)||[],R=(null==w?void 0:w.bitrate)||(null==s?void 0:s.defaultBitrate)||0,x=(null==w?void 0:w.definition)||(null==s?void 0:s.defaultDefinition)||"";if(this.mvmaf=(null==w?void 0:w.mvmaf)||(null==s?void 0:s.mvmaf)||"",this.config={vid:_,isNoRoot:!0,controls:!1,plugins:this.plugins,autoplay:h,codecType:k,width:"100%",height:"100%",videoConfig:r||{},volume:(null==s?void 0:s.volume)||1,playbackRate:(null==s?void 0:s.playbackRate)||1,H264DefinitionList:E,url:M,nullUrlStart:!M,ignores:(null==u?void 0:u.ignores)||[],defaultDefinition:x,defaultBitrate:R,duration:(null==s?void 0:s.duration)||0,videoInit:void 0===(null==u?void 0:u.videoInit)||u.videoInit,autoplayMuted:d},this.curBitrate=w,(0,bu.l)(Vd,"config",this.uuid,this.state,`videoInit:${this.config.videoInit}`,`addMSEPlugin:${i} closeMSE:${null==(t=e.extra)?void 0:t.closeMSE} needCheck:${null==(n=e.mp4EncryptPlayer)?void 0:n.needCheck}`,e),e.enableLogger){const{logger:t}=e,{ext:n={}}=t||{},r=Pu.a.getHevcDisableInfo()||{},i={...Bd(),codec_type:k,decodeFlag:"h265"===k,defaultBitrate:R,defaultDefinition:x,line_app_id:f,vid:p,vtype:"MP4",...t,playerCoreVersion:vu.version,pv:dt.version,strategyVersion:yu.v,ext:{...n,...r},bitrateAdapter:{userResolution:(null==S?void 0:S.userSelectResolution)||"auto",qualityType:(null==w?void 0:w.qualityType)||0,selector:(null==S?void 0:S.selector)||"default"},closeEvents:(null==t?void 0:t.closeEvents)||[],playerType:"XG"};this.config.vodLogOpts=i}e.mp4EncryptPlayer&&(this.config.mp4EncryptPlayer=e.mp4EncryptPlayer),this.player=new dt(this.config),Ed.attachVideo(this.player.media,{bitrate:this.config.defaultBitrate,vid:this.config.vid}),this.player.uuid=this.uuid,(0,bu.l)(Vd,this.uuid,"PlayerInit",this.config),this.player.on(m,this._onAutoplayPrevent),this.player.on(g,this._onAutoplayStart),this.player.on(c,this._onLoadedData),this.player.on(a,this._onTimeupdate),this.player.on(o,this._onCanplay),!i&&this.player.setEventsMiddleware(this.getVideoMiddleware()),this.player.preloader=Ad.preloader,this.element=this.player.media,this.initStyle(),this.initProperty(),Ad.addPlayingVid(_),this.resolutionInfo={currentResolution:(null==w?void 0:w.resolution)||"",codecType:k,vtype:"MP4",resolutionList:(null==P?void 0:P.bitrateList)||[],bitrateList:T},setTimeout((()=>{this.player.emit("resolutionReady",this.resolutionInfo)}),0)}_initSubtitle(){this.plugins.push(en)}_initPreloader(e){tn.DS.attachPreloader(Ad.preloader),Ad.update(e)}_initLoggerBefore(e){tn.DS.AB_SDK_VERSION=Pu.M.getAbVersions(),tn.K.init(Su.g,e.channelConfig,{region:e.region,user_unique_id:e.webId,user_is_login:e.isLogin,user_id:e.uid||e.webId}),this.plugins.push(tn.Ay)}set volume(e){this.player&&(this.player.volume=e||1)}set muted(e){this.player&&(this.player.muted=e)}set playbackRate(e){this.player&&(this.player.playbackRate=e)}get currentTime(){var e;return null==(e=this.player)?void 0:e.currentTime}get duration(){var e;return(null==(e=this.player)?void 0:e.duration)||0}get attributes(){const{element:e,player:t}=this,n=(null==t?void 0:t.rawSrc)||(null==e?void 0:e.currentSrc)||(null==e?void 0:e.src)||"";return{error:(null==e?void 0:e.error)||null,src:n,currentTime:(null==e?void 0:e.currentTime)||0,muted:!(null==e||!e.muted),duration:(null==e?void 0:e.duration)||0,readyState:(null==e?void 0:e.readyState)||0,networkState:(null==e?void 0:e.networkState)||0,buffered:null==e?void 0:e.buffered,volume:(null==e?void 0:e.volume)||1,ended:!(null==e||!e.ended),paused:!(null==e||!e.paused),seeking:!(null==e||!e.seeking),currentSrc:n}}get isReady(){var e;return(null==(e=this.player)?void 0:e.isCanplay)||!1}get volume(){var e;return(null==(e=this.player)?void 0:e.volume)||1}get muted(){var e;return(null==(e=this.player)?void 0:e.muted)||!1}get playbackRate(){var e;return(null==(e=this.player)?void 0:e.playbackRate)||1}get curDefinition(){var e;const t=(null==(e=this.player)?void 0:e.curDefinition)||null,{config:n}=this;return{url:(null==t?void 0:t.url)||"",bitrate:(null==t?void 0:t.bitrate)||n.defaultBitrate||-1,definition:(null==t?void 0:t.definition)||n.defaultDefinition,codecType:(null==t?void 0:t.codecType)||n.codecType||-1,duration:this.duration||0}}changeResolution(e){var t,n,r;const i=this.bitrateList,s=(null==(t=this.curBitrate)?void 0:t.codecType)||"h264",{resolution:a}=e;if(!this.player||a===(null==(n=this.curBitrate)?void 0:n.resolution))return;const o=Ed.select(i,s,"MP4",{},{resolution:e.resolution});if(Ed.updateConfig({userSelectResolution:e.resolution}),o){this.curBitrate=o;const e=this.player,t=this.state===Tu.R.ACTIVE;if(e.currentSrc.indexOf("blob:")<0){const n=e.currentTime;e.src=o.url,e.currentTime=n,e.config.url=o.url,t?e.play():e.pause()}else e.changeDefinition(o),t||e.pause();null!=(r=this.resolutionInfo)&&r.currentResolution&&(this.resolutionInfo.currentResolution=o.resolution||""),e.emit("resolutionReady",{...this.resolutionInfo})}}on(e,t,...n){var r;null==(r=this.player)||r.on(e,t,...n)}off(e,t){var n;null==(n=this.player)||n.off(e,t)}once(e,t){var n;null==(n=this.player)||n.once(e,t)}load(e){var t;null==(t=this.player)||t.playNext({url:e})}seek(e){this.player&&(this.player.currentTime=e)}play(){return(0,bu.l)(Vd,this.uuid,"play"),new Promise(((e,t)=>{this.player||t();const n=this.player.play();n||e(),n.then((()=>{e()})).catch((()=>{}))}))}pause(){return(0,bu.l)(Vd,this.uuid,"pause"),this.player.config.autoplay=!1,this.player.pause()}release(e){const{vid:t}=this.config;Ad.removePlayingVid(t),super.release(e);const n=this.player;n.off(m,this._onAutoplayPrevent),n.off(g,this._onAutoplayStart),n.off(c,this._onLoadedData),n.off(a,this._onTimeupdate),n.off(o,this._onCanplay),Ed.detachVideo(n.media),e||(n.destroy(),this.element=null)}reset(){}replay(){return this.player.replay()}addSubtitle(e,t){const n=this.player;!this.player||!n.plugins||!n.plugins.texttrack||n.plugins.texttrack.updateSubtitles(e,(e=>{t(e.text)}))}getVideoDesc(){return this.player?{videoType:this.player.vtype}:super.getVideoDesc()}preloadResources(e){Ad&&(Ad.clearTask(),Ad.addPreloadList(e))}updatePreloadConfig(e){Ad.update(e)}updatePreloadCodec(e){Ad.changeCodec(e)}updateConfig(e){this.player.setConfig({mp4encryptplayerConfig:{reqOptions:e}})}changeState(e){if(this.state=e,!this.player)return;const t=this.player,{mp4encryptplayer:n}=t.plugins;e===Tu.R.ACTIVE?(Ad.attachPlayer(t),n&&(n.isActive=!0)):n&&(n.isActive=!1),(0,bu.l)(Vd,"changeState",this.uuid,e===Tu.R.ACTIVE,e,t.isUserActive),t.emit("renderStateChange",{state:e})}getPreloadMeta(e){return Ad.getPreloadMeta(e)}async enterFullscreen(e){await this.player.getFullscreen(e)}async exitFullscreen(e){await this.player.exitFullscreen(e)}}class zd extends od{constructor(e){super("RAW"),this._init(e)}_init(e){this.player=new r.BasicPlayer({withCredentials:!0}),this.element=this.player.el,this.initStyle(),this.initProperty(),e&&(e.enablePreloader&&this._initPreloader(e.preloader),e.enableLogger&&this._initLoggerAfter(e),e.video&&(e.video.mvmaf&&(this.mvmaf=e.video.mvmaf),e.video.vqscore&&(this.vqscore=e.video.vqscore))),Ad.attachPlayer(this.element),e&&e.extra&&e.extra.url&&this.load(e.extra.url)}_initPreloader(e){const{preloader:t}=Ad;tn.DS.attachPreloader(t),Ad.update(e)}_initLoggerAfter(e){let t=0,n=0,r="",i="",s="",a="h264",o=0,l="",u="",c={},h="",d="",f=!1;e.logger&&(e.logger.line_app_id&&(n=e.logger.line_app_id),e.logger.appId&&(t=e.logger.appId),e.logger.playMode&&(r=e.logger.playMode),e.logger.tag&&(i=e.logger.tag),e.logger.vid&&(s=e.logger.vid),e.logger.abTestVersion&&(u=e.logger.abTestVersion),e.logger.channelConfig&&(c=e.logger.channelConfig),e.logger.region&&(h=e.logger.region),e.logger.webId&&(d=e.logger.webId),e.logger.isLogin&&(f=e.logger.isLogin)),e.video&&(e.video.codecType&&(a=e.video.codecType),e.video.defaultBitrate&&(o=e.video.defaultBitrate),e.video.defaultDefinition&&(l=e.video.defaultDefinition));let p={codec_type:a,decodeFlag:"h265"===a,defaultBitrate:o,defaultDefinition:l,line_app_id:n,playMode:r,playerCoreVersion:vu.version,pv:"",strategyVersion:yu.v,tag:i,vid:s,vtype:"MP4"};tn.K.appId=t,tn.DS.AB_SDK_VERSION=u,tn.K.init(Su.g,c,{region:h,user_unique_id:d,user_is_login:f});const g=new tn.DS(p);this.player.logger=g,g.attachPlayer(this.element),Ad.addPlayingVid(s)}play(){return new Promise(((e,t)=>{this.player.play().then((()=>{e()})).catch((e=>{this.forceAutoplay&&this.tryPlay(e)}))}))}pause(){this.player.pause()}load(e){this.player.load(e)}release(e){super.release(e),this.player.release()}reset(){this.pause(),this.seek(0)}on(e,t){this.player.on(e,t)}off(e,t){this.player.off(e,t)}once(e,t){const n=r=>{t(r),this.player.off(e,n)};this.player.on(e,n)}addSubtitle(e,t){this.player.addSubtitle(e,t)}preloadResources(e){const{closePreload:t}=this.hevcResult;Ad&&!t&&(Ad.clearTask(),Ad.addPreloadList(e))}updatePreloadConfig(e){Ad.update(e)}updatePreloadCodec(e){Ad.changeCodec(e)}get isReady(){return this.player.isReady}get playbackQuality(){return this.player?this.player.getQualityInfo():super.playbackQuality}}class Xd extends yu.C{constructor(e,t){super(),td(this,"onPlayCatch",((e,t)=>{if((0,bu.l)("_onPlayCatch",e,t),!t)return;const{message:n="",errorCode:r}=t;n.includes("is unsupported")&&Pu.a.focusDisableHevc({hevcCode:r||1,hevcMsg:n})})),td(this,"onceCanplay",(()=>{const{isTTP:e}=Pu.M.getInstance();null!==e&&Pu.b.asyncMark(e)})),td(this,"release",((e=!1)=>{this.currentPlayer&&(this.currentPlayer.off("canplay",this.onceCanplay),this.currentPlayer.release(e))})),this.event=e,this.device=t,this.currentPlayer=null}static get version(){return yu.v}static setCustomTracker(e){tn.DS.setCustomTracker(e)}usePlayer(e,t,n=!1){return this.release(n),this.currentPlayer&&n||(t?e==Tu.a.XG?(this.currentPlayer=new jd(t),this.currentPlayer.player.on("playCatch",this.onPlayCatch)):this.device&&this.device.isMSESupported?e==Tu.a.TT?this.currentPlayer=new ld(t):e==Tu.a.RAW&&(this.currentPlayer=new zd(t)):this.currentPlayer=new zd(t):this.currentPlayer=new zd(t),this.event.player=this.currentPlayer,this.currentPlayer.once("canplay",this.onceCanplay)),this.currentPlayer}get attributes(){return this.currentPlayer&&this.currentPlayer.element?{error:this.currentPlayer.element.error,src:this.currentPlayer.element.currentSrc,currentTime:this.currentPlayer.element.currentTime,muted:this.currentPlayer.element.muted,duration:this.currentPlayer.element.duration,readyState:this.currentPlayer.element.readyState,networkState:this.currentPlayer.element.networkState,buffered:this.currentPlayer.element.buffered,volume:this.currentPlayer.element.volume,ended:this.currentPlayer.element.ended,paused:this.currentPlayer.element.paused,seeking:this.currentPlayer.element.seeking}:null}get element(){return this.currentPlayer?this.currentPlayer.element:null}}class Kd extends yu.C{static get version(){return yu.v}constructor(){super(),this.config=new rd,this.event=new nd,this.device=new _u.A,this.network=new sd(this.device),this.metrics=new Tu.M(this.event,this.config),this.pool=new Xd(this.event,this.device)}_initConfig(){this.config=new rd}_initEvent(){this.event=new nd}_initDevice(){this.device=new _u.A}_initNetwork(){this.network=new sd(this.device)}_initMetrics(){this.metrics=new Tu.M(this.event,this.config)}_initPlayerPool(){this.pool=new Xd(this.event,this.device)}set player(e){this.event.player=e,this.metrics.player=e,this.pool.currentPlayer=e}get player(){return this.pool.currentPlayer}get attributes(){return this.pool.attributes}get element(){return this.pool.element}setCustomTracker(e){Xd.setCustomTracker(e)}usePlayer(e,t,n){const r=this.pool.usePlayer(e,t,n);return this.metrics.player=r,r}release(e){this.pool.release(e)}getPreloadMeta(e){return this.player&&this.player.preloader?this.player.getPreloadMeta(e):null}}class Wd{constructor(){this._eventemitter=new U}on(e,t,...n){this._eventemitter.on(e,t,...n)}once(e,t,...n){this._eventemitter.once(e,t,...n)}off(e,t,...n){this._eventemitter.off(e,t,...n)}emit(e,t,...n){this._eventemitter.emit(e,t,...n)}offAll(){this._eventemitter.removeAllListeners()}clear(){this._eventemitter.removeAllListeners()}}const Qd="[MultiplePlayerPool]";class qd extends Wd{constructor(e){super(),this.playerType=Tu.a.XG,this.type=Tu.a.XG,this.currentMuted=!1,this.currentVolume=1,this.onDataDownLoad=e=>{const{len:t=0,time:n=0}=e;Pu.M.setSpeed({size:8*t,speed:n?Math.round(8*t/n*1e3/1024):0,duration:n})},this.onHevcDetect=e=>{if(e){const{open:e}=Pu.M.checkHevcResult();e&&this.updatePreloadCodec("h265")}},this._onAutoplayPrevent=()=>{var e;(0,bu.l)(Qd,null==(e=this.currentPlayer)?void 0:e.uuid,"_onAutoplayPrevent"),this.autoplayPrevent=!0},this._onAutoplayStart=()=>{var e,t,n,r,i;(0,bu.l)(Qd,null==(e=this.currentPlayer)?void 0:e.uuid,"_onAutoplayStart",null==(t=this.currentPlayer)?void 0:t.muted,null==(r=null==(n=this.currentPlayer)?void 0:n.element)?void 0:r.paused,null==(i=this.currentPlayer)?void 0:i.currentTime,(new Date).getTime()),this.autoplayPrevent=!1},this._onActiveLoadedData=()=>{const{currentPlayer:e,currentProps:t}=this;e&&(t.muted=e.muted,t.volume=e.volume,this.checkLoadBackUpInstance("onActiveLoadedData"))},this._onActiveProgress=()=>{this.checkLoadBackUpInstance("onActiveProgress")},this._onVolumechange=()=>{var e;if((0,bu.l)(Qd,null==(e=this.currentPlayer)?void 0:e.uuid,"_onVolumechange"),!this.currentPlayer)return;const{currentPlayer:t,currentProps:n}=this;n.muted=t.muted,n.volume=t.volume},this._onRatechange=()=>{var e;if((0,bu.l)(Qd,null==(e=this.currentPlayer)?void 0:e.uuid,"_onRatechange"),!this.currentPlayer)return;const{currentPlayer:t,currentProps:n}=this;n.playbackRate=t.playbackRate},this._onPlayCatch=(e,t)=>{var n;if((0,bu.l)(Qd,null==(n=this.currentPlayer)?void 0:n.uuid,"_onPlayCatch",e,t),!t)return;const{message:r="",errorCode:i,errorMessage:s=""}=t;(r||s).includes("is unsupported")&&Pu.a.focusDisableHevc({hevcCode:i||1,hevcMsg:r})},this._onceCanplay=()=>{var e,t;const n=null==(e=this.currentPlayer)?void 0:e.buffered;(0,bu.l)(Qd,null==(t=this.currentPlayer)?void 0:t.uuid,"_onceCanplay",$d(n));const{isTTP:r}=Pu.M.getInstance();null!==r&&Pu.b.asyncMark(r||!1)},this._playerQueue=[],this.currentPlayer=null,this.prePlayers=[],this.currentProps={playbackRate:1,muted:!1,volume:1},this.autoplayPrevent=!1,this.config={enableReuse:!1,enableMultiple:!1,defaultMSE:!1,minBuffer:100,...e},Pu.a.setDetectCallback(this.onHevcDetect),Ad.on("prf_data_size",this.onDataDownLoad)}setCustomTracker(e){tn.DS.setCustomTracker(e)}get device(){return Pu.m}get version(){return yu.v}checkLoadBackUpInstance(e){var t,n,r;const i=null==(t=this.currentPlayer)?void 0:t.buffered,s=Nd(i,{minBuffer:this.config.minBuffer});if(s){const t=function(e){var t;for(let n=e.length-1;n>-1;n--)if(e[n].state===Tu.R.BACKUP&&(null==(t=e[n].player)||!t.hasStart))return e[n];return null}(this._playerQueue);if(t){const a=Ud(t);(0,bu.l)(Qd,null==(n=this.currentPlayer)?void 0:n.uuid,"checkLoadBackUpInstance",`${e} ifLoadInit:${s} hasStart:${a} end:${$d(i)}`),a<1&&(null==(r=t.player)||r.start())}}}_bindEvents(e){(0,bu.l)(Qd,"_bindEvents",e.uuid),e.on("real_time_speed",this.onDataDownLoad)}_unbindEvents(e){(0,bu.l)(Qd,"_unbindEvents",e.uuid),e.off("real_time_speed",this.onDataDownLoad)}_bindActiveEvents(e){e.on(u,this._onActiveLoadedData),e.on(d,this._onActiveProgress),e.on(h,this._onRatechange),e.on(l,this._onVolumechange),e.once(o,this._onceCanplay),e.on(m,this._onAutoplayPrevent),e.on(g,this._onAutoplayStart),e.on("playCatch",this._onPlayCatch)}_unbindActiveEvents(e){e.off(u,this._onActiveLoadedData),e.off(d,this._onActiveProgress),e.off(h,this._onRatechange),e.off(l,this._onVolumechange),e.off(o,this._onceCanplay),e.off(m,this._onAutoplayPrevent),e.off(g,this._onAutoplayStart),e.off("playCatch",this._onPlayCatch)}_activePlayer(e){var t;const{state:n}=e;n!==Tu.R.ACTIVE&&this._bindActiveEvents(e);const{currentProps:r}=this,i=Hd(e);(0,bu.l)(Qd,e.uuid,"_activePlayer",e.uuid,`preState:${n}`,i,r),e.muted=r.muted,e.volume=r.volume,e.forceAutoplay=!0,null==(t=e.metrics)||t.setStartInitInfo(i);const s=e.player;s&&(s.config.autoplay=!0),e.changeState(Tu.R.ACTIVE),e.play(),this.currentPlayer=e}_retainPlayer(e){(0,bu.l)(Qd,e.uuid,"_retainPlayer");const{state:t}=e;t===Tu.R.ACTIVE&&this._unbindActiveEvents(e),e.changeState(Tu.R.RETAIN),e.forceAutoplay=!1,e.pause(),e.seek(0),e.muted=!0}getInstance(e,t){var n,r,i,s;let a=function(e,t){for(let n=0;n<e.length;n++)if(e[n].state===t)return e[n];return null}(this._playerQueue,Tu.R.RELEASE);if(a)return(0,bu.l)(Qd,"getInstance resuse",a.uuid,t,e),a;let o=e;t!==Tu.R.ACTIVE&&(o=function(e,t,n){e.autoplay=!1,e.video&&(e.video.autoplay=!1);const r=Nd(n,{minBuffer:t.minBuffer});return e.extra&&(e.extra.videoInit=r),t.defaultMSE&&e.mp4EncryptPlayer&&(e.mp4EncryptPlayer.needPreloadCheck=!1,e.extra&&(e.extra.closeMSE=!1)),e}(e,this.config,null==(n=this.currentPlayer)?void 0:n.buffered)),a=new jd(o,t),this._bindEvents(a);const l=new nd,u=a.config,c=new Tu.M(l,{bitrate:u.defaultBitrate,definition:u.defaultDefinition,codecType:u.codecType});return t!==Tu.R.ACTIVE&&(a.muted=!0),a.metrics=c,a.event=l,l.player=a,c.player=a,this._playerQueue.push(a),(0,bu.l)(Qd,"getInstance new",a.uuid,t,`videoInit:${null==(r=o.extra)?void 0:r.videoInit}, closeMSE:${null==(i=o.extra)?void 0:i.closeMSE} autoplay:${null==(s=o.video)?void 0:s.autoplay} codecType:${u.codecType}  defaultBitrate:${u.defaultBitrate} defaultDefinition:${u.defaultDefinition}`),(0,bu.l)(Qd,"getInstance new","preloadPlayingIds",Ad.getPlayingVid()),a}removeInstance(e,t){const n=function(e,t){for(let n=0;n<e.length;n++)if(e[n].uuid===t.uuid)return n;return-1}(t,e),{enableReuse:r}=this.config;(0,bu.l)(Qd,"removeInstance",r,n),n>-1&&!r&&t.splice(n,1)}setConfig(e){Object.keys(e).forEach((t=>{this.config[t]=e[t]}))}mountDom(e,t){if(e&&t)try{if(!e.element)return;t.appendChild(e.element)}catch(e){console.error(e)}}unMountDom(e){var t;if(e)try{const{element:n}=e;if(!n)return;null==(t=null==n?void 0:n.parentElement)||t.removeChild(n)}catch(e){console.error(e)}}usePlayer(e,t){var n,r;const i=this.getInstance(e,t);return t===Tu.R.ACTIVE&&(null==(n=i.metrics)||n.setStartInitInfo(Hd(i)),this._bindActiveEvents(i),this.currentPlayer=i),(0,bu.l)(Qd,i.uuid,"usePlayer",i.state,t,null==(r=e.video)?void 0:r.autoplay),i}releasePlayer(e,t=!0){if(!e)return;this.unMountDom(e);const{enableReuse:n}=this.config,{state:r}=e;(0,bu.l)(Qd,null==e?void 0:e.uuid,"releasePlayer",r,t||!n),r===Tu.R.ACTIVE&&this._bindActiveEvents(e),e.changeState(Tu.R.RELEASE);const{metrics:i,event:s}=e;i&&(i.release(),i.removeEvent(),i.player=null),s&&(s.release(),s.player=null),this._unbindEvents(e),t||!n?(this.removeInstance(e,this._playerQueue),e.release(!1)):e.release(!0)}updatePlayer(e,t){const{state:n}=e,{enableReuse:r,enableMultiple:i}=this.config;if((0,bu.l)(Qd,e.uuid,"updatePlayer",n,t),n!==t&&i)switch(t){case Tu.R.RELEASE:this.releasePlayer(e,!r);break;case Tu.R.ACTIVE:this._activePlayer(e);break;case Tu.R.RETAIN:this._retainPlayer(e)}}callPlay(){(0,bu.l)(Qd,"callPlay",`autoplayPrevent:${this.autoplayPrevent}`),this.autoplayPrevent&&this._playerQueue.forEach((e=>{if(e.state===Tu.R.BACKUP){(0,bu.l)(Qd,"callPlay",e.uuid,`isPlaying:${Fd(e)} hasStart:${Ud(e)}`);const t=()=>{var n;(0,bu.l)(Qd,e.uuid,"onAutoplayStart",e.muted,null==(n=e.element)?void 0:n.paused,e.currentTime,(new Date).getTime()),e.state===Tu.R.BACKUP&&e.pause(),e.off(g,t)},n=()=>{var t;(0,bu.l)(Qd,e.uuid,"onTimeupdate",e.muted,null==(t=e.element)?void 0:t.paused,e.currentTime,(new Date).getTime()),e.off(a,n)};e.on(g,t),e.on(a,n),e.play()}}))}changeResolution(e,t){e&&(e.changeResolution(t),this._playerQueue.forEach((n=>{n!==e&&n.changeResolution(t)})))}getResolutionInfo(e){return e?e.resolutionInfo:null}getPreloadMeta(e){return Ad.getPreloadMeta(e)}preloadResources(e){if(Ad){Ad.clearTask();const t=Ad.addPreloadList(e);(0,bu.l)(Qd,"preloadResources",t)}}updatePreloadConfig(e){Ad.update(e)}updatePreloadCodec(e){Ad.changeCodec(e)}set muted(e){this.currentMuted=e,this.currentProps.muted=e,this.currentPlayer&&(this.currentPlayer.muted=e)}}const Yd="change",Jd="update",Zd="reset",ef="error";class tf{constructor(e){this.handlerEvent=e=>{e.type,this.emit("subtitle_event",e)},this.list=[],e.subTitlesList&&e.subTitlesList.forEach((e=>{this.list.push(e)})),this.player=null,this.xgSubtitle=new Zt({subTitles:this.list,domRender:!1,defaultOpen:e.defaultOpen,updateMode:e.updateMode||"vod",debugger:!!e.debugger,renderMode:"normal"}),this.bindEvent()}bindEvent(){this.on(Yd,this.handlerEvent),this.on("on",this.handlerEvent),this.on(Jd,this.handlerEvent),this.on(Zd,this.handlerEvent),this.on(ef,this.handlerEvent)}unBindEvents(){this.off(Yd,this.handlerEvent),this.off(Jd,this.handlerEvent),this.off(Zd,this.handlerEvent),this.off(ef,this.handlerEvent),this.off("on",this.handlerEvent)}attach(e){var t,n;null==(t=this.xgSubtitle)||t.detachPlayer(),null==(n=this.xgSubtitle)||n.attachPlayer(e)}detach(){var e;null==(e=this.xgSubtitle)||e.detachPlayer()}destroy(){var e;this.unBindEvents(),null==(e=this.xgSubtitle)||e.destroy(),this.xgSubtitle=null}switch(e){var t,n;if(e)return null==(n=this.xgSubtitle)?void 0:n.switch(e).catch((e=>{console.error("switch error",e)}));null==(t=this.xgSubtitle)||t.switchOff()}switchOff(){var e;return null==(e=this.xgSubtitle)?void 0:e.switchOff()}setSubTitles(e,t=!1){var n;const r=e.map((e=>({...e})));null==(n=this.xgSubtitle)||n.setSubTitles(r,t)}emit(e,t,...n){var r;null==(r=this.xgSubtitle)||r.emit(e,t,...n)}on(e,t,...n){var r;null==(r=this.xgSubtitle)||r.on(e,t,...n)}once(e,t,...n){var r;null==(r=this.xgSubtitle)||r.on(e,t,...n)}off(e,t,...n){var r;null==(r=this.xgSubtitle)||r.off(e,t,...n)}offAll(){var e;this.unBindEvents(),null==(e=this.xgSubtitle)||e.offAll()}}var nf="error",rf="timeupdate",sf="canplay",af="loadeddata",of="loadstart";function lf(e,t=!0){return!e||e.length<1?-1:t?e.end(e.length-1):e.start(e.length-1)}function uf(e){return e?e.hasStart?1:0:-1}function cf(e){return e?e.isPlaying?1:0:-1}function hf(e){if(!e)return null;const t=lf(e.buffered);return{buff:t<0?t:(0,bu.c)(t),state:e.state,hasStart:uf(e),playing:cf(e)}}function df(e,t){return null==e?void 0:e.getPlugin(t)}let ff=0;const pf="[WebPlayer]";class gf{constructor(e,t){this.h264birate=null,this.metrics=null,this.event=null,this.forceAutoplay=!1,this.attemptPlayCount=0,this.isPlaying=!1,this.hasStart=!1;const{playerType:n="XG"}=e;this.uuid=gf.generateUUID(n),this.playerType=n,this.el=null,this.player=null,this.state=t||Tu.R.ACTIVE,this.bitrateList=[],this.curBitrate=null,this.resolutionInfo=null,this.config=e}static get UUIDIndex(){return ff++,ff}static set UUIDIndex(e){ff=e}static generateUUID(e){return e+"_Multimedia_"+gf.UUIDIndex}get type(){return this.playerType}init(e){}createInnerContainer(){this.el||(this.el=document.createElement("div"))}initStyle(){this.element&&(this.element.style.width="100%",this.element.style.height="100%",this.element.style.position="absolute",this.element.style.top="0",this.element.style.left="0",this.element.style["::-webkit-media-controls-enclosure"]={display:"none !important"})}checkNeedMSE(e,t){return!(!function(){const e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported}()||(0,bu.i)())&&(e===Tu.V.MSE||e===Tu.V.AUDO&&(void 0===t||t))}getInitBitrate(e,t,n,r){r&&Ed.updateConfig(r);const i=this.getPreloadMeta(t,e),s=function(e,t){return"h265"!==e||t&&"h265"!==t.codecType?"h264":"h265"}(n,i),a=(null==i?void 0:i.definition)||"";let o=[];if(e.length>0){o=Ed.filterResolutionList(e,{codecType:s,vtype:"MP4"});const t=Ed.select(e,s,"MP4",{},{definition:a});(0,bu.l)(pf,this.uuid,`userSelectResolution:${Ed.config.userSelectResolution}`,"adapterConfig",r,e,t);let n=null;if("h265"===(null==t?void 0:t.codecType)&&(n=Ed.select(e,"h264","MP4")),t)return{curBitrate:t,preloadCodec:(null==i?void 0:i.codecType)||null,preloadDefinition:(null==i?void 0:i.definition)||null,h264birate:n,resolutionList:o,preloadMeta:i}}return null}changeResolution(e){var t,n;const r=this.bitrateList,i=(null==(t=this.curBitrate)?void 0:t.codecType)||"h264",{resolution:s}=e;if(s===(null==(n=this.curBitrate)?void 0:n.resolution))return;const a=Ed.select(r,i,"MP4",{},{resolution:e.resolution});Ed.updateConfig({userSelectResolution:e.resolution}),(0,bu.l)(pf,this.uuid,`changeResolution:${s}`,a),a&&(this.curBitrate=a)}get element(){return null}set volume(e){this.player&&(this.player.volume=e)}get volume(){var e;return(null==(e=this.player)?void 0:e.volume)||0}get playbackRate(){var e;return(null==(e=this.player)?void 0:e.playbackRate)||1}set playbackRate(e){this.player&&(this.player.playbackRate=e)}set muted(e){this.player&&(this.player.muted=e)}get muted(){var e;return(null==(e=this.player)?void 0:e.muted)||!1}get currentTime(){var e;return(null==(e=this.player)?void 0:e.currentTime)||0}set currentTime(e){this.player&&(this.player.currentTime=e)}get duration(){var e;return(null==(e=this.player)?void 0:e.duration)||0}get buffered(){var e;return null==(e=this.player)?void 0:e.buffered}get paused(){var e;return(null==(e=this.player)?void 0:e.paused)||!0}get ended(){var e;return(null==(e=this.player)?void 0:e.ended)||!1}get attributes(){const{element:e}=this;return{error:(null==e?void 0:e.error)||null,src:(null==e?void 0:e.currentSrc)||"",currentTime:(null==e?void 0:e.currentTime)||0,muted:!(null==e||!e.muted),duration:(null==e?void 0:e.duration)||0,readyState:(null==e?void 0:e.readyState)||0,networkState:(null==e?void 0:e.networkState)||0,buffered:null==e?void 0:e.buffered,volume:(null==e?void 0:e.volume)||1,ended:!(null==e||!e.ended),paused:!(null==e||!e.paused),seeking:!(null==e||!e.seeking),currentSrc:(null==e?void 0:e.currentSrc)||""}}changeState(e){this.state=e}startPlay(){var e;null==(e=this.player)||e.play()}play(){return this.player?this.player.play():Promise.resolve()}replay(){return this.seek(0),this.play()}pause(){var e;return null==(e=this.player)?void 0:e.pause()}load(e){}seek(e){this.player&&(this.player.currentTime=e)}playNext(){}tryPlay(){this.paused&&this.play()}release(){var e;null==(e=this.player)||e.destroy(),this.unMountDom(),this.player=null,this.el=null}addSubtitle(e,t){}reset(){}style(e,t){this.element&&(this.element.style[e]=t)}getVideoPlaybackQuality(){return this.element&&"VIDEO"===this.element.tagName?this.element.getVideoPlaybackQuality():null}mountDom(e){const{el:t}=this;if(t&&e&&t.parentNode!==e)try{e.appendChild(t)}catch(e){console.error(e)}}unMountDom(){var e;const{el:t}=this;if(t)try{null==(e=null==t?void 0:t.parentElement)||e.removeChild(t)}catch(e){console.error(e)}}updatePreloadCodec(e){}get curDefinition(){var e,t,n,r,i;return{url:null==(e=this.curBitrate)?void 0:e.url,definition:null==(t=this.curBitrate)?void 0:t.definition,bitrate:null==(n=this.curBitrate)?void 0:n.bitrate,duration:null==(r=this.curBitrate)?void 0:r.duration,codecType:null==(i=this.curBitrate)?void 0:i.codecType}}getPreloadMeta(e,t){return null}async exitFullscreen(e){}async enterFullscreen(e){}_initPreloader(e){}on(e,t,...n){var r;null==(r=this.player)||r.on(e,t,...n)}off(e,t){var n;null==(n=this.player)||n.off(e,t)}once(e,t,...n){var r;null==(r=this.player)||r.once(e,t,...n)}emit(e,...t){var n;null==(n=this.player)||n.emit(e,...t)}}const mf="[TTPlayer]";class vf extends gf{constructor(e,t){super(e),this.playerConfig={},this.player=null,this.vodCollector=null,this.downloadedSize=0,this.downloadedTime=0,this.loadStartTime=0,this._onDownloaded=e=>{var t;const{duration:n,byteLength:r,byteSpeed:i}=e;this.downloadedSize+=r,this.downloadedTime+=1e3*n,this.log("_onDownloaded",this.uuid,r,n,i,this.downloadedSize,this.downloadedTime,e),this.emit("prf_data_size",{mediaType:"video",cdn_size:r,pcdn_size:0,bitrate:(null==(t=this.curBitrate)?void 0:t.bitrate)||0})},this._onDowngrade=e=>{var t,n;this.log("_onDowngrade",e.name,e.message,null==(t=this.player)?void 0:t.rawSrc);const{message:r=""}=e;if("h265"===(null==(n=this.resolutionInfo)?void 0:n.codecType)&&r.includes("unsupported")){const t=df(this.player,"multiplex");return null==t||t.changeOptions({fallback:!0}),this.retryUseH264Source(),this.emit("downgrade",e),!1}return this.emit("downgrade",e),!0},this._onHitcache=e=>{this.log("hitcache",this.uuid,e),this.emit("hitcache",e)},this._onLoadedData=()=>{if(this.log("_onLoadedData"),(0,bu.l)(mf,"_onLoadedData"),!this.player)return;const{videoWidth:e,videoHeight:t}=this.player;0===e&&0===t&&(Pu.a.focusDisableHevc({hevcMsg:"width and height is 0",hevcCode:2}),this.updatePreloadCodec("h264"),this.retryUseH264Source())},this._onLoadStart=()=>{0===this.loadStartTime&&(this.loadStartTime=performance.now())},this._onError=e=>{var t,n;const r=performance.now()-this.loadStartTime;(0,bu.l)("_onError",`costTime: ${r}`,`rawSrc:${!(null==(t=this.player)||!t.rawSrc)} currentSrc:${null==(n=this.player)?void 0:n.currentSrc}`,e)},this._onException=e=>{var t,n;const r=performance.now()-this.loadStartTime;(0,bu.l)("_onException",`costTime: ${r}`,`rawSrc:${!(null==(t=this.player)||!t.rawSrc)} currentSrc:${!(null==(n=this.player)||!n.currentSrc)}`,e)},this._onCanplay=()=>{if(this.state!==Tu.R.ACTIVE&&this.player){const e=this.player;e.currentTime>.1&&(e.currentTime=0),null==e||e.pause()}},this._onTimeupdate=()=>{var e;this.state!==Tu.R.ACTIVE&&(null==(e=this.player)||e.pause())},this._emitAutoplayPrevent=()=>{(0,bu.l)(mf,this.uuid,"_emitAutoplayPrevent"),this.emit(Tu.A)},this._emitAutoplayStart=()=>{(0,bu.l)(mf,this.uuid,"_emitAutoplayStart"),this.emit(Tu.b)},this.playerType=Tu.a.NEW_TT;const n=t||Tu.R.ACTIVE;this.init(e),this.changeState(n)}get element(){var e;return(null==(e=this.player)?void 0:e.getElement())||null}get isActive(){return this.state===Tu.R.ACTIVE}log(e,...t){(0,bu.l)(mf,this.uuid,e,...t)}changeState(e){var t,n;this.state=e,this.player&&(e===Tu.R.ACTIVE?(this.log("setPreloader",this.uuid,this.state,this.playerType),null==(t=df(this.player,"multiplex"))||t.setPreloader(Ad.getCore(this.playerType))):null==(n=df(this.player,"multiplex"))||n.setPreloader(null),(0,bu.l)(mf,"changeState",this.uuid,e===Tu.R.ACTIVE,e),this.emit("renderStateChange",{state:e}))}getPlugin(e){var t,n;return null==(n=null==(t=this.player)?void 0:t.getPlugin(e))?void 0:n.core}getMultiplexPluginConfig(e,t){const{getRequestOptionsCallback:n,reqOptions:r}=e,{multiplexConfig:i,videoPlayMode:s}=t;return{parsers:[new Yh],loaderOptions:{onBeforeRequest:(e,t)=>{if(n){const r=n({url:e});r&&(t.credentials=r.credentials)}else r&&(t.credentials=r.credentials);return t},timeout:3e3},minBackwardBufferDuration:5,maxBackwardBufferDuration:60,minForwardBufferDuration:5,maxForwardBufferDuration:30,...i,fallback:"MSE"!==s}}getLoggerConfig(e,t,n){const{videoInfo:r,strategyConfig:i={},loggerParams:s,switchPlayerTime:a}=e,{bitrateAdapter:o}=i,l=this.curBitrate,{ext:u={}}=s||{},c=Pu.a.getHevcDisableInfo()||{},h=function(){const{regionInfo:e}=Pu.M,{shortData:t,deviceScore:n,gpuScoreData:r}=Pu.M.getInstance().deviceMark;return{playMode:Pu.M.playMode,tag:Pu.M.pageName,subtag:Pu.M.playMode,preTag:Pu.M.prePageName,preSubtag:Pu.M.prePlayMode,region:(null==e?void 0:e.region)||"",isLogin:!(null!=e&&e.isLogin),deviceScore:t,d_score:n||0,gpu:r.gpu||"",vendor:r.vendor||""}}(),d={app_id:s.lineAppId,line_app_id:s.lineAppId,...h,codec_type:t,decodeFlag:"h265"===t,defaultBitrate:(null==l?void 0:l.bitrate)||r.bitrate||0,defaultDefinition:(null==l?void 0:l.definition)||r.definition||0,vid:r.id,vtype:n||"MP4",switchPlayerTime:a,...s,playerCoreVersion:"0.3.1",pv:"0.3.1",strategyVersion:yu.v,ext:{...u,...c},bitrateAdapter:{userResolution:(null==o?void 0:o.userSelectResolution)||"auto",qualityType:(null==l?void 0:l.qualityType)||0,selector:(null==o?void 0:o.selector)||"default"},closeEvents:(null==s?void 0:s.closeEvents)||[],playerType:this.playerType};return{tea:{init:s.channelConfig,config:{region:s.region,user_unique_id:s.webId,user_is_login:s.isLogin}},config:d,type:"vod"}}init(e){var t,n,r;this.hasStart=!1,this.downloadedSize=0;const{videoInfo:i,playerConfig:s,strategyConfig:a={}}=e;this.createInnerContainer(),this._initPreloader(a.preloaderConfig);const o=(null==s?void 0:s.codecType)||"h264",l=(null==i?void 0:i.vid)||"";this.bitrateList=(null==i?void 0:i.bitrateList)||[];const u=this.getInitBitrate(this.bitrateList,l,o,a.bitrateAdapter),{curBitrate:c=null,h264birate:h=null,resolutionList:d}=u||{},f=(null==c?void 0:c.codecType)||o;this.curBitrate=c,this.h264birate=h,this.resolutionInfo={currentResolution:(null==c?void 0:c.resolution)||"",codecType:f,vtype:"MP4",resolutionList:d||[],bitrateList:this.bitrateList||[]},Ad.addPlayingVid(l,this.playerType);const p=null!=(t=this.curBitrate)&&t.url?this.curBitrate.url:(null==i?void 0:i.url)||"",g=!(null==u||!u.preloadDefinition),m=this.checkNeedMSE(a.videoPlayMode||"H5"),v=this.getMultiplexPluginConfig(s,a);this.log("getInitBitrate",this.uuid,l,m,`hasPreload:${g} preloadCodec: ${null==u?void 0:u.preloadDefinition} preloadeCode:${null==u?void 0:u.preloadCodec} curBitrate: ${null==(n=this.curBitrate)?void 0:n.definition}`,"preloadMeta:",null==u?void 0:u.preloadMeta,v);const y={container:this.el,src:"",plugins:m?[new mh(v)]:[],muted:s.muted||!1,autoplay:!1,preload:s.preload?s.preload:"",volume:s.volume||1,playbackRate:s.playbackRate||1};(0,bu.l)(mf,this.uuid,"PlayerInit",`autoplay:${s.autoplay}`,this.config),this.player=new dc(y),this._initLogger(e,f),this.initStyle(),this.bindPlayerEvents(this.player),this.load(p),s.autoplay&&this.isActive&&this.startPlay(),Ed.attachVideo(this.element,{bitrate:(null==(r=this.curBitrate)?void 0:r.bitrate)||0,vid:l}),setTimeout((()=>{this.emit("resolutionReady",{...this.resolutionInfo}),this.log("PRELOAD_INFO",null==u?void 0:u.preloadMeta),null!=u&&u.preloadMeta&&this.emit("PRELOAD_INFO",null==u?void 0:u.preloadMeta)}),0)}bindPlayerEvents(e){const t=df(e,"multiplex");t&&(this.log("multiplex",this.uuid,this.state,t),t.on("hitcache",this._onHitcache),t.on("downgrade",this._onDowngrade),t.on("downloaded",this._onDownloaded),this.state===Tu.R.ACTIVE&&t.setPreloader(Ad.getCore(this.playerType))),e.on(rf,this._onTimeupdate),e.on(af,this._onLoadedData),e.on(of,this._onLoadStart),e.on(sf,this._onCanplay),e.on(nf,this._onError),e.on("exception",this._onException)}unBindPlayerEvents(e){const t=df(e,"multiplex");t&&(t.off("hitcache",this._onHitcache),t.off("downgrade",this._onDowngrade),t.off("downloaded",this._onDownloaded)),e.off(rf,this._onTimeupdate),e.off(af,this._onLoadedData),e.off(of,this._onLoadStart),e.off(sf,this._onCanplay),e.off(nf,this._onError),e.off("exception",this._onException)}retryUseH264Source(e){var t,n;null==this||this.emit("playCatch","MP4_3",{errorCode:(null==e?void 0:e.code)||8200,message:(null==e?void 0:e.message)||"width and height is 0"}),this.log("retryUseH264Source",this.h264birate),null!=(t=this.h264birate)&&t.url&&(this.load(null==(n=this.h264birate)?void 0:n.url),this.isActive&&this.startPlay())}startPlay(){var e;if(this.log("startPlay",this.state,`isPlaying:${this.isPlaying} currentSrc:${null==(e=this.player)?void 0:e.currentSrc}`),!this.player)return;const t=this.player.play();t&&t.then&&t.then((e=>{var t,n;if(this.player)if(e){if(this.log("startPlay error",`attemptPlayCount:${this.attemptPlayCount} isPlaying:${this.isPlaying} muted:${this.muted}`,null==e?void 0:e.name,null==e?void 0:e.message,`currentSrc:${!(null==(t=this.player)||!t.currentSrc)}`),!this.player||"NotAllowedError"!==(n=e).name&&"AbortError"!==n.name)return this.isPlaying=!1,void this._emitAutoplayPrevent();this.attemptPlayCount<3?(this.player.muted=!0,this.attemptPlayCount++,this.startPlay()):(this._emitAutoplayPrevent(),this.isPlaying=!1)}else this.log("startPlay success"),this.isPlaying=!0,this._emitAutoplayStart()})).catch((e=>{var t;this.log("startPlay catch",`attemptPlayCount:${this.attemptPlayCount} isPlaying:${this.isPlaying} muted:${this.muted}`,`currentSrc:${!(null==(t=this.player)||!t.currentSrc)}`)}))}play(){var e;return this.log("call play",this.state,`paused:${this.paused} isPlaying:${this.isPlaying}`,`currentSrc:${!(null==(e=this.player)||!e.currentSrc)}`),this.player?this.player.play():Promise.resolve()}pause(){var e,t;return this.log("call pause",this.state,`attemptPlayCount:${this.attemptPlayCount} paused:${this.paused} isPlaying:${this.isPlaying}`,null==(e=this.player)?void 0:e.currentSrc),null==(t=this.player)?void 0:t.pause()}_initPreloader(e){if(!e)return;tn.DS.attachPreloader(Ad.ttPreloader);const{enablePreloader:t=!0,preloaderConfig:n}=this.config.strategyConfig;n&&Ad.update(n),(0,bu.l)(mf,"_initPreloader",e,t),t?Ad.enable():Ad.disable()}_initLogger(e,t){tn.DS.AB_SDK_VERSION=Pu.M.getAbVersions();const{loggerParams:n}=e;this.log("initLogger loggerParams",n),tn.K.init(Su.g,n.channelConfig,{region:n.region,user_unique_id:n.webId,user_is_login:n.isLogin,user_id:n.uid||n.webId});const r=this.getLoggerConfig(e,t,"MP4").config;this.vodCollector=new tn.DS(r),this.vodCollector.attachPlayer(this.player)}load(e){if(!this.player||!e)return void console.warn("load warn","url is null || this.player is null");const t="string"==typeof(n=e)?[{url:n}]:n.map((e=>({url:e.src})));var n;(0,bu.l)(mf,"load",t),this.player.src=t}getPreloadMeta(e,t){return this.log("getPreloadMeta",e),Ad.getPreloadMeta(e,t,this.playerType)}updatePreloadCodec(e){this.log("updatePreloadCodec",e),Ad.changeCodec(e)}release(){var e,t,n;this.log("release",this.state,`isPlaying: ${this.isPlaying}`),null==(e=this.player)||e.pause();const r=this.config.videoInfo.vid;r&&Ad.removePlayingVid(r,this.playerType),this.player&&this.unBindPlayerEvents(this.player),this.changeState(Tu.R.RELEASE),null==(t=this.vodCollector)||t.destroy(),this.emit("destroy"),null==(n=this.player)||n.destroy(),this.player=null,this.vodCollector=null}async exitFullscreen(e){return async function(){if(!document.fullscreenElement)return Promise.resolve();for(let e=0;e<Tu.E.length;e++){const t=Tu.E[e];if("function"==typeof document[t])return await document[t]()}}()}async enterFullscreen(e){return async function(e){if(!e)return Promise.reject(new Error("dom is undefined"));for(let t=0;t<Tu.G.length;t++){const n=Tu.G[t];if("function"==typeof e[n])return await e[n]()}}(e||this.el)}on(e,t,...n){var r;null==(r=this.player)||r.on(e,t,...n)}off(e,t){var n;null==(n=this.player)||n.off(e,t)}once(e,t){var n;null==(n=this.player)||n.once(e,t)}emit(e,...t){var n;null==(n=this.player)||n.emit(e,...t)}}const yf="[MultiplePlayerPool1]";class _f extends Wd{constructor(e){super(),this.playerType=Tu.a.NEW_TT,this.type=Tu.a.XG,this.currentMuted=!1,this.currentVolume=1,this.onDataDownLoad=e=>{const{len:t=0,time:n=0}=e;Pu.M.setSpeed({size:8*t,speed:n?Math.round(8*t/n*1e3/1024):0,duration:n})},this.onHevcDetect=e=>{if(e){const{open:e}=Pu.M.checkHevcResult();e&&this.updatePreloadCodec("h265")}},this._onAutoplayPrevent=()=>{var e;(0,bu.l)(yf,null==(e=this.currentPlayer)?void 0:e.uuid,"_onAutoplayPrevent"),this.autoplayPrevent=!0},this._onAutoplayStart=()=>{var e,t,n,r,i;(0,bu.l)(yf,null==(e=this.currentPlayer)?void 0:e.uuid,"_onAutoplayStart",null==(t=this.currentPlayer)?void 0:t.muted,null==(r=null==(n=this.currentPlayer)?void 0:n.element)?void 0:r.paused,null==(i=this.currentPlayer)?void 0:i.currentTime,(new Date).getTime()),this.autoplayPrevent=!1},this._onActiveLoadedData=()=>{const{currentPlayer:e,currentProps:t}=this;e&&(t.muted=e.muted,t.volume=e.volume,this.checkLoadBackUpInstance("onActiveLoadedData"))},this._onActiveProgress=()=>{this.checkLoadBackUpInstance("onActiveProgress")},this._onVolumechange=()=>{var e;if((0,bu.l)(yf,null==(e=this.currentPlayer)?void 0:e.uuid,"_onVolumechange"),!this.currentPlayer)return;const{currentPlayer:t,currentProps:n}=this;n.muted=t.muted,n.volume=t.volume},this._onRatechange=()=>{var e;if((0,bu.l)(yf,null==(e=this.currentPlayer)?void 0:e.uuid,"_onRatechange"),!this.currentPlayer)return;const{currentPlayer:t,currentProps:n}=this;n.playbackRate=t.playbackRate},this._onPlayCatch=(e,t)=>{var n;if((0,bu.l)(yf,null==(n=this.currentPlayer)?void 0:n.uuid,"_onPlayCatch",e,t),!t)return;const{message:r="",errorCode:i,errorMessage:s=""}=t;(r||s).includes("is unsupported")&&Pu.a.focusDisableHevc({hevcCode:i||1,hevcMsg:r})},this._onceCanplay=()=>{var e,t;const n=null==(e=this.currentPlayer)?void 0:e.buffered;(0,bu.l)(yf,null==(t=this.currentPlayer)?void 0:t.uuid,"_onceCanplay",lf(n));const{isTTP:r}=Pu.M.getInstance();null!==r&&Pu.b.asyncMark(r||!1)},this._playerQueue=[],this.currentPlayer=null,this.prePlayers=[],this.currentProps={playbackRate:1,muted:!1,volume:1},this.autoplayPrevent=!1,this.config={enableReuse:!1,enableMultiple:!1,defaultMSE:!1,minBuffer:100,...e},Pu.a.setDetectCallback(this.onHevcDetect),Ad.on("downloaded",this.onDataDownLoad,this.playerType)}setPlayerType(e){this.playerType=e}setCustomTracker(e){tn.DS.setCustomTracker(e)}get device(){return Pu.m}get version(){return yu.v}checkLoadBackUpInstance(e){var t;(function(e,t){const{minBuffer:n}=t;if(!e||!n)return!0;if(e&&e.length>0){const t=e.end(e.length-1);if((0,bu.c)(t)>=n)return!0}return!1})(null==(t=this.currentPlayer)?void 0:t.buffered,{minBuffer:this.config.minBuffer})&&function(e){var t;for(let n=e.length-1;n>-1;n--)if(e[n].state===Tu.R.BACKUP&&(null==(t=e[n])||!t.hasStart))return e[n]}(this._playerQueue)}_bindEvents(e){(0,bu.l)(yf,"_bindEvents",e.uuid),e.on("real_time_speed",this.onDataDownLoad)}_unbindEvents(e){(0,bu.l)(yf,"_unbindEvents",e.uuid),e.off("real_time_speed",this.onDataDownLoad)}_bindActiveEvents(e){e.on(u,this._onActiveLoadedData),e.on(d,this._onActiveProgress),e.on(h,this._onRatechange),e.on(l,this._onVolumechange),e.once(o,this._onceCanplay),e.on(m,this._onAutoplayPrevent),e.on(g,this._onAutoplayStart),e.on("playCatch",this._onPlayCatch)}_unbindActiveEvents(e){e.off(u,this._onActiveLoadedData),e.off(d,this._onActiveProgress),e.off(h,this._onRatechange),e.off(l,this._onVolumechange),e.off(o,this._onceCanplay),e.off(m,this._onAutoplayPrevent),e.off(g,this._onAutoplayStart),e.off("playCatch",this._onPlayCatch)}_activePlayer(e){var t;const{state:n}=e;n!==Tu.R.ACTIVE&&this._bindActiveEvents(e);const{currentProps:r}=this,i=hf(e);(0,bu.l)(yf,e.uuid,"_activePlayer",e.uuid,`hasStart:${e.hasStart} preState:${n}`,i,r),e.muted=r.muted,e.volume=r.volume,e.forceAutoplay=!0,null==(t=e.metrics)||t.setStartInitInfo(i),e.changeState(Tu.R.ACTIVE),e.hasStart?e.play():e.startPlay(),this.currentPlayer=e}_retainPlayer(e){(0,bu.l)(yf,e.uuid,"_retainPlayer");const{state:t}=e;t===Tu.R.ACTIVE&&this._unbindActiveEvents(e),e.changeState(Tu.R.RETAIN),e.forceAutoplay=!1,e.pause(),e.seek(0),e.muted=!0}getInstance(e,t){var n;let r=function(e,t){for(let n=0;n<e.length;n++)if(e[n].state===t)return e[n];return null}(this._playerQueue,Tu.R.RELEASE);if(r)return(0,bu.l)(yf,"getInstance resuse",r.uuid,t,e),r;let i=e;t!==Tu.R.ACTIVE&&(i=function(e,t){const{playerConfig:n,strategyConfig:r}=e;return n.autoplay=!1,t.defaultMSE&&(r.videoPlayMode="MSE"),e}(e,this.config,null==(n=this.currentPlayer)||n.buffered)),r=new vf(i,t),this._bindEvents(r);const s=new nd,a=r.config,o=new Tu.M(s,{bitrate:a.defaultBitrate,definition:a.defaultDefinition,codecType:a.codecType});return t!==Tu.R.ACTIVE&&(r.muted=!0),r.metrics=o,r.event=s,s.player=r,o.player=r,this._playerQueue.push(r),(0,bu.l)(yf,"getInstance new","preloadPlayingIds",Ad.getPlayingVid(this.playerType)),r}removeInstance(e,t){const n=function(e,t){for(let n=0;n<e.length;n++)if(e[n].uuid===t.uuid)return n;return-1}(t,e),{enableReuse:r}=this.config;(0,bu.l)(yf,"removeInstance",r,n),n>-1&&!r&&t.splice(n,1)}setConfig(e){Object.keys(e).forEach((t=>{this.config[t]=e[t]}))}mountDom(e,t){if(e&&t)try{if(!e.el)return;t.appendChild(e.el)}catch(e){console.error(e)}}unMountDom(e){var t;if(e)try{const{el:n}=e;if(!n)return;null==(t=null==n?void 0:n.parentElement)||t.removeChild(n)}catch(e){console.error(e)}}usePlayer(e,t){var n,r;const i=this.getInstance(e,t);return(0,bu.l)(yf,i.uuid,"usePlayer",t,e),t===Tu.R.ACTIVE&&(null==(n=i.metrics)||n.setStartInitInfo(hf(i)),this._bindActiveEvents(i),this.currentPlayer=i),(0,bu.l)(yf,i.uuid,"usePlayer",i.state,t,null==(r=e.playerConfig)?void 0:r.autoplay),i}releasePlayer(e,t=!0){if(!e)return;this.unMountDom(e);const{enableReuse:n}=this.config,{state:r}=e;(0,bu.l)(yf,null==e?void 0:e.uuid,"releasePlayer",r,t||!n),r===Tu.R.ACTIVE&&this._bindActiveEvents(e),e.changeState(Tu.R.RELEASE);const{metrics:i,event:s}=e;i&&(i.release(),i.removeEvent(),i.player=null),s&&(s.release(),s.player=null),this._unbindEvents(e),(t||!n)&&this.removeInstance(e,this._playerQueue),e.release()}updatePlayer(e,t){const{state:n}=e,{enableReuse:r,enableMultiple:i}=this.config;if((0,bu.l)(yf,e.uuid,"updatePlayer",n,t),n!==t&&i)switch(t){case Tu.R.RELEASE:this.releasePlayer(e,!r);break;case Tu.R.ACTIVE:this._activePlayer(e);break;case Tu.R.RETAIN:this._retainPlayer(e)}}callPlay(){(0,bu.l)(yf,"callPlay",`autoplayPrevent:${this.autoplayPrevent}`),this.autoplayPrevent&&this._playerQueue.forEach((e=>{if(e.state===Tu.R.BACKUP){(0,bu.l)(yf,"callPlay",e.uuid,`isPlaying:${cf(e)} hasStart:${uf(e)}`);const t=()=>{var n;(0,bu.l)(yf,e.uuid,"onAutoplayStart",e.muted,null==(n=e.element)?void 0:n.paused,e.currentTime,(new Date).getTime()),e.state===Tu.R.BACKUP&&e.pause(),e.off(g,t)},n=()=>{var t;(0,bu.l)(yf,e.uuid,"onTimeupdate",e.muted,null==(t=e.element)?void 0:t.paused,e.currentTime,(new Date).getTime()),e.off(a,n)};e.on(g,t),e.on(a,n),e.play()}}))}changeResolution(e,t){e&&(e.changeResolution(t),this._playerQueue.forEach((n=>{n!==e&&n.changeResolution(t)})))}getResolutionInfo(e){return e?e.resolutionInfo:null}getPreloadMeta(e,t){return Ad.getPreloadMeta(e,t,this.playerType)}preloadResources(e){if(Ad){Ad.clearTask(this.playerType);const t=Ad.addPreloadList(e,this.playerType);(0,bu.l)(yf,"preloadResources",t)}}updatePreloadConfig(e){Ad.update(e,this.playerType)}updatePreloadCodec(e){Ad.changeCodec(e,this.playerType)}set muted(e){this.currentMuted=e,this.currentProps.muted=e,this.currentPlayer&&(this.currentPlayer.muted=e)}}},5267:(e,t,n)=>{"use strict";n.d(t,{C:()=>r,v:()=>i});class r{constructor(){this._events=[],this._callbacks={}}register(e){this._events.includes(e)||this._events.push(e)}on(e,t){return!!this._events.includes(e)&&(this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),!0)}off(e,t){if(!this._events.includes(e)||!this._callbacks[e])return!1;const n=this._callbacks[e].indexOf(t);return this._callbacks[e].splice(n,1),!0}bind(e,t){if(!this._events.includes(e))return!1;this._callbacks[e]=[],this._callbacks[e].push(t)}clear(e){this._callbacks[e]=[]}trigger(e,t){if(!this._callbacks[e]||!this._callbacks[e].length)return!1;let n=null;return this._callbacks[e].forEach(((e,r)=>{0==r?n=e(t):e(t)})),n}set events(e){e.forEach((e=>{this.register(e)}))}get events(){return this._events}}const i="0.3.1"},23232:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>We,DS:()=>je,K:()=>Ke});const r=typeof window<"u"&&window.location.href.indexOf("loggerdebug")>-1;function i(e,t,...n){r&&console.log(`[logger>${e}]`,t,...n)}function s(){return(new Date).getTime()}function a(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}function o(e,t=2){const n=Math.pow(10,t);return Math.round(e*n)/n}function l(e){return parseInt((1e3*e).toFixed(0),10)}function u(e){return e&&e instanceof window.HTMLMediaElement}function c(e){if(!e||"string"!=typeof e)return"";const t=e.split("/");let n="";return t.length>3&&t[2]&&(n=t[2]),n}function h(e){try{return JSON.stringify(e)}catch{return""}}function d(e){return"string"==typeof e&&/^blob/.test(e)}function f(e){return null!=e&&e.media&&(e=e.media),!!(e&&e instanceof HTMLMediaElement)&&(d(null==e?void 0:e.currentSrc)||d(null==e?void 0:e.src))}function p(e){return null==e}function g(e,t,n){return e>0&&t>0?t-e:0}const m={UN_KNOW:0,EXPIRED:1,NO_EXPIRED:2},v=[new RegExp("(\\?|&)expire=([^&]*)(&|$)"),new RegExp("(\\?|&)x-tos-expires=([^&]*)(&|$)"),new RegExp("(\\?|&)x-expires=([^&]*)(&|$)")];function y(e){if(!e||"string"!=typeof e)return m.UN_KNOW;let t=m.UN_KNOW;try{const n=[];if(v.forEach((t=>{const r=e.match(t);r&&n.push(r)})),n.length>0)t=parseInt(n[0][2],10);else{const n=e.split("/");n.length>5&&8===n[4].length&&(t=parseInt(n[4],16))}if(t>0){const e=new Date;return t<=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),0)/1e3?m.EXPIRED:m.NO_EXPIRED}return m.UN_KNOW}catch{return m.UN_KNOW}}function _(e){try{return e.toString()}catch{return""}}function T(e,t){Object.keys(e).forEach((n=>{p(t[n])||(e[n]=t[n])}))}function b(e,t){return t[e]}const S="0.3.1",P=[{key:"QQBrowser",reg:/(qqbrowser)\/([\d.]+)/},{key:"2345Explorer",reg:/(2345explorer)\/([\d.]+)/},{key:"Wexin",reg:/(micromessenger)\/([\d.]+)/},{key:"Openlanguage",reg:/(openlanguage)\/([\d.]+)/},{key:"NewsArticle",reg:/(newsarticle)\/([\d.]+)/},{key:"VideoArticle",reg:/(videoarticle)\/([\d.]+)/},{key:"Hotsoon",reg:/(live_stream)_([\d.]+)/},{key:"Aweme",reg:/(aweme)_([\d.]+)/},{key:"Lark",reg:/(lark)\/([\d.]+)/},{key:"PlayStation",reg:/(playstation)/},{key:"BingPreview",reg:/(bingpreview)\/([\d.]+)/},{key:"Baiduspider",reg:/(baiduspider-render)\/([\d.]+)/},{key:"YandexBot",reg:/(yandexbot)\/([\d.]+)/},{key:"Chrome",reg:/(chrome)\/([\d.]+)/},{key:"Safari",reg:/(version)\/([\d.]+)\s*(safari)/}],w=[{key:"Trident",reg:/(rv:)([\d.]+)/},{key:"Trident",reg:/(msie)\s*([\d.]+)/}],k=["Baiduspider","YandexBot"],M=!(typeof window>"u"),E={isIOS:!1,isAndroid:!1,isMobile:!1,isPC:!1,isPad:!1,isSpider:!1,isSupportMP4:!0,mime:"",name:"",appVersion:"",isChrome:!1,isSafari:!1};typeof navigator<"u"&&function(e){if(typeof navigator>"u")return e;const t=window.navigator.userAgent.toLocaleLowerCase(),n=/(iphone)/.test(t)||/(ipad)/.test(t),r=/(android)/.test(t),i=/(windows phone)/.test(t),s=n||r||i;e.isIOS=n,e.isAndroid=r,e.isPC=!s,e.isPad=/(ipad)/.test(t);const a=function(){const e={isSupport:!1,mime:""};if(typeof document>"u")return e;let t=document.createElement("video");return"function"==typeof t.canPlayType?(["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"].map((n=>{"probably"===(null==t?void 0:t.canPlayType(`video/mp4; codecs="${n}"`))&&(e.isSupport=!0,e.mime+=`||${n}`)})),e):(t=null,e)}();e.isSupportMP4=a.isSupport,e.mime=a.mime;let o="",l="",u=[],c=P;/trident/.test(t)&&(c=w);for(let e=0;e<c.length;e++)if(u=c[e].reg.exec(t),u){o=c[e].key,l=u.length>2?u[2]:"";break}o?(e[`is${o}`]=!0,e.name=o,e.appVersion=l):function(){const{mimeTypes:e}=navigator;if(e){for(let t=0;t<e.length;t++)if(e[t].type&&e[t].type.indexOf("360")>-1||e[t].type&&e[t].type.indexOf("application/vnd.chromium.remoting-viewer")>-1||e[t].description&&e[t].description.indexOf("360")>-1)return!0;return!1}}()&&(e.name="360EE"),e.name&&"Trident"!==e.name&&/(trident)/.exec(t)&&(e.name=e.name?`${e.name}_Trident`:"Trident"),e.isSpider=function(e,t){let n=!1;return k.map((t=>{t===e&&(n=!0)})),/spider/.test(t)&&(n=!0),n}(e.name,t)}(E);const R=!(typeof navigator>"u"),x={sdk_version:S,pc:"",pv:"",sv:"",line_app_id:0,line_user_id:"",app_version:"",platform:E.isPad?"pad":E.isMobile?"mobile":"pc",cpu_core:0,memory_size:0,support:0,absdkVersion:"",d_score:-1,vendor:"",gpu:"",deviceScore:{},ua:""};let D="",I=0;function C(e){Object.keys(e).forEach((t=>{void 0!==e[t]&&("playerCoreVersion"===t?x.pc=e[t]:"playerVersion"===t?x.pv=e[t]:"appVersion"===t?x.app_version=e[t]:"strategyVersion"===t?x.sv=e[t]:void 0!==x[t]&&(x[t]=e[t]))}))}!function(){if(!R)return;const e=window.navigator,t=e&&e.hardwareConcurrency||0,n=e&&e.deviceMemory||0,r=e&&e.webdriver?1:0,s=e&&e.userAgent||"";x.cpu_core=t,x.memory_size=n,x.webdriver=r,x.ua=s,function(e){let t=E.isSupportMP4?1e4:0;t=typeof MediaSource>"u"||!MediaSource.isTypeSupported||!(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))?t:t+1e3,function(e){const t={supported:!1,smooth:!1,powerEfficient:!1};if(!e||typeof navigator>"u")return Promise.resolve(t);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(e);{const n=e.video||{contentType:""},r=e.audio||{contentType:""};try{const e=MediaSource.isTypeSupported(n.contentType||""),t=MediaSource.isTypeSupported(r.contentType);return Promise.resolve({supported:e&&t,smooth:!1,powerEfficient:!1})}catch{return Promise.resolve(t)}}}({type:"file",video:{contentType:'video/mp4;codecs="hev1.1.6.L120.90"',width:1920,height:1080,bitrate:1e4,framerate:30}}).then((n=>{n&&n.supported?t+=100:t+=10,e(t)})).catch((n=>{t+=1,e(t)}))}((e=>{x.support=e})),i("CommonData",x)}();const L="videoplayer_oneopera",O="videoplayer_oneevent",A="mdl_video_data_size",G="mdl_video_preload",B={videoplayer_oneplay:"play_session_events",mdl_video_preload:"mdl_video_preload"},N="unknown",$=6e4,U="playcatch",F="reset",H="page_unload";var V=(e=>(e.DEFAULT="default",e.ACTIVE="active",e.RETAIN="retain",e.RELEASE="release",e.BACKUP="backup",e))(V||{});function j(e,t){const n={startPos:0,endPos:0,include:0,diff:0,cur:t,start:-1,end:-1},r=e?e.length:0;if(r<1)return n;n.start=l(e.start(0)),n.end=l(e.end(r-1));let i=-1,s=-1;const a=l(t);for(let t=e.length-1;t>-1;t--){const r=l(e.start(t)),o=l(e.end(t));if(a>=r&&a<=o){n.include=1,n.startPos=r,n.endPos=o,n.diff=o-a;break}a<r&&(i<0||r-a<i)?(i=r-a,s=t):a>o&&(i<0||a-o<i)&&(i=a-o,s=t)}return 1!==n.include&&(s<0&&(s=e.length-1),n.startPos=l(e.start(s)),n.endPos=l(e.end(s))),n}function z(e){const t=[];if(!e||e.length<1)return t;const n=e.length;for(let r=0;r<n;r++){const n=l(e.start(r))/1e3,i=l(e.end(r))/1e3;t.push({start:n,end:i})}return t}function X(e,t=0,n=1){if(!e)return!1;t=l(t);for(let r=0;r<e.length;r++){const i=l(e.start(r))+n,s=l(e.end(r))-n;if(t>i&&t<s)return!0}return!1}const K={PLAY:"play",PAUSE:"pause",PLAYING:"playing",WAITING:"waiting",ENDED:"ended",SEEKING:"seeking",SEEKED:"seeked",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",TIMEUPDATE:"timeupdate",PROGRESS:"progress",CANPLAY:"canplay",VOLUME_CHANGE:"volumechange",RATE_CHANGE:"ratechange",LOADED_METADATA:"loadedmetadata",DURATION_CHANGE:"durationchange",EMPTIED:"emptied",ERROR:"error",SUSPEND:"suspend",ABORT:"abort",STALLED:"stalled"},W={PLAY_CATCH:"playCatch",AUTOPLAY_PREVENTED:"autoplay_was_prevented",AUTOPLAY_STARTED:"autoplay_started",PLAYER_DESTROY:"destroy",NEXT:"playnext",RESET:"reset",SOURCE_ERROR:"source_error",INITIAL_URL:"initialUrl",RENDER_STATE_CHANGE:"renderStateChange",LOADSTART_MSE:"loadstart_mse",DEFI_CHANGE:"definitionChange",BEFORE_DEFI_CHANGE:"beforeDefinitionChange",DEFI_CHANGE_SUCCESS:"definitionChangeSuccess",XG_LOG_CACHE:"xglog_cache",DEGRADE:"degrade",ABR_CHANGE:"ABR_CHANGE",DEFI_CHANGE_DETAIL:"definitionChangeDetail",PRF_DATA_SIZE:"prf_data_size",MEDIA_FORMAT_ERROR:"media_format_error",META_READY:"metaReady",HIT_CACHE:"hitcache"},Q={autoplay_started:"_onAutoPlayStart",autoplay_was_prevented:"_onAutoPlayPrevented",source_error:"_onSourceError",initialUrl:"_onInitialUrl",renderStateChange:"_onRenderStateChange",destroy:"_onPlayerDestroy",playnext:"_onPlayNext",reset:"_onPlayerReset",loadstart_mse:"_onLoadstartMse",definitionChange:"_onDefiChange",beforeDefinitionChange:"_onBeforeDefiChange",definitionChangeSuccess:"_onDefiChangeSuccess",xglog_cache:"_onXgLogCache",degrade:"_onDegrade",ABR_CHANGE:"_onAbrChange",definitionChangeDetail:"_onDefiChangeDetail",prf_data_size:"_onPrfDataSize",media_format_error:"_onMediaFormatError",metaReady:"_onMetaReady",hitcache:"_onHitcache"};function q(e,t,n=1){if(!e||!t)return;const r=u(e),i=Object.keys(K).map((e=>K[e])),s=Object.keys(W).map((e=>W[e]));(r?i:[...i,...s]).forEach((i=>{const{handler:s,evt:a}=function(e,t){let n;const r=`_on${e.charAt(0).toUpperCase()}${e.slice(1)}`;return n=t[r]?t[r]:t[Q[e]],{evt:e,handler:n}}(i,t);if(s)if(r){const t=e;1===n?t.addEventListener(a,s):t.removeEventListener(a,s)}else{const t=e;1===n?t.on(a,s):t.off(a,s)}}))}const Y=[];function J(e,t,n){Y.push({id:e,name:t,handler:n})}function Z(e,t){let n=-1;for(let r=0;r<Y.length;r++)if(Y[r].id===e&&Y[r].name===t){n=r;break}n>-1&&Y.splice(n,1)}const ee="beforeunload",te="visibilitychange";function ne(e,t,...n){Y.forEach((r=>{const{name:i,handler:s}=r;i===e&&s(t,...n)}))}function re(e){var t;return u(e)?e:(null==e?void 0:e.media)||(null==e?void 0:e.video)||(null==(t=null==e?void 0:e.getElement)?void 0:t.call(e))||null}function ie(e){return e.rawSrc||e.currentSrc||e.src}function se(e){return ae(e,["readyState","networkState"])}function ae(e,t){const n=re(e);if(!n)return{};if(Array.isArray(t)){const e={};return t.forEach((t=>{e[t]=n[t]})),e}return n[t]}function oe(e){var t;return e?(e.vtype?e.vtype:(null==(t=e.config)?void 0:t.vtype)||"")||(e.dash?"DASH":""):""}function le(e){return e&&e.config&&e.config.codecType?e.config.codecType:""}function ue(e,t){let n=0;return e>0&&t>0&&e<t?(n=parseInt((t-e).toFixed(0),10),n>$?$:n):0}function ce(e,t){const n=Math.min(e,t);return n>0?n>2160?"8K":n>1792?"4K":n>1216?"2K":n>896?"1080P":n>640?"720P":n>512?"540P":n>416?"480P":n>288?"360P":"240P":N}function he(e){let t=0;for(const n of e)n.end<0||n.start>n.end||(t+=1e3*n.end-1e3*n.start);return Math.round(t)/1e3}typeof document<"u"&&(i("GLOBAL_EVENTS","bindGlobalEvents",E.isPC,E.isMobile,E.isPad),!(typeof document>"u")&&(E.isPC?window.addEventListener("beforeunload",(()=>{ne("beforeunload")})):(E.isMobile||E.isPad)&&window.addEventListener("pagehide",(()=>{ne("beforeunload")})),document.addEventListener("visibilitychange",(e=>{ne("visibilitychange",document.visibilityState)}))));const de="Operate";class fe{constructor(e){this.suspendCallback=e,this.init()}reset(){this.init()}init(){this.seekCount=0,this.sat=0,this.ops=[],this.seek=this.getOperaInfo("seeked"),this.latestSeek=null,this.firstSeek=null,this.latestSwitch=this.getOperaInfo("switch"),this.firstSwitch=null,this.pauseLog={start:-1,acuTime:0,totalCount:0}}getOperaInfo(e){return{op:e,stateBefore:-1,stateAfter:-1,start:0,end:0,pos:0,inBuffer:!1,intervalId:0,readyState:-1,networkState:-1}}pushOP(e){const{ops:t}=this;t.length>10&&t.splice(0,t.length-10),t.push(e)}clearTimer(){const{seek:e}=this;e.intervalId&&(clearTimeout(e.intervalId),e.intervalId=0)}startSeekTimeout(){const{seek:e}=this;this.clearTimer(),e.intervalId=setTimeout((()=>{e.start&&this.suspendSeek("timeout","timeout"),this.clearTimer()}),6e4)}startSeek(e,t){const{seek:n}=this;if(i(de,"startSeek",`start1: ${s()-n.start} start:${n.start} currentTime:${e.currentTime} pos:${n.pos}`,t),n.start&&s()-n.start>6e3&&this.suspendSeek("seeking","seeking"),n.start)return;n.start=s();const{readyState:r,networkState:a}=se(e);n.pos=e.currentTime,n.stateBefore=t,n.inBuffer=X(e.buffered,e.currentTime,1),n.readyState=r,n.networkState=a,i(de,"startSeek",`start: ${s()-n.start} pos:${n.pos} inBuffer:${n.inBuffer}`,z(e.buffered)),this.seekCount++,this.startSeekTimeout()}suspendSeek(e,t){const{seek:n}=this;if(!n.start)return;const r=s()-n.start;i(de,"suspendSeek",`endType:${t} cost: ${r} inBuffer:${n.inBuffer}`);const{latestSeek:a}=this,o={costTime:r,stateBefore:n.stateBefore,stateAfter:e,start:n.start,end:s(),pos:n.pos,inBuffer:n.inBuffer,op:"seek",endType:t,interval:a?n.start-a.start:0,readyState:n.readyState,networkState:n.networkState};this.latestSeek=o,this.firstSeek||(this.firstSeek=o),this.pushOP(o),this.clearTimer(),n.start=0,n.intervalId=0,n.pos=0,n.inBuffer=!1,this.sat+=r,this.suspendCallback&&this.suspendCallback(L,this.latestSeek)}startPause(){const{pauseLog:e}=this;i(de,`endPause>pauseLog.start:${e.start}`),e.start<0&&(e.start=s(),e.totalCount++)}endPause(){const{pauseLog:e}=this;e.start>0&&(e.acuTime+=s()-e.start,e.start=-1,i(de,`endPause>pauseLog.acuTime:${e.acuTime}`))}}class pe{constructor(e){this._last=e,this._current=e,this._initVal=e}set initial(e){this._initVal=e}get current(){return this._current}set current(e){const{_current:t}=this;t!==e&&(this._last=this._current,this._current=e)}get last(){return this._last}reset(){this._current=this._initVal,this._last=this._initVal}}class ge{constructor(){this.reset()}reset(){this.t=0,this.visible=!1,this.fAcc=0,this.bAcc=0,this.acc=0,this.loopAcc=0}update(e,t){if(this.t){const e=s()-this.t;this.acc+=e,this.t=0,this.visible?this.fAcc+=e:this.bAcc+=e,t&&(this.loopAcc=this.acc)}}start(e){this.t||(i("ACC","startACC",e,this.t,this.visible),this.t=s())}getWatchDuration(e=0){switch(e){case 1:return this.fAcc;case 2:return this.bAcc;default:return this.acc}}}function me(){return{networkState:-1,readyState:-1,pos:-1,inBuffer:!1,start:0,end:0,startDiff:-1,endDiff:-1,rate:0,endType:N,costTime:0}}const ve="PlayPerformance";class ye{constructor(){this.switchPlayerTime=0,this._renderState=new pe(V.DEFAULT),this.init()}get isActive(){const{current:e}=this._renderState;return e===V.ACTIVE||e===V.DEFAULT}get renderState(){return this._renderState.current}get preRenderState(){return this._renderState.last}init(){this.isMSE=!1,this.loadState=0,this.playbackState=0,this.seeking=!1,this.ended=!1,this.paused=!1,this.duration=0,this.currentTime=new pe(0),this.playbackRate=new pe(0),this.muted=new pe(!1),this.volume=new pe(1),this.resolution=new pe(""),this.definition=new pe(N),this.bitrate=new pe(0),this.width=0,this.height=0,this.state=new pe(N),this.newTime=s(),this.startLoadTime=0,this.autoplayStart=1,this.playTime=0,this.prepareBeforePlayTime=0,this.loadedTime=0,this.bufferFinishTime=0,this.playCount=0,this.vvTime=0,this.metaTime=0,this.firstUpdateTime=0,this.autoplayTime=0,this.startPlayInfo={bufEnd:0,bufStart:0,vvBuffer:0,startPos:-1,mvt:0,loadedVT:0,updateVT:0,autoPlayVT:0,playVT:0,fplayTime:0,pos:0,loadstartT:0,msestartT:0,activeT:0,loadedT:0,dvt:0,muted:-1,cachetime:0,cachesize:0},this.leave={time:0,method:""},this.exit={time:0,method:""},this.fvt=0,this.nvt=0,this.lpt=0,this.loadvt=0,this.switchPt=0,this.userFvt=0,this.buffFinishTime=0,this.loopCount=0,this.br={time:0,method:"",count:0,lTime:0,lPos:-1,pos:-1},this.visible="visible"===document.visibilityState,this.initialUrl={url:"",ip:"",host:"",resolution:"",definition:"",bitrate:0,width:0,height:0},this.curUrlInfo={url:"",ip:"",host:"",resolution:"",definition:"",bitrate:0,width:0,height:0},this.accPlayed=new ge,this.accPlayed.visible=this.visible,this.startStep=0,this.buffered={init:0,list:[],cur:{}},this.buffered=null,this.readyState=-1,this.networkState=-1,this.preloadData={size:0,time:0},this.meta={a_codec:"",v_codec:"",f_time:0}}reset(e,t=!1){i(ve,"reset",e,t,this._renderState.current),e?(this.loopCount++,this.startStep=0,this.playTime=0,this.vvTime=0,this.metaTime=0,this.firstUpdateTime=0,this.autoplayTime=0,this.bufferFinishTime=0,this.br={time:0,method:"",count:0,lTime:0,lPos:-1,pos:-1},this.seeking=!1,this.ended=!1,this.accPlayed.reset(),this.autoplayStart=1,t||(this.startPlayInfo={bufEnd:0,bufStart:0,vvBuffer:0,startPos:0,mvt:0,loadedVT:0,updateVT:0,autoPlayVT:0,pos:0,playVT:0,fplayTime:0,loadstartT:0,msestartT:0,loadedT:0,activeT:0,dvt:0,muted:-1,cachetime:0,cachesize:0})):this.init()}setInitData(e){["playbackRate","volume","currentTime","muted"].forEach((t=>{this.change(t,e[t])}))}setMeta(e){e?T(this.meta,e):this.meta={a_codec:"",v_codec:"",f_time:0}}updateUrl(e){const{initialUrl:t}=this;t.url||(t.url=e.url||"",t.host=c(e.url)),e.definition&&(t.definition=e.definition),e.ip&&(t.ip=e.ip),e.bitrate&&(t.bitrate=e.bitrate)}updatePState(e,t){const{readyState:n,networkState:r}=se(e);this.readyState=n,this.networkState=r}setLoadStartTime(e){const t=s();e?(this.startLoadTime=t,this.startPlayInfo.msestartT=t,this.switchPt=this.switchPlayerTime?ue(this.switchPlayerTime,this.startLoadTime):0):this.startPlayInfo.loadstartT=t}setPlayStartTime(){const{startPlayInfo:e}=this;e.fplayTime||(e.fplayTime=s(),e.playVT=this.prepareBeforePlayTime>0?s()-this.prepareBeforePlayTime:-1)}setPT(e){this.prepareBeforePlayTime||(this.prepareBeforePlayTime=s()),this.isActive?(i(ve,`setPT>${e} playTime:${this.playTime} renderState:${this.renderState}`),this.startStep=1,this.startLoadTime||this.setLoadStartTime(!0),this.playTime||(this.playTime=s(),i(ve,"setPT",`init pt:${this.playTime}, document.visibilityState:${this.visible}`))):i(ve,`setPT>${e} preparePlayTime:${this.prepareBeforePlayTime} renderState:${this.renderState}`)}setVT(e,t,n){if(this.loadedTime||(this.loadedTime=s(),this.startPlayInfo.loadedVT=ue(this.prepareBeforePlayTime,this.loadedTime),this.loadvt=this.loadedTime-this.startLoadTime),this.isActive){if(1===this.startStep){if(i(ve,`setVT>${e} renderState:${this.renderState}`),!this.vvTime){const e=s();this.vvTime=e,this.fvt=e-this.playTime,this.nvt=e-this.newTime,this.userFvt=this.switchPlayerTime>0?e-this.switchPlayerTime:this.loadvt;const{startPlayInfo:r,muted:a}=this,{start:o,end:u,endPos:c}=j(t,0);r.bufEnd=u,r.vvBuffer=c,r.bufStart=o,r.pos=l(n),r.muted=a.current?1:0;const h=this.resolution.current;h&&(this.initialUrl.resolution=h),i(ve,"setVT: firstframe inited",`vt-pt:${this.fvt} vt-nt:${this.nvt} loadvt:${this.loadvt} start:${o} end:${u} endPos:${c}`,this.startPlayInfo)}this.startStep=2}}else i(ve,`setVT>${e} renderState:${this.renderState} return`)}changeRenderState(e,t){const n=this._renderState.current;n!==e&&(this._renderState.current=e);const r="statechange",{startPlayInfo:a}=this;if(i(ve,"changeRenderState setPV",`preState:${n} state:${e}`),this.isActive){const e=j(t.buffered,t.currentTime),{bitrate:n}=this.initialUrl;this.startPlayInfo.activeT=s(),a.loadstartT&&this.setPT(r),a.cachetime=e.end,a.cachesize=e.end*n/1e3,this.loadedTime&&this.setVT(r,t.buffered,t.currentTime),this.startAccTime(r)}}setResolution(e){this.resolution.current=e}setMetaDataInfo(e){if(!this.metaTime){this.metaTime=s();const{startPlayInfo:t}=this;t.mvt=ue(t.loadstartT,s()),t.pos=l(e),i(ve,"setMetaTime",`mvt:${t.mvt}`)}}setLoadedData(){const{startPlayInfo:e}=this,t=s();e.loadedT=t,e.dvt=t-e.loadstartT}setBreak(e,t){const{br:n}=this;n.method=e,n.time||(n.time=s(),n.pos=t),n.lTime=s(),n.count++,n.lPos=t}setPreload(e){this.preloadData=e}setFirstPlayInfo(e){const{startPlayInfo:t,state:n}=this;if(this.firstUpdateTime>0||"playing"!==n.current)return;const{start:r,end:a}=j(e.buffered,e.currentTime),o=s();this.firstUpdateTime=o,t.startPos=l(e.currentTime),t.updateVT=ue(this.vvTime,o),t.autoPlayVT=ue(this.autoplayTime,o),t.bufEnd=a,t.bufStart=r,i(ve,"setFirstPlayInfo",`updateVT:${t.updateVT} autoPlayVT:${t.autoPlayVT} mvt:${t.mvt} fvt: ${this.fvt} start:${r} end:${a}`,t)}updateBuffed(e,t){if(this.bufferFinishTime)return;const n=z(e);for(let e=n.length-1;e>=0;e--)if(n[e].end>=this.duration-1){this.bufferFinishTime=s();break}}setExit(e,t){const{leave:n,exit:r}=this,{startPos:a,endPos:o,diff:l}=j(t.buffered,t.currentTime);i(ve,"setExit",`isActive:${this.isActive}`),!this.vvTime&&this.isActive&&(n.method=e,n.time=s(),this.playTime&&(this.lpt=n.time-this.playTime)),r.method=e,r.time=s(),r.bufDiff=l,r.bufStart=a,r.bufEnd=o,r.codec=le(t),r.ismse=f(t)?1:0,r.vtype=oe(t);const u=ie(t);r.url=u,r.host=c(u),i(ve,"setExit",e,r)}updateAcc(e,t=!1){this.accPlayed.update(e,t)}startAccTime(e){this.accPlayed.start(e)}change(e,t){const n=a(e);"string"==typeof e?this[e]&&(this[e].current=t):"Object"===n&&Object.keys(e).forEach((t=>{"undefined"!==this[t]&&(this[t].current=e[t])}))}changeWidthHeight(e,t){if(!e||!t)return;this.width=e,this.height=t;const{current:n}=this.resolution;n||(this.resolution.current=ce(e,t))}getWatchDuration(e=0){return this.accPlayed.getWatchDuration(e)}get ifFirstTimeUpdate(){return this.firstUpdateTime>0}}const _e="WaitData";class Te{constructor(e){this.suspendCallback=e,this.init()}reset(){this.init()}init(){this._startTime=-1,this._realStartTime=-1,this._intervalId=0,this._tIntervalId=0,this._startPos=0,this._inBuffer=!1,this._startDiff=0,this._endDiff=0,this._playRate=-1,this.nbc=0,this.dbc=0,this.dAcuTime=0,this.nAcuTime=0,this.firstWait=me(),this.latestWait=me(),this.waitList=[]}_clearTimer(e){const t=this[e];t&&(clearTimeout(t),this[e]=void 0)}_startTimeout(e){this._clearTimer("_tIntervalId"),this._tIntervalId=setTimeout((()=>{this.suspendWait("timeout",e),this._clearTimer("_tIntervalId")}),6e4)}_realStartWait(e){if(this._startTime>0){this._realStartTime=s();const{buffered:t,currentTime:n,networkState:r,readyState:a}=e,o=X(t,n,1);i(_e,"_realStartWait",`realStartTime:${this._realStartTime-this._startTime}\n       startPos:${this._startPos} curPos:${n} isInBuf:${o}`),o?this.dbc++:this.nbc++;const l={networkState:r,readyState:a,pos:this._startPos,inBuffer:this._inBuffer,start:this._startTime,end:0,startDiff:this._startDiff,endDiff:0,rate:this._playRate,endType:N,costTime:0,interval:this.latestWait.end>0?this._startTime-this.latestWait.end:0};this.latestWait=l,this.firstWait.start||(this.firstWait=l)}}startWait(e){if(this._startTime>0)return;this._tIntervalId&&this._clearTimer("_tIntervalId"),this._startTime=s(),this._startPos=e.currentTime;const t=e?j(e.buffered,this._startPos):null;this._inBuffer=1===(null==t?void 0:t.include),this._startDiff=(null==t?void 0:t.diff)||0,this._playRate=e.playbackRate,i(_e,`startWait>inBuffer:${this._inBuffer} startDiff:${this._startDiff} startPos:${this._startPos} seeking:${e.seeking}`),this._intervalId=setTimeout((()=>{this._startTime>0&&(this._realStartWait(e),this._startTimeout(e)),this._clearTimer("_intervalId")}),200)}suspendWait(e,t){if(this._startTime<0)return;this._clearTimer("_intervalId"),this._clearTimer("_tIntervalId");const n=s();let r=n-this._startTime;if(r=r>6e4?6e4:r,this._realStartTime<0)return i(_e,`suspendWait>${e} not realStart cost:${r}`),this._startTime=-1,this._inBuffer=!1,void(this._startDiff=0);const{latestWait:a}=this;this._inBuffer?this.dAcuTime+=r:this.nAcuTime+=r;const o=t?j(t.buffered,a.pos):null;a.endType=e,a.costTime=r,a.endDiff=(null==o?void 0:o.diff)||0,a.end=n,i(_e,`suspendWait>inBuffer:${this._inBuffer} endDiff:${a.endDiff} startDiff:${a.startDiff} startPos:${a.pos} realCost:${r} ${e}`),this._startTime=-1,this._realStartTime=-1,this._inBuffer=!1,this._playRate=-1,this.suspendCallback&&this.suspendCallback(O,a)}}class be{constructor(e){this.pIndex=-1,this.codec_type="unknown",this.vtype="default",this.defaultBitrate=0,this.defaultDefinition="unknown",this.play_type=0,this.source_type="dir_url",this.playMode="unknown",this.vid="",this.tag="default",this.subtag="default",this.preSubtag="unknown",this.preTag="unknown",this.envInfo={},this.ext={},this.bitrateSetHevc=[],this.bitrateSet=[],this.init(e)}init(e){Object.keys(e).forEach((t=>{(function(e,t){return Object.prototype.hasOwnProperty.call(e,t)})(this,t)&&!p(e[t])&&(this[t]=e[t])}))}reset(e){this.init(e)}}function Se(e){return e.map((e=>{if(!e)return"";if("string"==typeof e)return e;const t=[];return e.qualityType&&t.push(e.qualityType),e.definition&&t.push(e.definition),e.gearName&&t.push(e.gearName),t.join("|")}))}const Pe={manifest:1e3,network:2e3,demux:3e3,remux:4e3,media:5e3,drm:7e3,other:8e3,runtime:9e3,no_error_handler:9997,custom_error:9998,notSupport:1005},we={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106};function ke(e){const t=[];return["errorMessage","message","httpCode"].forEach((n=>{void 0!==e[n]&&t.push(e[n])})),e.response&&t.push(e.response.statusText||""),t.join("_")}function Me(e){const{errorType:t}=e;return b(t,Pe)||("number"==typeof t?t:Pe.media)}class Ee{constructor(){this.first=null,this.latest=null,this.errors=[],this.count=0,this.retryCount=0}parseError(e,t){let n=null;if(e)if(u(t)||e.code)n={code:b(e.code,we)||e.code,type:Pe.media,message:e.message};else{const t=e;n={code:t.errorCode,type:Me(t),message:ke(t)}}else n={code:8101,type:Pe.other,message:"error_is_undefined"};n.pos=e.currentTime||t.currentTime;const r=e.url||e.src||ae(t,"currentSrc");n.isExpired=y(r);const{readyState:i,networkState:a}=se(t);return{...n,cdnUrl:r,cdnHost:c(r),time:s(),readyState:i,networkState:a}}setError(e,t){var n;this.count++;const r=this.parseError(e,t);this.first?r.interval=r.time-((null==(n=this.latest)?void 0:n.time)||0):(r.interval=0,this.first=r),i("ERROR","setError",r),(E.isPC&&!E.isSupportMP4||E.isSpider)&&(r.code=we[5],r.type=Pe.notSupport),r.stage=t.currentTime>0?"playing":"beforePlay",this.latest=r,this.errors.length>=10&&this.errors.splice(0,1),this.errors.push(r)}get errorCodes(){const e=[];return this.errors.forEach((t=>{e.push(t.code)})),e.join(";")}reset(){this.first=null,this.latest=null,this.errors=[],this.count=0}}class Re{constructor(){this.timeline=new Map}add(e,t=!1){!t&&this.timeline.has(e)||this.timeline.set(e,{time:Math.round(performance.now()),stamp:Date.now()})}addByPre(e,t){this.get(t)&&this.add(e)}get(e){var t;return(null==(t=this.timeline.get(e))?void 0:t.time)||0}getInterval(e,t){const n=this.get(e)||0,r=this.get(t)||0;return r>-1&&r>-1&&r>n?r-n:0}clear(){this.timeline.clear()}getAll(){return this.timeline}getDurations(){return{start_meta:this.getInterval("loadstart","loadedmetadata"),meta_loaded:this.getInterval("loadedmetadata","loadeddata"),start_loaded:this.getInterval("loadstart","loadeddata"),init_loaded:this.getInterval("init","loadeddata"),play_playing:this.getInterval("play","playing"),playing_update:this.getInterval("playing","timeupdate"),a_update:this.getInterval("active","timeupdate"),a_leave:this.getInterval("active","leave"),a_seek:this.getInterval("active","seeking"),a_loaded:this.getInterval("active","loadeddata"),a_play:this.getInterval("active","play")}}}function xe(e,t,n,r,i){const{source_type:a,codec_type:o,vtype:c,preTag:d,tag:f,subtag:p,pIndex:g,preSubtag:m,vid:v,play_type:y,envInfo:_,ext:T,playMode:b}=t,{networkState:S,readyState:P,duration:w,currentTime:k,width:M,height:E,isMSE:R}=n,D=l(r.currentTime||k.current),I=oe(r)||c,C=le(r)||o,L=u(r)?y+2:y,O=x.pv?x.pv:r?r.version:"",{deviceScore:A={}}=x;return{local_time:s(),player_sessionid:e,...x,...A,pv:O||N,codec_type:C,play_type:L,source_type:a,v,width:M,height:E,vtype:I,tag:f||N,subtag:p||b||N,pre_tag:d,pre_subtag:m,p_index:g,video_net_s:S,video_ready_s:P,vd:l(w),cur_play_pos:D,visible:n.visible?1:0,net:navigator.onLine?"online":"offline",is_mse:R?1:0,env_info:h(_),ext:h(T),player_type:i}}const De={player_sessionid:"play_sess",p_index:"play_order",vd:"vduration"};function Ie(e){switch(e){case 0:return"duration";case 1:return"size";default:return N}}function Ce(e){let t="";return t="Array"===a(e.url)&&e.url.length>0?e.url[0].src||"":e.url||"",{cdn_url:t||"",cdn_host:c(t)||"",cdn_ip:e.ip||""}}const Le={preload_start:"onLoadStart",preload_ended:"onLoadEnded",error:"onError",prf_data_size:"onPrfDataSize",prf_meta_ready:"onPrfMetaReady",preloadstart:"onLoadStartNew",preloadend:"onLoadEndedNew",preloadedmetadata:"onLoadMetadataNew"},Oe="MDLPreload";const Ae="MDLPlayback";class Ge{constructor(e,t){this.opts=t||{openSizeLog:!0},this.suspendCallback=e,this.init()}getInitBitrate(){return{bitrate:0,aBitrate:0,cdnSize:0,cdnVSize:0,pcdnSize:0,pcdnVSize:0,definition:"",fileid:""}}init(){this.played=[],this.playedSize=0,this.cdnSize=0,this.pcdnSize=0,this.cdnVSize=0,this.pcdnVSize=0,this.lastBitrate=null,this.curBitrate=this.getInitBitrate(),this.nextBitrate=null,this.nextStart=-1,this.accDatas={cdnSize:0,cdnVSize:0,pcdnSize:0,pcdnVSize:0,playedSize:0},this.buffers=[]}reset(){this.init()}updatePlayed(e,t,n){const{played:r,curBitrate:i}=this,s=r.length,{bitrate:a,aBitrate:o}=i;if(0===t||s<1){const t=s>0?r[s-1]:null;t&&t.end<0?(t.start=e,t.bitrate=a,t.aBitrate=o):r.push({start:e,end:-1,bitrate:a,aBitrate:o})}else{const t=r[s-1];t.end=e,t.bitrate||(t.bitrate=a,t.aBitrate=o)}}calculateVideoPlaySize(){return 0}getPlayedDuration(){const{played:e}=this;return he(e)}calculatePlaySize(){const{played:e,curBitrate:t}=this,n=he(e),r=Math.round((t.aBitrate+t.bitrate)*n/8);return this.playedSize+=r,i(Ae,"calculatePlaySize",`duration: ${n} playedSize:${this.playedSize}`),this.played=[],this.playedSize}calculateCacheSize(){const{curBitrate:e,buffers:t}=this,n=function(e){let t=0;return e.forEach((e=>{e.start<e.end&&(t+=e.end-e.start)})),t}(t),r=Math.round((e.aBitrate+e.bitrate)*n/8);return this.cdnSize=r,this.cdnVSize=r,i(Ae,"calculateCacheSize",`duration: ${n} cdnSize:${this.cdnSize}`,e,t),this.buffers=[],this.cdnSize}updateAccData(){const{accDatas:e}=this;["cdnSize","cdnVSize","pcdnSize","pcdnVSize","playedSize"].forEach((t=>{e[t]+=this[t],this[t]=0}))}updateBuffed(e){this.buffers=z(e)}breakPlaybackData(e,t){f(re(t))||this.calculateCacheSize(),this.calculatePlaySize();const{cdnSize:n,cdnVSize:r,pcdnSize:s,pcdnVSize:a,accDatas:o}=this;if(i(Ae,"breakPlaybackData",e,n,r,s,a,o),[n,r,s,a].filter((e=>e>0)).length>0){const t={cdnSize:n,cdnVSize:r,pcdnSize:s,pcdnVSize:a};this.sendMDLEvent(e,t),this.updateAccData()}}getFileSize(e){return function(e,t){const{bitrate:n,aBitrate:r}=t;return{audio:Math.round(e*r/8),video:Math.round(e*(n-r)/8),total:Math.round(e*n/8)}}(e,this.curBitrate)}checkNextBitrateStart(e){const{nextBitrate:t,nextStart:n}=this;n>-1&&e>=e&&t&&(this.calculatePlaySize(),i(Ae,"checkNextBitrate",e,e,this.cdnSize),t&&(this.curBitrate={...t}),this.updatePlayed(e,0),this.nextStart=-1,this.nextBitrate=null)}updateDefInfo(e,t){const{mediaType:n,start:r,bitrate:s,definition:a,fileid:o}=e;i(Ae,"updateDefInfo",t,n,e);const l=this.getInitBitrate();"audio"===n?l.aBitrate=s||0:(l.bitrate=s||0,l.definition=a,l.fileid=o,this.updateLastDefInfo(),this.nextStart=p(r)?-1:r,-1===this.nextStart&&(this.curBitrate=l))}updateLastDefInfo(){const{curBitrate:e}=this;e.bitrate>0&&(this.lastBitrate={...e})}updateDownload(e){const{cdn_size:t,pcdn_size:n,mediaType:r,bitrate:s}=e,{curBitrate:a,nextBitrate:o}=this,l=t||0,u=n||0;let c=0,h=0;"audio"!==r&&(c=l,h=u),this.cdnSize+=l,this.pcdnSize+=u,this.cdnVSize+=c,this.pcdnVSize+=h;const d=this.nextStart>0?o:a;i(Ae,"updateDownload",null==d?void 0:d.bitrate,this.played.length>0?`end:${this.played[0].end} bitrate:${this.played[0].bitrate}`:-1),d&&(d.bitrate=s||0,d.cdnSize+=l,d.pcdnSize+=u,d.cdnVSize+=c,d.pcdnVSize+=h)}sendMDLEvent(e,t){const{suspendCallback:n,opts:r}=this;if(!r.openSizeLog||!n)return;const{cdnSize:s,cdnVSize:a,pcdnSize:o,pcdnVSize:l,definition:u}=t,c={vds:s,pvds:o,vvds:a,pvvds:l,df:u,end_type:e};i(Ae,"sendMDLEvent",e,A,c),n(A,c)}}let Be=0;const Ne="Collector";class $e{constructor(e,t){this.timeline=new Re,this._onLoadstartMse=()=>{i(Ne,"onLoadstartMse",this.playPerf.startLoadTime),this.playPerf.setLoadStartTime(!0),this._onLoadstart(this.player,W.LOADSTART_MSE),this.playPerf.setMeta(null)},this._onMetaReady=e=>{const{audioCodec:t,videoCodec:n,timeRange:r=[]}=e;this.timeline.add("metaready"),this.playPerf.setMeta({v_codec:t||"",a_codec:n||"",f_time:r.length>0?l(r[0].endTime||0):0})},this._onLoadstart=(e,t="loadstart")=>{const{playPerf:n,playMDL:r,player:s,vInfo:a}=this;this.timeline.add(t);const o=ie(s);i(Ne,"onLoadstart",`renderState:${n.renderState} startStep:${n.startStep}`);const u=t!==W.LOADSTART_MSE&&(!(c=o)||window.location.href.indexOf(c)>-1);var c;n.setLoadStartTime(t===W.LOADSTART_MSE);const h=t,d=t===W.LOADSTART_MSE||f(re(s));if(n.isMSE=d,n.updateBuffed(s.buffered,h),r.updateBuffed(s.buffered),n.change("state",h),n.loadState=1,n.playbackState=1,n.setResolution(a.defaultDefinition),n.seeking=!1,n.updatePState(s,h),function(e){return e&&!!e.coreName}(s)||n.setPreload(function(e){const{plugins:t}=e||{},n={vtype:N,time:0,size:0,f_size:0,bitrate:0,codec:"UNKNOWN"};if(!t||!t.mp4encryptplayer)return n;const{preLoadData:r}=t.mp4encryptplayer;if(r){const{type:e,fileSize:t,vtype:n,codecType:i,bitrate:s,preloadTime:a,byteLength:o,definition:u}=r;return{vtype:n,time:l(a),size:o,f_size:t||0,bitrate:s,definition:u,type:e,codec:i}}return n}(s)),i(Ne,"onLoadstart",`startStep:${n.startStep} isSrcEmpty:${u}`),n.setInitData(s),!d){const e={url:o,definition:a.defaultDefinition};this.setInitialUrl(e),r.updateDefInfo(function(e,t){const{curDefinition:n,config:r}=e||{};return n&&n.bitrate?n:r&&r.defaultBitrate?{bitrate:r.defaultBitrate||0,definition:r.defaultDefinition||0}:t?{bitrate:t.defaultBitrate||0,definition:t.defaultDefinition||""}:{bitrate:0,definition:""}}(s,this.vInfo),0)}0===n.startStep&&!u&&n.setPT(h)},this._onDurationchange=()=>{const{player:e,playPerf:t}=this;t.duration=e.duration,i(Ne,"onDurationchange",e.duration)},this._onLoadedmetadata=()=>{const{playPerf:e,player:t,vInfo:n}=this,r=f(re(this.player));e.playbackState=10,e.setMetaDataInfo(t.currentTime),e.isMSE=r,this.timeline.add("loadedmetadata"),i(Ne,"onLoadedmetadata");const s={url:ie(t),definition:n.defaultDefinition};this.setInitialUrl(s)},this._onLoadeddata=()=>{const{playPerf:e,playMDL:t,player:n}=this,r=K.LOADED_DATA,s=re(n);i(Ne,"onLoadeddata",f(s));const a=(null==s?void 0:s.videoWidth)||0,o=(null==s?void 0:s.videoHeight)||0;e.changeWidthHeight(a,o),e.playbackState=2,e.change("state",r),this.timeline.add(r),e.loadState=9,e.updatePState(n,r),e.updateBuffed(n.buffered,r),t.updateBuffed(n.buffered),e.setLoadedData(),e.setVT(r,n.buffered,n.currentTime)},this._onCanplay=()=>{const{playPerf:e,playMDL:t,player:n}=this;i(Ne,"onCanplay",`startStep:${e.startStep} vvTime:${e.vvTime} playTime:${e.playTime}`),e.updatePState(n,K.CANPLAY),e.updateBuffed(n.buffered,K.CANPLAY),t.updateBuffed(n.buffered),e.setVT("canplay",n.buffered,n.currentTime)},this._onPause=()=>{const{operate:e,playPerf:t,player:n,playMDL:r}=this;n.error||(i(Ne,"onPause",t.state.current),t.change({state:K.PAUSE}),t.playbackState=4,t.paused=!1,t.updateAcc(K.PAUSE),r.updatePlayed(n.currentTime,1),e.startPause())},this._onPlaying=()=>{const{operate:e,playPerf:t,wait:n,player:r,playMDL:s}=this;i(Ne,"onPlaying");const a=K.PLAYING;t.paused=!1,t.change("state",a),this.timeline.add(a),t.playbackState=3,t.startAccTime(a),s.updatePlayed(r.currentTime,1),n.suspendWait(a,r),e.endPause()},this._onWaiting=()=>{const{playPerf:e,wait:t,player:n}=this,{ifFirstTimeUpdate:r,vvTime:s}=e,a=K.WAITING;i(Ne,"onWaiting",r,s,e.renderState),!n.seeking&&r&&s&&(t.startWait(n),e.change("state",a),e.playbackState=7),e.updatePState(n,a),e.updateAcc(K.WAITING)},this._onSeeking=()=>{const{playPerf:e,wait:t,operate:n,player:r,playMDL:s}=this,{ifFirstTimeUpdate:a,state:o,startStep:l,vvTime:u}=e;i(Ne,"onSeeking",r.currentTime,`curState:${o.current} lasteState:${o.last} vvTime:${u} ended1:${r.ended} ifFirstTimeUpdate:${a}`,r.seeking,o.current!==K.ENDED||u&&a);const c=K.SEEKING;var h;this.timeline.addByPre(c,"active"),(h=o.current)!==K.ENDED&&h!==K.LOAD_START&&u&&a&&(e.seeking=!0,t.suspendWait(c,r),n.startSeek(r,o.current),e.change("state",c),e.playbackState=8),e.updatePState(r,c),0===l&&e.setPT(c),e.startAccTime(c),s.updatePlayed(r.currentTime,0)},this._onSeeked=()=>{const{player:e,playPerf:t,operate:n}=this;i(Ne,"onSeeked",e.seeking,e.currentTime),t.updatePState(e,K.SEEKED),t.seeking=!1;const r=e.paused?K.PAUSE:K.PLAYING;t.change("state",r),t.playbackState=e.paused?4:3,n.suspendSeek(t.state.current,K.SEEKED)},this._onProgress=()=>{const{player:e,playMDL:t,playPerf:n}=this;n.updatePState(e,K.PROGRESS),n.updateBuffed(e.buffered,K.PROGRESS),t.updateBuffed(e.buffered)},this._onSuspend=()=>{const{player:e,playPerf:t}=this;i(Ne,"onSuspend"),t.updatePState(e,K.SUSPEND)},this._onVolumechange=()=>{const{muted:e,volume:t}=this.player;this.playPerf.change({muted:e,volume:t})},this._onRatechange=()=>{this.playPerf.change("playbackRate",this.player.playbackRate)},this._onEmptied=()=>{const{player:e,playPerf:t}=this;t.loadState=0,t.updatePState(e,K.EMPTIED),t.updateBuffed(e.buffered,K.EMPTIED),i(Ne,"onEmptied")},this._onStalled=()=>{const{player:e,playPerf:t}=this,n=K.STALLED;t.updatePState(e,n),"Safari"===E.name||(t.loadState=11,t.change("state",n)),i(Ne,"onStalled")},this._onAbort=()=>{const{player:e,playPerf:t}=this,n=K.ABORT;t.updatePState(e,n),t.change("state",n),i(Ne,"onAbort")},this.options=e||{},this.player=t,Be||(Be=function(){try{return parseInt(window.performance.now().toFixed(0),10)}catch{return 0}}()),this.playPerf=new ye,this.operate=new fe(((e,t)=>{this._suspendStateCallback(e,t)})),this.wait=new Te(((e,t)=>{this._suspendStateCallback(e,t)})),this.vInfo=new be({}),this.error=new Ee,this.extData={};const n={openSizeLog:this.options.openSizeLog},{ext:r,switchPlayerTime:s}=this.options;this.setExtData(r),this.setSwitchTime(s),this.playMDL=new Ge(((e,t)=>this._suspendStateCallback(e,t)),n)}_suspendStateCallback(e,t){i(Ne,"_suspendStateCallback",e,t)}get performanceNow(){return Be}resetDataOnEnded(){this.reset(!0)}reset(e,t=!1){i(Ne,"reset",`isEnded:${e} rendeStateChange:${t}`);const{operate:n,playPerf:r,wait:s,error:a,playMDL:o}=this;n.reset(),r.reset(e,t),s.reset(),a.reset(),o.reset(),this.timeline.clear()}setSwitchTime(e){this.playPerf.switchPlayerTime=e||s()}setExtData(e={}){Object.keys(e).forEach((t=>{this.extData[t]=e[t]}))}setPlayLeaveInfo(e,t){const n=e||W.RESET,r=t||F;i(Ne,"setPlayLeaveInfo",e);const{playPerf:s,wait:a,operate:o,player:l}=this;s.setExit(r,l),a.suspendWait(n,l),this.timeline.add("leave"),o.suspendSeek(s.state.current,n)}setInitialUrl(e){const{playPerf:t,vInfo:n}=this;e.definition||(e.definition=n.defaultDefinition),e.bitrate||(e.bitrate=0|n.defaultBitrate),t.updateUrl(e)}_onPlay(){const{playPerf:e,player:t,options:n}=this;t.error||(i(Ne,"onPlay",`startStep :${e.startStep} this.ended:${e.ended}`,s()),e.state.current===K.PAUSE&&e.playCount++,e.setPlayStartTime(),e.ended&&e.loopCount++,n.ifSendVVEnded&&e.ended&&(this.resetDataOnEnded(),e.ended=!1,e.setPT("play")))}_onEnded(){i(Ne,"onEnded");const e=K.ENDED,{playPerf:t,wait:n,player:r,options:s}=this;t.ended=!0,t.change("state",e),t.playbackState=6,t.updateAcc(e,!0),n.suspendWait(e,r),s.ifSendVVEnded&&t.setExit("ended",r)}_onTimeupdate(){const{playPerf:e,playMDL:t,player:n}=this;if(n.error)return;const{currentTime:r}=n;e.change({currentTime:r}),t.updatePlayed(r,1),e.firstUpdateTime||(i(Ne,"onTimeupdate"),e.setFirstPlayInfo(n)),!n.paused&&!n.ended&&e.startAccTime(K.TIMEUPDATE)}_onError(e){i(Ne,"onError",e);const t=K.ERROR,{playPerf:n,playMDL:r,wait:s,operate:a,error:o,player:l}=this;e||(e=this.player.error),o.setError(e,l),n.updatePState(l,t),n.updateBuffed(l.buffered,t),r.updateBuffed(l.buffered),n.change("state",t),n.loadState=10,n.playbackState=5,n.setExit("error",l),n.seeking=!1,n.updateAcc(t),s.suspendWait(t,l),r.breakPlaybackData(t,l),a.suspendSeek(n.state.current,t)}_onPlayCatch(e,t){const{playPerf:n,wait:r,operate:i,playMDL:s,player:a}=this,o=W.PLAY_CATCH;n.updatePState(a,o),n.change("state",o),n.seeking=!1,n.updateAcc(o),n.setBreak(o,n.currentTime.current),r.suspendWait(o,a),s.breakPlaybackData(o,a),i.suspendSeek(n.state.current,o)}_onPlayerDestroy(){const{playPerf:e,playMDL:t,wait:n,operate:r,player:i}=this,s=W.PLAYER_DESTROY;e.setExit("destroy",i),e.updateAcc(s),n.suspendWait(s,i),t.breakPlaybackData(s,i),r.suspendSeek(e.state.current,s)}_onAutoPlayStart(){i(Ne,"onAutoPlayStart");const{playPerf:e}=this;e.autoplayTime||(e.autoplayTime=s())}_onAutoPlayPrevented(){i(Ne,"onAutoPlayPrevented");const{playPerf:e}=this;e.playbackState=9,e.autoplayStart=0}sendEvent(e,t){}}const Ue="Collector";let Fe=null;const He=new class{constructor(e){this.onLoadStartNew=e=>{i(Oe,"onLoadStartNew",e);const{url:t="",vid:n="",bitrate:r=0,formatType:a="MP4",fileid:o="",definition:l="",codecType:u=""}=e||{},c=Ce({url:t}),h={...e,...c,v:n||"",codec_type:u,vtype:a,bitrate:r,fileid:o||"",df:l,task_type:-1,errc:0,vds:0,pvds:0,vvds:0,pvvds:0};this.vid=n,this.data=h,this.meta={a_codec:"",v_codec:""},this.startTime=s(),this.state="start"},this.onLoadStart=e=>{i(Oe,"onPreloadStart",e.cacheKey,e);const{codecType:t,vtype:n,vid:r,width:a,height:o,bitrate:l,file_id:u,definition:c,type:h}=e,{data:d}=this,f=Ce(e);let g=N;g=a&&o?ce(a,o):c;const m={...d,...f,v:r,codec_type:t,vtype:n,bitrate:l,fileid:u||"",df:g,task_type:p(h)?-1:h};this.vid=r,this.data=m,this.meta={a_codec:"",v_codec:"",f_time:0,f_size:0},this.startTime=s(),this.state="start"},this.onLoadEndedNew=e=>{i(Oe,"onLoadEndedNew",e);const{stats:t,url:n}=e,r=Ce({url:n}),a=s()-this.startTime,o=t.dataSize,l=t.duration,{data:u}=this;u.cdn_url=r.cdn_url,u.cdn_host=r.cdn_host,u.isexpired=y(r.cdn_url),u.cost_time=a,u.vpls=o,u.vplt=l,this.sendMDLEvent("loadended",u),this.vid="",this.startTime=0,this.data=this.getInitData(),this.state="suspend"},this.onLoadEnded=e=>{if(i(Oe,"onPreloadEnded",e.cacheKey,e),this.vid&&this.vid===e.vid){const t=Ce(e),n=s()-this.startTime,r=this.data.vds;this.setMetaFirst(e);const i={...this.data,vplt:o(e.preloadTime,2),vpls:r||e.preloadSize,cost_time:e.costTime||n,bitrate:e.bitrate,fileid:e.file_id||"",isexpired:y(t.cdn_url)};this.sendMDLEvent("loadended",i)}else console.warn(Oe,"onLoadEnded","cacheKey_not_match",this.vid,e.cacheKey);this.vid="",this.startTime=0,this.data=this.getInitData(),this.state="suspend"},this.onError=e=>{if(i(Oe,"onError",e),this.vid){const{context:t}=e,n=s()-this.startTime,r=Ce(t||{}),i={...this.data,errc:e.errorCode,err_msg:ke(e),cost_time:e.costTime||n,fileid:e.file_id||"",isexpired:y(r.cdn_url),...r};this.sendMDLEvent("loaderror",i)}this.vid="",this.startTime=0,this.data=this.getInitData(),this.state="suspend"},this.onPrfDataSize=e=>{if(this.vid){const{cdn_size:t,pcdn_size:n,mediaType:r}=e,{data:i}=this,s=t||0,a=n||0;let o=0,l=0;"audio"!==r&&(o=s,l=a),i.vds+=s,i.pvds+=a,i.vvds+=o,i.pvvds+=l}this.state="load"},this.onLoadMetadataNew=e=>{i(Oe,"onLoadMetadataNew",e);const{tracks:t=[]}=e;t.forEach((e=>{"audio"===e.type?this.meta.a_codec=e.codec:this.meta.v_codec=e.codec}))},this.onPrfMetaReady=e=>{this.setMetaFirst(e)},this.eventCallback=e,this.init()}init(){this.emptyCount=0,this.data=this.getInitData(),this.vid="",this.extData={tag:N,subtag:N,preSubtag:N,preTag:N,pIndex:-1,isMSE:!1},this.meta={a_codec:"",v_codec:"",f_time:0,f_size:0},this.state="init"}getInitData(){return{codec_type:N,v:"",vtype:N,errc:0,err_msg:"",vplt:0,vpls:0,vds:0,pvds:0,vvds:0,pvvds:0,cdn_host:"",cdn_ip:"",cost_time:0,df:N,bitrate:0,fileid:"",task_type:-1,isexpired:0}}setMetaFirst(e){const{mediaSegList:t=[],meta:n}=e||{},r=t.length>0?t[0]:{timeRange:[],totalRange:[]},{timeRange:i=[],totalRange:s=[]}=r;this.meta.f_size=s.length>1?s[1]:0,this.meta.f_time=i.length>1?l(i[1]):0,this.meta.v_codec=(null==n?void 0:n.videoCodec)||"",this.meta.a_codec=(null==n?void 0:n.audioCodec)||""}reset(){this.init()}setExtData(e){e&&T(this.extData,e)}attach(e){this.preload!==e&&(i(Oe,"attach"),this.preload&&this.detach(),this.preload=e,Object.keys(Le).forEach((e=>{this.preload.on(e,this[Le[e]])})))}detach(){i(Oe,"attach "),this.preload&&Object.keys(Le).forEach((e=>{this.preload.off(e,this[Le[e]])})),this.reset(),this.preload=null}sendMDLEvent(e,t){const{eventCallback:n,extData:r}=this,s={...x,...t,task_type:Ie(t.task_type),empty_c:0,tag:r.tag||N,subtag:r.subtag||N,pre_tag:r.preTag||N,pre_subtag:r.preSubtag||N,p_index:r.pIndex,is_mse:r.isMSE?1:0,meta:h(this.meta)};i(Oe,"event",e,G,s),n&&n(G,s)}}(((e,t)=>{Fe&&Fe.event(e,t)}));let Ve=null;class je extends $e{constructor(e,t){const n=function(e){const t={line_app_id:0,line_user_id:"",playerCoreVersion:"",playerVersion:"",app_version:"",channel:"cn",channelDomain:"",absdkVersion:"",maxQueueCount:5,ifSendVVEnded:!1,isTask:!1,vtype:"MP4",codec_type:"",tag:"普通视频",playType:0,sourceType:"vid",subtag:"",playMode:"",sendLocalCallback:(e,t)=>{},disableLocalCache:!1,closeResolutionLog:!1,closeSeekLog:!1,needXhrCheck:!1,trackerConfig:{},envInfo:{},ext:{},openSizeLog:!0,bitrateAdapter:{}};return Object.keys(e).forEach((n=>{t[n]=e[n]})),t}(e);super(n,t),this._onTimeupdate=()=>{const{playPerf:e}=this;e.isActive&&!this.timeline.get("timeupdate")&&this.timeline.addByPre("timeupdate","loadeddata"),super._onTimeupdate()},this._onPlay=()=>{const{ended:e,state:t,isMSE:n,isActive:r}=this.playPerf;e&&(this.isSendOnePlay=!1),r&&this.timeline.addByPre("play","active"),super._onPlay(),He.setExtData({isMSE:n}),i(Ue,"onPlay",t.current,t.last)},this._onEnded=()=>{super._onEnded();const{ifSendVVEnded:e}=this.options;e&&this._trackOnePlay("ended")},this._onError=e=>{super._onError(e);const{latest:t}=this.error,{playPerf:n}=this;if(i(Ue,"onError",e,t),"dash"!==this.player.type||!this.player.replayRunning){if(n.playTime||n.setPT("error"),(null==t?void 0:t.code)===we[5])return this._trackOneError("error",t),void(this.isSendOnePlay=!0);this._trackOneError("error",t),this._trackOnePlay("error",t)}},this._onSourceError=e=>{i(Ue,"onSourceError",e)},this._onPlayCatch=(e,t)=>{i(Ue,"onPlayCatch",e,t);const n=t?t.message:"";if(!t||"MP4_0"===e&&"no preload"===n)return;super._onPlayCatch(e,t);const{initialUrl:r}=this.playPerf;d(t.url)&&(t.url=r.url);const{error:s}=this;s.setError(t,this.player),this.playMDL.breakPlaybackData(U,this.player),this._trackOneError(U,s.latest)},this._onPlayerDestroy=()=>{super._onPlayerDestroy();const{playTime:e}=this.playPerf;i(Ue,"onPlayerDestroy",this.sessionId,e),this._trackOnePlay("player_destroy"),this.reset(!1),this._unBindEvt()},this._onPlayNext=()=>{var e,t;null!=(t=null==(e=this.player)?void 0:e.getCore)&&t.call(e)&&(i(Ue,"_onPlayNext",this.sessionId),this._onPlayerReset("next"))},this._onPlayerReset=e=>{const{playPerf:t}=this;i(Ue,"onPlayerReset",this.sessionId,`type:${e} playTime:${t.playTime}`),this.playMDL.breakPlaybackData(F,this.player),t.updateAcc("reset"),t.playTime>0&&(this.setPlayLeaveInfo(W.RESET,F),this._trackOnePlay(e||W.RESET)),this.reset(!1)},this._onAutoPlayStart=()=>{super._onAutoPlayStart()},this._onAutoPlayPrevented=()=>{super._onAutoPlayPrevented()},this._onVisibilityChange=e=>{i(Ue,"onVisibilityChange",e);const{playPerf:t}=this;t.visible="visible"===e,t.updateAcc("visible",!1)},this._onInitialUrl=e=>{i(Ue,"onInitialUrl",e),this.setInitialUrl(e)},this._onRenderStateChange=e=>{const{playPerf:t,player:n}=this;e.state===t.renderState||e.state===V.RELEASE||(i(Ue,"_onRenderStateChange",s(),n.playerId,t.renderState,e.state),t.renderState===V.ACTIVE&&e.state===V.RETAIN?(t.setExit("statechange",n),t.updateAcc("statechange"),this.setPlayLeaveInfo("statechange"),this._trackOnePlay("statechange"),this.reset(!1,!0)):e.state===V.ACTIVE&&this.timeline.add(V.ACTIVE),t.switchPlayerTime=s(),t.changeRenderState(e.state,n))},this._onBeforeDefiChange=e=>{i(Ue,"onBeforeDefinitionChange",e)},this._onDefiChange=e=>{i(Ue,"onDefinitionChange",e)},this._onDefiChangeSuccess=()=>{i(Ue,"onDefiChangeSuccess")},this._onDefiChangeDetail=e=>{i(Ue,"onDefiChangeDetail",e);const{playMDL:t,player:n}=this;t.updateDefInfo(e,n.currentTime);const{lastBitrate:r}=t;r&&e.mediaType},this._onPrfDataSize=e=>{i(Ue,"onPrfDataSize",e),this.playMDL.updateDownload(e)},this._onXgLogCache=()=>{const e=(null==(t=this.player)?void 0:t.logCache)||(null==t?void 0:t.getLogCache);var t;e&&(this.templog={vtype:oe(this.player),log:e})},this._onDegrade=()=>{i(Ue,"onDegrade")},this._onAbrChange=()=>{i(Ue,"onAbrChange")},this._onMediaFormatError=e=>{i(Ue,"onMediaFormatError",e)},this._onPageUnload=()=>{const{playTime:e}=this.playPerf;if(i(Ue,"onPageUnload",this.sessionId,e),e>0){const e=H;this.setPlayLeaveInfo(e,e),this.playMDL.breakPlaybackData(e,this.player),this._trackOnePlay(H)}},this._onHitcache=e=>{if(i(Ue,"_onHitcache",this.sessionId,e),!e||!e.stats)return;const{playPerf:t}=this,{stats:n}=e;t.setPreload({vtype:"MP4",time:l(n.duration),size:n.dataSize})},e&&e.line_app_id?(this.isSendOnePlay=!1,this.sessionId="",this.init(e),this.player&&this._bindEvt(this.player),this.timeline.add("init")):console.warn("player.config.vodLogOpts.line_app_id is necessary for plugin xgVodLogger")}static get version(){return S}static get preloadMDL(){return He}static setCustomTracker(e){i(Ue,"setCustomTracker",e),Ve=e}static set Tracker(e){Fe=e}static get Tracker(){return Fe}static sendEvent(e,t){Fe&&Fe.event(e,t)}static set commonData(e){C(e)}static set TEA_ID(e){I=e,D=`__tea_cache_tokens_${I}`}static get TEA_ID(){return I}static set AB_SDK_VERSION(e){x.absdkVersion=Array.isArray(e)?e.join(","):e}static get AB_SDK_VERSION(){return x.absdkVersion}static attachPreloader(e){He.attach(e)}static detachPreloader(){He.detach()}static get defaultConfig(){return{line_app_id:0,line_user_id:"",playerCoreVersion:"",playerVersion:"",app_version:"",channel:"cn",channelDomain:"",absdkVersion:"",maxQueueCount:5,ifSendVVEnded:!1,isTask:!1,vtype:"MP4",codec_type:"",tag:"普通视频",playType:0,sourceType:"vid",subtag:"",playMode:"",sendLocalCallback:(e,t)=>{},disableLocalCache:!1,closeResolutionLog:!1,closeSeekLog:!1,needXhrCheck:!1,trackerConfig:{},envInfo:{},ext:{},openSizeLog:!0,bitrateAdapter:{}}}init(e){i(Ue,"init",e);const t=this.options||{};Object.keys(e).forEach((n=>{t[n]=e[n]}));const n={...e.trackConfig};["referrer","channel","channel_domain"].forEach((t=>{void 0!==e[t]&&(n[t]=e[t])})),e.channelDomain&&(n.channel_domain=e.channelDomain),Fe&&Fe.config(n),this.initSessionId(),this.update(e)}update(e){C(e),this.vInfo.init(e);const{ext:t={},switchPlayerTime:n}=e;this.setExtData(t),n&&this.setSwitchTime(n),He.setExtData(e)}initSessionId(){if(this.sessionId)return;let e="0";try{e=function(e){if(!window.localStorage)return"";const t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch{return t}}(D).web_id||"0"}catch{e="0"}this.sessionId=function(e){let t="0";try{const n=window.localStorage.getItem(e)||"",r=JSON.parse(n);t=(null==r?void 0:r.web_id)||"0"}catch{t="0"}return function(e){let t=(new Date).getTime(),n=0;try{n=parseInt(e)}catch{n=0}return t+=n,window.performance&&"function"==typeof window.performance.now&&(t+=window.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)}))}(t)}(e),i(Ue,`sessionId webId:${e} ${this.sessionId}`)}attachPlayer(e){e!==this.player&&(this.detachPlayer(this.player),this.player=e,this.player.version&&(x.pv=this.player.version),this._bindEvt(e));const t=null==e?void 0:e.preloader;t&&He.attach(t);const n=(null==e?void 0:e.version)||"";x.pv=n}detachPlayer(e){this.player&&e===this.player&&(this._unBindEvt(),this.player=null)}resetConfig(e){i(Ue,"reset",e)}reset(e,t=!1){super.reset(e,t),this.isSendOnePlay=!1}destroy(){const{operate:e,playPerf:t,playMDL:n,wait:r,error:s,player:a}=this;i(Ue,"destroy",this.sessionId);const o="log_destroy";t.setExit("log_destroy",a),t.updateAcc(o),n.breakPlaybackData(o,a),this._trackOnePlay(o),e.reset(),t.reset(!1),r.reset(),s.reset(),n.reset(),this.detachPlayer(this.player)}getTokenFromTracker(){return Fe?Fe.getToken():{}}_bindEvt(e){e&&(J(this.sessionId,te,this._onVisibilityChange),J(this.sessionId,ee,this._onPageUnload),function(e,t){q(e,t,1)}(e,this))}_unBindEvt(){const{player:e}=this;e&&(function(e,t){q(e,t,2)}(e,this),Z(this.sessionId,te),Z(this.sessionId,ee))}_suspendStateCallback(e,t){if(e&&t)switch(i(Ue,"_suspendStateCallback",e,t),e){case O:this._trackOneEvent("wait",t);break;case L:this._trackOneOpera(t);break;case A:this._trackMdlVideoSize(t)}}_trackOnePlay(e,t){const{playPerf:n}=this;if(this.isSendOnePlay||!n.playTime)return void i(Ue,`_trackOnePlay_${e} isSendOnePlay:${this.isSendOnePlay} pt:${n.playTime} isActive:${n.isActive}`);this.timeline.add("leave");const r=function(e,t,n){const{vInfo:r,playPerf:i,playMDL:s,wait:a,operate:u,error:c,player:d,sessionId:f,extData:p,performanceNow:g,options:m,timeline:v}=e,{bitrateAdapter:_={},playerType:T="default"}=m,b=xe(f,r,i,d,T),{url:S,host:P,ip:w,bitrate:k}=i.initialUrl,{leave:M,exit:E,playTime:R,vvTime:x,newTime:D,volume:I,muted:C,playbackRate:L,bufferFinishTime:O,preloadData:A,br:G,resolution:B,startLoadTime:N,userFvt:$,width:U,height:F,switchPt:H,meta:V,startPlayInfo:j,autoplayStart:z}=i,{seekCount:X,sat:K,pauseLog:W}=u,{playedSize:Q,cdnSize:q,cdnVSize:Y,pcdnSize:J,pcdnVSize:Z}=s.accDatas,{firstWait:ee}=a,{errors:te}=c,ne=c.first,ie=i.getWatchDuration(),se=function(e){if(e&&e.pcdnVVStat){const t=e.pcdnVVStat;return{try_req:t.try_req_num,req_succ:t.req_node_succ,has_ret:t.has_ret_node,conn_ret:t.conn_ret_num,conn_fail:t.conn_fail_num,conn_jump:t.conn_jump_num}}return{}}(d),ae=function(e){return e&&e.performance||{}}(d),oe=function(e){const t=re(e),n={total:0,dropped:0,drop_rate:0};try{const e=null==t?void 0:t.getVideoPlaybackQuality();return n.dropped=(null==e?void 0:e.droppedVideoFrames)||0,n.total=(null==e?void 0:e.totalVideoFrames)||0,n.total>0&&(n.drop_rate=o(n.dropped/n.total*100)),n}catch{return n}}(d),{bitrateSet:le,bitrateSetHevc:ce}=r,he=function(e,t){return{h1:e.length,h2:t.length,set1:Se(e),set2:Se(t)}}(le,ce),de=k,fe=v.getDurations();return{...b,perf_time:g,prepare_start_time:0,prepare_end_time:0,initial_url:S||"",initial_host:P,initial_ip:w,isexpired:y(S),width:U,height:F,initial_resolution:i.initialUrl.resolution,nt:D,pt:R,vt:x,fvt:ue(R,x),svt:ue(N,x),nvt:x>0?x-D:R-D,user_fvt:$,switch_pt:H,player_created_t:D,lt:M.time,lpt:ae.lpt,et:E.time,lv_method:E.method,bft:O,volume:o(I.current,2),mute:C.current?1:0,play_speed:L.current,sc:X,sat:K,dbc:a.dbc,nbc:a.nbc,bc:a.dbc+a.nbc,bu_acu_t:a.dAcuTime+a.nAcuTime,de_bu_acu_t:a.dAcuTime,n_bu_acu_t:a.nAcuTime,pause_acu_t:W.acuTime,start_time:l(i.startPlayInfo.startPos||0),finish:i.ended||i.loopCount>0?1:0,lc:i.loopCount,watch_dur:ie,is_start_play_automatically:z,first_buf_startt:ee.start,first_buf_endt:ee.end,play_c:i.playCount,load_state:i.loadState,playback_state:i.playbackState,pcdn:h(se),pre_info:h(A),perf:h(ae),frame_info:h(oe),br:G.count,fbrt:G.time,df:B.current,lf:B.last,bitrate:de,errc:n?n.code:0,errt:n?n.type:0,vsc_message:n?n.message:"",fir_errc:ne?ne.code:0,fir_errt:ne?ne.type:0,accu_errc:c.count||0,merror:h(te),end_type:t,vps:Q,vds:q,pvds:J,vvds:Y,pvvds:Z,vplt:A.time,vpls:A.size,ext:h(p),bitset:h(he),meta:h(V),exit:h(E),start_info:h(j),rstate:i.renderState,pre_rstate:i.preRenderState,prepare_before_play_t:i.prepareBeforePlayTime,user_resolution:_.userResolution||"auto",quality_type:_.qualityType||0,selector:_.selector||"default",...j,...fe,timeline:h(fe)}}(this,e,t);i(Ue,`_trackOnePlay_${e}`,r,n.fvt,`vplt:${r.vplt} vpls: ${r.vpls}`),this.isSendOnePlay=!0,this.sendEvent("videoplayer_oneplay",r)}_trackOneEvent(e,t){const{closeEvents:n=[]}=this.options;if(n.includes(O))return;const r=function(e,t,n){const{vInfo:r,playPerf:i,operate:s,player:a,sessionId:o}=n,u=xe(o,r,i,a),{playbackRate:c,firstUpdateTime:h}=i,{latestSeek:d,latestSwitch:f}=s;return{...u,event_type:e,cost_time:t.costTime,end_type:t.endType,first_frame_interval:g(h,t.start),last_seek_interval:d?g(d.start,t.start):0,last_switch_interval:f?g(f.start,t.start):0,last_event_interval:t.interval,video_pos:l(t.pos),play_speed:c.current,st:t.start,et:t.end,rstate:i.renderState,pre_rstate:i.preRenderState,prepare_before_play_t:i.prepareBeforePlayTime}}(e,t,this);i(Ue,`_trackOneEvent_${e}`,t,r),this.sendEvent(O,r)}_trackOneOpera(e){const{closeEvents:t=[]}=this.options;if(t.includes(L))return;const n=e.op,r=function(e,t,n){const{vInfo:r,playPerf:i,player:s,sessionId:a}=n;return{...xe(a,r,i,s),opera_type:e,end_type:t.endType,state_before:t.stateBefore,state_after:t.stateAfter,cost_time:t.costTime,is_seek_in_buffer:t.inBuffer?1:0,last_interval:t.interval,video_pos:l(t.pos),cdn_url:"",cdn_ip:"",rstate:i.renderState,pre_rstate:i.preRenderState,prepare_before_play_t:i.prepareBeforePlayTime}}(n,e,this);i(Ue,`_trackOneOpera_${n}`,e,r),this.sendEvent(L,r)}_trackOneError(e,t){if(!t)return;const n=function(e,t,n=""){const{error:r,vInfo:i,playPerf:s,player:a,sessionId:o,extData:l}=t,{playerType:u="XG"}=t.options,c=xe(o,i,s,a,u),{resolution:d}=s.initialUrl,f=r.errorCodes;return{...c,errt:e.type,errc:e.code,err_msg:e.message,cdn_url:e.cdnUrl,cdn_host:e.cdnHost,cdn_ip:e.cdnIp,es:e.stage||"",isexpired:e.isExpired,resolution:_(d),end_type:n,last_errors:f,retry_count:r.retryCount,ext:h(l),rstate:s.renderState,pre_rstate:s.preRenderState,prepare_before_play_t:s.prepareBeforePlayTime}}(t,this,e);i(Ue,`_trackOneError_${e}`,t,n),this.sendEvent("videoplayer_oneerror",n)}_trackMdlVideoSize(e){const t=function(e,t){const{vInfo:n,playPerf:r,player:i,sessionId:s}=e;return{...xe(s,n,r,i),...t,rstate:r.renderState,pre_rstate:r.preRenderState,prepare_before_play_t:r.prepareBeforePlayTime}}(this,e);i(Ue,`_trackMdlVideoSize${e.end_type}`,t),this.sendEvent(A,t)}sendEvent(e,t){if(i(Ue,"sendEvent",`eventName:${e} extNAme:${B[e]}`),Fe&&Fe.event(e,t),Ve){const n=B[e];n&&Ve.event(n,function(e){const t={...e};try{return delete t.line_user_id,delete t.deviceScore,delete t.ua,delete t.absdkVersion,Object.keys(De).forEach((e=>{t[De[e]]=t[e],delete t[e]})),t}catch{return t}}(t))}}getFinalInfo(){var e,t;const{error:n,playPerf:r,vInfo:i,player:s}=this;return{vt:r.vvTime,pt:r.playTime,currentTime:s.currentTime,firstframeDuration:r.fvt,errorCode:(null==(e=n.latest)?void 0:e.code)||0,errorMessage:(null==(t=n.latest)?void 0:t.message)||"",isFinish:r.loopCount>0?1:0,codecType:i.codec_type,resolution:r.resolution.current,url:r.initialUrl.url}}}const ze="XGTracker",Xe="__xgplayer_vod_log__",Ke={appId:548444,_tt:{user_unique_id:""},_tracker:null,_options:{},init(e,t,n){var r,s,a;if((t.appId||t.app_id)&&(this.appId=t.appId||t.app_id),this._options=t,!M)return;i(ze,"init",this.appId,t);const o=window[Xe];!o&&e?(this._tracker=new e("xgplayer_tracker"),window[Xe]=this._tracker):this._tracker=o;const{channel:l,channel_domain:u}=t,c={app_id:this.appId,log:!1,disable_sdk_monitor:!0,enable_ab_test:!1,disable_auto_pv:!0,...t,channel:l||"cn",channel_domain:u};return null==(r=this._tracker)||r.init(c),null==(s=this._tracker)||s.getToken((e=>{this._tt=e})),this.config(n||{}),null==(a=this._tracker)||a.start(),this._tracker},config(e={}){const t={...e};E&&E.name&&!E.isChrome&&!E.isSafari&&(t.browser=E.name,E.appVersion&&(t.browser_version=E.appVersion));const n=e.user_unique_id||"";n&&(t.user_unique_id=n,t.web_id=n,t.device_id=n,t.user_id=e.user_id||n,this._tt={user_unique_id:n,user_id:e.user_id||n}),e.referrer&&(t.referrer=e.referrer,t.referrer_host=c(e.referrer)),this._tracker&&this._tracker.config(t)},getToken(){return this._tt},event(e,t){const{appId:n,_tracker:r,_tt:s}=Ke;i(ze,`sendEvent_${n}`,!r,e,t),r&&(t.line_user_id||(t.line_user_id=(null==s?void 0:s.user_unique_id)||""),"function"==typeof r?r(e,t):r.event(e,t))}};je.Tracker=Ke;const We=function(e){if(e&&e.player){const t=e.player.config.vodLogOpts||{};e.player.vodLogger=new je(t,e.player),e.player.plugins.xgVodLogger=e.player.vodLogger}else this.vodLogger=new je(this.config.vodLogOpts||{},this)};We.initTracker=function(e,t={}){Ke.init(e,t)},We.configTracker=function(e){Ke.config(e)},We.pluginName="__xgVodLogger",We.playerConfig={},We.setABSdkVersion=e=>{je.AB_SDK_VERSION=e}}}]);
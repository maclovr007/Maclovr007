"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[2301],{63363:(e,t,a)=>{a.d(t,{AF:()=>u,AP:()=>v,CA:()=>_,a8:()=>g,hA:()=>h,uJ:()=>p});var r=a(41271),s=a(47172),o=a(95868),n=a(60484),i=a(71281),d=a(49057),c=a(50970);const l="abTestVersion",h=()=>{var e;const{abTestVersion:t}=(0,n.L$)((0,d.W)((()=>[l]),[])),a=null!==(e=(0,i.qt)(t,"search_bar_style_opt"))&&void 0!==e?e:"v1",r="v2"===a,s="v3"===a;return{isSearchBarStyleV1:"v1"===a,isSearchBarStyleV2:r,isSearchBarStyleV3:s,withNewStyle:r||s}},_=()=>{var e;const{pathname:t}=(0,s.useLocation)(),{abTestVersion:a}=(0,n.L$)((0,d.W)((()=>[l]),[])),r=null!==(e=(0,i.qt)(a,"search_remove_related_search"))&&void 0!==e?e:"v0";return{hasRelatedSearch:"v0"===r||(0,o.ie)(t),hasSugReport:!0,isNewSearchLayout:"v0"!==r}},u=()=>{var e;const{abTestVersion:t}=(0,n.L$)((0,d.W)((()=>[l]),[]));return"v2"===(null!==(e=(0,i.qt)(t,"search_keep_sug_show"))&&void 0!==e?e:"v1")};function p(){var e;const{abTestVersion:t}=(0,n.L$)((0,d.W)((()=>[l]),[])),a=null!==(e=(0,i.qt)(t,"search_add_non_personalized_switch"))&&void 0!==e?e:"v1",{user:s}=(0,r.P)(c.L,{selector:e=>{var t;return{user:null===(t=e.appContext)||void 0===t?void 0:t.user}},dependencies:[]}),o=Boolean(s);return{hasPersonalizedSwitch:"v2"===a&&o}}function g(){var e;const{abTestVersion:t}=(0,n.L$)((0,d.W)((()=>[l]),[]));return{shouldRecomReduceIconRisk:"v1"===(null!==(e=(0,i.qt)(t,"should_recom_reduce_icon_risk"))&&void 0!==e?e:"v0")}}function v(){var e;const{abTestVersion:t}=(0,n.L$)((0,d.W)((()=>[l]),[]));return{notificationShouldBeClickable:"v1"===(null!==(e=(0,i.qt)(t,"webapp_moderation"))&&void 0!==e?e:"v0")}}},44900:(e,t,a)=>{a.d(t,{O:()=>P});var r=a(58632),s=a(64162),o=a(4126),n=a(93995),i=a(23999),d=a(76435),c=a(26324),l=a(24451),h=a(62564),_=a(72916),u=a(95719),p=a(8536),g=a(74690),v=a(65365),m=a(93608),S=a(7672),y=a(55099);let b=class{constructor(e){this.fetch=e}getRelatedSearch(e){return this.fetch.get("/api/search/suggest/guide/",{query:e,baseUrlType:2})}};b=(0,r.__decorate)([(0,S._)(),(0,r.__metadata)("design:paramtypes",[y.p])],b);var O=a(43271),w=a(45489);let P=class extends s.E{constructor(e,t,a){super(),this.service=e,this.search=t,this.personalization=a,this.defaultState={general:{},video:{},user:{},live:{}}}setGeneralState(e,t){e.general=t}setUserState(e,t){e.user=t}setVideoState(e,t){e.video=t}setLiveState(e,t){e.live=t}setGeneralStateShowRSPanel(e,t){e.general=Object.assign(Object.assign({},e.general),{showRSPanel:t})}setUserStateShowRSPanel(e,t){e.user=Object.assign(Object.assign({},e.user),{showRSPanel:t})}setVideoStateShowRSPanel(e,t){e.video=Object.assign(Object.assign({},e.video),{showRSPanel:t})}setLiveStateShowRSPanel(e,t){e.live=Object.assign(Object.assign({},e.live),{showRSPanel:t})}getTopRSData(e){return e.pipe((0,l.E)(this.search.state$,this.personalization.state$),(0,h.T)((([e,{searchGlobalParams:t},{isSearchPersonalized:a}])=>({payload:e,rootEnterFrom:null==t?void 0:t.rootEnterFrom,nonPersonalized:a?void 0:1}))),(0,_.n)((({payload:e,rootEnterFrom:t,nonPersonalized:a})=>this.service.getRelatedSearch(Object.assign(Object.assign({},e),{is_non_personalized_search:a})).pipe((0,h.T)((e=>this.handleRequestData(e))),(0,u.M)((({data:e,log_id:a})=>{this.reportTrendingShow(e,a,t,"general_search")})),(0,p.Z)((e=>{const t=Object.assign(Object.assign({},e),{showRSPanel:!1});return(0,i.of)(this.getActions().setGeneralState(t))})),(0,g.Z)(this.getActions().setGeneralState({})),(0,d.Q)(this.getAction$().dispose)))))}getVideoRSData(e){return e.pipe((0,l.E)(this.search.state$,this.personalization.state$),(0,h.T)((([e,{searchGlobalParams:t},{isSearchPersonalized:a}])=>({payload:e,rootEnterFrom:null==t?void 0:t.rootEnterFrom,nonPersonalized:a?void 0:1}))),(0,_.n)((({payload:e,rootEnterFrom:t,nonPersonalized:a})=>this.service.getRelatedSearch(Object.assign(Object.assign({},e),{is_non_personalized_search:a})).pipe((0,h.T)((e=>this.handleRequestData(e))),(0,u.M)((({data:e,log_id:a})=>{this.reportTrendingShow(e,a,t,"search_video")})),(0,p.Z)((e=>{const t=Object.assign(Object.assign({},e),{showRSPanel:!1});return(0,i.of)(this.getActions().setVideoState(t))})),(0,g.Z)(this.getActions().setVideoState({})),(0,d.Q)(this.getAction$().dispose)))))}getUserRSData(e){return e.pipe((0,l.E)(this.search.state$,this.personalization.state$),(0,h.T)((([e,{searchGlobalParams:t},{isSearchPersonalized:a}])=>({payload:e,rootEnterFrom:null==t?void 0:t.rootEnterFrom,nonPersonalized:a?void 0:1}))),(0,_.n)((({payload:e,rootEnterFrom:t,nonPersonalized:a})=>this.service.getRelatedSearch(Object.assign(Object.assign({},e),{is_non_personalized_search:a})).pipe((0,h.T)((e=>this.handleRequestData(e))),(0,u.M)((({data:e,log_id:a})=>{this.reportTrendingShow(e,a,t,"search_user")})),(0,p.Z)((e=>{const t=Object.assign(Object.assign({},e),{showRSPanel:!1});return(0,i.of)(this.getActions().setUserState(t))})),(0,g.Z)(this.getActions().setUserState({})),(0,d.Q)(this.getAction$().dispose)))))}getLiveRSData(e){return e.pipe((0,l.E)(this.search.state$,this.personalization.state$),(0,h.T)((([e,{searchGlobalParams:t},{isSearchPersonalized:a}])=>({payload:e,rootEnterFrom:null==t?void 0:t.rootEnterFrom,nonPersonalized:a?void 0:1}))),(0,_.n)((({payload:e,rootEnterFrom:t,nonPersonalized:a})=>this.service.getRelatedSearch(Object.assign(Object.assign({},e),{is_non_personalized_search:a})).pipe((0,h.T)((e=>this.handleRequestData(e))),(0,u.M)((({data:e,log_id:a})=>{this.reportTrendingShow(e,a,t,"search_live")})),(0,p.Z)((e=>{const t=Object.assign(Object.assign({},e),{showRSPanel:!1});return(0,i.of)(this.getActions().setLiveState(t))})),(0,g.Z)(this.getActions().setLiveState({})),(0,d.Q)(this.getAction$().dispose)))))}handleRequestData(e){const{status_code:t,data:a=[],log_id:r}=e;let s=[];return 0===t&&(null==a?void 0:a.length)&&(s=a.map((e=>Object.assign(Object.assign({},e),{impr_id:r})))),Object.assign(Object.assign({},e),{data:null!=s?s:[]})}reportTrendingShow(e,t,a,r){if(e&&e.length>=10){const s={enter_from:a,words_source:"related_search",search_position:m.f.commonParams.page_name,page_name:r};v.$G.handleTrendingShow(Object.assign({words_num:e.length,impr_id:null!=t?t:"",raw_query:""},s)),e.forEach(((e,a)=>{var r,o;return v.$G.handleTrendingWordsShow(Object.assign({words_position:a,words_content:null!==(r=null==e?void 0:e.word)&&void 0!==r?r:"",group_id:null!==(o=null==e?void 0:e.group_id)&&void 0!==o?o:"",impr_id:null!=t?t:""},s))}))}}};(0,r.__decorate)([(0,o.uk)(),(0,r.__metadata)("design:type",c.c)],P.prototype,"dispose",void 0),(0,r.__decorate)([(0,o.h5)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Object]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"setGeneralState",null),(0,r.__decorate)([(0,o.h5)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Object]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"setUserState",null),(0,r.__decorate)([(0,o.h5)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Object]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"setVideoState",null),(0,r.__decorate)([(0,o.h5)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Object]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"setLiveState",null),(0,r.__decorate)([(0,o.h5)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Boolean]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"setGeneralStateShowRSPanel",null),(0,r.__decorate)([(0,o.h5)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Boolean]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"setUserStateShowRSPanel",null),(0,r.__decorate)([(0,o.h5)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Boolean]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"setVideoStateShowRSPanel",null),(0,r.__decorate)([(0,o.h5)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Object,Boolean]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"setLiveStateShowRSPanel",null),(0,r.__decorate)([(0,o.Mj)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[c.c]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"getTopRSData",null),(0,r.__decorate)([(0,o.Mj)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[c.c]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"getVideoRSData",null),(0,r.__decorate)([(0,o.Mj)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[c.c]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"getUserRSData",null),(0,r.__decorate)([(0,o.Mj)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[c.c]),(0,r.__metadata)("design:returntype",void 0)],P.prototype,"getLiveRSData",null),P=(0,r.__decorate)([(0,n.n)("RelatedSearch"),(0,r.__metadata)("design:paramtypes",[b,O.tq,w.fu])],P)},2301:(e,t,a)=>{a.d(t,{Ae:()=>k,DQ:()=>f,Y6:()=>L,gc:()=>j,nY:()=>R,u5:()=>P});var r=a(46682),s=a(41271),o=a(48292),n=a.n(o),i=a(4474),d=a(40099),c=a(47172),l=a(82715),h=a(65365),_=a(63363),u=a(93341),p=a(71281),g=a(49057),v=a(48615),m=a(87303),S=a(60144),y=a(44900),b=a(79983),O=a(43271),w=a(45489);function P(){var e;const{search:t,state:a}=(0,c.useLocation)(),{enterMethod:r,searchSource:s,enterFrom:o,fromSearchSubTab:n,imprId:d,blankpageEnterFrom:l,blankpageEnterMethod:h,videoPageType:_,preClickId:u}=null!=a?a:{},{q:p}=(0,i.parse)(t);return{enterMethod:r,searchSource:s,enterFrom:o,keyword:null!==(e=Array.isArray(p)?p.toString():p)&&void 0!==e?e:"",fromSearchSubTab:n,imprId:d,blankpageEnterFrom:l,blankpageEnterMethod:h,videoPageType:_,preClickId:u}}function j(e){var t,a;const{keyword:s,enterMethod:o,searchSource:n,enterFrom:i,fromSearchSubTab:h,imprId:_,blankpageEnterFrom:u,blankpageEnterMethod:p,videoPageType:y,preClickId:w}=P(),{user:j,language:R="en",abTestVersion:F}=null!==(t=(0,g.W)((()=>["user","language","abTestVersion"]),[]))&&void 0!==t?t:{},{searchVideoForLoggedin:k,searchLiveForLoggedin:f}=null!==(a=(0,v.U)((()=>["searchVideoForLoggedin","searchLiveForLoggedin"]),[]))&&void 0!==a?a:{},T=(0,c.useLocation)(),{streamDeviceType:E}=(0,S.A)(),{pathname:V}=T,D=Boolean(j),[{state:A,rootEnterFrom:z},q]=(0,r.S)(O.tq,{dependencies:[],selector:t=>{var a;return{state:null!==(a=t[e])&&void 0!==a?a:{},rootEnterFrom:t.searchGlobalParams.rootEnterFrom}}}),$=(0,r.w)(b.O),G=(0,r.w)(m.F),Z=V===l.OZ.searchUser,U=L();return(0,d.useCallback)(((t=!0,a=!1)=>{const r=s!==(null==A?void 0:A.keyword)||t,d=s!==(null==A?void 0:A.keyword)||a,c=!k||D,g=!f||D,v={search_source:null!=n?n:"search_outer",search_type:e,enter_method:o,from_search_subtab:h,enter_from:null!=i?i:z,pre_click_id:null!=_?_:w,pre_recom_show_id:_,blankpage_enter_from:u,blankpage_enter_method:p,video_page_type:y};switch(e){case"general":V===l.OZ.searchHome&&r&&c&&(d&&(q.setSearchResult({key:"general",result:O.I4}),$.resetItemList({key:"search_top",loading:!0})),q.getTopSearch({keyword:s,teaParams:v,user:j,language:R,abTestVersion:F,hasSearchLive:U,search_source:n,device_type:E}));break;case"user":Z&&r&&(d&&q.setSearchResult({key:"user",result:O.Fy}),q.getUserSearch({keyword:s,teaParams:v,user:j,language:R,abTestVersion:F}));break;case"video":V===l.OZ.searchVideo&&r&&c&&(d&&(q.setSearchResult({key:"video",result:O.Fy}),$.resetItemList({key:"search_video",loading:!0})),q.getVideoSearch({keyword:s,teaParams:v,user:j,language:R,abTestVersion:F}));break;case"live":V===l.OZ.searchLive&&r&&g&&(d&&(q.setSearchResult({key:"live",result:O.Fy}),G.resetLiveList({key:"search_live",loading:!0})),q.getLiveSearch({keyword:s,teaParams:v,user:j,language:R,abTestVersion:F,device_type:E}))}}),[E,s,null==A?void 0:A.keyword,k,D,o,n,e,V,Z,q,j,R,F,$,U,G,f,h,z,_,u,p,w,y])}function R(e,t=!0){const{keyword:a}=P(),s=(0,c.useLocation)(),o=(0,c.useHistory)(),{state:n,pathname:i}=s,h=Boolean((0,c.matchPath)(i,{path:l.OZ.searchHome})),{hasRelatedSearch:u}=(0,_.CA)(),[p,g]=(0,r.S)(O.tq,{dependencies:[],selector:t=>{var a;return null!==(a=t[e])&&void 0!==a?a:{}}}),[,v]=(0,r.S)(y.O,{dependencies:[],selector:e=>e}),[m]=(0,r.S)(w.fu,{dependencies:[],selector:e=>({personalized:e.isSearchPersonalized})}),S=j(e);return(0,d.useEffect)((()=>{var r,i,d,c,l;if(!h)return;const _=Boolean(p.data)?!p.error&&0===(null===(i=null===(r=p.data)||void 0===r?void 0:r.videoList)||void 0===i?void 0:i.length)&&0===(null===(c=null===(d=p.data)||void 0===d?void 0:d.otherDataList)||void 0===c?void 0:c.length):0===(null===(l=null==p?void 0:p.items)||void 0===l?void 0:l.length),m=a!==p.keyword||_;if(t&&o.replace(Object.assign(Object.assign({},s),{state:Object.assign({},n)})),S(m),m&&u){const t={req_source:"related_search",search_source:e,keyword:a};switch(e){case"general":v.getTopRSData(t);break;case"user":v.getUserRSData(t);break;case"video":v.getVideoRSData(t);break;case"live":v.getLiveRSData(t)}}return()=>{g.dispose(),v.dispose()}}),[a,u,e,v,m]),Object.assign(Object.assign({},p),{keyword:a,handleSearch:S})}const F={general:l.OZ.searchHome,user:l.OZ.searchUser,video:l.OZ.searchVideo,live:l.OZ.searchLive};function k(e,t){const a=(0,d.useRef)(0),r=(0,c.useHistory)(),o=(0,c.useLocation)(),{keyword:i,enterMethod:l}=P(),{searchGlobalParams:_}=(0,s.P)(O.tq,{dependencies:[],selector:e=>({searchGlobalParams:e.searchGlobalParams})}),p=(0,u.GF)(),{pathname:g}=o;(0,d.useEffect)((()=>{if((0,c.matchPath)(g,{path:F[t]}))return a.current||(a.current=Date.now()),r.listen((({pathname:r})=>{var s;const o=Date.now()-a.current,d=null===(s=n()(F))||void 0===s?void 0:s[r];h.$G.handleSearchSessionFinish({duration:o,impr_id:e,search_id:e,search_type:t,search_keyword:i,enter_method:l,enter_from:_.rootEnterFrom,group_id:p,next_tab:d})}))}),[e,t,_,p,l])}function L(){var e,t;const{abTestVersion:a,user:r}=null!==(e=(0,g.W)((()=>["abTestVersion","user"]),[]))&&void 0!==e?e:{};return"v2"===(0,p.qt)(a,"search_add_live")&&(null===(t=null==r?void 0:r.hasSearchLivePermission)||void 0===t||t)}function f(e){const[,t]=(0,r.S)(O.tq,{selector:e=>({rootEnterFrom:e.searchGlobalParams.rootEnterFrom}),dependencies:[]});(0,d.useEffect)((()=>{t.setSearchGlobalParams({rootEnterFrom:e})}),[t,e])}}}]);